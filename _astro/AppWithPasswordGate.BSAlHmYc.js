import{j as o}from"./jsx-runtime.D_zvdyIk.js";import{r as k,g as Vv,R as ym,a as Uv}from"./index.D8BznOQS.js";import{r as $v}from"./index.DHFBN-Xi.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hv=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Wv=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,n)=>n?n.toUpperCase():r.toLowerCase()),Bd=t=>{const e=Wv(t);return e.charAt(0).toUpperCase()+e.slice(1)},_m=(...t)=>t.filter((e,r,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===r).join(" ").trim(),qv=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Gv={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zv=k.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:s="",children:a,iconNode:i,...l},c)=>k.createElement("svg",{ref:c,...Gv,width:e,height:e,stroke:t,strokeWidth:n?Number(r)*24/Number(e):r,className:_m("lucide",s),...!a&&!qv(l)&&{"aria-hidden":"true"},...l},[...i.map(([u,h])=>k.createElement(u,h)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=(t,e)=>{const r=k.forwardRef(({className:n,...s},a)=>k.createElement(zv,{ref:a,iconNode:e,className:_m(`lucide-${Hv(Bd(t))}`,`lucide-${t}`,n),...s}));return r.displayName=Bd(t),r};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yv=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],Kv=ht("building-2",Yv);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xv=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],Qv=ht("calculator",Xv);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jv=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Zv=ht("calendar",Jv);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ey=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],kl=ht("chevron-down",ey);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ty=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ry=ht("chevron-left",ty);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ny=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ol=ht("chevron-up",ny);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sy=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ay=ht("clock",sy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iy=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],oy=ht("dollar-sign",iy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ly=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],da=ht("download",ly);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cy=[["path",{d:"M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5",key:"1couwa"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1y4qbx"}]],uy=ht("file-pen",cy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hy=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Vd=ht("file-text",hy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dy=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]],fy=ht("git-merge",dy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const my=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],py=ht("house",my);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gy=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],wm=ht("info",gy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xy=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],vy=ht("lock-open",xy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yy=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],bm=ht("lock",yy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _y=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Em=ht("plus",_y);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wy=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],eu=ht("printer",wy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const by=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ey=ht("refresh-cw",by);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ty=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Ay=ht("save",Ty);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sy=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ny=ht("settings",Sy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cy=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Iy=ht("star",Cy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Py=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Tm=ht("triangle-alert",Py);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ry=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],$o=ht("upload",Ry);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dy=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],_a=ht("users",Dy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fy=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],jy=ht("wallet",Fy);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ky=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Br=ht("x",ky);function wn(t,e,{checkForDefaultPrevented:r=!0}={}){return function(s){if(t?.(s),r===!1||!s.defaultPrevented)return e?.(s)}}function Ud(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Am(...t){return e=>{let r=!1;const n=t.map(s=>{const a=Ud(s,e);return!r&&typeof a=="function"&&(r=!0),a});if(r)return()=>{for(let s=0;s<n.length;s++){const a=n[s];typeof a=="function"?a():Ud(t[s],null)}}}}function Us(...t){return k.useCallback(Am(...t),t)}function Sm(t,e=[]){let r=[];function n(a,i){const l=k.createContext(i),c=r.length;r=[...r,i];const u=f=>{const{scope:m,children:p,...x}=f,g=m?.[t]?.[c]||l,y=k.useMemo(()=>x,Object.values(x));return o.jsx(g.Provider,{value:y,children:p})};u.displayName=a+"Provider";function h(f,m){const p=m?.[t]?.[c]||l,x=k.useContext(p);if(x)return x;if(i!==void 0)return i;throw new Error(`\`${f}\` must be used within \`${a}\``)}return[u,h]}const s=()=>{const a=r.map(i=>k.createContext(i));return function(l){const c=l?.[t]||a;return k.useMemo(()=>({[`__scope${t}`]:{...l,[t]:c}}),[l,c])}};return s.scopeName=t,[n,Oy(s,...e)]}function Oy(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(a){const i=n.reduce((l,{useScope:c,scopeName:u})=>{const f=c(a)[`__scope${u}`];return{...l,...f}},{});return k.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return r.scopeName=e.scopeName,r}var Bu=$v();const My=Vv(Bu);function Ly(t){const e=By(t),r=k.forwardRef((n,s)=>{const{children:a,...i}=n,l=k.Children.toArray(a),c=l.find(Uy);if(c){const u=c.props.children,h=l.map(f=>f===c?k.Children.count(u)>1?k.Children.only(null):k.isValidElement(u)?u.props.children:null:f);return o.jsx(e,{...i,ref:s,children:k.isValidElement(u)?k.cloneElement(u,void 0,h):null})}return o.jsx(e,{...i,ref:s,children:a})});return r.displayName=`${t}.Slot`,r}function By(t){const e=k.forwardRef((r,n)=>{const{children:s,...a}=r;if(k.isValidElement(s)){const i=Hy(s),l=$y(a,s.props);return s.type!==k.Fragment&&(l.ref=n?Am(n,i):i),k.cloneElement(s,l)}return k.Children.count(s)>1?k.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Nm=Symbol("radix.slottable");function Vy(t){const e=({children:r})=>o.jsx(o.Fragment,{children:r});return e.displayName=`${t}.Slottable`,e.__radixId=Nm,e}function Uy(t){return k.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Nm}function $y(t,e){const r={...e};for(const n in e){const s=t[n],a=e[n];/^on[A-Z]/.test(n)?s&&a?r[n]=(...l)=>{const c=a(...l);return s(...l),c}:s&&(r[n]=s):n==="style"?r[n]={...s,...a}:n==="className"&&(r[n]=[s,a].filter(Boolean).join(" "))}return{...t,...r}}function Hy(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var Wy=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],fs=Wy.reduce((t,e)=>{const r=Ly(`Primitive.${e}`),n=k.forwardRef((s,a)=>{const{asChild:i,...l}=s,c=i?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),o.jsx(c,{...l,ref:a})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function qy(t,e){t&&Bu.flushSync(()=>t.dispatchEvent(e))}function Ml(t){const e=k.useRef(t);return k.useEffect(()=>{e.current=t}),k.useMemo(()=>(...r)=>e.current?.(...r),[])}function Gy(t,e=globalThis?.document){const r=Ml(t);k.useEffect(()=>{const n=s=>{s.key==="Escape"&&r(s)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[r,e])}var zy="DismissableLayer",tu="dismissableLayer.update",Yy="dismissableLayer.pointerDownOutside",Ky="dismissableLayer.focusOutside",$d,Cm=k.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Im=k.forwardRef((t,e)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:a,onInteractOutside:i,onDismiss:l,...c}=t,u=k.useContext(Cm),[h,f]=k.useState(null),m=h?.ownerDocument??globalThis?.document,[,p]=k.useState({}),x=Us(e,w=>f(w)),g=Array.from(u.layers),[y]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),I=g.indexOf(y),P=h?g.indexOf(h):-1,A=u.layersWithOutsidePointerEventsDisabled.size>0,D=P>=I,V=Jy(w=>{const E=w.target,_=[...u.branches].some(N=>N.contains(E));!D||_||(s?.(w),i?.(w),w.defaultPrevented||l?.())},m),H=Zy(w=>{const E=w.target;[...u.branches].some(N=>N.contains(E))||(a?.(w),i?.(w),w.defaultPrevented||l?.())},m);return Gy(w=>{P===u.layers.size-1&&(n?.(w),!w.defaultPrevented&&l&&(w.preventDefault(),l()))},m),k.useEffect(()=>{if(h)return r&&(u.layersWithOutsidePointerEventsDisabled.size===0&&($d=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(h)),u.layers.add(h),Hd(),()=>{r&&u.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=$d)}},[h,m,r,u]),k.useEffect(()=>()=>{h&&(u.layers.delete(h),u.layersWithOutsidePointerEventsDisabled.delete(h),Hd())},[h,u]),k.useEffect(()=>{const w=()=>p({});return document.addEventListener(tu,w),()=>document.removeEventListener(tu,w)},[]),o.jsx(fs.div,{...c,ref:x,style:{pointerEvents:A?D?"auto":"none":void 0,...t.style},onFocusCapture:wn(t.onFocusCapture,H.onFocusCapture),onBlurCapture:wn(t.onBlurCapture,H.onBlurCapture),onPointerDownCapture:wn(t.onPointerDownCapture,V.onPointerDownCapture)})});Im.displayName=zy;var Xy="DismissableLayerBranch",Qy=k.forwardRef((t,e)=>{const r=k.useContext(Cm),n=k.useRef(null),s=Us(e,n);return k.useEffect(()=>{const a=n.current;if(a)return r.branches.add(a),()=>{r.branches.delete(a)}},[r.branches]),o.jsx(fs.div,{...t,ref:s})});Qy.displayName=Xy;function Jy(t,e=globalThis?.document){const r=Ml(t),n=k.useRef(!1),s=k.useRef(()=>{});return k.useEffect(()=>{const a=l=>{if(l.target&&!n.current){let c=function(){Pm(Yy,r,u,{discrete:!0})};const u={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=c,e.addEventListener("click",s.current,{once:!0})):c()}else e.removeEventListener("click",s.current);n.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",a),e.removeEventListener("click",s.current)}},[e,r]),{onPointerDownCapture:()=>n.current=!0}}function Zy(t,e=globalThis?.document){const r=Ml(t),n=k.useRef(!1);return k.useEffect(()=>{const s=a=>{a.target&&!n.current&&Pm(Ky,r,{originalEvent:a},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function Hd(){const t=new CustomEvent(tu);document.dispatchEvent(t)}function Pm(t,e,r,{discrete:n}){const s=r.originalEvent.target,a=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});e&&s.addEventListener(t,e,{once:!0}),n?qy(s,a):s.dispatchEvent(a)}var es=globalThis?.document?k.useLayoutEffect:()=>{},e_=ym[" useId ".trim().toString()]||(()=>{}),t_=0;function r_(t){const[e,r]=k.useState(e_());return es(()=>{r(n=>n??String(t_++))},[t]),e?`radix-${e}`:""}const n_=["top","right","bottom","left"],ts=Math.min,Cr=Math.max,Jo=Math.round,wo=Math.floor,cn=t=>({x:t,y:t}),s_={left:"right",right:"left",bottom:"top",top:"bottom"},a_={start:"end",end:"start"};function ru(t,e,r){return Cr(t,ts(e,r))}function Nn(t,e){return typeof t=="function"?t(e):t}function Cn(t){return t.split("-")[0]}function Pa(t){return t.split("-")[1]}function Vu(t){return t==="x"?"y":"x"}function Uu(t){return t==="y"?"height":"width"}const i_=new Set(["top","bottom"]);function on(t){return i_.has(Cn(t))?"y":"x"}function $u(t){return Vu(on(t))}function o_(t,e,r){r===void 0&&(r=!1);const n=Pa(t),s=$u(t),a=Uu(s);let i=s==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[a]>e.floating[a]&&(i=Zo(i)),[i,Zo(i)]}function l_(t){const e=Zo(t);return[nu(t),e,nu(e)]}function nu(t){return t.replace(/start|end/g,e=>a_[e])}const Wd=["left","right"],qd=["right","left"],c_=["top","bottom"],u_=["bottom","top"];function h_(t,e,r){switch(t){case"top":case"bottom":return r?e?qd:Wd:e?Wd:qd;case"left":case"right":return e?c_:u_;default:return[]}}function d_(t,e,r,n){const s=Pa(t);let a=h_(Cn(t),r==="start",n);return s&&(a=a.map(i=>i+"-"+s),e&&(a=a.concat(a.map(nu)))),a}function Zo(t){return t.replace(/left|right|bottom|top/g,e=>s_[e])}function f_(t){return{top:0,right:0,bottom:0,left:0,...t}}function Rm(t){return typeof t!="number"?f_(t):{top:t,right:t,bottom:t,left:t}}function el(t){const{x:e,y:r,width:n,height:s}=t;return{width:n,height:s,top:r,left:e,right:e+n,bottom:r+s,x:e,y:r}}function Gd(t,e,r){let{reference:n,floating:s}=t;const a=on(e),i=$u(e),l=Uu(i),c=Cn(e),u=a==="y",h=n.x+n.width/2-s.width/2,f=n.y+n.height/2-s.height/2,m=n[l]/2-s[l]/2;let p;switch(c){case"top":p={x:h,y:n.y-s.height};break;case"bottom":p={x:h,y:n.y+n.height};break;case"right":p={x:n.x+n.width,y:f};break;case"left":p={x:n.x-s.width,y:f};break;default:p={x:n.x,y:n.y}}switch(Pa(e)){case"start":p[i]-=m*(r&&u?-1:1);break;case"end":p[i]+=m*(r&&u?-1:1);break}return p}const m_=async(t,e,r)=>{const{placement:n="bottom",strategy:s="absolute",middleware:a=[],platform:i}=r,l=a.filter(Boolean),c=await(i.isRTL==null?void 0:i.isRTL(e));let u=await i.getElementRects({reference:t,floating:e,strategy:s}),{x:h,y:f}=Gd(u,n,c),m=n,p={},x=0;for(let g=0;g<l.length;g++){const{name:y,fn:I}=l[g],{x:P,y:A,data:D,reset:V}=await I({x:h,y:f,initialPlacement:n,placement:m,strategy:s,middlewareData:p,rects:u,platform:i,elements:{reference:t,floating:e}});h=P??h,f=A??f,p={...p,[y]:{...p[y],...D}},V&&x<=50&&(x++,typeof V=="object"&&(V.placement&&(m=V.placement),V.rects&&(u=V.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:s}):V.rects),{x:h,y:f}=Gd(u,m,c)),g=-1)}return{x:h,y:f,placement:m,strategy:s,middlewareData:p}};async function Ei(t,e){var r;e===void 0&&(e={});const{x:n,y:s,platform:a,rects:i,elements:l,strategy:c}=t,{boundary:u="clippingAncestors",rootBoundary:h="viewport",elementContext:f="floating",altBoundary:m=!1,padding:p=0}=Nn(e,t),x=Rm(p),y=l[m?f==="floating"?"reference":"floating":f],I=el(await a.getClippingRect({element:(r=await(a.isElement==null?void 0:a.isElement(y)))==null||r?y:y.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(l.floating)),boundary:u,rootBoundary:h,strategy:c})),P=f==="floating"?{x:n,y:s,width:i.floating.width,height:i.floating.height}:i.reference,A=await(a.getOffsetParent==null?void 0:a.getOffsetParent(l.floating)),D=await(a.isElement==null?void 0:a.isElement(A))?await(a.getScale==null?void 0:a.getScale(A))||{x:1,y:1}:{x:1,y:1},V=el(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:P,offsetParent:A,strategy:c}):P);return{top:(I.top-V.top+x.top)/D.y,bottom:(V.bottom-I.bottom+x.bottom)/D.y,left:(I.left-V.left+x.left)/D.x,right:(V.right-I.right+x.right)/D.x}}const p_=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:n,placement:s,rects:a,platform:i,elements:l,middlewareData:c}=e,{element:u,padding:h=0}=Nn(t,e)||{};if(u==null)return{};const f=Rm(h),m={x:r,y:n},p=$u(s),x=Uu(p),g=await i.getDimensions(u),y=p==="y",I=y?"top":"left",P=y?"bottom":"right",A=y?"clientHeight":"clientWidth",D=a.reference[x]+a.reference[p]-m[p]-a.floating[x],V=m[p]-a.reference[p],H=await(i.getOffsetParent==null?void 0:i.getOffsetParent(u));let w=H?H[A]:0;(!w||!await(i.isElement==null?void 0:i.isElement(H)))&&(w=l.floating[A]||a.floating[x]);const E=D/2-V/2,_=w/2-g[x]/2-1,N=ts(f[I],_),T=ts(f[P],_),R=N,S=w-g[x]-T,se=w/2-g[x]/2+E,te=ru(R,se,S),me=!c.arrow&&Pa(s)!=null&&se!==te&&a.reference[x]/2-(se<R?N:T)-g[x]/2<0,ce=me?se<R?se-R:se-S:0;return{[p]:m[p]+ce,data:{[p]:te,centerOffset:se-te-ce,...me&&{alignmentOffset:ce}},reset:me}}}),g_=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,n;const{placement:s,middlewareData:a,rects:i,initialPlacement:l,platform:c,elements:u}=e,{mainAxis:h=!0,crossAxis:f=!0,fallbackPlacements:m,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:x="none",flipAlignment:g=!0,...y}=Nn(t,e);if((r=a.arrow)!=null&&r.alignmentOffset)return{};const I=Cn(s),P=on(l),A=Cn(l)===l,D=await(c.isRTL==null?void 0:c.isRTL(u.floating)),V=m||(A||!g?[Zo(l)]:l_(l)),H=x!=="none";!m&&H&&V.push(...d_(l,g,x,D));const w=[l,...V],E=await Ei(e,y),_=[];let N=((n=a.flip)==null?void 0:n.overflows)||[];if(h&&_.push(E[I]),f){const se=o_(s,i,D);_.push(E[se[0]],E[se[1]])}if(N=[...N,{placement:s,overflows:_}],!_.every(se=>se<=0)){var T,R;const se=(((T=a.flip)==null?void 0:T.index)||0)+1,te=w[se];if(te&&(!(f==="alignment"?P!==on(te):!1)||N.every(le=>on(le.placement)===P?le.overflows[0]>0:!0)))return{data:{index:se,overflows:N},reset:{placement:te}};let me=(R=N.filter(ce=>ce.overflows[0]<=0).sort((ce,le)=>ce.overflows[1]-le.overflows[1])[0])==null?void 0:R.placement;if(!me)switch(p){case"bestFit":{var S;const ce=(S=N.filter(le=>{if(H){const Ae=on(le.placement);return Ae===P||Ae==="y"}return!0}).map(le=>[le.placement,le.overflows.filter(Ae=>Ae>0).reduce((Ae,Oe)=>Ae+Oe,0)]).sort((le,Ae)=>le[1]-Ae[1])[0])==null?void 0:S[0];ce&&(me=ce);break}case"initialPlacement":me=l;break}if(s!==me)return{reset:{placement:me}}}return{}}}};function zd(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function Yd(t){return n_.some(e=>t[e]>=0)}const x_=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:n="referenceHidden",...s}=Nn(t,e);switch(n){case"referenceHidden":{const a=await Ei(e,{...s,elementContext:"reference"}),i=zd(a,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:Yd(i)}}}case"escaped":{const a=await Ei(e,{...s,altBoundary:!0}),i=zd(a,r.floating);return{data:{escapedOffsets:i,escaped:Yd(i)}}}default:return{}}}}},Dm=new Set(["left","top"]);async function v_(t,e){const{placement:r,platform:n,elements:s}=t,a=await(n.isRTL==null?void 0:n.isRTL(s.floating)),i=Cn(r),l=Pa(r),c=on(r)==="y",u=Dm.has(i)?-1:1,h=a&&c?-1:1,f=Nn(e,t);let{mainAxis:m,crossAxis:p,alignmentAxis:x}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return l&&typeof x=="number"&&(p=l==="end"?x*-1:x),c?{x:p*h,y:m*u}:{x:m*u,y:p*h}}const y_=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,n;const{x:s,y:a,placement:i,middlewareData:l}=e,c=await v_(e,t);return i===((r=l.offset)==null?void 0:r.placement)&&(n=l.arrow)!=null&&n.alignmentOffset?{}:{x:s+c.x,y:a+c.y,data:{...c,placement:i}}}}},__=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:n,placement:s}=e,{mainAxis:a=!0,crossAxis:i=!1,limiter:l={fn:y=>{let{x:I,y:P}=y;return{x:I,y:P}}},...c}=Nn(t,e),u={x:r,y:n},h=await Ei(e,c),f=on(Cn(s)),m=Vu(f);let p=u[m],x=u[f];if(a){const y=m==="y"?"top":"left",I=m==="y"?"bottom":"right",P=p+h[y],A=p-h[I];p=ru(P,p,A)}if(i){const y=f==="y"?"top":"left",I=f==="y"?"bottom":"right",P=x+h[y],A=x-h[I];x=ru(P,x,A)}const g=l.fn({...e,[m]:p,[f]:x});return{...g,data:{x:g.x-r,y:g.y-n,enabled:{[m]:a,[f]:i}}}}}},w_=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:n,placement:s,rects:a,middlewareData:i}=e,{offset:l=0,mainAxis:c=!0,crossAxis:u=!0}=Nn(t,e),h={x:r,y:n},f=on(s),m=Vu(f);let p=h[m],x=h[f];const g=Nn(l,e),y=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(c){const A=m==="y"?"height":"width",D=a.reference[m]-a.floating[A]+y.mainAxis,V=a.reference[m]+a.reference[A]-y.mainAxis;p<D?p=D:p>V&&(p=V)}if(u){var I,P;const A=m==="y"?"width":"height",D=Dm.has(Cn(s)),V=a.reference[f]-a.floating[A]+(D&&((I=i.offset)==null?void 0:I[f])||0)+(D?0:y.crossAxis),H=a.reference[f]+a.reference[A]+(D?0:((P=i.offset)==null?void 0:P[f])||0)-(D?y.crossAxis:0);x<V?x=V:x>H&&(x=H)}return{[m]:p,[f]:x}}}},b_=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var r,n;const{placement:s,rects:a,platform:i,elements:l}=e,{apply:c=()=>{},...u}=Nn(t,e),h=await Ei(e,u),f=Cn(s),m=Pa(s),p=on(s)==="y",{width:x,height:g}=a.floating;let y,I;f==="top"||f==="bottom"?(y=f,I=m===(await(i.isRTL==null?void 0:i.isRTL(l.floating))?"start":"end")?"left":"right"):(I=f,y=m==="end"?"top":"bottom");const P=g-h.top-h.bottom,A=x-h.left-h.right,D=ts(g-h[y],P),V=ts(x-h[I],A),H=!e.middlewareData.shift;let w=D,E=V;if((r=e.middlewareData.shift)!=null&&r.enabled.x&&(E=A),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(w=P),H&&!m){const N=Cr(h.left,0),T=Cr(h.right,0),R=Cr(h.top,0),S=Cr(h.bottom,0);p?E=x-2*(N!==0||T!==0?N+T:Cr(h.left,h.right)):w=g-2*(R!==0||S!==0?R+S:Cr(h.top,h.bottom))}await c({...e,availableWidth:E,availableHeight:w});const _=await i.getDimensions(l.floating);return x!==_.width||g!==_.height?{reset:{rects:!0}}:{}}}};function Ll(){return typeof window<"u"}function Ra(t){return Fm(t)?(t.nodeName||"").toLowerCase():"#document"}function Dr(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function xn(t){var e;return(e=(Fm(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function Fm(t){return Ll()?t instanceof Node||t instanceof Dr(t).Node:!1}function Kr(t){return Ll()?t instanceof Element||t instanceof Dr(t).Element:!1}function mn(t){return Ll()?t instanceof HTMLElement||t instanceof Dr(t).HTMLElement:!1}function Kd(t){return!Ll()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Dr(t).ShadowRoot}const E_=new Set(["inline","contents"]);function Wi(t){const{overflow:e,overflowX:r,overflowY:n,display:s}=Xr(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+r)&&!E_.has(s)}const T_=new Set(["table","td","th"]);function A_(t){return T_.has(Ra(t))}const S_=[":popover-open",":modal"];function Bl(t){return S_.some(e=>{try{return t.matches(e)}catch{return!1}})}const N_=["transform","translate","scale","rotate","perspective"],C_=["transform","translate","scale","rotate","perspective","filter"],I_=["paint","layout","strict","content"];function Hu(t){const e=Wu(),r=Kr(t)?Xr(t):t;return N_.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||C_.some(n=>(r.willChange||"").includes(n))||I_.some(n=>(r.contain||"").includes(n))}function P_(t){let e=rs(t);for(;mn(e)&&!wa(e);){if(Hu(e))return e;if(Bl(e))return null;e=rs(e)}return null}function Wu(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const R_=new Set(["html","body","#document"]);function wa(t){return R_.has(Ra(t))}function Xr(t){return Dr(t).getComputedStyle(t)}function Vl(t){return Kr(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function rs(t){if(Ra(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Kd(t)&&t.host||xn(t);return Kd(e)?e.host:e}function jm(t){const e=rs(t);return wa(e)?t.ownerDocument?t.ownerDocument.body:t.body:mn(e)&&Wi(e)?e:jm(e)}function Ti(t,e,r){var n;e===void 0&&(e=[]),r===void 0&&(r=!0);const s=jm(t),a=s===((n=t.ownerDocument)==null?void 0:n.body),i=Dr(s);if(a){const l=su(i);return e.concat(i,i.visualViewport||[],Wi(s)?s:[],l&&r?Ti(l):[])}return e.concat(s,Ti(s,[],r))}function su(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function km(t){const e=Xr(t);let r=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const s=mn(t),a=s?t.offsetWidth:r,i=s?t.offsetHeight:n,l=Jo(r)!==a||Jo(n)!==i;return l&&(r=a,n=i),{width:r,height:n,$:l}}function qu(t){return Kr(t)?t:t.contextElement}function fa(t){const e=qu(t);if(!mn(e))return cn(1);const r=e.getBoundingClientRect(),{width:n,height:s,$:a}=km(e);let i=(a?Jo(r.width):r.width)/n,l=(a?Jo(r.height):r.height)/s;return(!i||!Number.isFinite(i))&&(i=1),(!l||!Number.isFinite(l))&&(l=1),{x:i,y:l}}const D_=cn(0);function Om(t){const e=Dr(t);return!Wu()||!e.visualViewport?D_:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function F_(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==Dr(t)?!1:e}function Fs(t,e,r,n){e===void 0&&(e=!1),r===void 0&&(r=!1);const s=t.getBoundingClientRect(),a=qu(t);let i=cn(1);e&&(n?Kr(n)&&(i=fa(n)):i=fa(t));const l=F_(a,r,n)?Om(a):cn(0);let c=(s.left+l.x)/i.x,u=(s.top+l.y)/i.y,h=s.width/i.x,f=s.height/i.y;if(a){const m=Dr(a),p=n&&Kr(n)?Dr(n):n;let x=m,g=su(x);for(;g&&n&&p!==x;){const y=fa(g),I=g.getBoundingClientRect(),P=Xr(g),A=I.left+(g.clientLeft+parseFloat(P.paddingLeft))*y.x,D=I.top+(g.clientTop+parseFloat(P.paddingTop))*y.y;c*=y.x,u*=y.y,h*=y.x,f*=y.y,c+=A,u+=D,x=Dr(g),g=su(x)}}return el({width:h,height:f,x:c,y:u})}function Ul(t,e){const r=Vl(t).scrollLeft;return e?e.left+r:Fs(xn(t)).left+r}function Mm(t,e){const r=t.getBoundingClientRect(),n=r.left+e.scrollLeft-Ul(t,r),s=r.top+e.scrollTop;return{x:n,y:s}}function j_(t){let{elements:e,rect:r,offsetParent:n,strategy:s}=t;const a=s==="fixed",i=xn(n),l=e?Bl(e.floating):!1;if(n===i||l&&a)return r;let c={scrollLeft:0,scrollTop:0},u=cn(1);const h=cn(0),f=mn(n);if((f||!f&&!a)&&((Ra(n)!=="body"||Wi(i))&&(c=Vl(n)),mn(n))){const p=Fs(n);u=fa(n),h.x=p.x+n.clientLeft,h.y=p.y+n.clientTop}const m=i&&!f&&!a?Mm(i,c):cn(0);return{width:r.width*u.x,height:r.height*u.y,x:r.x*u.x-c.scrollLeft*u.x+h.x+m.x,y:r.y*u.y-c.scrollTop*u.y+h.y+m.y}}function k_(t){return Array.from(t.getClientRects())}function O_(t){const e=xn(t),r=Vl(t),n=t.ownerDocument.body,s=Cr(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),a=Cr(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let i=-r.scrollLeft+Ul(t);const l=-r.scrollTop;return Xr(n).direction==="rtl"&&(i+=Cr(e.clientWidth,n.clientWidth)-s),{width:s,height:a,x:i,y:l}}const Xd=25;function M_(t,e){const r=Dr(t),n=xn(t),s=r.visualViewport;let a=n.clientWidth,i=n.clientHeight,l=0,c=0;if(s){a=s.width,i=s.height;const h=Wu();(!h||h&&e==="fixed")&&(l=s.offsetLeft,c=s.offsetTop)}const u=Ul(n);if(u<=0){const h=n.ownerDocument,f=h.body,m=getComputedStyle(f),p=h.compatMode==="CSS1Compat"&&parseFloat(m.marginLeft)+parseFloat(m.marginRight)||0,x=Math.abs(n.clientWidth-f.clientWidth-p);x<=Xd&&(a-=x)}else u<=Xd&&(a+=u);return{width:a,height:i,x:l,y:c}}const L_=new Set(["absolute","fixed"]);function B_(t,e){const r=Fs(t,!0,e==="fixed"),n=r.top+t.clientTop,s=r.left+t.clientLeft,a=mn(t)?fa(t):cn(1),i=t.clientWidth*a.x,l=t.clientHeight*a.y,c=s*a.x,u=n*a.y;return{width:i,height:l,x:c,y:u}}function Qd(t,e,r){let n;if(e==="viewport")n=M_(t,r);else if(e==="document")n=O_(xn(t));else if(Kr(e))n=B_(e,r);else{const s=Om(t);n={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return el(n)}function Lm(t,e){const r=rs(t);return r===e||!Kr(r)||wa(r)?!1:Xr(r).position==="fixed"||Lm(r,e)}function V_(t,e){const r=e.get(t);if(r)return r;let n=Ti(t,[],!1).filter(l=>Kr(l)&&Ra(l)!=="body"),s=null;const a=Xr(t).position==="fixed";let i=a?rs(t):t;for(;Kr(i)&&!wa(i);){const l=Xr(i),c=Hu(i);!c&&l.position==="fixed"&&(s=null),(a?!c&&!s:!c&&l.position==="static"&&!!s&&L_.has(s.position)||Wi(i)&&!c&&Lm(t,i))?n=n.filter(h=>h!==i):s=l,i=rs(i)}return e.set(t,n),n}function U_(t){let{element:e,boundary:r,rootBoundary:n,strategy:s}=t;const i=[...r==="clippingAncestors"?Bl(e)?[]:V_(e,this._c):[].concat(r),n],l=i[0],c=i.reduce((u,h)=>{const f=Qd(e,h,s);return u.top=Cr(f.top,u.top),u.right=ts(f.right,u.right),u.bottom=ts(f.bottom,u.bottom),u.left=Cr(f.left,u.left),u},Qd(e,l,s));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function $_(t){const{width:e,height:r}=km(t);return{width:e,height:r}}function H_(t,e,r){const n=mn(e),s=xn(e),a=r==="fixed",i=Fs(t,!0,a,e);let l={scrollLeft:0,scrollTop:0};const c=cn(0);function u(){c.x=Ul(s)}if(n||!n&&!a)if((Ra(e)!=="body"||Wi(s))&&(l=Vl(e)),n){const p=Fs(e,!0,a,e);c.x=p.x+e.clientLeft,c.y=p.y+e.clientTop}else s&&u();a&&!n&&s&&u();const h=s&&!n&&!a?Mm(s,l):cn(0),f=i.left+l.scrollLeft-c.x-h.x,m=i.top+l.scrollTop-c.y-h.y;return{x:f,y:m,width:i.width,height:i.height}}function Rc(t){return Xr(t).position==="static"}function Jd(t,e){if(!mn(t)||Xr(t).position==="fixed")return null;if(e)return e(t);let r=t.offsetParent;return xn(t)===r&&(r=r.ownerDocument.body),r}function Bm(t,e){const r=Dr(t);if(Bl(t))return r;if(!mn(t)){let s=rs(t);for(;s&&!wa(s);){if(Kr(s)&&!Rc(s))return s;s=rs(s)}return r}let n=Jd(t,e);for(;n&&A_(n)&&Rc(n);)n=Jd(n,e);return n&&wa(n)&&Rc(n)&&!Hu(n)?r:n||P_(t)||r}const W_=async function(t){const e=this.getOffsetParent||Bm,r=this.getDimensions,n=await r(t.floating);return{reference:H_(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function q_(t){return Xr(t).direction==="rtl"}const G_={convertOffsetParentRelativeRectToViewportRelativeRect:j_,getDocumentElement:xn,getClippingRect:U_,getOffsetParent:Bm,getElementRects:W_,getClientRects:k_,getDimensions:$_,getScale:fa,isElement:Kr,isRTL:q_};function Vm(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function z_(t,e){let r=null,n;const s=xn(t);function a(){var l;clearTimeout(n),(l=r)==null||l.disconnect(),r=null}function i(l,c){l===void 0&&(l=!1),c===void 0&&(c=1),a();const u=t.getBoundingClientRect(),{left:h,top:f,width:m,height:p}=u;if(l||e(),!m||!p)return;const x=wo(f),g=wo(s.clientWidth-(h+m)),y=wo(s.clientHeight-(f+p)),I=wo(h),A={rootMargin:-x+"px "+-g+"px "+-y+"px "+-I+"px",threshold:Cr(0,ts(1,c))||1};let D=!0;function V(H){const w=H[0].intersectionRatio;if(w!==c){if(!D)return i();w?i(!1,w):n=setTimeout(()=>{i(!1,1e-7)},1e3)}w===1&&!Vm(u,t.getBoundingClientRect())&&i(),D=!1}try{r=new IntersectionObserver(V,{...A,root:s.ownerDocument})}catch{r=new IntersectionObserver(V,A)}r.observe(t)}return i(!0),a}function Y_(t,e,r,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:a=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:c=!1}=n,u=qu(t),h=s||a?[...u?Ti(u):[],...Ti(e)]:[];h.forEach(I=>{s&&I.addEventListener("scroll",r,{passive:!0}),a&&I.addEventListener("resize",r)});const f=u&&l?z_(u,r):null;let m=-1,p=null;i&&(p=new ResizeObserver(I=>{let[P]=I;P&&P.target===u&&p&&(p.unobserve(e),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var A;(A=p)==null||A.observe(e)})),r()}),u&&!c&&p.observe(u),p.observe(e));let x,g=c?Fs(t):null;c&&y();function y(){const I=Fs(t);g&&!Vm(g,I)&&r(),g=I,x=requestAnimationFrame(y)}return r(),()=>{var I;h.forEach(P=>{s&&P.removeEventListener("scroll",r),a&&P.removeEventListener("resize",r)}),f?.(),(I=p)==null||I.disconnect(),p=null,c&&cancelAnimationFrame(x)}}const K_=y_,X_=__,Q_=g_,J_=b_,Z_=x_,Zd=p_,e2=w_,t2=(t,e,r)=>{const n=new Map,s={platform:G_,...r},a={...s.platform,_c:n};return m_(t,e,{...s,platform:a})};var r2=typeof document<"u",n2=function(){},Ho=r2?k.useLayoutEffect:n2;function tl(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,n,s;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(n=r;n--!==0;)if(!tl(t[n],e[n]))return!1;return!0}if(s=Object.keys(t),r=s.length,r!==Object.keys(e).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(e,s[n]))return!1;for(n=r;n--!==0;){const a=s[n];if(!(a==="_owner"&&t.$$typeof)&&!tl(t[a],e[a]))return!1}return!0}return t!==t&&e!==e}function Um(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function ef(t,e){const r=Um(t);return Math.round(e*r)/r}function Dc(t){const e=k.useRef(t);return Ho(()=>{e.current=t}),e}function s2(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:n=[],platform:s,elements:{reference:a,floating:i}={},transform:l=!0,whileElementsMounted:c,open:u}=t,[h,f]=k.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[m,p]=k.useState(n);tl(m,n)||p(n);const[x,g]=k.useState(null),[y,I]=k.useState(null),P=k.useCallback(le=>{le!==H.current&&(H.current=le,g(le))},[]),A=k.useCallback(le=>{le!==w.current&&(w.current=le,I(le))},[]),D=a||x,V=i||y,H=k.useRef(null),w=k.useRef(null),E=k.useRef(h),_=c!=null,N=Dc(c),T=Dc(s),R=Dc(u),S=k.useCallback(()=>{if(!H.current||!w.current)return;const le={placement:e,strategy:r,middleware:m};T.current&&(le.platform=T.current),t2(H.current,w.current,le).then(Ae=>{const Oe={...Ae,isPositioned:R.current!==!1};se.current&&!tl(E.current,Oe)&&(E.current=Oe,Bu.flushSync(()=>{f(Oe)}))})},[m,e,r,T,R]);Ho(()=>{u===!1&&E.current.isPositioned&&(E.current.isPositioned=!1,f(le=>({...le,isPositioned:!1})))},[u]);const se=k.useRef(!1);Ho(()=>(se.current=!0,()=>{se.current=!1}),[]),Ho(()=>{if(D&&(H.current=D),V&&(w.current=V),D&&V){if(N.current)return N.current(D,V,S);S()}},[D,V,S,N,_]);const te=k.useMemo(()=>({reference:H,floating:w,setReference:P,setFloating:A}),[P,A]),me=k.useMemo(()=>({reference:D,floating:V}),[D,V]),ce=k.useMemo(()=>{const le={position:r,left:0,top:0};if(!me.floating)return le;const Ae=ef(me.floating,h.x),Oe=ef(me.floating,h.y);return l?{...le,transform:"translate("+Ae+"px, "+Oe+"px)",...Um(me.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:Ae,top:Oe}},[r,l,me.floating,h.x,h.y]);return k.useMemo(()=>({...h,update:S,refs:te,elements:me,floatingStyles:ce}),[h,S,te,me,ce])}const a2=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:n,padding:s}=typeof t=="function"?t(r):t;return n&&e(n)?n.current!=null?Zd({element:n.current,padding:s}).fn(r):{}:n?Zd({element:n,padding:s}).fn(r):{}}}},i2=(t,e)=>({...K_(t),options:[t,e]}),o2=(t,e)=>({...X_(t),options:[t,e]}),l2=(t,e)=>({...e2(t),options:[t,e]}),c2=(t,e)=>({...Q_(t),options:[t,e]}),u2=(t,e)=>({...J_(t),options:[t,e]}),h2=(t,e)=>({...Z_(t),options:[t,e]}),d2=(t,e)=>({...a2(t),options:[t,e]});var f2="Arrow",$m=k.forwardRef((t,e)=>{const{children:r,width:n=10,height:s=5,...a}=t;return o.jsx(fs.svg,{...a,ref:e,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:o.jsx("polygon",{points:"0,0 30,0 15,10"})})});$m.displayName=f2;var m2=$m;function p2(t){const[e,r]=k.useState(void 0);return es(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const a=s[0];let i,l;if("borderBoxSize"in a){const c=a.borderBoxSize,u=Array.isArray(c)?c[0]:c;i=u.inlineSize,l=u.blockSize}else i=t.offsetWidth,l=t.offsetHeight;r({width:i,height:l})});return n.observe(t,{box:"border-box"}),()=>n.unobserve(t)}else r(void 0)},[t]),e}var Gu="Popper",[Hm,Wm]=Sm(Gu),[g2,qm]=Hm(Gu),Gm=t=>{const{__scopePopper:e,children:r}=t,[n,s]=k.useState(null);return o.jsx(g2,{scope:e,anchor:n,onAnchorChange:s,children:r})};Gm.displayName=Gu;var zm="PopperAnchor",Ym=k.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:n,...s}=t,a=qm(zm,r),i=k.useRef(null),l=Us(e,i),c=k.useRef(null);return k.useEffect(()=>{const u=c.current;c.current=n?.current||i.current,u!==c.current&&a.onAnchorChange(c.current)}),n?null:o.jsx(fs.div,{...s,ref:l})});Ym.displayName=zm;var zu="PopperContent",[x2,v2]=Hm(zu),Km=k.forwardRef((t,e)=>{const{__scopePopper:r,side:n="bottom",sideOffset:s=0,align:a="center",alignOffset:i=0,arrowPadding:l=0,avoidCollisions:c=!0,collisionBoundary:u=[],collisionPadding:h=0,sticky:f="partial",hideWhenDetached:m=!1,updatePositionStrategy:p="optimized",onPlaced:x,...g}=t,y=qm(zu,r),[I,P]=k.useState(null),A=Us(e,be=>P(be)),[D,V]=k.useState(null),H=p2(D),w=H?.width??0,E=H?.height??0,_=n+(a!=="center"?"-"+a:""),N=typeof h=="number"?h:{top:0,right:0,bottom:0,left:0,...h},T=Array.isArray(u)?u:[u],R=T.length>0,S={padding:N,boundary:T.filter(_2),altBoundary:R},{refs:se,floatingStyles:te,placement:me,isPositioned:ce,middlewareData:le}=s2({strategy:"fixed",placement:_,whileElementsMounted:(...be)=>Y_(...be,{animationFrame:p==="always"}),elements:{reference:y.anchor},middleware:[i2({mainAxis:s+E,alignmentAxis:i}),c&&o2({mainAxis:!0,crossAxis:!1,limiter:f==="partial"?l2():void 0,...S}),c&&c2({...S}),u2({...S,apply:({elements:be,rects:ye,availableWidth:pe,availableHeight:xe})=>{const{width:We,height:Ve}=ye.reference,nt=be.floating.style;nt.setProperty("--radix-popper-available-width",`${pe}px`),nt.setProperty("--radix-popper-available-height",`${xe}px`),nt.setProperty("--radix-popper-anchor-width",`${We}px`),nt.setProperty("--radix-popper-anchor-height",`${Ve}px`)}}),D&&d2({element:D,padding:l}),w2({arrowWidth:w,arrowHeight:E}),m&&h2({strategy:"referenceHidden",...S})]}),[Ae,Oe]=Jm(me),Je=Ml(x);es(()=>{ce&&Je?.()},[ce,Je]);const U=le.arrow?.x,Y=le.arrow?.y,q=le.arrow?.centerOffset!==0,[W,ae]=k.useState();return es(()=>{I&&ae(window.getComputedStyle(I).zIndex)},[I]),o.jsx("div",{ref:se.setFloating,"data-radix-popper-content-wrapper":"",style:{...te,transform:ce?te.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:W,"--radix-popper-transform-origin":[le.transformOrigin?.x,le.transformOrigin?.y].join(" "),...le.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:o.jsx(x2,{scope:r,placedSide:Ae,onArrowChange:V,arrowX:U,arrowY:Y,shouldHideArrow:q,children:o.jsx(fs.div,{"data-side":Ae,"data-align":Oe,...g,ref:A,style:{...g.style,animation:ce?void 0:"none"}})})})});Km.displayName=zu;var Xm="PopperArrow",y2={top:"bottom",right:"left",bottom:"top",left:"right"},Qm=k.forwardRef(function(e,r){const{__scopePopper:n,...s}=e,a=v2(Xm,n),i=y2[a.placedSide];return o.jsx("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:o.jsx(m2,{...s,ref:r,style:{...s.style,display:"block"}})})});Qm.displayName=Xm;function _2(t){return t!==null}var w2=t=>({name:"transformOrigin",options:t,fn(e){const{placement:r,rects:n,middlewareData:s}=e,i=s.arrow?.centerOffset!==0,l=i?0:t.arrowWidth,c=i?0:t.arrowHeight,[u,h]=Jm(r),f={start:"0%",center:"50%",end:"100%"}[h],m=(s.arrow?.x??0)+l/2,p=(s.arrow?.y??0)+c/2;let x="",g="";return u==="bottom"?(x=i?f:`${m}px`,g=`${-c}px`):u==="top"?(x=i?f:`${m}px`,g=`${n.floating.height+c}px`):u==="right"?(x=`${-c}px`,g=i?f:`${p}px`):u==="left"&&(x=`${n.floating.width+c}px`,g=i?f:`${p}px`),{data:{x,y:g}}}});function Jm(t){const[e,r="center"]=t.split("-");return[e,r]}var b2=Gm,E2=Ym,T2=Km,A2=Qm,S2="Portal",Zm=k.forwardRef((t,e)=>{const{container:r,...n}=t,[s,a]=k.useState(!1);es(()=>a(!0),[]);const i=r||s&&globalThis?.document?.body;return i?My.createPortal(o.jsx(fs.div,{...n,ref:e}),i):null});Zm.displayName=S2;function N2(t,e){return k.useReducer((r,n)=>e[r][n]??r,t)}var Yu=t=>{const{present:e,children:r}=t,n=C2(e),s=typeof r=="function"?r({present:n.isPresent}):k.Children.only(r),a=Us(n.ref,I2(s));return typeof r=="function"||n.isPresent?k.cloneElement(s,{ref:a}):null};Yu.displayName="Presence";function C2(t){const[e,r]=k.useState(),n=k.useRef(null),s=k.useRef(t),a=k.useRef("none"),i=t?"mounted":"unmounted",[l,c]=N2(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return k.useEffect(()=>{const u=bo(n.current);a.current=l==="mounted"?u:"none"},[l]),es(()=>{const u=n.current,h=s.current;if(h!==t){const m=a.current,p=bo(u);t?c("MOUNT"):p==="none"||u?.display==="none"?c("UNMOUNT"):c(h&&m!==p?"ANIMATION_OUT":"UNMOUNT"),s.current=t}},[t,c]),es(()=>{if(e){let u;const h=e.ownerDocument.defaultView??window,f=p=>{const g=bo(n.current).includes(CSS.escape(p.animationName));if(p.target===e&&g&&(c("ANIMATION_END"),!s.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",u=h.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},m=p=>{p.target===e&&(a.current=bo(n.current))};return e.addEventListener("animationstart",m),e.addEventListener("animationcancel",f),e.addEventListener("animationend",f),()=>{h.clearTimeout(u),e.removeEventListener("animationstart",m),e.removeEventListener("animationcancel",f),e.removeEventListener("animationend",f)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:k.useCallback(u=>{n.current=u?getComputedStyle(u):null,r(u)},[])}}function bo(t){return t?.animationName||"none"}function I2(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var P2=ym[" useInsertionEffect ".trim().toString()]||es;function R2({prop:t,defaultProp:e,onChange:r=()=>{},caller:n}){const[s,a,i]=D2({defaultProp:e,onChange:r}),l=t!==void 0,c=l?t:s;{const h=k.useRef(t!==void 0);k.useEffect(()=>{const f=h.current;f!==l&&console.warn(`${n} is changing from ${f?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=l},[l,n])}const u=k.useCallback(h=>{if(l){const f=F2(h)?h(t):h;f!==t&&i.current?.(f)}else a(h)},[l,t,a,i]);return[c,u]}function D2({defaultProp:t,onChange:e}){const[r,n]=k.useState(t),s=k.useRef(r),a=k.useRef(e);return P2(()=>{a.current=e},[e]),k.useEffect(()=>{s.current!==r&&(a.current?.(r),s.current=r)},[r,s]),[r,n,a]}function F2(t){return typeof t=="function"}var j2=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),k2="VisuallyHidden",ep=k.forwardRef((t,e)=>o.jsx(fs.span,{...t,ref:e,style:{...j2,...t.style}}));ep.displayName=k2;var O2=ep,[$l]=Sm("Tooltip",[Wm]),Hl=Wm(),tp="TooltipProvider",M2=700,au="tooltip.open",[L2,Ku]=$l(tp),rp=t=>{const{__scopeTooltip:e,delayDuration:r=M2,skipDelayDuration:n=300,disableHoverableContent:s=!1,children:a}=t,i=k.useRef(!0),l=k.useRef(!1),c=k.useRef(0);return k.useEffect(()=>{const u=c.current;return()=>window.clearTimeout(u)},[]),o.jsx(L2,{scope:e,isOpenDelayedRef:i,delayDuration:r,onOpen:k.useCallback(()=>{window.clearTimeout(c.current),i.current=!1},[]),onClose:k.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>i.current=!0,n)},[n]),isPointerInTransitRef:l,onPointerInTransitChange:k.useCallback(u=>{l.current=u},[]),disableHoverableContent:s,children:a})};rp.displayName=tp;var Ai="Tooltip",[B2,qi]=$l(Ai),np=t=>{const{__scopeTooltip:e,children:r,open:n,defaultOpen:s,onOpenChange:a,disableHoverableContent:i,delayDuration:l}=t,c=Ku(Ai,t.__scopeTooltip),u=Hl(e),[h,f]=k.useState(null),m=r_(),p=k.useRef(0),x=i??c.disableHoverableContent,g=l??c.delayDuration,y=k.useRef(!1),[I,P]=R2({prop:n,defaultProp:s??!1,onChange:w=>{w?(c.onOpen(),document.dispatchEvent(new CustomEvent(au))):c.onClose(),a?.(w)},caller:Ai}),A=k.useMemo(()=>I?y.current?"delayed-open":"instant-open":"closed",[I]),D=k.useCallback(()=>{window.clearTimeout(p.current),p.current=0,y.current=!1,P(!0)},[P]),V=k.useCallback(()=>{window.clearTimeout(p.current),p.current=0,P(!1)},[P]),H=k.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{y.current=!0,P(!0),p.current=0},g)},[g,P]);return k.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),o.jsx(b2,{...u,children:o.jsx(B2,{scope:e,contentId:m,open:I,stateAttribute:A,trigger:h,onTriggerChange:f,onTriggerEnter:k.useCallback(()=>{c.isOpenDelayedRef.current?H():D()},[c.isOpenDelayedRef,H,D]),onTriggerLeave:k.useCallback(()=>{x?V():(window.clearTimeout(p.current),p.current=0)},[V,x]),onOpen:D,onClose:V,disableHoverableContent:x,children:r})})};np.displayName=Ai;var iu="TooltipTrigger",sp=k.forwardRef((t,e)=>{const{__scopeTooltip:r,...n}=t,s=qi(iu,r),a=Ku(iu,r),i=Hl(r),l=k.useRef(null),c=Us(e,l,s.onTriggerChange),u=k.useRef(!1),h=k.useRef(!1),f=k.useCallback(()=>u.current=!1,[]);return k.useEffect(()=>()=>document.removeEventListener("pointerup",f),[f]),o.jsx(E2,{asChild:!0,...i,children:o.jsx(fs.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...n,ref:c,onPointerMove:wn(t.onPointerMove,m=>{m.pointerType!=="touch"&&!h.current&&!a.isPointerInTransitRef.current&&(s.onTriggerEnter(),h.current=!0)}),onPointerLeave:wn(t.onPointerLeave,()=>{s.onTriggerLeave(),h.current=!1}),onPointerDown:wn(t.onPointerDown,()=>{s.open&&s.onClose(),u.current=!0,document.addEventListener("pointerup",f,{once:!0})}),onFocus:wn(t.onFocus,()=>{u.current||s.onOpen()}),onBlur:wn(t.onBlur,s.onClose),onClick:wn(t.onClick,s.onClose)})})});sp.displayName=iu;var Xu="TooltipPortal",[V2,U2]=$l(Xu,{forceMount:void 0}),ap=t=>{const{__scopeTooltip:e,forceMount:r,children:n,container:s}=t,a=qi(Xu,e);return o.jsx(V2,{scope:e,forceMount:r,children:o.jsx(Yu,{present:r||a.open,children:o.jsx(Zm,{asChild:!0,container:s,children:n})})})};ap.displayName=Xu;var ba="TooltipContent",ip=k.forwardRef((t,e)=>{const r=U2(ba,t.__scopeTooltip),{forceMount:n=r.forceMount,side:s="top",...a}=t,i=qi(ba,t.__scopeTooltip);return o.jsx(Yu,{present:n||i.open,children:i.disableHoverableContent?o.jsx(op,{side:s,...a,ref:e}):o.jsx($2,{side:s,...a,ref:e})})}),$2=k.forwardRef((t,e)=>{const r=qi(ba,t.__scopeTooltip),n=Ku(ba,t.__scopeTooltip),s=k.useRef(null),a=Us(e,s),[i,l]=k.useState(null),{trigger:c,onClose:u}=r,h=s.current,{onPointerInTransitChange:f}=n,m=k.useCallback(()=>{l(null),f(!1)},[f]),p=k.useCallback((x,g)=>{const y=x.currentTarget,I={x:x.clientX,y:x.clientY},P=G2(I,y.getBoundingClientRect()),A=z2(I,P),D=Y2(g.getBoundingClientRect()),V=X2([...A,...D]);l(V),f(!0)},[f]);return k.useEffect(()=>()=>m(),[m]),k.useEffect(()=>{if(c&&h){const x=y=>p(y,h),g=y=>p(y,c);return c.addEventListener("pointerleave",x),h.addEventListener("pointerleave",g),()=>{c.removeEventListener("pointerleave",x),h.removeEventListener("pointerleave",g)}}},[c,h,p,m]),k.useEffect(()=>{if(i){const x=g=>{const y=g.target,I={x:g.clientX,y:g.clientY},P=c?.contains(y)||h?.contains(y),A=!K2(I,i);P?m():A&&(m(),u())};return document.addEventListener("pointermove",x),()=>document.removeEventListener("pointermove",x)}},[c,h,i,u,m]),o.jsx(op,{...t,ref:a})}),[H2,W2]=$l(Ai,{isInside:!1}),q2=Vy("TooltipContent"),op=k.forwardRef((t,e)=>{const{__scopeTooltip:r,children:n,"aria-label":s,onEscapeKeyDown:a,onPointerDownOutside:i,...l}=t,c=qi(ba,r),u=Hl(r),{onClose:h}=c;return k.useEffect(()=>(document.addEventListener(au,h),()=>document.removeEventListener(au,h)),[h]),k.useEffect(()=>{if(c.trigger){const f=m=>{m.target?.contains(c.trigger)&&h()};return window.addEventListener("scroll",f,{capture:!0}),()=>window.removeEventListener("scroll",f,{capture:!0})}},[c.trigger,h]),o.jsx(Im,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:a,onPointerDownOutside:i,onFocusOutside:f=>f.preventDefault(),onDismiss:h,children:o.jsxs(T2,{"data-state":c.stateAttribute,...u,...l,ref:e,style:{...l.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[o.jsx(q2,{children:n}),o.jsx(H2,{scope:r,isInside:!0,children:o.jsx(O2,{id:c.contentId,role:"tooltip",children:s||n})})]})})});ip.displayName=ba;var lp="TooltipArrow",cp=k.forwardRef((t,e)=>{const{__scopeTooltip:r,...n}=t,s=Hl(r);return W2(lp,r).isInside?null:o.jsx(A2,{...s,...n,ref:e})});cp.displayName=lp;function G2(t,e){const r=Math.abs(e.top-t.y),n=Math.abs(e.bottom-t.y),s=Math.abs(e.right-t.x),a=Math.abs(e.left-t.x);switch(Math.min(r,n,s,a)){case a:return"left";case s:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function z2(t,e,r=5){const n=[];switch(e){case"top":n.push({x:t.x-r,y:t.y+r},{x:t.x+r,y:t.y+r});break;case"bottom":n.push({x:t.x-r,y:t.y-r},{x:t.x+r,y:t.y-r});break;case"left":n.push({x:t.x+r,y:t.y-r},{x:t.x+r,y:t.y+r});break;case"right":n.push({x:t.x-r,y:t.y-r},{x:t.x-r,y:t.y+r});break}return n}function Y2(t){const{top:e,right:r,bottom:n,left:s}=t;return[{x:s,y:e},{x:r,y:e},{x:r,y:n},{x:s,y:n}]}function K2(t,e){const{x:r,y:n}=t;let s=!1;for(let a=0,i=e.length-1;a<e.length;i=a++){const l=e[a],c=e[i],u=l.x,h=l.y,f=c.x,m=c.y;h>n!=m>n&&r<(f-u)*(n-h)/(m-h)+u&&(s=!s)}return s}function X2(t){const e=t.slice();return e.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),Q2(e)}function Q2(t){if(t.length<=1)return t.slice();const e=[];for(let n=0;n<t.length;n++){const s=t[n];for(;e.length>=2;){const a=e[e.length-1],i=e[e.length-2];if((a.x-i.x)*(s.y-i.y)>=(a.y-i.y)*(s.x-i.x))e.pop();else break}e.push(s)}e.pop();const r=[];for(let n=t.length-1;n>=0;n--){const s=t[n];for(;r.length>=2;){const a=r[r.length-1],i=r[r.length-2];if((a.x-i.x)*(s.y-i.y)>=(a.y-i.y)*(s.x-i.x))r.pop();else break}r.push(s)}return r.pop(),e.length===1&&r.length===1&&e[0].x===r[0].x&&e[0].y===r[0].y?e:e.concat(r)}var J2=rp,Z2=np,ew=sp,tw=ap,rw=ip,nw=cp;const tf=Symbol.for("constructDateFrom");function sw(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&tf in t?t[tf](e):t instanceof Date?new t.constructor(e):new Date(e)}function js(t,e){return sw(t,t)}function rf(t,e){const r=js(t);return r.setHours(0,0,0,0),r}function aw(t,e){return+js(t)-+js(e)}function nf(t,e){return+js(t)>+js(e)}function iw(t,e){return+js(t)<+js(e)}const ow=365.25;function Gi(t,e,r,n){const s=t-e,a=s>0?s*n/100/12:0,l=388.38/12,u=2e3/12,h=a+l+u,f=h*r;return{monthlyInterest:a,monthlyTax:l,monthlyInsurance:u,totalMonthly:h,totalForPeriod:f}}function up(t,e,r,n,s,a,i=0){const l=t+e+r,c=zi(l,s.indexationRate,n),u=0,h=a.totalForPeriod*(s.carryingCostRecovery/100),f=l+c+h+i;return{basePrice:l,feesRecovery:u,indexation:c,carryingCostRecovery:h,renovations:i,totalPrice:f,breakdown:{base:l,fees:u,indexation:c,carrying:h,renovations:i}}}function Qu(t,e,r,n,s,a,i=0){const l=up(t,e,r,n,s,a,i);return{basePrice:l.basePrice,surfaceImposed:!0,indexation:l.indexation,carryingCostRecovery:l.carryingCostRecovery,feesRecovery:l.feesRecovery,totalPrice:l.totalPrice,pricePerM2:0}}function lw(t,e,r,n,s,a){if(e<=0)throw new Error("Total coproprit lot surface must be greater than zero");if(t<=0)throw new Error("Surface chosen must be greater than zero");if(t>e)throw new Error("Surface chosen cannot exceed total coproprit lot surface");const i=t/e,l=r*i,c=zi(l,s.indexationRate,n),u=a*i*(s.carryingCostRecovery/100),h=0,f=l+c+u,m=f/t;return{basePrice:l,surfaceImposed:!1,indexation:c,carryingCostRecovery:u,feesRecovery:h,totalPrice:f,pricePerM2:m}}function Wl(t,e){const r=rf(t),n=rf(e);return iw(n,r)?0:aw(n,r)/(1e3*60*60*24*ow)}function zi(t,e,r){const n=Math.pow(1+e/100,r);return t*(n-1)}function cw(t,e,r,n){const s=zi(t,r.indexationRate,e),a=n.totalForPeriod*(r.carryingCostRecovery/100),i=t+s+a;return{basePrice:t,indexation:s,carryingCostRecovery:a,totalPrice:i}}const uw=1377,hw=.05;function dw(t,e,r,n){if(!t||t<=0||t>e)return null;const s=e*uw,a=s*hw*r;return lw(t,e,s,r,n,a)}function hp(t,e,r,n,s,a,i,l,c){if(r<=0)throw new Error("Total building surface must be greater than zero");if(t<=0||t>r)throw new Error("Invalid surface purchased");let u=e;if(i!==void 0&&l!==void 0&&c!==void 0&&c>0){const A=i instanceof Date?i:new Date(i);(l instanceof Date?l:new Date(l))<A&&(u=e-c)}const f=u/r*t,m=zi(f,s.indexationRate,n),p=t/r,x=a*p*(s.carryingCostRecovery/100),g=f+m+x,y=s.coproReservesShare/100,I=g*y,P=g*(1-y);return{basePrice:f,indexation:m,carryingCostRecovery:x,totalPrice:g,pricePerM2:g/t,distribution:{toCoproReserves:I,toParticipants:P}}}const zr={indexationRate:2,carryingCostRecovery:100,averageInterestRate:4.5,coproReservesShare:30};function fw(t,e){if(e<=0)throw new Error("Total surface must be greater than zero");return t/e}function mw(t){return t.reduce((e,r)=>e+(r.surface||0),0)}function Yi(t){if(!t)return 0;const e=t.conservatoire.reduce((s,a)=>s+a.amount,0),r=t.habitabiliteSommaire.reduce((s,a)=>s+a.amount,0),n=t.premierTravaux.reduce((s,a)=>s+a.amount,0);return e+r+n}function pw(t){return t.expenseCategories?Yi(t.expenseCategories)+t.fraisGeneraux3ans:t.mesuresConservatoires+t.demolition+t.infrastructures+t.etudesPreparatoires+t.fraisEtudesPreparatoires+t.fraisGeneraux3ans}function Ju(t){if(t.amount!==void 0&&(t.sqm===void 0||t.sqm===0))return t.amount;const e=t.sqm||0,r=e*(t.cascoPricePerSqm||0),n=e*(t.parachevementPricePerSqm||0);return r+n}function gw(t){return(t.sqm||0)*(t.cascoPricePerSqm||0)}function bn(t){const e=t.batimentFondationConservatoire+t.batimentFondationComplete+t.batimentCoproConservatoire,r=t.travauxCommuns?.enabled?t.travauxCommuns.items.reduce((n,s)=>n+Ju(s),0):0;return e+r}function xw(t){const e=t.batimentFondationConservatoire+t.batimentFondationComplete+t.batimentCoproConservatoire,r=t.travauxCommuns?.enabled?t.travauxCommuns.items.reduce((n,s)=>n+gw(s),0):0;return e+r}function vw(t,e){return bn(t)/e}function ms(t,e,r){let n=0;for(const A of t){if(!A.unitId||!A.surface||!A.quantity)continue;const V=(A.cascoSqm!==void 0?A.cascoSqm:A.surface)*e.globalCascoPerM2;n+=V*A.quantity}n+=xw(e);const s=n*.15*.3,a=s/3,i=388.38,l=1e3,c=600,u=2e3,h=2e3,f=2e3,m=i+l+c+u+h+f,p=m*3,x=500,g=45,y=5e3,I=x+g+y,P=s+p+I;return{totalCasco:n,honorairesYearly:a,honorairesTotal3Years:s,recurringYearly:{precompteImmobilier:i,comptable:l,podioAbonnement:c,assuranceBatiment:u,fraisReservation:h,imprevus:f,total:m},recurringTotal3Years:p,oneTimeCosts:{fraisDossierCredit:x,fraisGestionCredit:g,fraisNotaireBasePartagee:y,total:I},total:P}}function yw(t,e,r){return ms(t,e).total}function sf(t,e){return t*e}function _w(t,e){return t*(e/100)}function ww(t){return t*1e3}function bw(t,e,r,n,s,a,i,l=0){const c=a!==void 0?a:e,u=i!==void 0?i:e;let h=c*n;l>0&&(h=h*(1+l/100));let f;if(s!==void 0)f=u*s;else if(r[t]){const m=r[t].parachevements/e;f=u*m}else f=u*500;return{casco:h,parachevements:f}}function Ew(t,e,r){if(!r)return{casco:t,parachevements:e};const n=r.founderPaysCasco?0:t,s=r.founderPaysParachvement?0:e;return{casco:n,parachevements:s}}function Tw(t,e){return t-e}function ou(t,e,r){if(t<=0)return 0;const n=e/100/12,s=r*12;return t*(n*Math.pow(1+n,s))/(Math.pow(1+n,s)-1)}function lu(t,e,r){return t*e*12-r}function Aw(t,e){return e<=0?0:t/e*100}function Sw(t,e,r,n,s,a){const i=a.loan2RenovationAmount||0,l=a.capitalForLoan1||0,c=a.capitalForLoan2||0,u=a.loan2DelayYears??2,h=s-i,f=Math.max(0,t+e+r+n+h-l),m=Math.max(0,i-c),p=a.durationYears-u,x=ou(f,a.interestRate,a.durationYears),g=ou(m,a.interestRate,p),y=lu(x,a.durationYears,f),I=lu(g,p,m);return{loan1Amount:f,loan1MonthlyPayment:x,loan1Interest:y,loan2Amount:m,loan2DurationYears:p,loan2MonthlyPayment:g,loan2Interest:I,totalInterest:y+I}}function Nw(t,e,r,n,s){const a=t.filter(y=>y.enabled!==!1),i=mw(a),l=fw(e.totalPurchase,i),c=yw(a,e),u={...e,fraisGeneraux3ans:c},h=pw(u),f=a.length||1,m=h/f,p=vw(e,f),x=t.map(y=>{if(y.enabled===!1)return{...y,quantity:y.quantity||1,pricePerM2:l,purchaseShare:0,droitEnregistrements:0,fraisNotaireFixe:0,casco:0,parachevements:0,personalRenovationCost:0,constructionCost:0,constructionCostPerUnit:0,travauxCommunsPerUnit:0,sharedCosts:0,totalCost:0,loanNeeded:0,financingRatio:0,monthlyPayment:0,totalRepayment:0,totalInterest:0};const I=y.unitId||0,P=y.surface||0,A=y.quantity||1;let{casco:D,parachevements:V}=bw(I,P,r,e.globalCascoPerM2,y.parachevementsPerM2,y.cascoSqm,y.parachevementsSqm,e.cascoTvaRate||0);if(y.purchaseDetails?.lotId){const ye=t.flatMap(pe=>pe.lotsOwned||[]).find(pe=>pe.lotId===y.purchaseDetails.lotId&&pe.isPortage);if(ye){const pe=Ew(D,V,ye);D=pe.casco,V=pe.parachevements}}let H;if(!y.isFounder&&y.purchaseDetails?.buyingFrom==="Coproprit"&&y.entryDate&&n){const ye=t.filter(pe=>{const xe=pe.entryDate||(pe.isFounder?new Date(n):null);if(!xe)return!1;const We=y.entryDate?y.entryDate instanceof Date?y.entryDate:new Date(y.entryDate):new Date(n);return xe<=We});try{H=dp(P,ye,e.totalPurchase,n,y.entryDate,s).totalPrice}catch(pe){console.error("Error calculating newcomer price, falling back to standard calculation:",pe),H=y.purchaseDetails?.purchasePrice??sf(P,l)}}else H=y.purchaseDetails?.purchasePrice??sf(P,l);const w=_w(H,y.registrationFeesRate),E=ww(A),T=D+V,R=p*A,S=T+R,se=S/A,te=H+w+E+S+m;let me,ce,le,Ae,Oe,Je,U,Y,q,W,ae;if(y.useTwoLoans){const ye=Sw(H,w,E,m,T,y);Oe=ye.loan1Amount,Je=ye.loan1MonthlyPayment,U=ye.loan1Interest,Y=ye.loan2Amount,q=ye.loan2DurationYears,W=ye.loan2MonthlyPayment,ae=ye.loan2Interest,me=Oe+Y,ce=Je,le=Je*y.durationYears*12+W*q*12,Ae=ye.totalInterest}else me=Tw(te,y.capitalApporte),ce=ou(me,y.interestRate,y.durationYears),le=ce*y.durationYears*12,Ae=lu(ce,y.durationYears,me);const be=Aw(me,te);return{...y,quantity:A,pricePerM2:l,purchaseShare:H,droitEnregistrements:w,fraisNotaireFixe:E,casco:D,parachevements:V,personalRenovationCost:T,constructionCost:S,constructionCostPerUnit:se,travauxCommunsPerUnit:p,sharedCosts:m,totalCost:te,loanNeeded:me,financingRatio:be,monthlyPayment:ce,totalRepayment:le,totalInterest:Ae,loan1Amount:Oe,loan1MonthlyPayment:Je,loan1Interest:U,loan2Amount:Y,loan2DurationYears:q,loan2MonthlyPayment:W,loan2Interest:ae}}),g={purchase:e.totalPurchase,totalDroitEnregistrements:x.reduce((y,I)=>y+I.droitEnregistrements,0),construction:x.reduce((y,I)=>y+I.constructionCost,0),shared:h,totalTravauxCommuns:bn(e),travauxCommunsPerUnit:p,total:e.totalPurchase+x.reduce((y,I)=>y+I.droitEnregistrements,0)+x.reduce((y,I)=>y+I.constructionCost,0)+h,capitalTotal:a.reduce((y,I)=>y+I.capitalApporte,0),totalLoansNeeded:x.reduce((y,I)=>y+I.loanNeeded,0),averageLoan:f>0?x.reduce((y,I)=>y+I.loanNeeded,0)/f:0,averageCapital:f>0?a.reduce((y,I)=>y+I.capitalApporte,0)/f:0};return{totalSurface:i,pricePerM2:l,sharedCosts:h,sharedPerPerson:m,participantBreakdown:x,totals:g}}function Cw(t,e){const r=e.reduce((n,s)=>n+(s.surface||0),0);return r<=0?0:t/r}function dp(t,e,r,n,s,a){const i=Cw(t,e),l=i*r,c=n instanceof Date?n:new Date(n),h=((s instanceof Date?s:new Date(s)).getTime()-c.getTime())/(1e3*60*60*24*365.25),f=a?.indexationRate??2,m=l*(Math.pow(1+f/100,h)-1),g=500*h*12*i,y=l+m+g;return{quotite:i,basePrice:l,indexation:m,carryingCostRecovery:g,totalPrice:y,yearsHeld:h}}function rl(t,e){if(!t||t.length===0)return 1;if(!e)return Math.max(1,t.length);try{const r=new Date(e);if(isNaN(r.getTime()))return Math.max(1,t.length);const n=r.toISOString().split("T")[0],s=t.filter(a=>{if(a.isFounder===!0)return!0;if(a.entryDate)try{const i=new Date(a.entryDate);return isNaN(i.getTime())?!1:i.toISOString().split("T")[0]===n}catch{return!1}return!1}).length;return Math.max(1,s)}catch{return Math.max(1,t.length)}}function fp(t,e,r){if(!t||t.length===0)return 1;try{const n=e instanceof Date?e:new Date(e);if(isNaN(n.getTime()))return rl(t,r);const s=n.toISOString().split("T")[0],a=t.filter(i=>{if(i.isFounder===!0)return!0;if(i.entryDate)try{const l=new Date(i.entryDate);return isNaN(l.getTime())?!1:l.toISOString().split("T")[0]<=s}catch{return!1}return!1}).length;return Math.max(1,a)}catch{return rl(t,r)}}function Iw(t,e,r,n,s){const a=ms(e,r),i=r.expenseCategories&&Yi(r.expenseCategories)||0,l=bn(r)||0,c=(a.honorairesTotal3Years||0)+(a.recurringTotal3Years||0)+(a.oneTimeCosts?.total||0),u=i+c+l,h=!t.isFounder;let f;h&&t.entryDate?f=fp(e,t.entryDate,s):f=rl(e,s);const m=(a.honorairesTotal3Years||0)/f,p=(a.recurringTotal3Years||0)/f,x=(a.oneTimeCosts?.total||0)/f,g=i/f,y=l/f,I=g+m+p+x+y;return{totalCommunBeforeDivision:u,expenseCategoriesTotal:g,honorairesPerParticipant:m,frais3ansPerParticipant:p,ponctuelsPerParticipant:x,travauxCommunsPerParticipant:y,sharedCostsPerParticipant:I,participantsCount:f}}function Pw(t,e,r,n,s){const a=t/e,i=new Date(r),l=n instanceof Date?n:new Date(n);if(isNaN(i.getTime())||isNaN(l.getTime()))return{base:a,indexation:0,total:a,yearsHeld:0};const c=(l.getTime()-i.getTime())/(1e3*60*60*24*365.25),u=s.indexationRate||2,h=zi(a,u,Math.max(0,c)),f=a+h;return{base:a,indexation:h,total:f,yearsHeld:Math.max(0,c)}}const mp="credit-castor-unlock-state",af="admin2025";function pp(){try{const t=localStorage.getItem(mp);if(!t)return{isUnlocked:!1,unlockedAt:null,unlockedBy:null};const e=JSON.parse(t);return{isUnlocked:e.isUnlocked||!1,unlockedAt:e.unlockedAt?new Date(e.unlockedAt):null,unlockedBy:e.unlockedBy||null}}catch(t){return console.error("Failed to load unlock state:",t),{isUnlocked:!1,unlockedAt:null,unlockedBy:null}}}function of(t){try{localStorage.setItem(mp,JSON.stringify({isUnlocked:t.isUnlocked,unlockedAt:t.unlockedAt?.toISOString()||null,unlockedBy:t.unlockedBy}))}catch(e){console.error("Failed to save unlock state:",e)}}function Rw(t="default",e){const[r,n]=k.useState(pp);k.useEffect(()=>{of(r)},[r]),k.useEffect(()=>{const l=()=>{r.isUnlocked&&of({isUnlocked:!1,unlockedAt:null,unlockedBy:null})};return window.addEventListener("beforeunload",l),()=>{window.removeEventListener("beforeunload",l)}},[r.isUnlocked]);const s=k.useCallback(async(l,c)=>l!==af?!1:(n({isUnlocked:!0,unlockedAt:new Date,unlockedBy:c}),!0),[]),a=k.useCallback(async()=>{n({isUnlocked:!1,unlockedAt:null,unlockedBy:null})},[]),i=k.useCallback(l=>l===af,[]);return{...r,unlock:s,lock:a,validatePassword:i,isLoading:!1}}function Dw(){return pp()}const gp=k.createContext(void 0);function xp({children:t,projectId:e="default"}){const r=Rw(e);return o.jsx(gp.Provider,{value:r,children:t})}function ql(){const t=k.useContext(gp);if(t===void 0)throw new Error("useUnlock must be used within an UnlockProvider");return t}const Fw=["projectParams","projectParams.*","portageFormula","portageFormula.*","deedDate","projectParams.renovationStartDate","participants.*.interestRate","participants.*.durationYears","participants.*.registrationFeesRate","participants.*.useTwoLoans","participants.*.loan2DelayYears","participants.*.loan2RenovationAmount","participants.*.isFounder","participants.*.entryDate","participants.*.exitDate"],jw=["participants.*.capitalApporte","participants.*.name","participants.*.lotsOwned","participants.*.lotsOwned.*","participants.*.surface","participants.*.quantity","participants.*.unitId","participants.*.purchaseDetails","participants.*.purchaseDetails.*","participants.*.parachevementsPerM2","participants.*.cascoSqm","participants.*.parachevementsSqm","participants.*.capitalForLoan1","participants.*.capitalForLoan2"];function vp(t,e){if(t===e)return!0;const r=e.replace(/\./g,"\\.").replace(/\*/g,"[^.]+");return new RegExp(`^${r}$`).test(t)}function yp(t){return Fw.some(e=>vp(t,e))}function _p(t){return jw.some(e=>vp(t,e))}function wp(t,e){return _p(t)?!0:yp(t)?e:!0}function kw(t,e){return wp(t,e)?null:"Ce champ est verrouill. Demandez  un administrateur de dverrouiller les champs collectifs."}function bp(t){const{isUnlocked:e}=ql(),r=k.useMemo(()=>wp(t,e),[t,e]),n=k.useMemo(()=>kw(t,e),[t,e]),s=k.useMemo(()=>yp(t),[t]),a=k.useMemo(()=>_p(t),[t]),i=k.useMemo(()=>s&&!e,[s,e]);return{canEdit:r,lockReason:n,isCollective:s,isIndividual:a,isLocked:i}}function ni(t){const e=`projectParams.${t}`;return bp(e)}function Eo(t){const e=`portageFormula.${t}`;return bp(e)}function Ow(t,e){if(!t)return e;const r=t instanceof Date?t:new Date(t);return isNaN(r.getTime())?e:r.toISOString().split("T")[0]}function Mw(t,e){const r=new Date(t);return r.setDate(r.getDate()+e),r.toISOString().split("T")[0]}function Lw(t,e){const r=Mw(e,1);return[...new Set(t.map(s=>{const a=s.isFounder?e:r;return Ow(s.entryDate,a)}))].sort()}function Bw(t,e,r){if(!t)return[];const n=Lw(e,r),s=[],a=t.getBoundingClientRect();return n.forEach(i=>{const l=Array.from(t.querySelectorAll("[data-timeline-date]")).find(c=>c.getAttribute("data-timeline-date")===i);if(l){const c=l.closest(".relative.pl-20");if(c){const u=c.getBoundingClientRect(),h=u.top-a.top,f=u.bottom-a.top;s.push({date:i,y:f,top:h,bottom:f})}else{const u=l.getBoundingClientRect(),h=u.top-a.top,f=h+u.height+100;s.push({date:i,y:f,top:h,bottom:f})}}}),s}const lf=({renovationStartDate:t,deedDate:e,participants:r,onDateChange:n,canEdit:s,isLocked:a,lockReason:i})=>{const[l,c]=k.useState(!1),[u,h]=k.useState(null),[f,m]=k.useState(null),p=k.useRef(null),x=k.useRef(null);k.useEffect(()=>{const P=()=>{if(p.current){const D=p.current.closest("[data-timeline-container]");D&&(x.current=D)}};P();const A=setTimeout(P,100);return()=>clearTimeout(A)},[]);const g=k.useCallback(P=>{if(!(a||!s)&&(P.preventDefault(),c(!0),p.current)){const A=p.current.getBoundingClientRect(),D=p.current.closest("[data-timeline-container]");if(D){const V=D.getBoundingClientRect(),H=P.clientY-A.top,w=A.top-V.top;h(P.clientY),m(w),p.current._dragOffsetY=H}}},[a,s]),y=k.useCallback(P=>{if(!(!l||a||!s)&&p.current&&u!==null&&f!==null){const A=p.current.closest("[data-timeline-container]");if(A){const D=A.getBoundingClientRect(),V=p.current._dragOffsetY||0,w=P.clientY-V-D.top-f;p.current.style.transform=`translateY(${w}px)`}}},[l,a,s,u,f]),I=k.useCallback(P=>{if(!(!l||a||!s)&&(c(!1),h(null),m(null),p.current&&(p.current.style.transform="",delete p.current._dragOffsetY),x.current)){const A=Bw(x.current,r,e);if(A.length>0){const D=x.current.getBoundingClientRect(),H=P.clientY-D.top;let w=e;for(let E=A.length-1;E>=0;E--){const _=A[E];if(H>=_.bottom){const N=new Date(_.date);N.setDate(N.getDate()+1),w=N.toISOString().split("T")[0];break}}if(H<A[0].top){const E=new Date(e);E.setDate(E.getDate()+1),w=E.toISOString().split("T")[0]}w<e&&(w=e),w!==t&&n(w)}}},[l,a,s,r,e,t,n]);return k.useEffect(()=>{if(l){document.addEventListener("mousemove",y);const P=A=>I(A);return document.addEventListener("mouseup",P),document.body.style.cursor="grabbing",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",P),document.body.style.cursor="",document.body.style.userSelect=""}}},[l,y,I]),o.jsx("div",{ref:p,"data-testid":"draggable-renovation-card","data-dragging":l,className:`relative ${a||!s?"opacity-60":""} ${l?"z-50":""}`,style:{transition:l?"none":"transform 0.3s ease-out"},children:o.jsx("div",{"data-testid":"draggable-card-content",className:`px-4 py-2 rounded-lg border-2 transition-all ${a?"bg-gray-100 border-gray-300 text-gray-600":"bg-orange-50 border-orange-300 text-orange-800 hover:bg-orange-100 hover:shadow-md"} ${l?"shadow-xl scale-105 ring-2 ring-orange-400 ring-opacity-50":""}`,onMouseDown:g,title:a?i||"Champ verrouill":"Glisser pour changer la date",style:{cursor:a||!s?"not-allowed":l?"grabbing":"grab"},children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"date",value:t||e,onChange:P=>{!a&&s&&P.target.value>=e&&n(P.target.value)},min:e,disabled:a||!s,className:`text-sm font-semibold px-2 py-1 border-2 rounded-lg focus:outline-none ${a?"bg-gray-100 border-gray-300 text-gray-500 cursor-not-allowed":"border-orange-300 focus:border-orange-500 focus:ring-1 focus:ring-orange-500 bg-white text-gray-700"}`,onClick:P=>P.stopPropagation(),title:a&&i||void 0}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("div",{className:"text-xs text-orange-600 font-medium",children:"Dbut des rnovations"}),o.jsxs("div",{className:"text-xs text-gray-500 italic flex items-center gap-1",children:[o.jsx(wm,{className:"w-3 h-3"}),"Date de dbut des travaux de rnovation."]})]})]})})})};function Vw(t){return t&&typeof t=="object"&&"seconds"in t&&"nanoseconds"in t?new Date(t.seconds*1e3+t.nanoseconds/1e6):t}function Fc(t,e){if(!t)return e;const r=Vw(t);if(!r)return e;const n=r instanceof Date?r:new Date(r);return isNaN(n.getTime())?(console.warn(`Invalid date value in ParticipantsTimeline: ${t}, using fallback: ${e}`),e):n.toISOString().split("T")[0]}const Uw=({participants:t,deedDate:e,renovationStartDate:r,onDeedDateChange:n,onRenovationStartDateChange:s,onUpdateParticipant:a})=>{const[i,l]=k.useState(null),c=k.useRef(null),{canEdit:u,isLocked:h,lockReason:f}=ni("renovationStartDate"),m=I=>{l(P=>P===I?null:I)},x=[...t].sort((I,P)=>{const A=Fc(I.entryDate,e),D=Fc(P.entryDate,e),V=new Date(A),H=new Date(D);return V.getTime()-H.getTime()}).reduce((I,P)=>{const A=Fc(P.entryDate,e);return I[A]||(I[A]=[]),I[A].push(P),I},{}),g=I=>new Date(I).toLocaleDateString("fr-BE",{year:"numeric",month:"long",day:"numeric"}),y=k.useMemo(()=>{if(!r||!s)return null;const I=Object.keys(x).sort(),P=new Date(r).getTime();for(let A=I.length-1;A>=0;A--){const D=new Date(I[A]).getTime();if(P>=D)return I[A]}return null},[r,x,s]);return o.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx(ay,{className:"w-6 h-6 text-blue-600"}),o.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:" Timeline des Participants"})]}),o.jsxs("div",{ref:c,className:"relative","data-timeline-container":!0,style:{minHeight:"200px"},children:[o.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-0.5 bg-gray-300"}),o.jsxs("div",{className:"space-y-6",style:{position:"relative",zIndex:1},children:[Object.entries(x).map(([I,P])=>{const A=I===e,D=y===I;return o.jsxs(Uv.Fragment,{children:[o.jsxs("div",{className:"relative pl-20 transition-all duration-300 ease-in-out",children:[o.jsx("div",{className:`absolute left-6 w-5 h-5 rounded-full border-4 ${A?"bg-green-500 border-green-200":"bg-blue-500 border-blue-200"}`}),o.jsx("div",{className:"mb-2","data-timeline-date":I,children:A?o.jsx("div",{className:"space-y-3",children:o.jsxs("div",{children:[o.jsx("input",{type:"date",value:e,onChange:V=>n(V.target.value),className:"text-sm font-semibold text-gray-700 px-2 py-1 border-2 border-green-300 rounded-lg focus:border-green-500 focus:ring-1 focus:ring-green-500 focus:outline-none bg-white mb-1"}),o.jsx("div",{className:"text-xs text-green-600 font-medium",children:"T0 - Date de l'acte (Fondateurs)"}),o.jsx("div",{className:"text-xs text-gray-500 italic mt-1",children:" Changer cette date ajustera automatiquement toutes les dates d'entre des participants et la date des travaux"})]})}):o.jsx("div",{className:"text-sm font-semibold text-gray-700",children:g(I)})}),o.jsx("div",{className:"flex flex-wrap gap-2",children:P.map((V,H)=>{const w=i===V.name,E=t.findIndex(_=>_.name===V.name);return o.jsxs("div",{className:`px-4 py-2 rounded-lg border-2 cursor-pointer transition-all hover:shadow-md ${V.enabled===!1?"opacity-50 bg-gray-100 border-gray-300 text-gray-600":V.isFounder?"bg-green-50 border-green-300 text-green-800 hover:bg-green-100":"bg-blue-50 border-blue-300 text-blue-800 hover:bg-blue-100"}`,onClick:()=>m(V.name),children:[o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:V.enabled!==!1,onChange:_=>{_.stopPropagation(),E!==-1&&a(E,{...V,enabled:_.target.checked})},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500",title:V.enabled===!1?"Activer ce participant":"Dsactiver ce participant"}),o.jsxs("div",{children:[o.jsx("div",{className:"font-semibold",children:V.name}),o.jsxs("div",{className:"text-xs opacity-75",children:["Unit ",V.unitId,"  ",V.surface,"m"]}),V.purchaseDetails?.buyingFrom&&o.jsxs("div",{className:"text-xs mt-1 font-medium",children:[" Achte de ",V.purchaseDetails.buyingFrom]})]})]}),w?o.jsx(Ol,{className:"w-4 h-4 flex-shrink-0"}):o.jsx(kl,{className:"w-4 h-4 flex-shrink-0"})]}),w&&o.jsx("div",{className:"mt-3 pt-3 border-t border-current border-opacity-20 text-xs space-y-1",children:o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsx("span",{className:"opacity-75",children:"Capital:"}),o.jsxs("div",{className:"font-semibold",children:[V.capitalApporte?.toLocaleString("fr-BE")," "]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"opacity-75",children:"Frais notaire:"}),o.jsxs("div",{className:"font-semibold",children:[V.registrationFeesRate,"%"]})]}),V.interestRate&&o.jsxs("div",{children:[o.jsx("span",{className:"opacity-75",children:"Taux:"}),o.jsxs("div",{className:"font-semibold",children:[V.interestRate,"%"]})]}),V.durationYears&&o.jsxs("div",{children:[o.jsx("span",{className:"opacity-75",children:"Dure:"}),o.jsxs("div",{className:"font-semibold",children:[V.durationYears," ans"]})]}),V.parachevementsPerM2&&o.jsxs("div",{children:[o.jsx("span",{className:"opacity-75",children:"Parachvements:"}),o.jsxs("div",{className:"font-semibold",children:[V.parachevementsPerM2," /m"]})]}),V.purchaseDetails?.purchasePrice&&o.jsxs("div",{children:[o.jsx("span",{className:"opacity-75",children:"Prix d'achat:"}),o.jsxs("div",{className:"font-semibold",children:[V.purchaseDetails.purchasePrice.toLocaleString("fr-BE")," "]})]})]})})]},H)})})]}),D&&s&&o.jsxs("div",{className:"relative pl-20 mt-4",children:[o.jsx("div",{className:"absolute left-6 w-5 h-5 rounded-full border-4 bg-orange-500 border-orange-200 z-30 shadow-md",style:{transform:"translateY(-50%)"},title:`Dbut des rnovations: ${r?new Date(r).toLocaleDateString("fr-BE"):""}`}),o.jsx(lf,{renovationStartDate:r||e,deedDate:e,participants:t,onDateChange:s,canEdit:u,isLocked:h,lockReason:f!==null?f:void 0})]})]},I)}),y===null&&s&&o.jsxs("div",{className:"relative pl-20",children:[o.jsx("div",{className:"absolute left-6 w-5 h-5 rounded-full border-4 bg-orange-500 border-orange-200 z-30 shadow-md",style:{transform:"translateY(-50%)"},title:`Dbut des rnovations: ${r?new Date(r).toLocaleDateString("fr-BE"):""}`}),o.jsx(lf,{renovationStartDate:r||e,deedDate:e,participants:t,onDateChange:s,canEdit:u,isLocked:h,lockReason:f!==null?f:void 0})]})]})]}),o.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx(_a,{className:"w-4 h-4 text-green-600"}),o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Fondateurs"})]}),o.jsx("div",{className:"text-2xl font-bold text-green-700",children:t.filter(I=>I.isFounder).length})]}),o.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx(_a,{className:"w-4 h-4 text-blue-600"}),o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nouveauxelles entrantes"})]}),o.jsx("div",{className:"text-2xl font-bold text-blue-700",children:t.filter(I=>!I.isFounder).length})]})]})]})},K=t=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(t);function $w({calculations:t,participants:e}){return o.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-8 mb-8",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[o.jsx(Kv,{className:"w-12 h-12 text-blue-600"}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-4xl font-bold text-gray-900",children:"Achat Ferme du Temple"}),o.jsx("p",{className:"text-sm text-gray-500",children:"Wallonie, Belgique  Prix d'achat 650,000"})]})]}),o.jsx("div",{className:"bg-blue-50/50 border border-blue-200 rounded-lg p-3 mb-6 inline-block",children:o.jsxs("p",{className:"text-xs text-blue-700",children:[o.jsx("strong",{children:" Principe:"})," L'achat est fonction des m (",t.pricePerM2.toFixed(2),"/m)."]})}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:[o.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 border border-gray-200 shadow-sm",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(_a,{className:"w-4 h-4 text-gray-500"}),o.jsx("p",{className:"text-sm font-semibold text-gray-700",children:e.length})]}),o.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wide mt-1",children:"Participants"})]}),o.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 border border-gray-200 shadow-sm",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(py,{className:"w-4 h-4 text-gray-500"}),o.jsxs("p",{className:"text-sm font-semibold text-gray-700",children:[t.totalSurface,"m"]})]}),o.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wide mt-1",children:"Surface"})]}),o.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 border border-gray-300 shadow-sm",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(oy,{className:"w-4 h-4 text-gray-500"}),o.jsx("p",{className:"text-sm font-semibold text-gray-700",children:K(t.totals.total)})]}),o.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wide mt-1",children:"Cot Total"})]}),o.jsxs("div",{className:"bg-green-50 rounded-lg p-2 border-2 border-green-400 shadow-md",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(jy,{className:"w-4 h-4 text-green-700"}),o.jsx("p",{className:"text-base font-bold text-green-700",children:K(t.totals.capitalTotal)})]}),o.jsx("p",{className:"text-[10px] text-green-700 uppercase tracking-wide mt-1 font-semibold",children:"Capital Total"})]}),o.jsxs("div",{className:"bg-red-50 rounded-lg p-2 border-2 border-red-400 shadow-lg",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Qv,{className:"w-5 h-5 text-red-700"}),o.jsx("p",{className:"text-lg font-extrabold text-red-700",children:K(t.totals.totalLoansNeeded)})]}),o.jsx("p",{className:"text-[10px] text-red-700 uppercase tracking-wide mt-1 font-bold",children:" Emprunter"})]})]})]})}function Hw({onDownloadScenario:t,onLoadScenario:e,onExportToExcel:r,onPrintAllFounders:n}){const[s,a]=k.useState(!1);return o.jsxs("div",{className:"fixed right-0 top-1/2 -translate-y-1/2 z-[9999] no-print",children:[o.jsx("div",{className:`bg-white shadow-2xl border-l border-gray-200 transition-transform duration-300 ease-in-out ${s?"translate-x-0":"translate-x-full"}`,children:o.jsxs("div",{className:"p-4 min-w-[140px]",children:[o.jsxs("div",{className:"mb-3 pb-3 border-b border-gray-200 flex items-center justify-between",children:[o.jsx("h3",{className:"text-xs font-semibold text-gray-700",children:"Scnarios"}),o.jsx("button",{onClick:()=>a(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Fermer",children:o.jsx(ry,{className:"w-4 h-4 text-gray-600"})})]}),o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("button",{onClick:t,className:"bg-white hover:bg-gray-50 text-gray-700 font-medium p-2.5 rounded-lg transition-colors flex flex-col items-center justify-center gap-1 border border-gray-300",title:"Tlcharger",children:[o.jsx(da,{className:"w-5 h-5"}),o.jsx("span",{className:"text-[10px]",children:"Tlcharger"})]}),o.jsxs("button",{onClick:e,className:"bg-white hover:bg-gray-50 text-gray-700 font-medium p-2.5 rounded-lg transition-colors flex flex-col items-center justify-center gap-1 border border-gray-300",title:"Charger",children:[o.jsx($o,{className:"w-5 h-5"}),o.jsx("span",{className:"text-[10px]",children:"Charger"})]}),o.jsxs("button",{onClick:r,className:"bg-blue-600 hover:bg-blue-700 text-white font-medium p-2.5 rounded-lg transition-colors flex flex-col items-center justify-center gap-1 border border-blue-600",title:"Excel",children:[o.jsx(da,{className:"w-5 h-5"}),o.jsx("span",{className:"text-[10px]",children:"Excel"})]}),o.jsxs("button",{onClick:()=>window.print(),className:"bg-green-600 hover:bg-green-700 text-white font-medium p-2.5 rounded-lg transition-colors flex flex-col items-center justify-center gap-1 border border-green-600",title:"Imprimer / PDF",children:[o.jsx(eu,{className:"w-5 h-5"}),o.jsx("span",{className:"text-[10px]",children:"PDF"})]}),n&&o.jsxs("button",{onClick:n,className:"bg-purple-600 hover:bg-purple-700 text-white font-medium p-2.5 rounded-lg transition-colors flex flex-col items-center justify-center gap-1 border border-purple-600",title:"Imprimer tous les fondateurs",children:[o.jsx(eu,{className:"w-5 h-5"}),o.jsx("span",{className:"text-[10px]",children:"Fondateurs"})]})]}),o.jsx("p",{className:"text-[10px] text-gray-500 mt-3 pt-3 text-center border-t border-gray-200",children:"Sauvegarde auto"})]})}),o.jsx("button",{onClick:()=>a(!s),className:"absolute right-0 top-0 bg-white hover:bg-gray-50 rounded-l-lg shadow-lg border border-gray-200 p-3 transition-all",title:s?"Fermer":"Gestion des Scnarios",children:o.jsx(Ay,{className:"w-6 h-6 text-gray-600"})})]})}function Ww(t,e){if(!t)return e;const r=new Date(t);return isNaN(r.getTime())?e:r.toISOString().split("T")[0]}function Ep({availableLots:t,deedDate:e,formulaParams:r,onSelectLot:n,buyerEntryDate:s}){const[a,i]=k.useState({}),l=t.filter(p=>p.source==="FOUNDER"),c=t.filter(p=>p.source==="COPRO");if(n!==void 0&&!s)return o.jsxs("div",{id:"portage-marketplace",className:"bg-red-50 border border-red-300 rounded-lg p-6",children:[o.jsx("p",{className:"text-red-700 font-semibold",children:" Impossible de calculer le prix en portage"}),o.jsx("p",{className:"text-red-600 text-sm mt-2",children:"Le participant doit avoir une date d'entre valide pour acheter un lot en portage."})]});if(s&&!nf(s,e)&&s.getTime()!==e.getTime())return o.jsxs("div",{id:"portage-marketplace",className:"bg-red-50 border border-red-300 rounded-lg p-6",children:[o.jsx("p",{className:"text-red-700 font-semibold",children:" Date d'entre invalide"}),o.jsxs("p",{className:"text-red-600 text-sm mt-2",children:["La date d'entre du participant (",s.toLocaleDateString("fr-BE"),") doit tre gale ou postrieure  la date de l'acte (",e.toLocaleDateString("fr-BE"),")."]})]});const h=s||(nf(new Date,e)?new Date:e),f=Wl(e,h),m=(p,x)=>{i(g=>({...g,[p]:x}))};return t.length===0?o.jsx("div",{id:"portage-marketplace",className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:o.jsx("p",{className:"text-gray-600",children:"Aucun lot disponible pour le moment"})}):o.jsxs("div",{id:"portage-marketplace",className:"space-y-6 scroll-mt-6",children:[l.length>0&&o.jsxs("div",{className:"bg-orange-50 rounded-lg border-2 border-orange-200 p-6",children:[o.jsxs("h3",{className:"text-lg font-semibold text-orange-700 mb-3 flex items-center gap-2",children:[o.jsx("span",{children:""}),"Lots en Portage (Surface impose)"]}),o.jsx("div",{className:"space-y-3",children:l.map(p=>{const x=(p.originalPrice||0)+(p.originalNotaryFees||0)+(p.originalConstructionCost||0),g=Gi(x,0,f*12,r.averageInterestRate),y=Qu(p.originalPrice||0,p.originalNotaryFees||0,p.originalConstructionCost||0,f,r,g);return o.jsxs("div",{className:"bg-white border-2 border-orange-300 rounded-lg p-4 hover:shadow-md transition-shadow",children:[o.jsxs("div",{className:"flex items-start justify-between mb-3",children:[o.jsxs("div",{children:[o.jsxs("h4",{className:"font-semibold text-orange-800",children:["Lot #",p.lotId]}),o.jsxs("p",{className:"text-sm text-gray-600",children:["De: ",p.fromParticipant]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("p",{className:"text-sm text-gray-600",children:"Surface impose"}),o.jsxs("p",{className:"text-xl font-bold text-orange-700",children:[p.surface,"m"]})]})]}),o.jsxs("div",{className:"bg-orange-100 rounded p-3 mb-3",children:[o.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Prix de vente"}),o.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[y.totalPrice.toLocaleString("fr-BE",{maximumFractionDigits:0})," "]}),o.jsxs("div",{className:"text-xs text-gray-600 mt-2 space-y-1",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Base (achat+notaire+casco):"}),o.jsxs("span",{className:"font-semibold",children:[((p.originalPrice||0)+(p.originalNotaryFees||0)+(p.originalConstructionCost||0)).toLocaleString("fr-BE")," "]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsxs("span",{children:["Indexation (",r.indexationRate,"%  ",f.toFixed(1)," ans):"]}),o.jsxs("span",{className:"font-semibold",children:[y.indexation.toLocaleString("fr-BE")," "]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsxs("span",{children:["Frais de portage (",f.toFixed(1)," ans):"]}),o.jsxs("span",{className:"font-semibold",children:[y.carryingCostRecovery.toLocaleString("fr-BE")," "]})]})]})]}),n&&o.jsxs("button",{onClick:()=>n(p,y),className:"w-full px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white font-semibold rounded-lg transition-colors",children:[" Slectionner ce lot (",p.surface,"m)"]})]},p.lotId)})})]}),c.length>0&&o.jsxs("div",{className:"bg-purple-50 rounded-lg border-2 border-purple-200 p-6",children:[o.jsxs("h3",{className:"text-lg font-semibold text-purple-700 mb-3 flex items-center gap-2",children:[o.jsx("span",{children:""}),"Lots Coproprit (Surface libre)"]}),o.jsx("div",{className:"space-y-3",children:c.map(p=>{const x=a[p.lotId]||0,g=dw(x,p.totalCoproSurface||p.surface,f,r);return o.jsxs("div",{className:"bg-purple-50 border-2 border-purple-300 rounded-lg p-4 hover:shadow-md transition-shadow",children:[o.jsxs("div",{className:"flex items-start justify-between mb-3",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"font-bold text-purple-900 text-lg",children:["Lot #",p.lotId]}),o.jsx("div",{className:"text-sm text-purple-700",children:"De la coproprit"})]}),o.jsx("div",{className:"px-3 py-1 bg-purple-600 text-white text-xs font-semibold rounded-full",children:"Surface Libre"})]}),o.jsx("div",{className:"mb-3",children:o.jsxs("div",{className:"bg-white p-3 rounded border border-purple-200",children:[o.jsxs("label",{className:"block text-xs text-gray-600 mb-2",children:["Choisissez votre surface (max ",p.surface,"m)"]}),o.jsx("input",{type:"number",min:"0",max:p.surface,step:"1",value:x||"",onChange:y=>m(p.lotId,parseFloat(y.target.value)||0),placeholder:"0",className:"w-full px-3 py-2 text-lg font-bold border border-purple-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-500 focus:outline-none"})]})}),g&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[o.jsxs("div",{className:"bg-white p-3 rounded border border-purple-200",children:[o.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Votre surface"}),o.jsxs("div",{className:"text-2xl font-bold text-purple-900",children:[x,"m"]})]}),o.jsxs("div",{className:"bg-white p-3 rounded border border-purple-200",children:[o.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Prix Total"}),o.jsxs("div",{className:"text-2xl font-bold text-purple-900",children:["",g.totalPrice.toLocaleString("fr-BE",{maximumFractionDigits:0})]})]})]}),o.jsxs("div",{className:"bg-white p-3 rounded border border-purple-200",children:[o.jsx("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Dtail du prix:"}),o.jsxs("div",{className:"space-y-1 text-xs",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-600",children:"Prix de base"}),o.jsxs("span",{className:"font-semibold",children:["",g.basePrice.toLocaleString("fr-BE",{maximumFractionDigits:0})]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsxs("span",{className:"text-gray-600",children:["Indexation (",r.indexationRate,"%)"]}),o.jsxs("span",{className:"font-semibold",children:["",g.indexation.toLocaleString("fr-BE",{maximumFractionDigits:0})]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-600",children:"Frais de portage"}),o.jsxs("span",{className:"font-semibold",children:["",g.carryingCostRecovery.toLocaleString("fr-BE",{maximumFractionDigits:0})]})]}),o.jsxs("div",{className:"flex justify-between text-purple-700 font-semibold",children:[o.jsx("span",{children:"Prix au m"}),o.jsxs("span",{children:["",g.pricePerM2.toLocaleString("fr-BE",{maximumFractionDigits:0}),"/m"]})]})]})]}),n&&o.jsxs("button",{onClick:()=>n({...p,surface:x},g),className:"w-full mt-3 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg transition-colors",children:[" Slectionner ce lot (",x,"m)"]})]}),!g&&x>0&&o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-2 text-xs text-red-700",children:["Surface invalide (max ",p.surface,"m)"]})]},p.lotId)})})]}),o.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"text-blue-600 text-xl",children:""}),o.jsxs("div",{className:"text-xs text-blue-800",children:[o.jsx("div",{className:"font-semibold mb-1",children:" propos des prix"}),o.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[o.jsxs("li",{children:[o.jsx("strong",{children:"Lots portage:"})," Prix fixe incluant ",f.toFixed(1)," ans d'indexation  ",r.indexationRate,"% et frais de portage dude la fondateurrice"]}),o.jsxs("li",{children:[o.jsx("strong",{children:"Lots copro:"})," Choisissez votre surface. Prix calcul proportionnellement avec indexation et frais de portage"]}),o.jsx("li",{children:"Tous les prix sont indicatifs et sujets  validation lors de la transaction"})]})]})]})})]})}function ci({children:t,formula:e}){return o.jsxs(Z2,{delayDuration:200,children:[o.jsx(ew,{asChild:!0,children:o.jsxs("span",{className:"inline-flex items-center gap-1 cursor-help",children:[t,o.jsx(wm,{className:"w-3 h-3 text-gray-400 hover:text-blue-600 transition-colors"})]})}),o.jsx(tw,{children:o.jsxs(rw,{className:"bg-gray-900 text-white text-xs rounded-lg px-3 py-2 max-w-xs shadow-lg z-50",sideOffset:5,children:[e.map((r,n)=>o.jsx("div",{className:n===0?"font-semibold mb-1":"",children:r},n)),o.jsx(nw,{className:"fill-gray-900"})]})})]})}function qw(t,e){return["Prix moyen par mtre carr",`${t.purchase.toLocaleString()} achat total  ${e}m surface totale`]}function Gw(){return["Somme de toutes les dpenses du projet","Achat + Notaire + Construction + Commun"]}function zw(t,e){return["Revenus attendus du portage & ventes coproprit",`Somme de ${e} paiement(s) = ${t.toLocaleString()}`,"Reus lorsque de nouveaux participants rejoignent"]}function Yw(t,e,r){return["Calcul du prix de vente du lot en portage",`Base acquisition (achat+notaire+casco): ${t.basePrice.toLocaleString()}`,`Indexation (${r}%  ${e.toFixed(1)} ans): ${t.indexation.toLocaleString()}`,`Frais de portage (${e.toFixed(1)} ans): ${t.carryingCostRecovery.toLocaleString()}`,`Prix total: ${t.totalPrice.toLocaleString()}`]}function Kw({portageLots:t,onAddLot:e,onRemoveLot:r,onUpdateSurface:n,onUpdateConstructionPayment:s,deedDate:a,formulaParams:i,participantName:l}){const c=()=>{const u=document.getElementById("portage-marketplace");u&&u.scrollIntoView({behavior:"smooth",block:"start"})};return o.jsxs("div",{className:"p-3 bg-orange-50/40 rounded-lg border border-orange-100",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsx("p",{className:"text-xs text-orange-600 uppercase tracking-wide font-medium",children:" Lot en Portage"}),t.length===0&&o.jsx("button",{onClick:e,className:"text-xs bg-orange-600 hover:bg-orange-700 text-white px-3 py-1 rounded transition-colors",children:"+ Ajouter lot portage"})]}),t&&t.length>0?o.jsxs("div",{className:"space-y-4",children:[t.map(u=>{const h=u.soldDate!==void 0,f=h&&u.soldDate?Wl(a,u.soldDate):0;let m=null,p=null;if(h){const x=u.originalPrice??0,g=u.originalNotaryFees??0,y=u.originalConstructionCost??0;p=Gi(x,0,Math.round(f*12),i.averageInterestRate),m=Qu(x,g,y,f,i,p,0)}return o.jsxs("div",{className:"bg-white p-4 rounded border border-orange-300 space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Surface  vendre (m)"}),o.jsx("input",{type:"number",step:"1",min:"0",value:u.allocatedSurface||0,onChange:x=>n(u.lotId,parseFloat(x.target.value)||0),className:"w-full px-3 py-2 text-sm font-semibold border border-orange-300 rounded-lg focus:border-orange-500 focus:ring-1 focus:ring-orange-500 focus:outline-none"})]}),s&&o.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 space-y-2",children:[o.jsx("div",{className:"text-xs font-semibold text-blue-900 mb-2",children:"Paiement des travaux de construction"}),o.jsx("p",{className:"text-xs text-blue-700 mb-2",children:"Qui paie pour les travaux pendant la priode de portage?"}),o.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:u.founderPaysCasco||!1,onChange:x=>{const g=x.target.checked,y=g&&u.founderPaysParachvement||!1;s(u.lotId,g,y)},className:"mt-0.5 w-4 h-4 text-blue-600 border-blue-300 rounded focus:ring-blue-500"}),o.jsx("span",{className:"text-sm text-gray-700",children:"Le porteur (fondateur) paie le CASCO"})]}),o.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:u.founderPaysParachvement||!1,onChange:x=>{x.target.checked?s(u.lotId,!0,!0):s(u.lotId,u.founderPaysCasco||!1,!1)},disabled:!u.founderPaysCasco,className:"mt-0.5 w-4 h-4 text-blue-600 border-blue-300 rounded focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"}),o.jsxs("span",{className:`text-sm ${u.founderPaysCasco?"text-gray-700":"text-gray-400"}`,children:["Le porteur (fondateur) paie les parachvements",!u.founderPaysCasco&&o.jsx("span",{className:"block text-xs text-gray-400 italic",children:"(ncessite CASCO)"})]})]}),(u.founderPaysCasco||u.founderPaysParachvement)&&o.jsxs("div",{className:"mt-2 p-2 bg-blue-100 rounded text-xs text-blue-800",children:[" L'acheteur ne paiera pas pour le"," ",u.founderPaysParachvement?"CASCO ni les parachvements":"CASCO"," ","car le porteur les a dj pays."]})]}),h&&m?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-2 mb-2",children:[o.jsx("div",{className:"text-xs text-blue-700 mb-1",children:" Date de vente prvue:"}),o.jsx("div",{className:"text-sm font-semibold text-blue-900",children:u.soldDate?.toLocaleDateString("fr-BE",{year:"numeric",month:"long",day:"numeric"})})]}),o.jsxs("div",{className:"text-sm",children:[o.jsxs("div",{className:"text-gray-700 mb-1",children:["Prix de vente (",f.toFixed(1)," ans de portage):"]}),o.jsx("div",{className:"text-2xl font-bold text-orange-900",children:K(m.totalPrice)})]}),o.jsx("div",{className:"bg-orange-50 rounded border border-orange-200 overflow-hidden",children:o.jsx("table",{className:"w-full text-xs",children:o.jsxs("tbody",{children:[o.jsxs("tr",{className:"border-b border-orange-100",children:[o.jsx("td",{className:"px-3 py-2 text-gray-700",children:"Base acquisition (achat+notaire+casco)"}),o.jsx("td",{className:"px-3 py-2 text-right font-semibold",children:K(m.basePrice)})]}),o.jsxs("tr",{className:"border-b border-orange-100",children:[o.jsxs("td",{className:"px-3 py-2 text-gray-700",children:["Indexation (",i.indexationRate,"%  ",f.toFixed(1)," ans)"]}),o.jsx("td",{className:"px-3 py-2 text-right font-semibold",children:K(m.indexation)})]}),o.jsxs("tr",{className:"border-b border-orange-200",children:[o.jsxs("td",{className:"px-3 py-2 text-gray-700",children:["Frais de portage (",f.toFixed(1)," ans)"]}),o.jsx("td",{className:"px-3 py-2 text-right font-semibold",children:K(m.carryingCostRecovery)})]}),o.jsxs("tr",{className:"bg-orange-100",children:[o.jsx("td",{className:"px-3 py-2 font-bold text-orange-900",children:"Prix total"}),o.jsx("td",{className:"px-3 py-2 text-right font-bold text-orange-900",children:o.jsx(ci,{formula:Yw(m,f,i.indexationRate),children:K(m.totalPrice)})})]})]})})})]}):o.jsxs("div",{className:"bg-gray-50 rounded border border-gray-300 p-4 text-center",children:[o.jsx("div",{className:"text-sm text-gray-600 italic",children:"Pas encore de date de vente prvue"}),o.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Le prix sera calcul lorsqu'une acheteurse slectionnera ce lot"})]}),o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsx("button",{onClick:c,className:"text-xs text-orange-700 hover:text-orange-900 underline",children:" Voir dans la place de march"}),o.jsx("button",{onClick:()=>r(u.lotId),className:"text-red-600 hover:text-red-700 text-xs px-2 py-1 rounded border border-red-300 hover:bg-red-50",children:"Retirer"})]})]},u.lotId)}),t.length<2&&o.jsx("button",{onClick:e,className:"w-full text-xs bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded transition-colors",children:"+ Ajouter un autre lot portage"})]}):o.jsx("p",{className:"text-xs text-gray-500 italic",children:"Aucun lot en portage configur."})]})}function Xw(t,e,r){const n=e.reduce((s,a)=>s+a.surface,0);return n<=0?[]:e.map(s=>{const a=s.surface/n,i=t*a,l=(r.getTime()-s.entryDate.getTime())/(1e3*60*60*24*365.25);return{participantName:s.name,quotite:a,share:i,yearsHeld:l}})}function To(t,e){return t?t instanceof Date?t:new Date(t):e}function Qw(t,e,r,n){const s=[],i=[...e.map(l=>({...l,entryDate:To(l.entryDate,n)}))].sort((l,c)=>l.entryDate.getTime()-c.entryDate.getTime());for(const l of i){if(To(t.entryDate||(t.isFounder?n:void 0),t.isFounder?n:new Date)>l.entryDate||(t.surface||0)<=0)continue;const h=r.filter(p=>{const x=To(p.entryDate||(p.isFounder?n:void 0),p.isFounder?n:new Date),g=p.surface||0;return x<=l.entryDate&&g>0}).map(p=>({name:p.name,surface:p.surface||0,isFounder:p.isFounder||!1,entryDate:To(p.entryDate||(p.isFounder?n:void 0),p.isFounder?n:new Date)})),m=Xw(l.amount,h,l.entryDate).find(p=>p.participantName===t.name);m&&m.share>0&&s.push({date:l.entryDate,buyer:l.buyer,amount:m.share,type:"copro",description:`Redistribution vente coproprit (quotit: ${(m.quotite*100).toFixed(1)}%)`})}return s}function Jw(t,e,r,n=30,s,a,i){return k.useMemo(()=>{const l=e.filter(A=>A.purchaseDetails?.buyingFrom===t.name).map(A=>({date:A.entryDate||new Date(r),buyer:A.name,amount:A.purchaseDetails?.purchasePrice||0,type:"portage",description:"Achat de lot portage"})),c=i||zr,u=1-n/100,h=a?.totals?(a.totals.purchase||0)+(a.totals.totalDroitEnregistrements||0)+(a.totals.construction||0):0,f=a?.totalSurface||0,m=s?.renovationStartDate,p=a?.participantBreakdown?a.participantBreakdown.reduce((A,D)=>A+(D.personalRenovationCost||0),0):0,x=new Date(r),g=e.filter(A=>A.purchaseDetails?.buyingFrom==="Coproprit").map(A=>{const D=A.entryDate?A.entryDate instanceof Date?A.entryDate:new Date(A.entryDate):x,V=A.surface||0,H=Wl(x,D);let w;return h>0&&f>0&&V>0&&m&&p>0?w=hp(V,h,f,H,c,0,m,D,p).distribution.toParticipants:w=(A.purchaseDetails?.purchasePrice||0)*u,{buyer:A.name,entryDate:D,amount:w}}),y=Qw(t,g,e,x),I=[...l,...y].sort((A,D)=>new Date(A.date).getTime()-new Date(D.date).getTime()),P=I.reduce((A,D)=>A+D.amount,0);return{paybacks:I,totalRecovered:P}},[t,e,r,n,s?.renovationStartDate,s,a?.totals?.purchase,a?.totals?.totalDroitEnregistrements,a?.totals?.construction,a?.totalSurface,a?.participantBreakdown,i])}function Tp({participant:t,allParticipants:e,deedDate:r,coproReservesShare:n=30,className:s="",projectParams:a,calculations:i,formulaParams:l}){const{paybacks:c,totalRecovered:u}=Jw(t,e,r,n,a,i,l);return c.length===0?null:o.jsxs("div",{className:`p-4 bg-purple-50 rounded-lg border border-purple-200 ${s}`,children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold mb-3",children:" Remboursements attendus"}),o.jsx("div",{className:"space-y-2",children:c.map((h,f)=>o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-purple-100",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-800",children:h.buyer}),o.jsxs("span",{className:"text-gray-600 text-xs ml-2",children:["(",new Date(h.date).toLocaleDateString("fr-BE",{year:"numeric",month:"short",day:"numeric"}),")"]})]}),o.jsx("div",{className:"font-bold text-purple-700",children:K(h.amount)})]}),o.jsxs("div",{className:"text-xs text-gray-500",children:[h.type==="portage"?" ":" ",h.description]})]},f))}),o.jsxs("div",{className:"mt-3 pt-3 border-t border-purple-300 flex justify-between items-center",children:[o.jsx("span",{className:"text-sm font-semibold text-gray-800",children:"Total rcupr"}),o.jsx("span",{className:"text-lg font-bold text-purple-800",children:o.jsx(ci,{formula:zw(u,c.length),children:K(u)})})]}),o.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"Ces montants seront verss lorsque les nouveaux participants entreront dans le projet."})]})}function Ap({participant:t,participantCalc:e,personalRenovationCost:r,validationErrors:n,onUpdateParticipant:s}){const a=t.capitalForLoan1||0,i=t.capitalForLoan2||0,l=a+i,c=(t.capitalApporte||0)-l,u=t.loan2RenovationAmount||0,h=Math.max(0,r-u),f=r-u,m=t.loan2DelayYears??2,p=(t.durationYears||0)-m,x=e?.loan1Amount,g=e?.loan2Amount,y=e?.loan1MonthlyPayment,I=e?.loan2MonthlyPayment;return o.jsxs("div",{className:"border-t pt-4 mt-4",children:[o.jsxs("label",{className:"flex items-center gap-2 mb-4 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:t.useTwoLoans||!1,onChange:P=>{s({...t,useTwoLoans:P.target.checked})},className:"w-4 h-4 text-blue-600 rounded"}),o.jsx("span",{className:"font-semibold text-sm",children:"Financement en deux prts"})]}),t.useTwoLoans&&o.jsxs("div",{className:"ml-6 mt-3 space-y-4 bg-blue-50 p-4 rounded-lg border border-blue-200",children:[o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-blue-100",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Calendrier des prts"}),p>0&&o.jsxs("span",{className:"text-xs text-gray-500",children:["Dure prt 2: ",o.jsxs("span",{className:"font-semibold text-blue-700",children:[p," ans"]})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Prt 2 commence aprs (annes)"}),o.jsx("input",{type:"number",value:m,onChange:P=>{s({...t,loan2DelayYears:parseFloat(P.target.value)||2})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none bg-white",min:"1",step:"0.5"}),o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Dure totale: ",t.durationYears||0," ans"]})]}),p>0&&o.jsx("div",{className:"flex items-end",children:o.jsxs("div",{className:"w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Dure prt 2 calcule"}),o.jsxs("p",{className:"text-sm font-semibold text-blue-700",children:[p," ans"]})]})})]}),n.loanDelay&&o.jsxs("div",{className:"text-red-600 text-xs mt-2 p-2 bg-red-50 rounded border border-red-200",children:[" ",n.loanDelay]})]}),o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-blue-100",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rpartition des cots de rnovation"}),o.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Ajustez le curseur pour quilibrer les cots de rnovation entre les deux prts."}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),o.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"Prt 1"})]}),o.jsx("div",{className:"flex-1 mx-3 relative",children:r>0&&o.jsxs("div",{className:"relative h-2 bg-gradient-to-r from-blue-500 via-blue-300 to-blue-500 rounded-full",children:[o.jsx("div",{className:"absolute top-0 h-full bg-blue-200 transition-all duration-150 rounded-l-full",style:{left:0,width:`${h/r*100}%`}}),o.jsx("div",{className:"absolute top-0 h-full bg-blue-500 transition-all duration-150 rounded-r-full",style:{left:`${h/r*100}%`,width:`${u/r*100}%`}})]})}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-700"}),o.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"Prt 2"})]})]}),o.jsxs("div",{className:"relative",children:[o.jsx("input",{type:"range",min:"0",max:r||0,step:"1000",value:u,onChange:P=>{s({...t,loan2RenovationAmount:parseFloat(P.target.value)||0})},className:"w-full h-3 bg-transparent appearance-none cursor-pointer renovation-slider"}),o.jsx("style",{children:`
                  .renovation-slider::-webkit-slider-thumb {
                    appearance: none;
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    background: #3b82f6;
                    cursor: pointer;
                    border: 3px solid white;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
                    transition: transform 0.1s ease;
                  }
                  .renovation-slider::-webkit-slider-thumb:hover {
                    transform: scale(1.1);
                    background: #2563eb;
                  }
                  .renovation-slider::-moz-range-thumb {
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    background: #3b82f6;
                    cursor: pointer;
                    border: 3px solid white;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
                    transition: transform 0.1s ease;
                  }
                  .renovation-slider::-moz-range-thumb:hover {
                    transform: scale(1.1);
                    background: #2563eb;
                  }
                  .renovation-slider::-ms-thumb {
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    background: #3b82f6;
                    cursor: pointer;
                    border: 3px solid white;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
                  }
                  .renovation-slider::-webkit-slider-runnable-track {
                    height: 3px;
                    background: transparent;
                  }
                  .renovation-slider::-moz-range-track {
                    height: 3px;
                    background: transparent;
                  }
                `})]}),o.jsxs("div",{className:"flex items-center justify-between mt-2",children:[o.jsx("span",{className:"text-xs text-gray-500",children:"0 (tout dans prt 1)"}),o.jsxs("span",{className:"text-xs font-semibold text-blue-700 px-2 py-1 bg-blue-50 rounded",children:["",u.toLocaleString()]}),o.jsxs("span",{className:"text-xs text-gray-500",children:["",(r||0).toLocaleString()," (tout dans prt 2)"]})]})]}),o.jsx("div",{className:"pt-3 border-t border-gray-100",children:o.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[o.jsxs("div",{className:`text-center p-3 rounded-lg border-2 ${f>=0?"bg-blue-50 border-blue-200":"bg-red-50 border-red-200"}`,children:[o.jsx("p",{className:"text-gray-600 mb-1.5",children:"Dans prt 1"}),o.jsxs("p",{className:`text-base font-bold ${f>=0?"text-blue-700":"text-red-700"}`,children:["",h.toLocaleString()]}),o.jsx("p",{className:`text-xs mt-1 ${f>=0?"text-gray-500":"text-red-600"}`,children:r>0?`${Math.round(h/r*100)}%`:"0%"})]}),o.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[o.jsx("p",{className:"text-gray-500 mb-1.5",children:"Total"}),o.jsxs("p",{className:"text-base font-bold text-gray-900",children:["",r?.toLocaleString()||"0"]})]}),o.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg border-2 border-blue-200",children:[o.jsx("p",{className:"text-gray-600 mb-1.5",children:"Dans prt 2"}),o.jsxs("p",{className:"text-base font-bold text-blue-700",children:["",u.toLocaleString()]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r>0?`${Math.round(u/r*100)}%`:"0%"})]})]})}),n.renovationAmount&&o.jsxs("div",{className:"text-red-600 text-xs mt-3 p-2 bg-red-50 rounded border border-red-200",children:[" ",n.renovationAmount]})]}),o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-blue-100",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rpartition du capital apport"}),o.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Allouez votre capital disponible entre les deux prts."}),o.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Capital pour prt 1 ()"}),o.jsx("input",{type:"number",value:a,onChange:P=>{s({...t,capitalForLoan1:parseFloat(P.target.value)||0})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none bg-white",min:"0",step:"1000"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Capital pour prt 2 ()"}),o.jsx("input",{type:"number",value:i,onChange:P=>{s({...t,capitalForLoan2:parseFloat(P.target.value)||0})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none bg-white",min:"0",step:"1000"})]})]}),o.jsxs("div",{className:"pt-3 border-t border-gray-100 space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-xs text-gray-600",children:"Capital allou:"}),o.jsxs("span",{className:`text-sm font-semibold ${l<=(t.capitalApporte||0)?"text-gray-900":"text-red-700"}`,children:["",l.toLocaleString()]})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-xs text-gray-600",children:"Capital disponible:"}),o.jsxs("span",{className:"text-sm font-bold text-green-700",children:["",(t.capitalApporte||0).toLocaleString()]})]}),c!==0&&o.jsxs("div",{className:"flex items-center justify-between pt-1 border-t border-gray-100",children:[o.jsx("span",{className:"text-xs text-gray-500",children:c>0?"Capital non allou:":"Dpassement:"}),o.jsxs("span",{className:`text-xs font-semibold ${c>=0?"text-gray-600":"text-red-700"}`,children:["",Math.abs(c).toLocaleString()]})]})]}),n.capitalAllocation&&o.jsxs("div",{className:"text-red-600 text-xs mt-2 p-2 bg-red-50 rounded border border-red-200",children:[" ",n.capitalAllocation]})]}),(x!==void 0||g!==void 0)&&o.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[o.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-3 uppercase tracking-wide",children:"Rsultats calculs"}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Prt 1"}),o.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Montant  emprunter:"}),o.jsx("p",{className:"text-sm font-bold text-gray-900 mb-0.5",children:x!==void 0?`${x.toLocaleString("fr-FR",{maximumFractionDigits:0})}`:""}),y!==void 0&&x!==void 0&&x>0&&o.jsxs("p",{className:"text-xs text-gray-500",children:["Mensualit: ",y.toLocaleString("fr-FR",{maximumFractionDigits:0})]}),x!==void 0&&x===0&&o.jsx("p",{className:"text-xs text-green-600 font-medium",children:"Entirement couvert par le capital"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Prt 2"}),u>0&&o.jsxs("div",{className:"mb-1",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Rnovation alloue:"}),o.jsxs("p",{className:"text-xs font-semibold text-blue-700",children:["",u.toLocaleString()]})]}),o.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Montant  emprunter:"}),o.jsx("p",{className:"text-sm font-bold text-gray-900 mb-0.5",children:g!==void 0?`${g.toLocaleString("fr-FR",{maximumFractionDigits:0})}`:""}),I!==void 0&&g!==void 0&&g>0&&o.jsxs("p",{className:"text-xs text-gray-500",children:["Mensualit: ",I.toLocaleString("fr-FR",{maximumFractionDigits:0}),o.jsxs("span",{className:"text-gray-400",children:[" (",p," ans)"]})]}),g===0&&u>0&&o.jsx("p",{className:"text-xs text-green-600 font-medium",children:"Entirement couvert par le capital"}),g===0&&u===0&&o.jsx("p",{className:"text-xs text-gray-400",children:"Aucune rnovation alloue"})]})]})]})]})]})}function Sp({participant:t,participantCalc:e,projectParams:r,onUpdateParachevementsPerM2:n,onUpdateCascoSqm:s,onUpdateParachevementsSqm:a}){return o.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold mb-3",children:"Dtail Construction"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[o.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"CASCO (gros uvre)"}),o.jsx("p",{className:"text-lg font-bold text-gray-900",children:K(e.casco)}),o.jsxs("p",{className:"text-xs text-gray-400",children:[t.cascoSqm||e.surface,"m  ",r.globalCascoPerM2,"/m (global)",r.cascoTvaRate?` + TVA ${r.cascoTvaRate}%`:""]})]}),o.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[o.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Parachvements - Prix/m"}),o.jsx("input",{type:"number",step:"10",value:t.parachevementsPerM2,onChange:i=>n(parseFloat(i.target.value)||0),className:"w-full px-3 py-2 text-sm font-semibold border border-gray-300 rounded-lg focus:border-gray-500 focus:ring-1 focus:ring-gray-500 focus:outline-none mb-2"}),o.jsxs("p",{className:"text-xs text-gray-500",children:["Total: ",o.jsx("span",{className:"font-bold text-gray-900",children:K(e.parachevements)})]}),o.jsxs("p",{className:"text-xs text-gray-400",children:[t.parachevementsSqm||e.surface,"m  ",t.parachevementsPerM2,"/m"]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[o.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[o.jsx("label",{className:"block text-xs text-blue-700 font-medium mb-1",children:"Surface  rnover CASCO (m)"}),o.jsx("input",{type:"number",step:"1",min:"0",max:e.surface,value:t.cascoSqm||e.surface,onChange:i=>s(parseFloat(i.target.value)||void 0),className:"w-full px-3 py-2 text-sm font-semibold border border-blue-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none",placeholder:`${e.surface}m (total)`}),o.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Surface totale: ",e.surface,"m"]})]}),o.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[o.jsx("label",{className:"block text-xs text-blue-700 font-medium mb-1",children:"Surface  rnover Parachvements (m)"}),o.jsx("input",{type:"number",step:"1",min:"0",max:e.surface,value:t.parachevementsSqm||e.surface,onChange:i=>a(parseFloat(i.target.value)||void 0),className:"w-full px-3 py-2 text-sm font-semibold border border-blue-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none",placeholder:`${e.surface}m (total)`}),o.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Surface totale: ",e.surface,"m"]})]})]})]})}function Zw(t,e){if(!t.isFounder||!e)return null;const r=t.surface||0;if(r===0)return null;const n=e.filter(f=>f.isFounder===!0).reduce((f,m)=>f+(m.surface||0),0);if(n===0)return null;const s=r/n,a=Math.round(s*1e3),i=1e3,l=(f,m)=>m===0?f:l(m,f%m),c=l(a,i),u=a/c,h=i/c;return`${u}/${h}`}function Np({participant:t,participantCalc:e,projectParams:r,allParticipants:n,unitDetails:s,deedDate:a,formulaParams:i}){const l=Zw(t,n),c=t.isFounder&&t.surface||0,u=t.isFounder&&n?n.filter(E=>E.isFounder===!0).reduce((E,_)=>E+(_.surface||0),0):0,h=t.isFounder&&c>0&&u>0,f=!t.isFounder;let m;if(f&&t.purchaseDetails?.buyingFrom==="Coproprit"&&n&&r&&a&&t.entryDate)try{const E=n.filter(_=>{const N=_.entryDate||(_.isFounder?new Date(a):null);if(!N)return!1;const T=t.entryDate?t.entryDate instanceof Date?t.entryDate:new Date(t.entryDate):new Date(a);return N<=T});m=dp(t.surface||0,E,r.totalPurchase,a,t.entryDate,i)}catch(E){console.error("Error calculating newcomer price:",E)}const p=r&&n&&s?Iw(t,n,r,s,a):null,x=n?rl(n,a):1,g=f&&t.entryDate&&n?fp(n,t.entryDate,a):x;let y,I=null;if(p)if(f&&t.entryDate&&a&&i){const E=Pw(p.totalCommunBeforeDivision,g,a,t.entryDate,i);y=E.total,I=E}else y=p.sharedCostsPerParticipant;else y=0;const P=p?.expenseCategoriesTotal||0,A=p?.honorairesPerParticipant||0,D=p?.frais3ansPerParticipant||0,V=p?.ponctuelsPerParticipant||0,H=p?.travauxCommunsPerParticipant||0,w=p?.totalCommunBeforeDivision||0;return o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold mb-4",children:"Dcomposition des Cots"}),o.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1.5",children:"Part d'achat"}),o.jsx("p",{className:"text-lg font-bold text-gray-900",children:K(m?m.totalPrice:e.purchaseShare??0)}),(e.surface??0)>0&&o.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[e.surface,"m"]}),f&&(m||t.purchaseDetails?.purchasePrice)&&o.jsxs("div",{className:"mt-1.5 pt-1.5 border-t border-gray-100",children:[o.jsx("p",{className:"text-xs text-gray-500 italic mb-1",children:"Calcul pour nouveau participant:"}),t.purchaseDetails?.buyingFrom==="Coproprit"&&m?o.jsxs("p",{className:"text-xs text-gray-400 leading-relaxed",children:[o.jsx("span",{className:"font-medium",children:"1. Calcul quotit:"}),o.jsx("br",{}),"Quotit = ",t.surface||0,"m  ",n?.reduce((E,_)=>E+(_.surface||0),0),"m total = ",(m.quotite*100).toFixed(1),"% (",Math.round(m.quotite*1e3),"/1000)",o.jsx("br",{}),o.jsx("br",{}),o.jsx("span",{className:"font-medium",children:"2. Prix de base = Quotit  Cot projet"}),o.jsx("br",{}),"Prix de base = ",(m.quotite*100).toFixed(1),"%  ",K(r?.totalPurchase||0)," = ",K(m.basePrice),o.jsx("br",{}),o.jsx("br",{}),o.jsxs("span",{className:"font-medium",children:["3. Formule portage copro (",m.yearsHeld.toFixed(1)," ans):"]}),o.jsx("br",{}),"Indexation (",i?.indexationRate??2,"%/an): ",K(m.basePrice),"  ",((Math.pow(1+(i?.indexationRate??2)/100,m.yearsHeld)-1)*100).toFixed(1),"% = ",K(m.indexation),o.jsx("br",{}),"Rcup. frais portage: ",K(m.carryingCostRecovery),o.jsx("br",{}),o.jsx("br",{}),o.jsxs("span",{className:"font-semibold text-gray-700",children:["Prix final = ",K(m.basePrice)," + ",K(m.indexation)," + ",K(m.carryingCostRecovery)," = ",K(m.totalPrice)]})]}):t.purchaseDetails?.buyingFrom!=="Coproprit"?o.jsxs("p",{className:"text-xs text-gray-400 leading-relaxed",children:["Formule portage depuis fondateur:",o.jsx("br",{}),"Prix de base + Indexation + Rcupration frais de portage + Rcupration honoraires",o.jsx("br",{}),o.jsx("span",{className:"font-medium",children:"Prix de base = Prix d'origine du fondateur par lot"}),o.jsx("br",{}),"Indexation = croissance compose sur prix de base",o.jsx("br",{}),o.jsx("span",{className:"text-gray-500",children:"Stock dans: purchaseDetails.purchasePrice"})]}):o.jsx("p",{className:"text-xs text-gray-400",children:"Aucun dtail disponible"}),o.jsxs("p",{className:"text-xs text-green-600 mt-1.5 pt-1 border-t border-green-100",children:[" Utilise ",m?"calcul quotit + formule portage":"purchaseDetails.purchasePrice (formule portage calcule)"]})]}),l&&o.jsxs("div",{className:"mt-1.5 pt-1.5 border-t border-gray-100",children:[o.jsxs("p",{className:"text-xs text-gray-500",children:["Quotit: ",l]}),h&&o.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[c,"m / ",u,"m"]})]})]}),o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1.5",children:"Droit d'enregistrements"}),o.jsx("p",{className:"text-lg font-bold text-gray-900",children:K(e.droitEnregistrements??0)}),o.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[e.registrationFeesRate??0,"%"]}),e.purchaseShare!=null&&e.registrationFeesRate!=null&&o.jsxs("p",{className:"text-xs text-gray-400 mt-1.5 pt-1.5 border-t border-gray-100",children:["Part d'achat (",K(e.purchaseShare),")  ",e.registrationFeesRate,"% = ",K(e.droitEnregistrements??0)]})]}),o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1.5",children:"Frais de notaire"}),o.jsx("p",{className:"text-lg font-bold text-gray-900",children:K(e.fraisNotaireFixe??0)}),o.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[e.quantity??0," lot",(e.quantity??0)>1?"s":""]})]}),o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-purple-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1.5",children:"Commun"}),o.jsx("p",{className:"text-lg font-bold text-purple-700",children:K(y||0)}),(P>0||A>0||D>0||V>0||H>0)&&o.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-100 space-y-1 text-xs text-gray-600",children:[P>0&&o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Infrastructures"}),o.jsx("span",{className:"font-medium",children:K(P||0)})]}),H>0&&o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Travaux communs"}),o.jsx("span",{className:"font-medium",children:K(H||0)})]}),A>0&&o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Honoraires"}),o.jsx("span",{className:"font-medium",children:K(A||0)})]}),D>0&&o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Frais 3 ans"}),o.jsx("span",{className:"font-medium",children:K(D||0)})]}),V>0&&o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Ponctuels"}),o.jsx("span",{className:"font-medium",children:K(V||0)})]})]}),f&&I?o.jsxs("p",{className:"text-xs text-gray-400 mt-2 pt-2 border-t border-purple-50",children:[o.jsx("span",{className:"italic",children:"Formule portage copro:"}),o.jsx("br",{}),o.jsxs("span",{className:"font-medium",children:[K(w||0),"  ",g," participant",g>1?"s":""," = ",K(I.base||0),I.indexation>0&&o.jsxs(o.Fragment,{children:[o.jsx("br",{}),"+ Indexation (",I.yearsHeld.toFixed(2)," ans) = ",K(I.indexation||0)]}),o.jsx("br",{}),"= ",K(I.total||0)]})]}):x>0&&w>0?o.jsxs("p",{className:"text-xs text-gray-400 mt-2 pt-2 border-t border-purple-50",children:[o.jsx("span",{className:"italic",children:"Rpartis quitablement (non par quotit):"}),o.jsx("br",{}),o.jsxs("span",{className:"font-medium",children:[K(w||0),"  ",x," participant",x>1?"s":"","  l'achat = ",K(y||0)]})]}):null]}),o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-orange-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1.5",children:"CASCO"}),o.jsx("p",{className:"text-lg font-bold text-orange-700",children:K(e.casco??0)}),(t.cascoSqm??e.surface??0)>0&&o.jsxs("p",{className:"text-xs text-orange-500 mt-1",children:[t.cascoSqm??e.surface??0,"m"]})]}),o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-orange-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1.5",children:"Parachvements"}),o.jsx("p",{className:"text-lg font-bold text-orange-700",children:K(e.parachevements??0)}),(t.parachevementsSqm??e.surface??0)>0&&o.jsxs("p",{className:"text-xs text-orange-500 mt-1",children:[t.parachevementsSqm??e.surface??0,"m"]})]})]})]})}function Cp({participantCalc:t,projectParams:e,allParticipants:r,unitDetails:n}){const s=t.useTwoLoans&&t.loan1Amount&&t.loan2Amount,a=r?Math.max(1,r.filter(m=>m.enabled!==!1).length):1,i=e&&r&&n?ms(r,e):null,c=(e?.expenseCategories&&Yi(e.expenseCategories)||0||0)/a,u=i?(i.honorairesTotal3Years||0)/a:0,h=i?(i.recurringTotal3Years||0)/a:0,f=i?(i.oneTimeCosts?.total||0)/a:0;return o.jsxs("div",{className:"bg-red-50 rounded-lg p-5 border border-red-200 mb-6",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Emprunt Ncessaire"}),o.jsxs("span",{className:"bg-red-600 text-white text-xs font-bold px-2 py-0.5 rounded",children:[t.financingRatio.toFixed(1),"% financ"]}),s&&o.jsx("span",{className:"bg-blue-600 text-white text-xs font-bold px-2 py-0.5 rounded",children:"2 prts"})]}),o.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 flex-1",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Cot du projet"}),o.jsx("p",{className:"text-lg font-bold text-gray-900",children:K(t.totalCost)}),o.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-100 text-xs text-gray-500 space-y-0.5",children:[o.jsx("div",{className:"font-medium text-gray-600 mb-1",children:"Calcul:"}),o.jsxs("div",{children:["Part d'achat: ",K(t.purchaseShare)]}),o.jsxs("div",{children:["+ Droit d'enregistrements: ",K(t.droitEnregistrements)]}),o.jsxs("div",{children:["+ Frais de notaire: ",K(t.fraisNotaireFixe)]}),o.jsxs("div",{children:["+ CASCO: ",K(t.casco)]}),o.jsxs("div",{children:["+ Parachvements: ",K(t.parachevements)]}),t.constructionCost-t.personalRenovationCost>0&&o.jsxs("div",{children:["+ Travaux communs: ",K(t.constructionCost-t.personalRenovationCost)]}),o.jsxs("div",{children:["+ Commun: ",K(t.sharedCosts)]}),(c>0||u>0||h>0||f>0)&&o.jsxs("div",{className:"ml-4 mt-1 pt-1 border-l-2 border-purple-200 pl-2 space-y-0.5 text-xs text-purple-700",children:[c>0&&o.jsxs("div",{children:[" Infrastructures: ",K(c||0)]}),u>0&&o.jsxs("div",{children:[" Honoraires: ",K(u||0)]}),h>0&&o.jsxs("div",{children:[" Frais 3 ans: ",K(h||0)]}),f>0&&o.jsxs("div",{children:[" Ponctuels: ",K(f||0)]})]}),o.jsxs("div",{className:"font-semibold text-gray-900 pt-1 border-t border-gray-50 mt-1",children:["= ",K(t.totalCost)]})]})]}),o.jsx("div",{className:"text-xl font-bold text-gray-400 flex-shrink-0",children:""}),o.jsxs("div",{className:"bg-green-50 rounded-lg p-3 border border-green-300 flex-1",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Capital apport"}),o.jsx("p",{className:"text-lg font-bold text-green-700",children:K(t.capitalApporte)})]}),o.jsx("div",{className:"text-xl font-bold text-gray-400 flex-shrink-0",children:"="}),o.jsxs("div",{className:"bg-red-100 rounded-lg p-3 border-2 border-red-400 flex-1",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:" emprunter"}),o.jsx("p",{className:"text-xl font-bold text-red-700",children:K(t.loanNeeded)})]})]}),s?o.jsxs("div",{className:"space-y-4 pt-3 border-t border-red-200",children:[o.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-blue-300",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx("span",{className:"bg-blue-600 text-white text-xs font-bold px-2 py-0.5 rounded",children:"PRT 1"}),o.jsx("span",{className:"text-xs text-gray-600",children:"Immdiat"})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Montant"}),o.jsx("p",{className:"text-base font-bold text-gray-900",children:K(t.loan1Amount||0)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Intrts"}),o.jsx("p",{className:"text-base font-bold text-red-700",children:K(t.loan1Interest||0)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total rembours"}),o.jsx("p",{className:"text-base font-bold text-gray-900",children:K((t.loan1Amount||0)+(t.loan1Interest||0))})]}),o.jsxs("div",{className:"bg-blue-50 rounded p-2",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Mensualit"}),o.jsx("p",{className:"text-xl font-bold text-blue-700",children:K(t.loan1MonthlyPayment||0)}),o.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[t.durationYears," ans @ ",t.interestRate,"%"]})]})]})]}),o.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-purple-300",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx("span",{className:"bg-purple-600 text-white text-xs font-bold px-2 py-0.5 rounded",children:"PRT 2"}),o.jsxs("span",{className:"text-xs text-gray-600",children:["Dmarre aprs ",t.loan2DelayYears||2," an(s)"]})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Montant"}),o.jsx("p",{className:"text-base font-bold text-gray-900",children:K(t.loan2Amount||0)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Intrts"}),o.jsx("p",{className:"text-base font-bold text-red-700",children:K(t.loan2Interest||0)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total rembours"}),o.jsx("p",{className:"text-base font-bold text-gray-900",children:K((t.loan2Amount||0)+(t.loan2Interest||0))})]}),o.jsxs("div",{className:"bg-purple-50 rounded p-2",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Mensualit"}),o.jsx("p",{className:"text-xl font-bold text-purple-700",children:K(t.loan2MonthlyPayment||0)}),o.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[t.loan2DurationYears," ans @ ",t.interestRate,"%"]})]})]})]}),o.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border-2 border-gray-400",children:[o.jsx("div",{className:"flex items-center justify-between mb-2",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"bg-gray-700 text-white text-xs font-bold px-2 py-0.5 rounded",children:"MENSUALIT COMBINE"}),o.jsxs("span",{className:"text-xs text-gray-600",children:["Annes ",t.loan2DelayYears||2,"  ",t.durationYears]})]})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Intrts totaux"}),o.jsx("p",{className:"text-base font-bold text-red-700",children:K(t.totalInterest)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total  rembourser"}),o.jsx("p",{className:"text-base font-bold text-gray-900",children:K(t.totalRepayment)})]}),o.jsxs("div",{className:"md:col-span-1 bg-white rounded-lg p-3 border-2 border-gray-400",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Mensualit totale"}),o.jsx("p",{className:"text-3xl font-bold text-gray-900",children:K((t.loan1MonthlyPayment||0)+(t.loan2MonthlyPayment||0))}),o.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-600",children:[o.jsx("span",{className:"text-blue-600 font-semibold",children:K(t.loan1MonthlyPayment||0)}),o.jsx("span",{children:"+"}),o.jsx("span",{className:"text-purple-600 font-semibold",children:K(t.loan2MonthlyPayment||0)})]})]})]})]})]}):o.jsx("div",{className:"pt-3 border-t border-red-200",children:o.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-red-300",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx("span",{className:"bg-red-600 text-white text-xs font-bold px-2 py-0.5 rounded",children:"PRT UNIQUE"}),o.jsxs("span",{className:"text-xs text-gray-600",children:[t.durationYears," ans @ ",t.interestRate,"%"]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Montant"}),o.jsx("p",{className:"text-base font-bold text-gray-900",children:K(t.loanNeeded)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Intrts"}),o.jsx("p",{className:"text-base font-bold text-red-700",children:K(t.totalInterest)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Total rembours"}),o.jsx("p",{className:"text-base font-bold text-gray-900",children:K(t.totalRepayment)})]}),o.jsxs("div",{className:"bg-red-50 rounded p-2",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Mensualit"}),o.jsx("p",{className:"text-2xl font-bold text-red-700",children:K(t.monthlyPayment)}),o.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:["pendant ",t.durationYears," ans"]})]})]})]})})]})}function Ip(t,e,r){const n=[];for(let s=0;s<t.length;s++){const a=t[s];if(a.isFounder&&a.lotsOwned){const i=r?.participantBreakdown[s],l=a.quantity||1;for(const c of a.lotsOwned)if(c.isPortage&&!c.soldDate){let u=c.originalPrice,h=c.originalNotaryFees,f=c.originalConstructionCost;i&&(!u||!h||!f)&&(u=(i.purchaseShare||0)/l,h=(i.droitEnregistrements||0)/l,f=(i.constructionCost||0)/l),n.push({lotId:c.lotId,surface:c.allocatedSurface||c.surface,source:"FOUNDER",surfaceImposed:!0,fromParticipant:a.name,originalPrice:u,originalNotaryFees:h,originalConstructionCost:f})}}}for(const s of e)s.soldDate||n.push({lotId:s.lotId,surface:s.surface,source:"COPRO",surfaceImposed:!1,totalCoproSurface:s.surface});return n}function Pp(t,e){const r={};if(!t.useTwoLoans)return r;const n=t.capitalForLoan1||0,s=t.capitalForLoan2||0,a=n+s;a>t.capitalApporte&&(r.capitalAllocation=`Capital allou (${a.toLocaleString()}) dpasse le capital disponible (${t.capitalApporte.toLocaleString()})`);const i=t.loan2RenovationAmount||0;i>e&&(r.renovationAmount=`Montant rnovation prt 2 (${i.toLocaleString()}) dpasse la rnovation totale (${e.toLocaleString()})`);const l=t.loan2DelayYears??2;l>=t.durationYears&&(r.loanDelay=`Dlai prt 2 (${l} ans) doit tre infrieur  la dure totale (${t.durationYears} ans)`);const c=t.durationYears-l;return c<1&&(r.loanDelay=`Dure prt 2 rsultante (${c} ans) doit tre au moins 1 an`),r}function eb({isOpen:t,onClose:e,participantIndex:r,participant:n,participantBreakdown:s,deedDate:a,allParticipants:i,calculations:l,projectParams:c,unitDetails:u,formulaParams:h,isPinned:f,onPin:m,onUnpin:p,onUpdateName:x,onUpdateSurface:g,onUpdateCapital:y,onUpdateNotaryRate:I,onUpdateInterestRate:P,onUpdateDuration:A,onUpdateQuantity:D,onUpdateParachevementsPerM2:V,onUpdateCascoSqm:H,onUpdateParachevementsSqm:w,onUpdateParticipant:E,onAddPortageLot:_,onRemovePortageLot:N,onUpdatePortageLotSurface:T,onUpdatePortageLotConstructionPayment:R,onRemove:S,totalParticipants:se}){const te=r,me=k.useMemo(()=>n.useTwoLoans?Pp(n,s.personalRenovationCost||0):{},[n,s.personalRenovationCost]);return t?o.jsxs("div",{className:"fixed inset-0 bg-white z-50 overflow-y-auto print-visible",children:[o.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 z-10 shadow-sm",children:o.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[o.jsxs("div",{className:"print-header hidden mb-4",children:[o.jsx("h1",{className:"text-2xl font-bold",children:"Dtails du Participant"}),o.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[s.name," - Gnr le ",new Date().toLocaleDateString("fr-BE",{day:"numeric",month:"long",year:"numeric"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx("div",{className:"flex items-center gap-3",children:o.jsx("input",{type:"text",value:s.name,onChange:ce=>x(ce.target.value),className:"text-2xl font-bold text-gray-900 bg-transparent border-b-2 border-transparent hover:border-gray-300 focus:border-blue-500 focus:outline-none px-1 py-1",placeholder:"Nom dude la participante"})}),o.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx("span",{className:"text-gray-400",children:"Unit"}),o.jsx("span",{className:"font-medium text-blue-600",children:s.unitId})]}),o.jsx("span",{className:"text-gray-300",children:""}),o.jsxs("span",{children:[s.surface,"m"]}),o.jsx("span",{className:"text-gray-300",children:""}),o.jsxs("span",{children:[s.quantity||1," ",(s.quantity||1)>1?"units":"unit"]}),n.entryDate&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"text-gray-300",children:""}),o.jsxs("span",{className:`font-medium ${n.isFounder?"text-green-600":"text-blue-600"}`,children:["Entre: ",new Date(n.entryDate).toLocaleDateString("fr-BE")]})]})]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[o.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Cot Total"}),o.jsx("p",{className:"text-xl font-bold text-gray-900",children:K(s.totalCost)})]}),o.jsxs("div",{className:"bg-red-50 rounded-lg p-3 border border-red-300",children:[o.jsx("p",{className:"text-xs text-gray-600 mb-1",children:" emprunter"}),o.jsx("p",{className:"text-xl font-bold text-red-700",children:K(s.loanNeeded)})]}),o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:s.useTwoLoans&&s.loan1MonthlyPayment&&s.loan2MonthlyPayment?"Mensualit combi":"Mensualit"}),o.jsx("p",{className:"text-xl font-bold text-red-600",children:K(s.useTwoLoans&&s.loan1MonthlyPayment&&s.loan2MonthlyPayment?s.loan1MonthlyPayment+s.loan2MonthlyPayment:s.monthlyPayment)})]})]})]}),o.jsxs("div",{className:"absolute top-6 right-6 flex items-center gap-3 no-print",children:[o.jsx("button",{onClick:()=>window.print(),className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Imprimer / PDF",children:o.jsx(eu,{className:"w-8 h-8"})}),o.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:o.jsx(Br,{className:"w-8 h-8"})})]})]})}),o.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[o.jsx("button",{onClick:ce=>{ce.stopPropagation(),f?p():m()},className:"absolute top-6 right-16 text-gray-400 hover:text-yellow-500 transition-colors no-print",title:f?"Dspingler":"pingler en haut",children:o.jsx(Iy,{className:"w-6 h-6",fill:f?"currentColor":"none",style:{color:f?"#eab308":void 0}})}),!n.isFounder&&o.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold mb-3",children:" Slection du Lot"}),o.jsx("div",{className:"mb-4",children:o.jsx(Ep,{availableLots:Ip(i,[{lotId:999,surface:300,acquiredDate:new Date(a),soldDate:void 0}],l),deedDate:new Date(a),formulaParams:h,buyerEntryDate:n.entryDate?new Date(n.entryDate):void 0,onSelectLot:(ce,le)=>{E({...n,surface:ce.surface,capitalApporte:Math.min(n.capitalApporte||0,le.totalPrice),purchaseDetails:{buyingFrom:ce.fromParticipant||"Coproprit",lotId:ce.lotId,purchasePrice:le.totalPrice,breakdown:{basePrice:le.basePrice,indexation:le.indexation,carryingCostRecovery:le.carryingCostRecovery,feesRecovery:le.feesRecovery||0,renovations:0}}})}})}),n.purchaseDetails?.lotId&&o.jsxs("div",{className:"bg-green-50 border border-green-300 rounded-lg p-3 mt-3",children:[o.jsxs("div",{className:"flex items-start justify-between mb-2",children:[o.jsx("p",{className:"text-xs font-semibold text-green-800",children:" Lot slectionn:"}),o.jsx("button",{onClick:()=>{E({...n,purchaseDetails:void 0,surface:0})},className:"text-xs text-red-600 hover:text-red-800 font-semibold hover:underline",children:" Changer de lot"})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-600",children:"Lot:"}),o.jsxs("span",{className:"font-semibold ml-1",children:["#",n.purchaseDetails.lotId]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-600",children:"De:"}),o.jsx("span",{className:"font-semibold ml-1",children:n.purchaseDetails.buyingFrom})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-600",children:"Prix:"}),o.jsxs("span",{className:"font-semibold ml-1",children:["",n.purchaseDetails.purchasePrice?.toLocaleString("fr-BE",{maximumFractionDigits:0})]})]})]})]})]}),o.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold mb-3",children:"Configuration"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsxs("label",{className:"block text-xs text-gray-600 mb-1",children:["Surface totale (m)",!n.isFounder&&n.purchaseDetails?.buyingFrom&&n.purchaseDetails?.buyingFrom!=="Coproprit"&&o.jsx("span",{className:"ml-2 text-orange-600 font-semibold",children:" Impose par portage"})]}),o.jsx("input",{type:"number",step:"1",value:s.surface,onChange:ce=>g(parseFloat(ce.target.value)||0),disabled:!n.isFounder&&!!n.purchaseDetails?.buyingFrom&&n.purchaseDetails?.buyingFrom!=="Coproprit",className:`w-full px-3 py-2 font-medium border rounded-lg focus:outline-none ${!n.isFounder&&n.purchaseDetails?.buyingFrom&&n.purchaseDetails?.buyingFrom!=="Coproprit"?"border-orange-300 bg-orange-50 text-gray-700 cursor-not-allowed":"border-gray-300 bg-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500"}`}),o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Total pour ",s.quantity||1," ",(s.quantity||1)>1?"units":"unit"]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Quantit"}),o.jsx("input",{type:"number",step:"1",min:"1",value:s.quantity,onChange:ce=>D(parseInt(ce.target.value)||1),className:"w-full px-3 py-2 font-medium border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none bg-white"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Capital apport"}),o.jsx("input",{type:"number",step:"10000",value:s.capitalApporte,onChange:ce=>y(parseFloat(ce.target.value)||0),className:"w-full px-3 py-2 text-base font-semibold border border-green-300 rounded-lg focus:border-green-500 focus:ring-1 focus:ring-green-500 focus:outline-none bg-white text-green-700"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Frais d'enregistrement"}),o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer px-3 py-2 border rounded-lg transition-colors hover:bg-gray-100",style:{borderColor:s.registrationFeesRate===3?"#9ca3af":"#e5e7eb",backgroundColor:s.registrationFeesRate===3?"#f3f4f6":"white"},children:[o.jsx("input",{type:"radio",name:`notaryRate-fullscreen-${te}`,value:"3",checked:s.registrationFeesRate===3,onChange:ce=>I(parseFloat(ce.target.value)),className:"w-4 h-4"}),o.jsx("span",{className:"font-medium text-gray-700 text-sm",children:"3%"})]}),o.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer px-3 py-2 border rounded-lg transition-colors hover:bg-gray-100",style:{borderColor:s.registrationFeesRate===12.5?"#9ca3af":"#e5e7eb",backgroundColor:s.registrationFeesRate===12.5?"#f3f4f6":"white"},children:[o.jsx("input",{type:"radio",name:`notaryRate-fullscreen-${te}`,value:"12.5",checked:s.registrationFeesRate===12.5,onChange:ce=>I(parseFloat(ce.target.value)),className:"w-4 h-4"}),o.jsx("span",{className:"font-medium text-gray-700 text-sm",children:"12.5%"})]})]}),o.jsxs("div",{className:"text-sm text-gray-600",children:["= ",K(s.droitEnregistrements)]})]}),n.isFounder&&o.jsx(Kw,{portageLots:n.lotsOwned?.filter(ce=>ce.isPortage)||[],onAddLot:_,onRemoveLot:N,onUpdateSurface:T,onUpdateConstructionPayment:R,deedDate:new Date(a),formulaParams:h}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Taux d'intrt (%)"}),o.jsx("input",{type:"number",step:"0.1",value:s.interestRate,onChange:ce=>P(parseFloat(ce.target.value)||0),className:"w-full px-3 py-2 font-medium border border-gray-300 rounded-lg focus:border-gray-500 focus:ring-1 focus:ring-gray-500 focus:outline-none bg-white"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Dure (annes)"}),o.jsx("input",{type:"number",value:s.durationYears,onChange:ce=>A(parseInt(ce.target.value)||0),className:"w-full px-3 py-2 font-medium border border-gray-300 rounded-lg focus:border-gray-500 focus:ring-1 focus:ring-gray-500 focus:outline-none bg-white"})]})]}),o.jsx(Ap,{participant:n,participantCalc:s,personalRenovationCost:s.personalRenovationCost||0,validationErrors:me,onUpdateParticipant:E})]}),o.jsx(Np,{participant:n,participantCalc:s,projectParams:c,allParticipants:i,unitDetails:u,deedDate:a,formulaParams:h}),o.jsx(Sp,{participant:n,participantCalc:s,projectParams:c,onUpdateParachevementsPerM2:V,onUpdateCascoSqm:H,onUpdateParachevementsSqm:w}),o.jsx(Cp,{participantCalc:s,projectParams:c,allParticipants:i,unitDetails:u,deedDate:a}),o.jsx(Tp,{participant:n,allParticipants:i,deedDate:a,coproReservesShare:h.coproReservesShare,projectParams:c,calculations:l,formulaParams:h}),o.jsx("div",{className:"max-w-7xl mx-auto px-6 mt-8",children:o.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold mb-3",children:" Date d'entre"}),o.jsx("div",{className:"mb-4",children:o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:n.isFounder||!1,onChange:ce=>{const le=new Date(a);le.setFullYear(le.getFullYear()+1),E({...n,isFounder:ce.target.checked,entryDate:ce.target.checked?new Date(a):n.entryDate||le,purchaseDetails:ce.target.checked?void 0:n.purchaseDetails})},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Fondateurrice (entre  la date de l'acte)"})]})}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date d'entre dans le projet"}),o.jsx("input",{type:"date",value:Ww(n.entryDate,a),onChange:ce=>{const le=new Date(ce.target.value);if(le<new Date(a)){alert(`La date d'entre ne peut pas tre avant la date de l'acte (${a})`);return}E({...n,entryDate:le})},disabled:n.isFounder,min:a,className:`w-full px-4 py-2 border-2 rounded-lg focus:outline-none ${n.isFounder?"bg-gray-100 border-gray-300 text-gray-500 cursor-not-allowed":"bg-white border-green-300 focus:border-green-500 focus:ring-2 focus:ring-green-500"}`}),o.jsx("p",{className:"text-xs text-gray-600 mt-1",children:n.isFounder?"Les fondateurrices entrent toustes  la date de l'acte":"Date  laquelle cette participante rejoint le projet (doit tre >= date de l'acte)"})]})]})}),se>1&&S&&o.jsx("div",{className:"max-w-7xl mx-auto px-6 pb-6",children:o.jsx("button",{onClick:()=>{confirm(`tes-vous sr de vouloir retirer ${n.name} ?`)&&(S(),e())},className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-3 rounded-lg transition-colors",children:"Retirer cette participante"})})]})]}):null}function tb(t,e,r=30){return k.useMemo(()=>{const n=r/100,s=1-n,a=t.filter(u=>u.purchaseDetails?.buyingFrom==="Coproprit").map(u=>{const h=u.purchaseDetails?.purchasePrice||0,f=h*n,m=h*s;return{date:u.entryDate||new Date(e),buyer:u.name,amount:h,toReserves:f,toParticipants:m,description:`Vente de lot ${u.purchaseDetails?.lotId||"?"} (${u.surface||0}m)`}}).sort((u,h)=>u.date.getTime()-h.date.getTime()),i=a.reduce((u,h)=>u+h.amount,0),l=a.reduce((u,h)=>u+h.toReserves,0),c=a.reduce((u,h)=>u+h.toParticipants,0);return{sales:a,totalRevenue:i,totalToReserves:l,totalToParticipants:c}},[t,e,r])}function rb({isOpen:t,onClose:e,snapshot:r,coproReservesShare:n,allParticipants:s,deedDate:a}){const{sales:i,totalRevenue:l,totalToReserves:c,totalToParticipants:u}=tb(s,a,n);return t?o.jsxs("div",{className:"fixed inset-0 bg-white z-50 overflow-y-auto",children:[o.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 z-10 shadow-sm",children:o.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx("div",{className:"flex items-center gap-3",children:o.jsx("h2",{className:"text-2xl font-bold text-purple-900",children:"La Coproprit"})}),o.jsx("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx("span",{className:"text-gray-400",children:"Date"}),o.jsx("span",{className:"font-medium text-purple-600",children:r.date.toLocaleDateString("fr-BE")})]})})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 border border-purple-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Lots disponibles"}),o.jsx("p",{className:"text-xl font-bold text-purple-900",children:r.availableLots})]}),o.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 border border-purple-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Surface totale"}),o.jsxs("p",{className:"text-xl font-bold text-purple-900",children:[r.totalSurface,"m"]})]})]})]}),o.jsx("button",{onClick:e,className:"absolute top-6 right-6 text-gray-400 hover:text-gray-600 transition-colors",children:o.jsx(Br,{className:"w-8 h-8"})})]})}),o.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[r.soldThisDate.length>0&&o.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg border border-red-200",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold mb-3",children:" Ventes  cette date"}),o.jsx("div",{className:"space-y-2",children:r.soldThisDate.map((h,f)=>o.jsx("div",{className:"p-3 bg-white border border-red-200 rounded-lg",children:o.jsx("div",{className:"font-semibold text-red-700",children:h})},f))}),r.reserveIncrease>0&&o.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-300 rounded-lg",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("span",{className:"text-sm font-semibold text-green-700",children:[" Augmentation des rserves (",n,"%)"]}),o.jsx("span",{className:"text-lg font-bold text-green-800",children:K(r.reserveIncrease)})]})})]}),o.jsxs("div",{className:"mb-6 p-4 bg-purple-50 rounded-lg border border-purple-200",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold mb-3",children:" tat de l'inventaire"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{className:"p-4 bg-white border border-purple-300 rounded-lg",children:[o.jsx("div",{className:"text-xs text-purple-600 mb-1",children:"Lots disponibles"}),o.jsx("div",{className:"text-3xl font-bold text-purple-800",children:r.availableLots}),o.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"lots en portage disponibles pour de nouveaux participants"})]}),o.jsxs("div",{className:"p-4 bg-white border border-purple-300 rounded-lg",children:[o.jsx("div",{className:"text-xs text-purple-600 mb-1",children:"Surface totale"}),o.jsxs("div",{className:"text-3xl font-bold text-purple-800",children:[r.totalSurface,"m"]}),o.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"surface totale disponible"})]})]})]}),r.soldThisDate.length===0&&o.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:o.jsx("p",{className:"text-sm text-gray-600 italic",children:"Aucune vente enregistre  cette date."})}),i.length>0&&o.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold mb-3",children:" Remboursements attendus"}),o.jsx("div",{className:"space-y-2",children:i.map((h,f)=>o.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-100",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-800",children:h.buyer}),o.jsxs("span",{className:"text-gray-600 text-xs ml-2",children:["(",h.date.toLocaleDateString("fr-BE",{year:"numeric",month:"short",day:"numeric"}),")"]})]}),o.jsx("div",{className:"font-bold text-green-700",children:K(h.amount)})]}),o.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[" ",h.description]}),o.jsxs("div",{className:"flex gap-4 text-xs",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsxs("span",{className:"text-gray-600",children:["Rserves (",n,"%):"]}),o.jsx("span",{className:"font-semibold text-purple-700",children:K(h.toReserves)})]}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsxs("span",{className:"text-gray-600",children:["Participants (",100-n,"%):"]}),o.jsx("span",{className:"font-semibold text-blue-700",children:K(h.toParticipants)})]})]})]},f))}),o.jsxs("div",{className:"mt-4 pt-3 border-t border-green-300 space-y-2",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-sm font-semibold text-gray-800",children:"Total revenus"}),o.jsx("span",{className:"text-lg font-bold text-green-800",children:K(l)})]}),o.jsxs("div",{className:"flex justify-between items-center text-sm",children:[o.jsx("span",{className:"text-gray-700",children:" Aux rserves copro"}),o.jsx("span",{className:"font-bold text-purple-700",children:K(c)})]}),o.jsxs("div",{className:"flex justify-between items-center text-sm",children:[o.jsx("span",{className:"text-gray-700",children:" Redistribus aux participants"}),o.jsx("span",{className:"font-bold text-blue-700",children:K(u)})]})]}),o.jsx("p",{className:"text-xs text-green-600 mt-3",children:"Ces montants seront verss lorsque les nouveaux participants entreront dans le projet."})]})]})]}):null}function nb({founders:t,founderCalculations:e,deedDate:r,allParticipants:n,calculations:s,projectParams:a,unitDetails:i,formulaParams:l}){return o.jsxs("div",{className:"print-visible hidden print:block",children:[o.jsxs("div",{className:"print-header mb-8",children:[o.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Dtails de Tous les Fondateurs"}),o.jsxs("p",{className:"text-lg text-gray-600",children:["Gnr le ",new Date().toLocaleDateString("fr-BE",{day:"numeric",month:"long",year:"numeric"})]}),o.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Date de l'acte: ",new Date(r).toLocaleDateString("fr-BE",{day:"numeric",month:"long",year:"numeric"})]})]}),o.jsxs("div",{className:"mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200",children:[o.jsx("h2",{className:"text-xl font-bold mb-4",children:"Rsum du Projet"}),o.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Cot Total du Projet"}),o.jsx("p",{className:"text-2xl font-bold",children:K(s.totals.total||0)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Nombre de Fondateurs"}),o.jsx("p",{className:"text-2xl font-bold",children:t.length})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Surface Totale"}),o.jsxs("p",{className:"text-2xl font-bold",children:[s.totalSurface||0,"m"]})]})]})]}),t.map((c,u)=>{const h=e[u];if(!h)return null;const f=c.useTwoLoans?Pp(c,h.personalRenovationCost||0):{};return o.jsxs("div",{className:"mb-12 page-break-before",children:[o.jsxs("div",{className:"mb-6 pb-4 border-b-2 border-gray-300",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:h.name}),o.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx("span",{className:"text-gray-400",children:"Unit"}),o.jsx("span",{className:"font-medium text-blue-600",children:h.unitId})]}),o.jsx("span",{className:"text-gray-300",children:""}),o.jsxs("span",{children:[h.surface,"m"]}),o.jsx("span",{className:"text-gray-300",children:""}),o.jsxs("span",{children:[h.quantity||1," ",(h.quantity||1)>1?"units":"unit"]}),o.jsx("span",{className:"text-gray-300",children:""}),o.jsx("span",{className:"font-medium text-green-600",children:"Fondateurrice"})]})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[o.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Cot Total"}),o.jsx("p",{className:"text-xl font-bold text-gray-900",children:K(h.totalCost)})]}),o.jsxs("div",{className:"bg-red-50 rounded-lg p-4 border border-red-300",children:[o.jsx("p",{className:"text-xs text-gray-600 mb-1",children:" emprunter"}),o.jsx("p",{className:"text-xl font-bold text-red-700",children:K(h.loanNeeded)})]}),o.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[o.jsx("p",{className:"text-xs text-gray-500 mb-1",children:h.useTwoLoans&&h.loan1MonthlyPayment&&h.loan2MonthlyPayment?"Mensualit combi":"Mensualit"}),o.jsx("p",{className:"text-xl font-bold text-red-600",children:K(h.useTwoLoans&&h.loan1MonthlyPayment&&h.loan2MonthlyPayment?h.loan1MonthlyPayment+h.loan2MonthlyPayment:h.monthlyPayment)})]})]}),o.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold mb-3",children:"Configuration"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Surface totale (m)"}),o.jsxs("div",{className:"text-base font-medium",children:[h.surface,"m"]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Quantit"}),o.jsx("div",{className:"text-base font-medium",children:h.quantity||1})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Capital apport"}),o.jsx("div",{className:"text-base font-semibold text-green-700",children:K(h.capitalApporte)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Frais d'enregistrement"}),o.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:[h.registrationFeesRate,"%"]}),o.jsx("div",{className:"text-base font-medium",children:K(h.droitEnregistrements)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Taux d'intrt (%)"}),o.jsxs("div",{className:"text-base font-medium",children:[h.interestRate,"%"]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Dure (annes)"}),o.jsx("div",{className:"text-base font-medium",children:h.durationYears})]})]}),c.useTwoLoans&&o.jsx("div",{className:"mt-4",children:o.jsx(Ap,{participant:c,participantCalc:h,personalRenovationCost:h.personalRenovationCost||0,validationErrors:f,onUpdateParticipant:()=>{}})})]}),o.jsx("div",{className:"mb-6",children:o.jsx(Np,{participant:c,participantCalc:h,projectParams:a,allParticipants:n,unitDetails:i,deedDate:r,formulaParams:l})}),o.jsx("div",{className:"mb-6",children:o.jsx(Sp,{participant:c,participantCalc:h,projectParams:a,onUpdateParachevementsPerM2:()=>{},onUpdateCascoSqm:()=>{},onUpdateParachevementsSqm:()=>{}})}),o.jsx("div",{className:"mb-6",children:o.jsx(Cp,{participantCalc:h,projectParams:a,allParticipants:n,unitDetails:i,deedDate:r})}),o.jsx("div",{className:"mb-6",children:o.jsx(Tp,{participant:c,allParticipants:n,deedDate:r,coproReservesShare:l.coproReservesShare,projectParams:a,calculations:s,formulaParams:l})})]},c.name||u)}),o.jsxs("div",{className:"mt-12 page-break-before",children:[o.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Frais Communs (Commun)"}),o.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 border border-gray-200",children:[o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Frais Communs"}),o.jsx("p",{className:"text-lg font-bold",children:K(s.totals.shared||0)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Par Participant"}),o.jsx("p",{className:"text-lg font-bold",children:K((s.totals.shared||0)/(t.length||1))})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Infrastructures"}),o.jsx("p",{className:"text-lg font-medium",children:K(a.expenseCategories?Yi(a.expenseCategories):0)})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Travaux Communs"}),o.jsx("p",{className:"text-lg font-medium",children:K(typeof a.travauxCommuns=="number"?a.travauxCommuns:0)})]})]}),a.expenseCategories&&o.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold mb-2",children:"Dtail des Catgories"}),o.jsxs("div",{className:"space-y-3",children:[a.expenseCategories.conservatoire&&a.expenseCategories.conservatoire.length>0&&o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:"Conservatoire"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:a.expenseCategories.conservatoire.map((c,u)=>o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsxs("span",{className:"text-gray-600",children:[c.label,":"]}),o.jsx("span",{className:"font-medium",children:K(c.amount||0)})]},u))})]}),a.expenseCategories.habitabiliteSommaire&&a.expenseCategories.habitabiliteSommaire.length>0&&o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:"Habitabilit Sommaire"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:a.expenseCategories.habitabiliteSommaire.map((c,u)=>o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsxs("span",{className:"text-gray-600",children:[c.label,":"]}),o.jsx("span",{className:"font-medium",children:K(c.amount||0)})]},u))})]}),a.expenseCategories.premierTravaux&&a.expenseCategories.premierTravaux.length>0&&o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:"Premier Travaux"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:a.expenseCategories.premierTravaux.map((c,u)=>o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsxs("span",{className:"text-gray-600",children:[c.label,":"]}),o.jsx("span",{className:"font-medium",children:K(c.amount||0)})]},u))})]})]})]})]})]})]})}function sb({title:t,items:e,onItemChange:r,onItemLabelChange:n,onAddItem:s,onRemoveItem:a,disabled:i=!1}){const[l,c]=k.useState(!1),u=e.reduce((h,f)=>h+f.amount,0);return o.jsxs("div",{className:"mb-3 border border-gray-200 rounded-lg overflow-hidden",children:[o.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>c(!l),children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("button",{className:"text-gray-600 hover:text-gray-800",children:l?o.jsx(Ol,{className:"w-4 h-4"}):o.jsx(kl,{className:"w-4 h-4"})}),o.jsx("h4",{className:"text-sm font-semibold text-gray-800 uppercase tracking-wide",children:t})]}),o.jsx("span",{className:"text-sm font-bold text-purple-700",children:K(u)})]}),l&&o.jsxs("div",{className:"p-3 bg-white space-y-2",children:[e.map((h,f)=>o.jsxs("div",{className:"grid grid-cols-[1fr_auto_auto] gap-2 items-center",children:[o.jsx("input",{type:"text",value:h.label,onChange:m=>n(f,m.target.value),onClick:m=>m.stopPropagation(),disabled:i,className:`px-3 py-2 text-xs border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-1 focus:ring-purple-500 focus:outline-none bg-white ${i?"opacity-60 cursor-not-allowed bg-gray-50":""}`,placeholder:"Label"}),o.jsx("input",{type:"number",step:"100",value:h.amount,onChange:m=>r(f,parseFloat(m.target.value)||0),onClick:m=>m.stopPropagation(),disabled:i,className:`w-32 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-1 focus:ring-purple-500 focus:outline-none bg-white ${i?"opacity-60 cursor-not-allowed bg-gray-50":""}`}),o.jsx("button",{onClick:m=>{m.stopPropagation(),a(f)},disabled:i,className:`p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors ${i?"opacity-60 cursor-not-allowed":""}`,title:"Supprimer",children:o.jsx(Br,{className:"w-4 h-4"})})]},f)),o.jsxs("button",{onClick:h=>{h.stopPropagation(),s()},disabled:i,className:`w-full mt-2 flex items-center justify-center gap-2 px-3 py-2 text-sm text-purple-700 border border-purple-300 rounded-lg hover:bg-purple-50 transition-colors ${i?"opacity-60 cursor-not-allowed":""}`,children:[o.jsx(Em,{className:"w-4 h-4"}),"Ajouter une ligne"]})]})]})}const ab=[{key:"conservatoire",title:"CONSERVATOIRE"},{key:"habitabiliteSommaire",title:"HABITABILITE SOMMAIRE"},{key:"premierTravaux",title:"PREMIER TRAVAUX"}];function ib({expenseCategories:t,projectParams:e,sharedCosts:r,onUpdateProjectParams:n,participants:s,unitDetails:a}){const[i,l]=k.useState(!1),[c,u]=k.useState(!0),{canEdit:h}=ni("globalCascoPerM2"),{canEdit:f}=ni("cascoTvaRate"),{canEdit:m}=ni("expenseCategories"),{canEdit:p}=ni("maxTotalLots"),x=ms(s,e),g=e.travauxCommuns??{enabled:!1,items:[{label:"Rnovation complte",sqm:0,cascoPricePerSqm:0,parachevementPricePerSqm:0,amount:27e4}]},y=bn(e),I=(R,S,se)=>{const te={...t,[R]:t[R].map((me,ce)=>ce===S?{...me,amount:se}:me)};n({...e,expenseCategories:te})},P=(R,S,se)=>{const te={...t,[R]:t[R].map((me,ce)=>ce===S?{...me,label:se}:me)};n({...e,expenseCategories:te})},A=R=>{const S={...t,[R]:[...t[R],{label:"Nouvelle dpense",amount:0}]};n({...e,expenseCategories:S})},D=(R,S)=>{const se={...t,[R]:t[R].filter((te,me)=>me!==S)};n({...e,expenseCategories:se})},V=()=>{n({...e,travauxCommuns:{...g,enabled:!g.enabled}})},H=(R,S)=>{const se=g.items.map((te,me)=>me===R?{...te,sqm:S||0}:te);n({...e,travauxCommuns:{...g,items:se}})},w=(R,S)=>{const se=g.items.map((te,me)=>me===R?{...te,cascoPricePerSqm:S||0}:te);n({...e,travauxCommuns:{...g,items:se}})},E=(R,S)=>{const se=g.items.map((te,me)=>me===R?{...te,parachevementPricePerSqm:S||0}:te);n({...e,travauxCommuns:{...g,items:se}})},_=(R,S)=>{const se=g.items.map((te,me)=>me===R?{...te,label:S}:te);n({...e,travauxCommuns:{...g,items:se}})},N=()=>{n({...e,travauxCommuns:{...g,items:[...g.items,{label:"Nouvelle dpense",sqm:0,cascoPricePerSqm:0,parachevementPricePerSqm:0}]}})},T=R=>{n({...e,travauxCommuns:{...g,items:g.items.filter((S,se)=>se!==R)}})};return o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:`border border-gray-200 rounded-lg overflow-hidden ${g.enabled?"":"opacity-60"}`,children:[o.jsxs("button",{onClick:()=>{l(!i)},className:"flex justify-between items-center p-3 bg-gray-50 w-full transition-colors hover:bg-gray-100",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:g.enabled,onChange:R=>{R.stopPropagation(),V(),g.enabled||l(!0)},className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),o.jsx("svg",{className:`w-4 h-4 text-gray-600 transition-transform ${i?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-800 uppercase tracking-wide",children:"TRAVAUX COMMUNS"}),o.jsx("p",{className:"text-xs text-gray-500 italic mt-0.5",children:"Rpartition : par personne (gale)"})]})]}),o.jsx("span",{className:`text-sm font-bold ${g.enabled?"text-purple-700":"text-gray-400"}`,children:K(y)})]}),i&&o.jsxs("div",{className:"p-3 bg-white space-y-2",children:[!g.enabled&&o.jsx("div",{className:"p-3 bg-gray-50 rounded text-center",children:o.jsx("p",{className:"text-sm text-gray-500 italic",children:"Activez les travaux communs pour ajouter des lments personnalisables"})}),g.enabled&&o.jsxs(o.Fragment,{children:[g.items.length>0&&o.jsx("h5",{className:"text-xs font-semibold text-gray-700 uppercase",children:"Travaux additionnels (personnalisables)"}),g.items.map((R,S)=>{const se=Ju(R);return o.jsxs("div",{className:"space-y-2 p-3 border border-gray-200 rounded-lg bg-gray-50",children:[o.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-2 items-center",children:[o.jsx("input",{type:"text",value:R.label,onChange:te=>_(S,te.target.value),disabled:!m,className:`px-3 py-2 text-xs border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-1 focus:ring-purple-500 focus:outline-none bg-white ${m?"":"opacity-60 cursor-not-allowed bg-gray-50"}`,placeholder:"Label"}),o.jsx("button",{onClick:()=>T(S),disabled:!m,className:`p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors ${m?"":"opacity-60 cursor-not-allowed"}`,title:"Supprimer",children:o.jsx(Br,{className:"w-4 h-4"})})]}),o.jsxs("div",{className:"grid grid-cols-4 gap-2 items-center",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:`travaux-sqm-${S}`,className:"text-xs text-gray-600 block mb-1",children:"m"}),o.jsx("input",{id:`travaux-sqm-${S}`,type:"number",step:"0.01",value:R.sqm||"",onChange:te=>H(S,parseFloat(te.target.value)||0),disabled:!m,className:`w-full px-2 py-1 text-xs border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-1 focus:ring-purple-500 focus:outline-none bg-white ${m?"":"opacity-60 cursor-not-allowed bg-gray-50"}`,placeholder:"0"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:`travaux-casco-${S}`,className:"text-xs text-gray-600 block mb-1",children:"CASCO /m"}),o.jsx("input",{id:`travaux-casco-${S}`,type:"number",step:"0.01",value:R.cascoPricePerSqm||"",onChange:te=>w(S,parseFloat(te.target.value)||0),disabled:!m,className:`w-full px-2 py-1 text-xs border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-1 focus:ring-purple-500 focus:outline-none bg-white ${m?"":"opacity-60 cursor-not-allowed bg-gray-50"}`,placeholder:"0"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:`travaux-parach-${S}`,className:"text-xs text-gray-600 block mb-1",children:"Parach. /m"}),o.jsx("input",{id:`travaux-parach-${S}`,type:"number",step:"0.01",value:R.parachevementPricePerSqm||"",onChange:te=>E(S,parseFloat(te.target.value)||0),disabled:!m,className:`w-full px-2 py-1 text-xs border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-1 focus:ring-purple-500 focus:outline-none bg-white ${m?"":"opacity-60 cursor-not-allowed bg-gray-50"}`,placeholder:"0"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:`travaux-total-${S}`,className:"text-xs text-gray-600 block mb-1",children:"Total"}),o.jsx("input",{id:`travaux-total-${S}`,type:"text",value:K(se),readOnly:!0,disabled:!0,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded-lg bg-gray-100 text-gray-700 cursor-not-allowed"})]})]})]},S)}),o.jsxs("button",{onClick:N,disabled:!m,className:`w-full mt-2 flex items-center justify-center gap-2 px-3 py-2 text-sm text-purple-700 border border-purple-300 rounded-lg hover:bg-purple-50 transition-colors ${m?"":"opacity-60 cursor-not-allowed"}`,children:[o.jsx(Em,{className:"w-4 h-4"}),"Ajouter une ligne"]})]}),o.jsx("div",{className:"mt-3 p-2 bg-purple-100 rounded border border-purple-300",children:o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-sm font-bold text-gray-800",children:"TOTAL Travaux Communs"}),o.jsx("span",{className:"text-sm font-bold text-purple-800",children:K(y)})]}),s.length>0&&o.jsxs("div",{className:"text-xs text-gray-600 mt-1 italic",children:["Par participant: ",K(y/s.length)]})]})})]})]}),ab.map(({key:R,title:S})=>o.jsx(sb,{title:S,items:t[R],onItemChange:(se,te)=>I(R,se,te),onItemLabelChange:(se,te)=>P(R,se,te),onAddItem:()=>A(R),onRemoveItem:se=>D(R,se),disabled:!m},R)),o.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[o.jsxs("button",{onClick:()=>u(!c),className:"flex justify-between items-center p-3 bg-gray-50 w-full hover:bg-gray-100 transition-colors",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{className:`w-4 h-4 text-gray-600 transition-transform ${c?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-800 uppercase tracking-wide",children:"Frais Gnraux (3 ans)"}),o.jsx("p",{className:"text-xs text-gray-500 italic mt-0.5",children:"Rpartition : par personne (gale)"})]})]}),o.jsx("span",{className:"text-sm font-bold text-purple-700",children:K(r-Yi(t))})]}),c&&o.jsxs("div",{className:"p-3 bg-white space-y-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{className:"text-xs text-gray-600 whitespace-nowrap",children:"Prix CASCO/m Global:"}),o.jsx("input",{type:"number",step:"10",value:e.globalCascoPerM2,onChange:R=>n({...e,globalCascoPerM2:parseFloat(R.target.value)||1590}),disabled:!h,className:`w-24 px-2 py-1 text-sm font-semibold border border-blue-300 rounded focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none ${h?"":"opacity-60 cursor-not-allowed bg-gray-50"}`}),o.jsx("span",{className:"text-xs text-blue-600",children:"/m"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{className:"text-xs text-gray-600 whitespace-nowrap",children:"Nombre max. de lots:"}),o.jsx("input",{type:"number",step:"1",min:"1",value:e.maxTotalLots??10,onChange:R=>n({...e,maxTotalLots:Math.max(1,parseInt(R.target.value)||10)}),disabled:!p,className:`w-20 px-2 py-1 text-sm font-semibold border border-blue-300 rounded focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none ${p?"":"opacity-60 cursor-not-allowed bg-gray-50"}`}),o.jsx("span",{className:"text-xs text-blue-600",children:"lots"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("label",{className:"text-xs text-gray-600 whitespace-nowrap",children:"TVA CASCO:"}),o.jsx("input",{type:"number",step:"1",min:"0",max:"21",value:e.cascoTvaRate??6,onChange:R=>n({...e,cascoTvaRate:parseFloat(R.target.value)||0}),disabled:!f,className:`w-16 px-2 py-1 text-sm font-semibold border border-green-300 rounded focus:border-green-500 focus:ring-1 focus:ring-green-500 focus:outline-none ${f?"":"opacity-60 cursor-not-allowed bg-gray-50"}`}),o.jsx("span",{className:"text-xs text-green-600",children:"%"}),o.jsx("span",{className:"text-xs text-gray-400 italic",children:"(6% ou 21%)"})]}),o.jsxs("div",{className:"mt-3 space-y-2 border-t border-gray-200 pt-3",children:[o.jsx("h5",{className:"text-xs font-semibold text-gray-700 uppercase",children:"Dtail du calcul"}),o.jsxs("div",{className:"bg-blue-50 p-2 rounded",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Honoraires (15%  30% CASCO hors TVA sur 3 ans)"}),o.jsx("span",{className:"text-xs font-bold text-blue-700",children:K(x.honorairesTotal3Years)})]}),o.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Base CASCO hors TVA: ",K(x.totalCasco)," | ",K(x.honorairesYearly),"/an"]})]}),o.jsxs("div",{className:"bg-amber-50 p-2 rounded",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Frais rcurrents (3 ans)"}),o.jsx("span",{className:"text-xs font-bold text-amber-700",children:K(x.recurringTotal3Years)})]}),o.jsxs("div",{className:"space-y-0.5 text-xs text-gray-600 pl-2",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:" Prcompte immobilier"}),o.jsxs("span",{children:[K(x.recurringYearly.precompteImmobilier),"/an"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:" Comptable"}),o.jsxs("span",{children:[K(x.recurringYearly.comptable),"/an"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:" Podio abonnement"}),o.jsxs("span",{children:[K(x.recurringYearly.podioAbonnement),"/an"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:" Assurance btiment"}),o.jsxs("span",{children:[K(x.recurringYearly.assuranceBatiment),"/an"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:" Frais rservation"}),o.jsxs("span",{children:[K(x.recurringYearly.fraisReservation),"/an"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:" Imprvus"}),o.jsxs("span",{children:[K(x.recurringYearly.imprevus),"/an"]})]})]})]}),o.jsxs("div",{className:"bg-green-50 p-2 rounded",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Frais ponctuels"}),o.jsx("span",{className:"text-xs font-bold text-green-700",children:K(x.oneTimeCosts.total)})]}),o.jsxs("div",{className:"space-y-0.5 text-xs text-gray-600 pl-2",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:" Frais dossier crdit"}),o.jsx("span",{children:K(x.oneTimeCosts.fraisDossierCredit)})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:" Frais gestion crdit"}),o.jsx("span",{children:K(x.oneTimeCosts.fraisGestionCredit)})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:" Frais notaire base partage"}),o.jsx("span",{children:K(x.oneTimeCosts.fraisNotaireBasePartagee)})]})]})]}),o.jsx("div",{className:"bg-purple-100 p-2 rounded border border-purple-300",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-sm font-semibold text-gray-800",children:"TOTAL Frais Gnraux"}),o.jsx("span",{className:"text-sm font-bold text-purple-800",children:K(x.total)})]})})]})]})]})]})}function ob({formulaParams:t,onUpdateParams:e,deedDate:r}){const[n,s]=k.useState(!1),{canEdit:a}=Eo("indexationRate"),{canEdit:i}=Eo("carryingCostRecovery"),{canEdit:l}=Eo("averageInterestRate"),{canEdit:c}=Eo("coproReservesShare"),u=(x,g)=>{e({...t,[x]:g})},h=2.5,f=6e4,m=Gi(f,0,Math.round(h*12),t.averageInterestRate),p=cw(f,h,t,m);return o.jsxs("div",{className:"mb-6 bg-blue-50 rounded-lg border-2 border-blue-200",children:[o.jsxs("button",{onClick:()=>s(!n),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-blue-100 transition-colors rounded-t-lg",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:""}),o.jsx("h3",{className:"text-lg font-bold text-blue-900",children:"Configuration Formule de Portage"})]}),n?o.jsx(Ol,{className:"w-5 h-5 text-blue-700"}):o.jsx(kl,{className:"w-5 h-5 text-blue-700"})]}),n&&o.jsxs("div",{className:"px-6 pb-6 pt-2 space-y-6",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-3",children:"Paramtres ajustables"}),o.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"indexationRate",className:"block text-xs text-gray-700 mb-1",children:"Taux d'indexation annuel"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{id:"indexationRate",type:"number",step:"0.1",min:"0",max:"10",value:t.indexationRate,onChange:x=>u("indexationRate",parseFloat(x.target.value)||0),disabled:!a,className:`w-full px-3 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none ${a?"":"opacity-60 cursor-not-allowed bg-gray-50"}`}),o.jsx("span",{className:"text-sm text-gray-600",children:"%"})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"carryingCostRecovery",className:"block text-xs text-gray-700 mb-1",children:"Rcupration frais de portage"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{id:"carryingCostRecovery",type:"number",step:"5",min:"0",max:"100",value:t.carryingCostRecovery,onChange:x=>u("carryingCostRecovery",parseFloat(x.target.value)||0),disabled:!i,className:`w-full px-3 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none ${i?"":"opacity-60 cursor-not-allowed bg-gray-50"}`}),o.jsx("span",{className:"text-sm text-gray-600",children:"%"})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"averageInterestRate",className:"block text-xs text-gray-700 mb-1",children:"Taux d'intrt moyen"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{id:"averageInterestRate",type:"number",step:"0.1",min:"0",max:"15",value:t.averageInterestRate,onChange:x=>u("averageInterestRate",parseFloat(x.target.value)||0),disabled:!l,className:`w-full px-3 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none ${l?"":"opacity-60 cursor-not-allowed bg-gray-50"}`}),o.jsx("span",{className:"text-sm text-gray-600",children:"%"})]})]})]})]}),o.jsx("hr",{className:"border-blue-200"}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-3",children:"Achat depuis la coproprit"}),o.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Lors de la vente d'un lot par la coproprit  un nouveau membre, dfinissez comment le prix de vente est redistribu."}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"coproReservesShare",className:"block text-xs text-gray-700 mb-1",children:"Part rserves coproprit"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{id:"coproReservesShare",type:"number",step:"5",min:"0",max:"100",value:t.coproReservesShare,onChange:x=>u("coproReservesShare",parseFloat(x.target.value)||0),disabled:!c,className:`w-full px-3 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none ${c?"":"opacity-60 cursor-not-allowed bg-gray-50"}`}),o.jsx("span",{className:"text-sm text-gray-600",children:"%"})]}),o.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Vers aux rserves collectives"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"foundersShare",className:"block text-xs text-gray-700 mb-1",children:"Part redistribution fondateurs"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{id:"foundersShare",type:"number",value:100-t.coproReservesShare,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600"}),o.jsx("span",{className:"text-sm text-gray-600",children:"%"})]}),o.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Distribu selon quotit T0"})]})]})]}),o.jsx("hr",{className:"border-blue-200"}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Aperu de la formule"}),o.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-200 space-y-2 text-sm",children:[o.jsx("div",{className:"font-semibold text-blue-900",children:"Prix de vente = Base + Indexation + Frais de portage"}),o.jsxs("div",{className:"text-gray-700 space-y-1 text-xs",children:[o.jsx("div",{children:o.jsx("strong",{children:"O:"})}),o.jsx("div",{children:" Base = Achat initial + Frais notaire + Construction"}),o.jsxs("div",{children:[" Indexation = Base  [(1 + ",t.indexationRate,"%)^annes - 1]"]}),o.jsxs("div",{children:[" Frais de portage = (Intrts + Taxes + Assurance)  ",t.carryingCostRecovery,"%"]})]})]})]}),o.jsxs("div",{children:[o.jsxs("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:["Exemple pour ",h," ans de portage sur lot de ",K(f)]}),o.jsx("div",{className:"bg-white rounded-lg border border-blue-200 overflow-hidden",children:o.jsx("table",{className:"w-full text-sm",children:o.jsxs("tbody",{children:[o.jsxs("tr",{className:"border-b border-blue-100",children:[o.jsx("td",{className:"px-4 py-2 text-gray-700",children:"Base acquisition"}),o.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:K(f)})]}),o.jsxs("tr",{className:"border-b border-blue-100",children:[o.jsxs("td",{className:"px-4 py-2 text-gray-700",children:["Indexation (",t.indexationRate,"%  ",h," ans)"]}),o.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:K(p.indexation)})]}),o.jsxs("tr",{className:"border-b border-blue-100",children:[o.jsxs("td",{className:"px-4 py-2 text-gray-700",children:["Frais de portage (",h," ans)"]}),o.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:K(p.carryingCostRecovery)})]}),o.jsxs("tr",{className:"border-b border-blue-100 text-xs text-gray-600",children:[o.jsxs("td",{className:"px-6 py-1",children:["- Intrts (",t.averageInterestRate,"% sur prt)"]}),o.jsx("td",{className:"px-4 py-1 text-right",children:K(m.monthlyInterest*h*12)})]}),o.jsxs("tr",{className:"border-b border-blue-100 text-xs text-gray-600",children:[o.jsx("td",{className:"px-6 py-1",children:"- Taxe btiment inoccup"}),o.jsx("td",{className:"px-4 py-1 text-right",children:K(m.monthlyTax*h*12)})]}),o.jsxs("tr",{className:"border-b border-blue-200 text-xs text-gray-600",children:[o.jsx("td",{className:"px-6 py-1",children:"- Assurance"}),o.jsx("td",{className:"px-4 py-1 text-right",children:K(m.monthlyInsurance*h*12)})]}),o.jsxs("tr",{className:"bg-blue-50",children:[o.jsx("td",{className:"px-4 py-3 font-bold text-blue-900",children:"Prix total de vente"}),o.jsx("td",{className:"px-4 py-3 text-right font-bold text-blue-900",children:K(p.totalPrice)})]})]})})})]})]})]})}const Da=10;function lb(t){return t.reduce((e,r)=>r.lotsOwned?e+r.lotsOwned.length:e+(r.quantity||1),0)}function cb(t){return t.length}function ub(t,e){return lb(t)+cb(e)}function hb(t,e=Da,r=1){return t+r>e}function db(t,e=Da){return Math.max(0,e-t)}function Rp(t,e,r=Da){const n=ub(t,e);if(hb(n,r,1)){const s=db(n,r);return{isValid:!1,error:`Cannot add lot: Maximum of ${r} total lots reached. ${s} lot${s!==1?"s":""} remaining.`}}return{isValid:!0}}const Fa="1.37.1";function Dp(t){if(!t)return!1;const e=Fa.split(".").map(Number),r=t.split(".").map(Number);if(e.length!==3||r.length!==3)return!1;const[n]=e,[s]=r;return n===s}const Cs="2026-02-01",Fp=[{name:"Manuela/Dragan",capitalApporte:5e4,registrationFeesRate:12.5,unitId:1,surface:112,interestRate:4.5,durationYears:25,quantity:1,parachevementsPerM2:500,isFounder:!0,entryDate:new Date(Cs)},{name:"Cathy/Jim",capitalApporte:17e4,registrationFeesRate:12.5,unitId:3,surface:134,interestRate:4.5,durationYears:25,quantity:1,parachevementsPerM2:500,isFounder:!0,entryDate:new Date(Cs)},{name:"Annabelle/Colin",capitalApporte:2e5,registrationFeesRate:12.5,unitId:5,surface:198,interestRate:4.5,durationYears:25,quantity:2,parachevementsPerM2:500,isFounder:!0,entryDate:new Date(Cs),lotsOwned:[{lotId:1,surface:118,unitId:5,isPortage:!1,allocatedSurface:118,acquiredDate:new Date("2026-02-01")},{lotId:2,surface:80,unitId:5,isPortage:!0,allocatedSurface:80,acquiredDate:new Date("2026-02-01"),originalPrice:94200,originalNotaryFees:11775,originalConstructionCost:127200}]},{name:"Julie/Sverin",capitalApporte:7e4,registrationFeesRate:12.5,unitId:6,surface:108,interestRate:4.5,durationYears:25,quantity:1,parachevementsPerM2:500,isFounder:!0,entryDate:new Date(Cs)},{name:"Nouveauelle Arrivante",capitalApporte:8e4,registrationFeesRate:12.5,unitId:5,surface:80,interestRate:4.5,durationYears:25,quantity:1,parachevementsPerM2:500,isFounder:!1,entryDate:new Date("2027-06-01"),purchaseDetails:{buyingFrom:"Annabelle/Colin",lotId:2,purchasePrice:256490}}],Wo={totalPurchase:65e4,mesuresConservatoires:0,demolition:0,infrastructures:0,etudesPreparatoires:0,fraisEtudesPreparatoires:0,fraisGeneraux3ans:0,batimentFondationConservatoire:0,batimentFondationComplete:0,batimentCoproConservatoire:0,globalCascoPerM2:1590,cascoTvaRate:6,maxTotalLots:10,expenseCategories:{conservatoire:[{label:"Traitement Mrule",amount:4e4},{label:"Dmolition (mrule)",amount:2e4},{label:"nettoyage du site",amount:6e3},{label:"toitures",amount:1e4},{label:"scurit du site? (portes, accs..)",amount:2e3}],habitabiliteSommaire:[{label:"plomberie",amount:1e3},{label:"lectricit (refaire un tableau)",amount:1e3},{label:"retirer des lignes (lectrique)",amount:2e3},{label:"isolation thermique",amount:1e3},{label:"cloisons",amount:2e3},{label:"chauffage",amount:0}],premierTravaux:[{label:"poulailler",amount:150},{label:"atelier maintenance (et reparation)",amount:500},{label:"stockage ressources/nergie/consommables (eau, bois,...)",amount:700},{label:"verger prix par 1ha",amount:2e3},{label:"atelier construction",amount:2500},{label:"Cuisine (commune)",amount:3e3},{label:"travaux chapelle rudimentaires",amount:5e3},{label:"local + outil jardin",amount:5e3}]}},Gl="credit-castor-scenario",Zu="credit-castor-pinned-participant",fb=t=>{try{localStorage.setItem(Zu,JSON.stringify({participantName:t}))}catch(e){console.error("Failed to save pinned participant:",e)}},mb=()=>{try{const t=localStorage.getItem(Zu);if(t)return JSON.parse(t).participantName||null}catch(t){console.error("Failed to load pinned participant:",t)}return null},jp=()=>{try{localStorage.removeItem(Zu)}catch(t){console.error("Failed to clear pinned participant:",t)}},cu=(t,e,r,n)=>{try{const s={releaseVersion:Fa,version:2,timestamp:new Date().toISOString(),participants:t,projectParams:e,deedDate:r,portageFormula:n||zr};localStorage.setItem(Gl,JSON.stringify(s))}catch(s){console.error("Failed to save to localStorage:",s)}},nl=()=>{try{const t=localStorage.getItem(Gl);if(t){const e=JSON.parse(t),r=e.releaseVersion,n=Dp(r),s=e.portageFormula?{...zr,...e.portageFormula}:zr,a={isCompatible:n,storedVersion:r,currentVersion:Fa,participants:e.participants||Fp,projectParams:e.projectParams||Wo,deedDate:e.deedDate,portageFormula:s,timestamp:e.timestamp};return n&&(a.projectParams&&!a.projectParams.globalCascoPerM2&&(a.projectParams.globalCascoPerM2=a.participants?.[0]?.cascoPerM2||1590),a.projectParams&&a.projectParams.cascoTvaRate===void 0&&(a.projectParams.cascoTvaRate=6),a.participants&&(a.participants=a.participants.map(i=>{const{cascoPerM2:l,notaryFeesRate:c,...u}=i;return c!==void 0&&!u.registrationFeesRate&&(u.registrationFeesRate=c),u})),a.participants&&(a.participants=a.participants.map(i=>{const l={...i};return l.entryDate&&(typeof l.entryDate=="string"?l.entryDate=new Date(l.entryDate):(!(l.entryDate instanceof Date)||isNaN(l.entryDate.getTime()))&&(console.warn(`Corrupted entryDate for ${l.name}, removing`),delete l.entryDate)),l.exitDate&&(typeof l.exitDate=="string"?l.exitDate=new Date(l.exitDate):(!(l.exitDate instanceof Date)||isNaN(l.exitDate.getTime()))&&(console.warn(`Corrupted exitDate for ${l.name}, removing`),delete l.exitDate)),l.lotsOwned&&(l.lotsOwned=l.lotsOwned.map(c=>{const u={...c};return u.acquiredDate&&typeof u.acquiredDate=="string"&&(u.acquiredDate=new Date(u.acquiredDate)),u.soldDate&&typeof u.soldDate=="string"&&(u.soldDate=new Date(u.soldDate)),u})),l}))),a}}catch(t){console.error("Failed to load from localStorage:",t)}return null},pb=()=>{try{localStorage.removeItem(Gl)}catch(t){console.error("Failed to clear localStorage:",t)}};function gb({storedVersion:t,currentVersion:e,onExportAndReset:r,onDismiss:n}){const[s,a]=k.useState(!1),i=async()=>{a(!0);try{await r()}finally{a(!1)}};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full p-6 relative",children:[o.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Fermer",children:o.jsx(Br,{className:"w-5 h-5"})}),o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"bg-orange-100 rounded-full p-3",children:o.jsx(Tm,{className:"w-8 h-8 text-orange-600"})}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Version incompatible dtecte"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Vos donnes ont t cres avec une version antrieure"})]})]}),o.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4 space-y-2",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-sm text-gray-600",children:"Version stocke:"}),o.jsx("span",{className:"font-mono font-semibold text-gray-800",children:t||"inconnue"})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-sm text-gray-600",children:"Version actuelle:"}),o.jsx("span",{className:"font-mono font-semibold text-green-700",children:e})]})]}),o.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 mb-6",children:[o.jsx("p",{className:"text-sm text-blue-800 mb-2",children:o.jsx("strong",{children:"Pourquoi ce message ?"})}),o.jsx("p",{className:"text-sm text-blue-700",children:"La structure des donnes a chang entre les versions. Pour viter les erreurs et la corruption de donnes, nous devons rinitialiser le localStorage."})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:" tapes recommandes :"}),o.jsxs("ol",{className:"space-y-2 text-sm text-gray-700",children:[o.jsxs("li",{className:"flex gap-2",children:[o.jsx("span",{className:"font-semibold text-blue-600",children:"1."}),o.jsx("span",{children:'Cliquez sur "Tlcharger & Rinitialiser" pour sauvegarder vos donnes'})]}),o.jsxs("li",{className:"flex gap-2",children:[o.jsx("span",{className:"font-semibold text-blue-600",children:"2."}),o.jsxs("span",{children:["Envoyez le fichier tlcharg  ",o.jsx("strong",{children:"Dragan"})," (drag.markovic@gmail.com)"]})]}),o.jsxs("li",{className:"flex gap-2",children:[o.jsx("span",{className:"font-semibold text-blue-600",children:"3."}),o.jsx("span",{children:"Le localStorage sera automatiquement rinitialis aprs le tlchargement"})]})]})]}),o.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-6",children:o.jsxs("p",{className:"text-xs text-yellow-800",children:[" ",o.jsx("strong",{children:"Important :"}),` Si vous cliquez sur "Ignorer", vous risquez de rencontrer des bugs et des comportements inattendus. Il est fortement recommand d'exporter vos donnes avant de continuer.`]})}),o.jsxs("div",{className:"flex gap-3",children:[o.jsxs("button",{onClick:i,disabled:s,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[o.jsx(da,{className:"w-5 h-5"}),s?"Tlchargement...":"Tlcharger & Rinitialiser"]}),o.jsx("button",{onClick:n,className:"px-6 py-3 border-2 border-gray-300 hover:border-gray-400 text-gray-700 font-semibold rounded-lg transition-colors",children:"Ignorer (non recommand)"})]})]})})}function xb(){const[t,e]=k.useState(!1),[r,n]=k.useState({show:!1}),[s,a]=k.useState(null),[i,l]=k.useState(()=>mb()),[c,u]=k.useState(null),h=k.useRef([]),[f,m]=k.useState(null),[p,x]=k.useState(null),[g,y]=k.useState(null);return{participants:s,projectParams:f,deedDate:p,portageFormula:g,pinnedParticipant:i,fullscreenParticipantIndex:c,versionMismatch:r,isInitialized:t,setParticipants:a,setProjectParams:m,setDeedDate:x,setPortageFormula:y,setPinnedParticipant:l,setFullscreenParticipantIndex:u,setVersionMismatch:n,setIsInitialized:e,handlePinParticipant:A=>{fb(A),l(A)},handleUnpinParticipant:()=>{jp(),l(null)},participantRefs:h}}function vb(t,e){return k.useMemo(()=>{if(!e)return t.participantBreakdown;const r=t.participantBreakdown.findIndex(a=>a.name===e);if(r===-1)return t.participantBreakdown;const n=[...t.participantBreakdown],[s]=n.splice(r,1);return n.unshift(s),n},[t.participantBreakdown,e])}function cf(t,e,r,n,s,a,i,l){const c=(r.getTime()-a.getTime())/315576e5,u=t.lotsOwned?.find(x=>x.lotId===e.purchaseDetails?.lotId);if(!u)throw new Error(`Seller ${t.name} has no lot with ID ${e.purchaseDetails?.lotId}`);const h=(u.originalPrice||0)+(u.originalNotaryFees||0)+(u.originalConstructionCost||0),f=Gi(h,t.capitalApporte,c*12,t.interestRate),m=up(u.originalPrice||0,u.originalNotaryFees||0,u.originalConstructionCost||0,c,i,f),p=-m.totalPrice;return{type:"portage_sale",seller:t.name,lotPrice:m.totalPrice,indexation:m.indexation,carryingCosts:m.carryingCostRecovery,delta:{totalCost:p,loanNeeded:p,reason:`Sold portage lot to ${e.name}`}}}function yb(t,e,r,n,s=30,a,i,l,c,u,h,f){let m;const p=1-s/100,x=e.surface||0;if(a&&i&&l&&c!==void 0&&c>0&&u!==void 0&&u>0&&x>0&&h!==void 0&&f!==void 0&&f>0){const H=i instanceof Date?i:new Date(i),w=l instanceof Date?l:new Date(l),E=Wl(H,w);m=hp(x,c,u,E,a,0,h,l,f).distribution.toParticipants}else{const H=e.purchaseDetails?.purchasePrice||0;if(H===0)return{type:"copro_sale",delta:{totalCost:0,loanNeeded:0,reason:`${e.name} joined (copro sale)`}};m=H*p}const y=n.filter(H=>H.isFounder===!0&&H.name!==e.name),I=y.reduce((H,w)=>H+(w.surface||0),0);if(I===0){const H=y.length,E=-(H>0?m/H:0);return{type:"copro_sale",delta:{totalCost:E,loanNeeded:E,reason:`${e.name} joined (copro sale)`}}}const P=t.surface||0,A=I>0?P/I:0,V=-(m*A);return{type:"copro_sale",delta:{totalCost:V,loanNeeded:V,reason:`${e.name} joined (copro sale)`}}}function eh(t,e){const r=new Date(t);return r.setDate(r.getDate()+e),r.toISOString().split("T")[0]}function _b(t){return t&&typeof t=="object"&&"seconds"in t&&"nanoseconds"in t?new Date(t.seconds*1e3+t.nanoseconds/1e6):t}function Si(t,e){if(!t)return e;const r=_b(t);if(!r)return e;const n=r instanceof Date?r:new Date(r);return isNaN(n.getTime())?(console.warn(`Invalid date value: ${t}, using fallback: ${e}`),e):n.toISOString().split("T")[0]}function wb(t,e){const r=eh(e,1);return[...new Set(t.map(s=>{const a=s.isFounder?e:r;return Si(s.entryDate,a)}))].sort().map(s=>new Date(s))}function bb(t,e,r,n=30,s){const a=[],i=eh(r,1),l=[...new Set(t.map(m=>{const p=m.isFounder?r:i;return Si(m.entryDate,p)}))].sort(),c=s?.maxTotalLots??t.length,u=e.totalSurface;let h=null,f=null;return l.forEach((m,p)=>{const x=new Date(m),g=t.filter(V=>{const H=V.isFounder?r:i;return Si(V.entryDate,H)===m&&V.purchaseDetails?.buyingFrom==="Coproprit"}),y=g.reduce((V,H)=>{const w=H.purchaseDetails?.purchasePrice||0;return V+w*(n/100)},0),I=g.length,P=g.reduce((V,H)=>V+(H.surface||0),0);let A,D;p===0||h===null||f===null?(A=Math.max(0,c-I),D=Math.max(0,u-P)):(A=Math.max(0,h-I),D=Math.max(0,f-P)),(p===0||A!==h||D!==f)&&(a.push({date:x,availableLots:A,totalSurface:D,soldThisDate:g.map(V=>V.name),reserveIncrease:y,colorZone:p}),h=A,f=D)}),a}function Eb(t,e,r,n,s){if(s)return t.filter(i=>i.isFounder);const a=[];return t.forEach(i=>{if(a.push(i),i.purchaseDetails?.buyingFrom==="Coproprit"){const l=e.filter(c=>(c.entryDate?new Date(c.entryDate):new Date(n))<r);a.push(...l)}else if(i.purchaseDetails?.buyingFrom){const l=e.find(c=>c.name===i.purchaseDetails.buyingFrom);l&&a.push(l)}}),Array.from(new Set(a))}function kp(t,e,r,n,s){const a=new Map,i=new Map,l=eh(r,1);return[...new Set(t.map(u=>{const h=u.isFounder?r:l;return Si(u.entryDate,h)}))].sort().forEach((u,h)=>{const f=new Date(u),m=t.filter(x=>{const g=x.isFounder?r:l;return Si(x.entryDate,g)===u});Eb(m,t,f,r,h===0).forEach(x=>{const g=t.indexOf(x),y=e.participantBreakdown[g];if(!y)return;let I;const P=m.some(E=>E.purchaseDetails?.buyingFrom===x.name),A=m.includes(x)&&x.purchaseDetails?.buyingFrom&&x.purchaseDetails.buyingFrom!=="Coproprit",D=m.includes(x)&&x.purchaseDetails?.buyingFrom==="Coproprit",V=m.filter(E=>E.purchaseDetails?.buyingFrom==="Coproprit"),H=h===0||A||D;if(P){const E=m.find(_=>_.purchaseDetails?.buyingFrom===x.name);if(E){const _=t.indexOf(E),N=e.participantBreakdown[_],T=x.entryDate?new Date(x.entryDate):new Date(r);N&&(I=cf(x,E,f,y,N,T,n,t.length))}}else if(A){const E=t.find(_=>_.name===x.purchaseDetails?.buyingFrom);if(E){const _=t.indexOf(E),N=e.participantBreakdown[_],T=E.entryDate?new Date(E.entryDate):new Date(r);N&&(I=cf(E,x,f,N,y,T,n,t.length))}}else if(V.length>0&&!D){const E=i.get(x.name);if(E){const _=t.filter(le=>(le.entryDate?new Date(le.entryDate):new Date(r))<=f),N=(e.totals.purchase||0)+(e.totals.totalDroitEnregistrements||0)+(e.totals.construction||0),T=e.participantBreakdown.reduce((le,Ae)=>le+(Ae.personalRenovationCost||0),0),R=s?.renovationStartDate,S=V.map(le=>{const Ae=le.entryDate?new Date(le.entryDate):f;return yb(x,le,E,_,n.coproReservesShare,n,r,Ae,N,e.totalSurface,R,T)}),se=S.reduce((le,Ae)=>le+Ae.delta.totalCost,0),te=S.reduce((le,Ae)=>le+Ae.delta.loanNeeded,0),me=V.map(le=>le.name).join(", "),ce=V.length===1?S[0].delta.reason:`${me} joined (copro sale, total)`;I={type:"copro_sale",delta:{totalCost:se,loanNeeded:te,reason:ce}}}}const w={date:f,participantName:x.name,participantIndex:g,totalCost:y.totalCost,loanNeeded:y.loanNeeded,monthlyPayment:y.monthlyPayment,isT0:h===0&&x.isFounder===!0,colorZone:h,transaction:I,showFinancingDetails:H,useTwoLoans:y.useTwoLoans,loan1MonthlyPayment:y.loan1MonthlyPayment,loan2MonthlyPayment:y.loan2MonthlyPayment};a.has(x.name)||a.set(x.name,[]),a.get(x.name).push(w),i.set(x.name,w)})}),a}function Tb(t,e,r,n){const s=ms(t,e),a=s.honorairesYearly,i=s.recurringYearly.total,l=s.oneTimeCosts.total,c=l+i+a;return{year:1,date:n,oneTimeCosts:l,recurringYearlyCosts:i,honorairesThisYear:a,total:c}}function Ab(t,e,r,n){const s=ms(t,e),a=s.honorairesYearly,i=s.recurringYearly.total,l=i+a,c=new Date(n);return c.setFullYear(c.getFullYear()+1),{year:2,date:c,oneTimeCosts:0,recurringYearlyCosts:i,honorairesThisYear:a,total:l}}function Sb(t,e,r,n){const s=ms(t,e),a=s.honorairesYearly,i=s.recurringYearly.total,l=i+a,c=new Date(n);return c.setFullYear(c.getFullYear()+2),{year:3,date:c,oneTimeCosts:0,recurringYearlyCosts:i,honorairesThisYear:a,total:l}}function Nb(t,e,r,n){return[Tb(t,e,r,n),Ab(t,e,r,n),Sb(t,e,r,n)]}function Op(t,e){return t.filter(r=>{const s=(r.entryDate||new Date(0))<=e,a=!r.exitDate||r.exitDate>e;return s&&a})}function uf(t,e){const r=Op(t,e.date);if(r.length===0)return[];const n=e.total/r.length;return r.map(s=>({participantName:s.name,year:e.year,amountOwed:n,isFounder:s.isFounder||!1,isActive:!0}))}function Cb(t,e){const r=t.filter(s=>s.isFounder===!0);if(r.length===0)return[];const n=e.total/r.length;return r.map(s=>({participantName:s.name,year:1,amountOwed:n,isFounder:!0,isActive:!0}))}function Ib(t,e,r){const n=t.filter(c=>!c.isFounder&&c.entryDate&&c.entryDate>r).sort((c,u)=>(c.entryDate?.getTime()||0)-(u.entryDate?.getTime()||0)),s=[],a=new Map,i=t.filter(c=>c.isFounder===!0),l=e.total/i.length;i.forEach(c=>{a.set(c.name,l)});for(const c of n){const u=Op(t,c.entryDate),h=e.total/u.length,m=u.filter(x=>x.name!==c.name).map(x=>{const y=(a.get(x.name)||0)-h;return a.set(x.name,h),{toParticipant:x.name,amount:y}}),p=m.reduce((x,g)=>x+g.amount,0);a.set(c.name,p),s.push({newcomerName:c.name,entryDate:c.entryDate,year:1,reimbursements:m,totalPaid:p})}return s}function jc(t,e){const r=`FRAIS_GENERAUX_YEAR_${t.year}`;return{id:`frais-generaux-year-${t.year}-${t.date.getTime()}`,type:r,date:t.date,year:t.year,breakdown:{oneTimeCosts:t.oneTimeCosts,recurringYearlyCosts:t.recurringYearlyCosts,honorairesThisYear:t.honorairesThisYear,total:t.total},payments:e.map(n=>({participantName:n.participantName,amountOwed:n.amountOwed,isFounder:n.isFounder}))}}function Pb(t){return{id:`newcomer-reimbursement-${t.newcomerName}-${t.entryDate.getTime()}`,type:"NEWCOMER_FRAIS_GENERAUX_REIMBURSEMENT",date:t.entryDate,year:t.year,newcomerName:t.newcomerName,reimbursements:t.reimbursements,totalPaid:t.totalPaid,description:`${t.newcomerName} reimburses founders for Year ${t.year} Frais Gnraux overpayment`}}function Rb(t,e,r,n){const s=[],a=Nb(t,e,r,n),i=a[0],l=Cb(t,i);s.push(jc(i,l)),Ib(t,i,n).forEach(p=>{s.push(Pb(p))});const u=a[1],h=uf(t,u);h.length>0&&s.push(jc(u,h));const f=a[2],m=uf(t,f);return m.length>0&&s.push(jc(f,m)),s.sort((p,x)=>p.date.getTime()-x.date.getTime()),s}function Db({onAddParticipant:t}){return o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:" Besoins de Financement Individuels"}),o.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Visualisez l'volution des besoins de financement au fil du temps"})]}),o.jsxs("button",{onClick:t,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-lg transition-colors flex items-center gap-2",children:[o.jsx(_a,{className:"w-5 h-5"}),"Ajouter une participante"]})]})}function Fb({participants:t,onUpdateParticipant:e}){return o.jsxs("div",{className:"flex-shrink-0 w-48 pr-4",children:[o.jsx("div",{className:"h-40 flex items-center border-b border-gray-200 swimlane-row bg-purple-50",children:o.jsx("div",{className:"font-semibold text-purple-800",children:"La Coproprit"})}),o.jsx("div",{className:"h-48 flex items-center border-b border-gray-200 swimlane-row bg-purple-25",children:o.jsx("div",{className:"font-semibold text-purple-700",children:"Frais Gnraux"})}),t.map((r,n)=>o.jsx("div",{className:`h-40 flex items-center border-b border-gray-200 swimlane-row ${r.enabled===!1?"opacity-50":""}`,children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:r.enabled!==!1,onChange:s=>{e(n,{...r,enabled:s.target.checked})},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500",title:r.enabled===!1?"Activer ce participant":"Dsactiver ce participant"}),o.jsx("div",{className:`font-semibold ${r.enabled===!1?"text-gray-500":"text-gray-800"}`,children:r.name})]})},n))]})}const jb=(t,e)=>{if(e)return"bg-green-50";const r=["bg-blue-50","bg-purple-50","bg-indigo-50","bg-cyan-50","bg-teal-50"];return r[t%r.length]};function kb({date:t,availableLots:e,totalSurface:r,soldThisDate:n,reserveIncrease:s,colorZone:a,isT0:i,coproReservesShare:l,onClick:c}){return o.jsxs("div",{onClick:c,className:`
        w-full p-4 rounded-lg border-2 border-purple-300 transition-shadow hover:shadow-md
        ${c?"cursor-pointer hover:shadow-lg":""}
        ${jb(a,i)}
      `,children:[o.jsx("div",{className:"text-xs text-gray-500 mb-2",children:t.toLocaleDateString("fr-BE")}),o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-xs text-purple-600",children:"Lots disponibles"}),o.jsx("span",{className:"text-sm font-bold text-purple-800",children:e})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-xs text-purple-600",children:"Surface totale"}),o.jsxs("span",{className:"text-sm font-bold text-purple-800",children:[r,"m"]})]})]}),n.length>0&&o.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-200",children:[o.jsxs("div",{className:"text-xs font-semibold text-red-700",children:[" Vendu  ",n.join(", ")]}),s>0&&o.jsxs("div",{className:"text-xs font-semibold text-green-700 mt-1",children:[" +",K(s)," rserves (",l,"%)"]})]})]})}function Ob({allDates:t,coproSnapshots:e,coproReservesShare:r,onOpenCoproDetails:n}){return o.jsx("div",{className:"h-40 flex items-center border-b border-gray-200 swimlane-row bg-purple-50",children:t.map((s,a)=>{const i=s.toISOString().split("T")[0],l=e.find(c=>c.date.toISOString().split("T")[0]===i);return o.jsx("div",{className:"w-56 flex-shrink-0 px-2",children:l&&o.jsx(kb,{date:l.date,availableLots:l.availableLots,totalSurface:l.totalSurface,soldThisDate:l.soldThisDate,reserveIncrease:l.reserveIncrease,colorZone:l.colorZone,isT0:a===0,coproReservesShare:r,onClick:()=>n(l)})},a)})})}const Mb=(t,e,r)=>{if(e)return"bg-purple-50";if(r==="NEWCOMER_FRAIS_GENERAUX_REIMBURSEMENT")return"bg-emerald-50";const n=["bg-purple-100","bg-purple-50","bg-indigo-50","bg-violet-50","bg-fuchsia-50"];return n[t%n.length]};function Lb({event:t,colorZone:e,isT0:r,onClick:n}){const s=t.type==="NEWCOMER_FRAIS_GENERAUX_REIMBURSEMENT";return o.jsxs("div",{onClick:n,className:`
        w-full p-3 rounded-lg border-2 transition-shadow hover:shadow-md
        ${n?"cursor-pointer hover:shadow-lg":""}
        ${Mb(e,r,t.type)}
        ${s?"border-emerald-300":"border-purple-300"}
      `,children:[o.jsx("div",{className:"text-xs text-gray-500 mb-2",children:t.date.toLocaleDateString("fr-BE")}),s?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"text-xs font-semibold text-emerald-700 mb-1",children:" Remboursement FG"}),o.jsx("div",{className:"text-xs text-gray-700 mb-2",children:t.newcomerName}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-xs text-gray-600",children:"Montant"}),o.jsx("span",{className:"text-sm font-bold text-emerald-800",children:K(t.totalPaid)})]}),o.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[" ",t.reimbursements.length," participant",t.reimbursements.length!==1?"s":""]})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"text-xs font-semibold text-purple-700 mb-1",children:[" Frais Gnraux Anne ",t.year]}),o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("span",{className:"text-xs text-gray-600",children:"Total"}),o.jsx("span",{className:"text-sm font-bold text-purple-800",children:K(t.breakdown.total)})]}),o.jsxs("div",{className:"text-xs text-gray-500",children:[t.payments.length," participant",t.payments.length!==1?"s":"",t.year===1&&" (fondateurs)"]}),t.year===1&&o.jsxs("div",{className:"mt-2 pt-2 border-t border-purple-200 space-y-0.5 text-xs",children:[t.breakdown.oneTimeCosts>0&&o.jsxs("div",{className:"flex justify-between text-gray-600",children:[o.jsx("span",{children:"Ponctuel"}),o.jsx("span",{children:K(t.breakdown.oneTimeCosts)})]}),o.jsxs("div",{className:"flex justify-between text-gray-600",children:[o.jsx("span",{children:"Rcurrent"}),o.jsx("span",{children:K(t.breakdown.recurringYearlyCosts)})]}),o.jsxs("div",{className:"flex justify-between text-gray-600",children:[o.jsx("span",{children:"Honoraires"}),o.jsx("span",{children:K(t.breakdown.honorairesThisYear)})]})]})]})]})}function Bb({allDates:t,events:e,onOpenEventDetails:r}){return o.jsx("div",{className:"h-48 flex items-center border-b border-gray-200 swimlane-row bg-purple-25",children:t.map((n,s)=>{const a=n.toISOString().split("T")[0],i=e.find(l=>l.date.toISOString().split("T")[0]===a);return o.jsx("div",{className:"w-56 flex-shrink-0 px-2",children:i&&o.jsx(Lb,{event:i,colorZone:s,isT0:s===0,onClick:()=>r(i)})},s)})})}const Vb=(t,e,r)=>{if(e)return"bg-green-50";const n=["bg-blue-50","bg-purple-50","bg-indigo-50","bg-cyan-50","bg-teal-50"];return n[t%n.length]};function Ub({date:t,totalCost:e,loanNeeded:r,monthlyPayment:n,isT0:s,isFounder:a,colorZone:i,transaction:l,onClick:c,showFinancingDetails:u,useTwoLoans:h,loan1MonthlyPayment:f,loan2MonthlyPayment:m}){const p=h&&f&&m?f+m:n,x=h&&f&&m?"Mensualit combi":"Mensualit";return o.jsxs("div",{className:`
        w-full p-4 rounded-lg border-2 transition-shadow hover:shadow-md cursor-pointer
        ${s?"timeline-card-t0":""}
        ${Vb(i,s)}
        ${s?"border-green-300":a?"border-green-200":"border-blue-200"}
      `,onClick:c,children:[o.jsx("div",{className:"text-xs text-gray-500 mb-2",children:t.toLocaleDateString("fr-BE")}),u&&o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-xs text-gray-600",children:"Cot Total"}),o.jsx("span",{className:"text-sm font-bold text-gray-900",children:K(e)})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-xs text-gray-600",children:" emprunter"}),o.jsx("span",{className:"text-sm font-bold text-red-700",children:K(r)})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-xs text-gray-600",children:x}),o.jsx("span",{className:"text-sm font-bold text-red-600",children:K(p)})]})]}),s&&o.jsx("div",{className:"mt-2 text-xs text-green-700 font-medium",children:"Cliquer pour dtails "}),l&&o.jsxs("div",{className:`${u?"mt-2 pt-2 border-t border-current border-opacity-20":""}`,children:[o.jsxs("div",{className:`text-xs font-semibold ${l.delta.totalCost<0?"text-green-700":"text-red-700"}`,children:[l.delta.totalCost<0?"":""," ",K(Math.abs(l.delta.totalCost))]}),o.jsx("div",{className:"text-xs text-gray-600 mt-1",children:l.delta.reason})]})]})}function $b({participant:t,allDates:e,snapshots:r,onOpenParticipantDetails:n}){return o.jsx("div",{className:"h-40 flex items-center border-b border-gray-200 swimlane-row",children:e.map((s,a)=>{const i=s.toISOString().split("T")[0],l=r.find(c=>c.date.toISOString().split("T")[0]===i);return o.jsx("div",{className:"w-56 flex-shrink-0 px-2",children:l&&o.jsx(Ub,{date:l.date,totalCost:l.totalCost,loanNeeded:l.loanNeeded,monthlyPayment:l.monthlyPayment,isT0:l.isT0,isFounder:t.isFounder===!0,colorZone:l.colorZone,transaction:l.transaction,onClick:()=>n(l.participantIndex),showFinancingDetails:l.showFinancingDetails,useTwoLoans:l.useTwoLoans,loan1MonthlyPayment:l.loan1MonthlyPayment,loan2MonthlyPayment:l.loan2MonthlyPayment})},a)})})}function Hb({allDates:t,coproSnapshots:e,fraisGenerauxEvents:r,participants:n,snapshots:s,onOpenParticipantDetails:a,onOpenCoproDetails:i,onOpenFraisGenerauxDetails:l,coproReservesShare:c}){return o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx(Ob,{allDates:t,coproSnapshots:e,coproReservesShare:c,onOpenCoproDetails:i}),o.jsx(Bb,{allDates:t,events:r,onOpenEventDetails:l}),n.map((u,h)=>{const f=s.get(u.name)||[];return o.jsx($b,{participant:u,allDates:t,snapshots:f,onOpenParticipantDetails:a},h)})]})}function Wb({event:t}){const[e,r]=k.useState(t.year===1),{breakdown:n,payments:s,year:a}=t;return o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"font-semibold text-purple-900",children:["Frais Gnraux - Year ",a]}),o.jsx("button",{onClick:()=>r(!e),className:"text-xs text-purple-600 hover:text-purple-800 font-medium",children:e?" Collapse":" Expand"})]}),o.jsxs("div",{className:"bg-purple-50 p-2 rounded",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"Total"}),o.jsx("span",{className:"text-sm font-bold text-purple-800",children:K(n.total)})]}),o.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Split among ",s.length," participant",s.length!==1?"s":""]})]}),e&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[o.jsx("div",{className:"text-xs text-gray-600 font-medium mb-2",children:"Cost Breakdown"}),o.jsxs("div",{className:"space-y-1 text-xs",children:[n.oneTimeCosts>0&&o.jsxs("div",{className:"flex justify-between bg-green-50 px-2 py-1 rounded",children:[o.jsx("span",{className:"text-gray-700",children:"One-time costs:"}),o.jsx("span",{className:"font-medium text-green-700",children:K(n.oneTimeCosts)})]}),o.jsxs("div",{className:"flex justify-between bg-amber-50 px-2 py-1 rounded",children:[o.jsxs("span",{className:"text-gray-700",children:["Recurring Year ",a,":"]}),o.jsx("span",{className:"font-medium text-amber-700",children:K(n.recurringYearlyCosts)})]}),o.jsxs("div",{className:"flex justify-between bg-blue-50 px-2 py-1 rounded",children:[o.jsx("span",{className:"text-gray-700",children:"Honoraires ( 3):"}),o.jsx("span",{className:"font-medium text-blue-700",children:K(n.honorairesThisYear)})]})]})]}),o.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[o.jsxs("div",{className:"text-xs text-gray-600 font-medium mb-2",children:["Payments",a===1?" (Founders only)":""]}),o.jsx("div",{className:"space-y-1",children:s.map((i,l)=>o.jsxs("div",{className:"flex justify-between items-center text-xs bg-gray-50 px-2 py-1 rounded",children:[o.jsxs("span",{className:"text-gray-700",children:[i.participantName,i.isFounder&&a===1&&o.jsx("span",{className:"ml-1 text-purple-600 font-medium",children:"(Founder)"})]}),o.jsx("span",{className:"font-medium text-gray-900",children:K(i.amountOwed)})]},l))})]})]})]})}function qb({event:t}){const{newcomerName:e,reimbursements:r,totalPaid:n,year:s,description:a}=t;return o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"font-semibold text-emerald-900",children:[e," - Frais Gnraux Reimbursement"]}),o.jsx("div",{className:"text-xs text-gray-600 italic",children:a}),o.jsx("div",{className:"bg-emerald-50 p-2 rounded border border-emerald-200",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"text-xs text-gray-600 font-medium",children:["Total Paid (Year ",s,")"]}),o.jsx("span",{className:"text-sm font-bold text-emerald-800",children:K(n)})]})}),o.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[o.jsx("div",{className:"text-xs text-gray-600 font-medium mb-2",children:"Reimbursements"}),o.jsx("div",{className:"space-y-1",children:r.map((i,l)=>o.jsxs("div",{className:"flex justify-between items-center text-xs bg-gray-50 px-2 py-1 rounded",children:[o.jsxs("span",{className:"text-gray-700",children:["To ",i.toParticipant]}),o.jsx("span",{className:"font-medium text-gray-900",children:K(i.amount)})]},l))})]}),o.jsx("div",{className:"mt-2 text-xs text-gray-500 italic bg-gray-50 p-2 rounded",children:" Newcomers reimburse existing participants for their overpayment. Costs are recalculated to split equally among all active participants."})]})}function Gb({event:t,onClose:e}){const r=t.type==="NEWCOMER_FRAIS_GENERAUX_REIMBURSEMENT";return o.jsxs("div",{className:"fixed inset-0 bg-white z-50 overflow-y-auto",children:[o.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 z-10 shadow-sm",children:o.jsx("div",{className:"max-w-4xl mx-auto p-6",children:o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx("h2",{className:"text-2xl font-bold text-purple-900",children:r?o.jsx(o.Fragment,{children:" Remboursement Frais Gnraux"}):o.jsxs(o.Fragment,{children:[" Frais Gnraux - Anne ",t.year]})}),o.jsx("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx("span",{className:"text-gray-400",children:"Date"}),o.jsx("span",{className:"font-medium text-purple-600",children:t.date.toLocaleDateString("fr-BE")})]})})]}),o.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:o.jsx(Br,{className:"w-8 h-8"})})]})})}),o.jsx("div",{className:"max-w-4xl mx-auto p-6",children:o.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:r?o.jsx(qb,{event:t}):o.jsx(Wb,{event:t})})})]})}function zb({participants:t,projectParams:e,calculations:r,deedDate:n,onOpenParticipantDetails:s,onOpenCoproDetails:a,onAddParticipant:i,onUpdateParticipant:l,coproReservesShare:c=zr.coproReservesShare,unitDetails:u={}}){const[h,f]=k.useState(null),m=k.useMemo(()=>bb(t,r,n,c,e),[t,r,n,c,e]),p=k.useMemo(()=>Rb(t,e,u,new Date(n)),[t,e,u,n]),x=k.useMemo(()=>{const y=wb(t,n),I=p.map(D=>D.date),P=[...y,...I],A=new Set(P.map(D=>D.toISOString().split("T")[0]));return Array.from(A).map(D=>new Date(D)).sort((D,V)=>D.getTime()-V.getTime())},[t,n,p]),g=k.useMemo(()=>kp(t,r,n,{...zr,coproReservesShare:c},e),[t,r,n,c,e]);return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[o.jsx(Db,{onAddParticipant:i}),o.jsxs("div",{className:"flex overflow-x-auto",children:[o.jsx(Fb,{participants:t,onUpdateParticipant:l}),o.jsx(Hb,{allDates:x,coproSnapshots:m,fraisGenerauxEvents:p,participants:t,snapshots:g,onOpenParticipantDetails:s,onOpenCoproDetails:a,onOpenFraisGenerauxDetails:f,coproReservesShare:c})]})]}),h&&o.jsx(Gb,{event:h,onClose:()=>f(null)})]})}function Yb(t,e,r,n){if(!t.purchaseDetails||t.purchaseDetails.buyingFrom==="Coproprit")return;const{lotId:s}=t.purchaseDetails,a=e.lotsOwned?.find(g=>g.lotId===s);if(!a||!a.isPortage)return;const i=a.acquiredDate||e.entryDate||new Date(r),c=((t.entryDate||new Date(r)).getTime()-i.getTime())/(1e3*60*60*24*365.25),u=a.originalPrice||0,h=a.originalNotaryFees||0,f=a.originalConstructionCost||0,m=u+h+f,p=Gi(m,0,Math.round(c*12),n.averageInterestRate);return Qu(u,h,f,c,n,p,0).totalPrice}function Kb(t,e,r,n){const s=Yb(t,e,r,n);return s===void 0?t:{...t,purchaseDetails:{...t.purchaseDetails,purchasePrice:s}}}function Xb({onSubmit:t,onCancel:e}){const[r,n]=k.useState(""),[s,a]=k.useState(""),[i,l]=k.useState(null),c=u=>{if(u.preventDefault(),!s.trim()){l("Veuillez entrer votre email");return}if(!r.trim()){l("Veuillez entrer le mot de passe");return}t(r,s)};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[o.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[o.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Dverrouiller les champs collectifs"}),o.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Fermer",children:o.jsx(Br,{className:"w-5 h-5"})})]}),o.jsxs("form",{onSubmit:c,className:"p-6",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Votre email"}),o.jsx("input",{id:"email",type:"email",value:s,onChange:u=>{a(u.target.value),l(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"votre-email@exemple.com",autoFocus:!0})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Mot de passe administrateur"}),o.jsx("input",{id:"password",type:"password",value:r,onChange:u=>{n(u.target.value),l(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:""})]}),i&&o.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm",children:i}),o.jsx("div",{className:"bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded-md text-sm",children:o.jsx("p",{children:"Le dverrouillage permet de modifier les paramtres collectifs du projet (prix d'achat, frais gnraux, formule de portage, etc.)."})})]}),o.jsxs("div",{className:"flex gap-3 mt-6",children:[o.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"Annuler"}),o.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Dverrouiller"})]})]})]})})}function Qb(){const{isUnlocked:t,unlockedBy:e,unlockedAt:r,unlock:n,lock:s}=ql(),[a,i]=k.useState(!1),[l,c]=k.useState(null),u=async(m,p)=>{await n(m,p)?(i(!1),c(null)):c("Mot de passe incorrect")},h=async()=>{await s(),c(null)},f=()=>{t?h():i(!0)};return o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:f,className:`
          flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors
          ${t?"bg-green-100 text-green-700 border border-green-300 hover:bg-green-200":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}
        `,title:t?`Dverrouill par ${e} le ${r?.toLocaleString("fr-BE")}`:"Cliquez pour dverrouiller les champs collectifs",children:t?o.jsxs(o.Fragment,{children:[o.jsx(vy,{className:"w-4 h-4"}),o.jsx("span",{children:"Verrouiller"})]}):o.jsxs(o.Fragment,{children:[o.jsx(bm,{className:"w-4 h-4"}),o.jsx("span",{children:"Dverrouiller"})]})}),a&&o.jsx(Xb,{onSubmit:(m,p)=>{u(m,p)},onCancel:()=>{i(!1),c(null)}}),l&&o.jsx("div",{className:"mt-2 bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-md text-sm",children:l})]})}let Jb={data:""},Zb=t=>{if(typeof window=="object"){let e=(t?t.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return e.nonce=window.__nonce__,e.parentNode||(t||document.head).appendChild(e),e.firstChild}return t||Jb},eE=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,tE=/\/\*[^]*?\*\/|  +/g,hf=/\n+/g,Gn=(t,e)=>{let r="",n="",s="";for(let a in t){let i=t[a];a[0]=="@"?a[1]=="i"?r=a+" "+i+";":n+=a[1]=="f"?Gn(i,a):a+"{"+Gn(i,a[1]=="k"?"":e)+"}":typeof i=="object"?n+=Gn(i,e?e.replace(/([^,])+/g,l=>a.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,c=>/&/.test(c)?c.replace(/&/g,l):l?l+" "+c:c)):a):i!=null&&(a=/^--/.test(a)?a:a.replace(/[A-Z]/g,"-$&").toLowerCase(),s+=Gn.p?Gn.p(a,i):a+":"+i+";")}return r+(e&&s?e+"{"+s+"}":s)+n},_n={},Mp=t=>{if(typeof t=="object"){let e="";for(let r in t)e+=r+Mp(t[r]);return e}return t},rE=(t,e,r,n,s)=>{let a=Mp(t),i=_n[a]||(_n[a]=(c=>{let u=0,h=11;for(;u<c.length;)h=101*h+c.charCodeAt(u++)>>>0;return"go"+h})(a));if(!_n[i]){let c=a!==t?t:(u=>{let h,f,m=[{}];for(;h=eE.exec(u.replace(tE,""));)h[4]?m.shift():h[3]?(f=h[3].replace(hf," ").trim(),m.unshift(m[0][f]=m[0][f]||{})):m[0][h[1]]=h[2].replace(hf," ").trim();return m[0]})(t);_n[i]=Gn(s?{["@keyframes "+i]:c}:c,r?"":"."+i)}let l=r&&_n.g?_n.g:null;return r&&(_n.g=_n[i]),((c,u,h,f)=>{f?u.data=u.data.replace(f,c):u.data.indexOf(c)===-1&&(u.data=h?c+u.data:u.data+c)})(_n[i],e,n,l),i},nE=(t,e,r)=>t.reduce((n,s,a)=>{let i=e[a];if(i&&i.call){let l=i(r),c=l&&l.props&&l.props.className||/^go/.test(l)&&l;i=c?"."+c:l&&typeof l=="object"?l.props?"":Gn(l,""):l===!1?"":l}return n+s+(i??"")},"");function zl(t){let e=this||{},r=t.call?t(e.p):t;return rE(r.unshift?r.raw?nE(r,[].slice.call(arguments,1),e.p):r.reduce((n,s)=>Object.assign(n,s&&s.call?s(e.p):s),{}):r,Zb(e.target),e.g,e.o,e.k)}let Lp,uu,hu;zl.bind({g:1});let In=zl.bind({k:1});function sE(t,e,r,n){Gn.p=e,Lp=t,uu=r,hu=n}function ps(t,e){let r=this||{};return function(){let n=arguments;function s(a,i){let l=Object.assign({},a),c=l.className||s.className;r.p=Object.assign({theme:uu&&uu()},l),r.o=/ *go\d+/.test(c),l.className=zl.apply(r,n)+(c?" "+c:"");let u=t;return t[0]&&(u=l.as||t,delete l.as),hu&&u[0]&&hu(l),Lp(u,l)}return s}}var aE=t=>typeof t=="function",sl=(t,e)=>aE(t)?t(e):t,iE=(()=>{let t=0;return()=>(++t).toString()})(),Bp=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),oE=20,th="default",Vp=(t,e)=>{let{toastLimit:r}=t.settings;switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,r)};case 1:return{...t,toasts:t.toasts.map(i=>i.id===e.toast.id?{...i,...e.toast}:i)};case 2:let{toast:n}=e;return Vp(t,{type:t.toasts.find(i=>i.id===n.id)?1:0,toast:n});case 3:let{toastId:s}=e;return{...t,toasts:t.toasts.map(i=>i.id===s||s===void 0?{...i,dismissed:!0,visible:!1}:i)};case 4:return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(i=>i.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let a=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(i=>({...i,pauseDuration:i.pauseDuration+a}))}}},qo=[],Up={toasts:[],pausedAt:void 0,settings:{toastLimit:oE}},ln={},$p=(t,e=th)=>{ln[e]=Vp(ln[e]||Up,t),qo.forEach(([r,n])=>{r===e&&n(ln[e])})},Hp=t=>Object.keys(ln).forEach(e=>$p(t,e)),lE=t=>Object.keys(ln).find(e=>ln[e].toasts.some(r=>r.id===t)),Yl=(t=th)=>e=>{$p(e,t)},cE={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},uE=(t={},e=th)=>{let[r,n]=k.useState(ln[e]||Up),s=k.useRef(ln[e]);k.useEffect(()=>(s.current!==ln[e]&&n(ln[e]),qo.push([e,n]),()=>{let i=qo.findIndex(([l])=>l===e);i>-1&&qo.splice(i,1)}),[e]);let a=r.toasts.map(i=>{var l,c,u;return{...t,...t[i.type],...i,removeDelay:i.removeDelay||((l=t[i.type])==null?void 0:l.removeDelay)||t?.removeDelay,duration:i.duration||((c=t[i.type])==null?void 0:c.duration)||t?.duration||cE[i.type],style:{...t.style,...(u=t[i.type])==null?void 0:u.style,...i.style}}});return{...r,toasts:a}},hE=(t,e="blank",r)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...r,id:r?.id||iE()}),Ki=t=>(e,r)=>{let n=hE(e,t,r);return Yl(n.toasterId||lE(n.id))({type:2,toast:n}),n.id},Lt=(t,e)=>Ki("blank")(t,e);Lt.error=Ki("error");Lt.success=Ki("success");Lt.loading=Ki("loading");Lt.custom=Ki("custom");Lt.dismiss=(t,e)=>{let r={type:3,toastId:t};e?Yl(e)(r):Hp(r)};Lt.dismissAll=t=>Lt.dismiss(void 0,t);Lt.remove=(t,e)=>{let r={type:4,toastId:t};e?Yl(e)(r):Hp(r)};Lt.removeAll=t=>Lt.remove(void 0,t);Lt.promise=(t,e,r)=>{let n=Lt.loading(e.loading,{...r,...r?.loading});return typeof t=="function"&&(t=t()),t.then(s=>{let a=e.success?sl(e.success,s):void 0;return a?Lt.success(a,{id:n,...r,...r?.success}):Lt.dismiss(n),s}).catch(s=>{let a=e.error?sl(e.error,s):void 0;a?Lt.error(a,{id:n,...r,...r?.error}):Lt.dismiss(n)}),t};var dE=1e3,fE=(t,e="default")=>{let{toasts:r,pausedAt:n}=uE(t,e),s=k.useRef(new Map).current,a=k.useCallback((f,m=dE)=>{if(s.has(f))return;let p=setTimeout(()=>{s.delete(f),i({type:4,toastId:f})},m);s.set(f,p)},[]);k.useEffect(()=>{if(n)return;let f=Date.now(),m=r.map(p=>{if(p.duration===1/0)return;let x=(p.duration||0)+p.pauseDuration-(f-p.createdAt);if(x<0){p.visible&&Lt.dismiss(p.id);return}return setTimeout(()=>Lt.dismiss(p.id,e),x)});return()=>{m.forEach(p=>p&&clearTimeout(p))}},[r,n,e]);let i=k.useCallback(Yl(e),[e]),l=k.useCallback(()=>{i({type:5,time:Date.now()})},[i]),c=k.useCallback((f,m)=>{i({type:1,toast:{id:f,height:m}})},[i]),u=k.useCallback(()=>{n&&i({type:6,time:Date.now()})},[n,i]),h=k.useCallback((f,m)=>{let{reverseOrder:p=!1,gutter:x=8,defaultPosition:g}=m||{},y=r.filter(A=>(A.position||g)===(f.position||g)&&A.height),I=y.findIndex(A=>A.id===f.id),P=y.filter((A,D)=>D<I&&A.visible).length;return y.filter(A=>A.visible).slice(...p?[P+1]:[0,P]).reduce((A,D)=>A+(D.height||0)+x,0)},[r]);return k.useEffect(()=>{r.forEach(f=>{if(f.dismissed)a(f.id,f.removeDelay);else{let m=s.get(f.id);m&&(clearTimeout(m),s.delete(f.id))}})},[r,a]),{toasts:r,handlers:{updateHeight:c,startPause:l,endPause:u,calculateOffset:h}}},mE=In`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,pE=In`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,gE=In`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,xE=ps("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${mE} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${pE} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${gE} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,vE=In`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,yE=ps("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${vE} 1s linear infinite;
`,_E=In`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,wE=In`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,bE=ps("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${_E} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${wE} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,EE=ps("div")`
  position: absolute;
`,TE=ps("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,AE=In`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,SE=ps("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${AE} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,NE=({toast:t})=>{let{icon:e,type:r,iconTheme:n}=t;return e!==void 0?typeof e=="string"?k.createElement(SE,null,e):e:r==="blank"?null:k.createElement(TE,null,k.createElement(yE,{...n}),r!=="loading"&&k.createElement(EE,null,r==="error"?k.createElement(xE,{...n}):k.createElement(bE,{...n})))},CE=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,IE=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,PE="0%{opacity:0;} 100%{opacity:1;}",RE="0%{opacity:1;} 100%{opacity:0;}",DE=ps("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,FE=ps("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,jE=(t,e)=>{let r=t.includes("top")?1:-1,[n,s]=Bp()?[PE,RE]:[CE(r),IE(r)];return{animation:e?`${In(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${In(s)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},kE=k.memo(({toast:t,position:e,style:r,children:n})=>{let s=t.height?jE(t.position||e||"top-center",t.visible):{opacity:0},a=k.createElement(NE,{toast:t}),i=k.createElement(FE,{...t.ariaProps},sl(t.message,t));return k.createElement(DE,{className:t.className,style:{...s,...r,...t.style}},typeof n=="function"?n({icon:a,message:i}):k.createElement(k.Fragment,null,a,i))});sE(k.createElement);var OE=({id:t,className:e,style:r,onHeightUpdate:n,children:s})=>{let a=k.useCallback(i=>{if(i){let l=()=>{let c=i.getBoundingClientRect().height;n(t,c)};l(),new MutationObserver(l).observe(i,{subtree:!0,childList:!0,characterData:!0})}},[t,n]);return k.createElement("div",{ref:a,className:e,style:r},s)},ME=(t,e)=>{let r=t.includes("top"),n=r?{top:0}:{bottom:0},s=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Bp()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(r?1:-1)}px)`,...n,...s}},LE=zl`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Ao=16,BE=({reverseOrder:t,position:e="top-center",toastOptions:r,gutter:n,children:s,toasterId:a,containerStyle:i,containerClassName:l})=>{let{toasts:c,handlers:u}=fE(r,a);return k.createElement("div",{"data-rht-toaster":a||"",style:{position:"fixed",zIndex:9999,top:Ao,left:Ao,right:Ao,bottom:Ao,pointerEvents:"none",...i},className:l,onMouseEnter:u.startPause,onMouseLeave:u.endPause},c.map(h=>{let f=h.position||e,m=u.calculateOffset(h,{reverseOrder:t,gutter:n,defaultPosition:e}),p=ME(f,m);return k.createElement(OE,{id:h.id,key:h.id,onHeightUpdate:u.updateHeight,className:h.visible?LE:"",style:p},h.type==="custom"?sl(h.message,h):s?s(h):k.createElement(kE,{toast:h,position:f}))}))},ir=Lt;const VE={storageKey:Gl,notifyOnInitialLoad:!1};function df(t){try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(e){return console.error("Failed to load scenario data:",e),null}}function UE(t,e){if(!t||!e)return[];const r=[],s=Dw().unlockedBy||null,a=new Date,i=t.participants||[],l=e.participants||[];if(l.length>i.length){const c=l.slice(i.length).map(u=>u.name).join(", ");r.push({type:"participant_added",description:`Participant ajout : ${c}`,changedBy:s,timestamp:a,details:{addedNames:c}})}if(l.length<i.length){const c=i.length-l.length;r.push({type:"participant_removed",description:`${c} participant(s) supprim(s)`,changedBy:s,timestamp:a,details:{removedCount:c}})}return l.length===i.length&&JSON.stringify(i)!==JSON.stringify(l)&&r.push({type:"participant_modified",description:"Donnes participant modifies",changedBy:s,timestamp:a}),t.projectParams&&e.projectParams&&JSON.stringify(t.projectParams)!==JSON.stringify(e.projectParams)&&r.push({type:"project_params_modified",description:"Paramtres projet modifis",changedBy:s,timestamp:a}),t.portageFormula&&e.portageFormula&&JSON.stringify(t.portageFormula)!==JSON.stringify(e.portageFormula)&&r.push({type:"portage_formula_modified",description:"Formule de portage modifie",changedBy:s,timestamp:a}),t.deedDate!==e.deedDate&&r.push({type:"deed_date_modified",description:"Date acte notari modifie",changedBy:s,timestamp:a,details:{oldDate:t.deedDate,newDate:e.deedDate}}),r}function $E(t={}){const{storageKey:e,notifyOnInitialLoad:r}={...VE,...t},[n,s]=k.useState([]),a=k.useRef(null),i=k.useRef(!0),l=k.useCallback(()=>{s([])},[]),c=k.useCallback(()=>{const u=df(e);if(!u)return;if(i.current&&!r){a.current=u,i.current=!1;return}const h=UE(a.current,u);h.length>0&&s(f=>[...f,...h]),a.current=u,i.current=!1},[e,r]);return k.useEffect(()=>{const u=h=>{h.key===e&&h.newValue&&c()};return a.current=df(e),window.addEventListener("storage",u),()=>{window.removeEventListener("storage",u)}},[e,c]),{changes:n,clearChanges:l,checkForChanges:c}}function HE({change:t,onReload:e,onMerge:r,onDismiss:n}){return o.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-blue-200 p-4 max-w-md",children:[o.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[o.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:o.jsx(uy,{className:"w-5 h-5 text-blue-600"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Donnes modifies"}),o.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.description}),t.changedBy&&o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Par ",t.changedBy]})]}),o.jsx("button",{onClick:n,className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Fermer",children:o.jsx(Br,{className:"w-4 h-4"})})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("button",{onClick:e,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors",children:[o.jsx(Ey,{className:"w-4 h-4"}),"Recharger"]}),r&&o.jsxs("button",{onClick:r,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 text-sm font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-md transition-colors",children:[o.jsx(fy,{className:"w-4 h-4"}),"Fusionner"]}),o.jsx("button",{onClick:n,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-md transition-colors",children:"Ignorer"})]})]})}function WE({user:t,action:e,onDismiss:r}){const n=e==="joined";return o.jsx("div",{className:`bg-white rounded-lg shadow-lg border p-4 max-w-md ${n?"border-green-200":"border-gray-200"}`,children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${n?"bg-green-100":"bg-gray-100"}`,children:o.jsx(_a,{className:`w-5 h-5 ${n?"text-green-600":"text-gray-600"}`})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:n?"Utilisateur actif":"Utilisateur parti"}),o.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.email," ",n?"a ouvert":"a ferm"," l'application"]})]}),o.jsx("button",{onClick:r,className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Fermer",children:o.jsx(Br,{className:"w-4 h-4"})})]})})}function ei({title:t,message:e,type:r="info",onDismiss:n}){const s={info:"border-blue-200 bg-blue-50",success:"border-green-200 bg-green-50",warning:"border-yellow-200 bg-yellow-50",error:"border-red-200 bg-red-50"},a={info:"text-blue-600",success:"text-green-600",warning:"text-yellow-600",error:"text-red-600"};return o.jsx("div",{className:`bg-white rounded-lg shadow-lg border p-4 max-w-md ${s[r]}`,children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:`text-sm font-semibold ${a[r]}`,children:t}),o.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e})]}),o.jsx("button",{onClick:n,className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Fermer",children:o.jsx(Br,{className:"w-4 h-4"})})]})})}function ea(t,e){return JSON.stringify(t)===JSON.stringify(e)}function qE(t){return{totalPurchase:"Prix d'achat total",notaryRate:"Taux notaire",defaultInterestRate:"Taux d'intrt",defaultLoanDurationYears:"Dure du prt (annes)",travauxCommunsSurface:"Surface travaux communs",travauxCommunsCostPerM2:"Cot/m travaux communs",useTravauxCommunsSurfaceMultiplier:"Multiplicateur surface T.C."}[t]||t}function GE(t){return{fixedMonthlyFee:"Frais fixes mensuels",emptyPropertyTaxRate:"Taux prcompte vacant",insuranceRate:"Taux assurance",adminFeesRate:"Taux frais admin",maintenanceFundRate:"Taux fonds entretien",carryingCostRecovery:"Rcupration cots portage",includeNotaryInBasis:"Inclure notaire dans base",useDualLoanStructure:"Structure double prt",dualLoanSplitRatio:"Ratio split prts",dualLoanRate2:"Taux prt 2",dualLoanDuration2:"Dure prt 2"}[t]||t}function So(t){return typeof t=="boolean"?t?"Oui":"Non":typeof t=="number"?t>0&&t<1?`${(t*100).toFixed(2)}%`:t.toLocaleString("fr-BE"):t==null?"Non dfini":String(t)}function ff(t,e){const r=[];return new Set([...Object.keys(t||{}),...Object.keys(e||{})]).forEach(s=>{const a=t?.[s],i=e?.[s];JSON.stringify(a)!==JSON.stringify(i)&&r.push({key:s,localValue:a,remoteValue:i})}),r}function zE(t,e){const r=new Set(t.map(l=>l.name)),n=new Set(e.map(l=>l.name)),s=[],a=[],i=[];return e.forEach(l=>{r.has(l.name)||s.push(l.name)}),t.forEach(l=>{n.has(l.name)||a.push(l.name)}),t.forEach(l=>{const c=e.find(u=>u.name===l.name);c&&JSON.stringify(l)!==JSON.stringify(c)&&i.push(l.name)}),{added:s,removed:a,modified:i}}function YE({conflictState:t,onResolve:e}){if(!t.hasConflict)return null;const{localData:r,remoteData:n,message:s}=t;return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[o.jsx("div",{className:"bg-amber-500 text-white p-6 rounded-t-lg",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center",children:o.jsx(Tm,{className:"w-7 h-7"})}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold",children:"Conflit de synchronisation"}),o.jsx("p",{className:"text-amber-100 text-sm mt-1",children:"Des modifications concurrentes ont t dtectes"})]})]})}),o.jsxs("div",{className:"p-6 space-y-6",children:[o.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:o.jsx("p",{className:"text-sm text-gray-700",children:s||"Un autre utilisateur a modifi les donnes pendant que vous travailliez. Vous devez choisir quelle version conserver."})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{className:"border border-blue-200 rounded-lg p-4 bg-blue-50",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx($o,{className:"w-5 h-5 text-blue-600"}),o.jsx("h3",{className:"font-semibold text-blue-900",children:"Vos modifications locales"})]}),r&&o.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Modifi par :"})," Vous"]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Date :"})," ",new Date(r.lastModifiedAt).toLocaleString("fr-BE")]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Version :"})," ",r.version]})]})]}),o.jsxs("div",{className:"border border-purple-200 rounded-lg p-4 bg-purple-50",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx(da,{className:"w-5 h-5 text-purple-600"}),o.jsx("h3",{className:"font-semibold text-purple-900",children:"Modifications distantes"})]}),n&&o.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Modifi par :"})," ",n.lastModifiedBy]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Date :"})," ",new Date(n.lastModifiedAt).toLocaleString("fr-BE")]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium",children:"Version :"})," ",n.version]})]})]})]}),r&&n&&o.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[o.jsx("div",{className:"bg-gray-100 px-4 py-3 border-b border-gray-200",children:o.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[o.jsx(Vd,{className:"w-5 h-5"}),"Diffrences dtectes"]})}),o.jsxs("div",{className:"p-4 space-y-3",children:[!ea(r.participants,n.participants)&&(()=>{const{added:a,removed:i,modified:l}=zE(r.participants,n.participants);return o.jsxs("div",{className:"flex gap-3 items-start bg-yellow-50 border border-yellow-200 rounded p-3",children:[o.jsx(_a,{className:"w-5 h-5 text-yellow-700 flex-shrink-0 mt-0.5"}),o.jsxs("div",{className:"flex-1 text-sm",children:[o.jsx("div",{className:"font-medium text-yellow-900 mb-2",children:"Participants modifis"}),o.jsxs("div",{className:"text-gray-700 space-y-2",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-blue-700 font-medium",children:"Vous :"})," ",r.participants.length," participant(s)"]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-purple-700 font-medium",children:"Distant :"})," ",n.participants.length," participant(s)"]})]}),a.length>0&&o.jsxs("div",{className:"border-l-2 border-green-400 pl-2",children:[o.jsx("div",{className:"font-medium text-green-800 text-xs",children:" Ajouts (distant)"}),o.jsx("div",{className:"text-gray-700 text-xs",children:a.join(", ")})]}),i.length>0&&o.jsxs("div",{className:"border-l-2 border-red-400 pl-2",children:[o.jsx("div",{className:"font-medium text-red-800 text-xs",children:" Supprims (distant)"}),o.jsx("div",{className:"text-gray-700 text-xs",children:i.join(", ")})]}),l.length>0&&o.jsxs("div",{className:"border-l-2 border-orange-400 pl-2",children:[o.jsx("div",{className:"font-medium text-orange-800 text-xs",children:" Modifis (distant)"}),o.jsx("div",{className:"text-gray-700 text-xs",children:l.join(", ")})]})]})]})]})})(),r.deedDate!==n.deedDate&&o.jsxs("div",{className:"flex gap-3 items-start bg-yellow-50 border border-yellow-200 rounded p-3",children:[o.jsx(Zv,{className:"w-5 h-5 text-yellow-700 flex-shrink-0 mt-0.5"}),o.jsxs("div",{className:"flex-1 text-sm",children:[o.jsx("div",{className:"font-medium text-yellow-900 mb-1",children:"Date d'acte modifie"}),o.jsxs("div",{className:"text-gray-700 space-y-1",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-blue-700",children:"Vous :"})," ",r.deedDate]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-purple-700",children:"Distant :"})," ",n.deedDate]})]})]})]}),!ea(r.projectParams,n.projectParams)&&(()=>{const a=ff(r.projectParams,n.projectParams);return o.jsxs("div",{className:"flex gap-3 items-start bg-yellow-50 border border-yellow-200 rounded p-3",children:[o.jsx(Ny,{className:"w-5 h-5 text-yellow-700 flex-shrink-0 mt-0.5"}),o.jsxs("div",{className:"flex-1 text-sm",children:[o.jsx("div",{className:"font-medium text-yellow-900 mb-2",children:"Paramtres du projet modifis"}),a.length>0?o.jsx("div",{className:"space-y-2",children:a.map(({key:i,localValue:l,remoteValue:c})=>o.jsxs("div",{className:"border-l-2 border-yellow-400 pl-2",children:[o.jsx("div",{className:"font-medium text-yellow-800",children:qE(i)}),o.jsxs("div",{className:"text-gray-700 space-y-0.5 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-blue-700",children:"Vous :"})," ",So(l)]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-purple-700",children:"Distant :"})," ",So(c)]})]})]},i))}):o.jsx("div",{className:"text-gray-700",children:"Les paramtres du projet ont t modifis."})]})]})})(),!ea(r.portageFormula,n.portageFormula)&&(()=>{const a=ff(r.portageFormula,n.portageFormula);return o.jsxs("div",{className:"flex gap-3 items-start bg-yellow-50 border border-yellow-200 rounded p-3",children:[o.jsx(Vd,{className:"w-5 h-5 text-yellow-700 flex-shrink-0 mt-0.5"}),o.jsxs("div",{className:"flex-1 text-sm",children:[o.jsx("div",{className:"font-medium text-yellow-900 mb-2",children:"Formule de portage modifie"}),a.length>0?o.jsx("div",{className:"space-y-2",children:a.map(({key:i,localValue:l,remoteValue:c})=>o.jsxs("div",{className:"border-l-2 border-yellow-400 pl-2",children:[o.jsx("div",{className:"font-medium text-yellow-800",children:GE(i)}),o.jsxs("div",{className:"text-gray-700 space-y-0.5 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-blue-700",children:"Vous :"})," ",So(l)]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-purple-700",children:"Distant :"})," ",So(c)]})]})]},i))}):o.jsx("div",{className:"text-gray-700",children:"Les paramtres de la formule de portage ont t modifis."})]})]})})(),ea(r.participants,n.participants)&&r.deedDate===n.deedDate&&ea(r.projectParams,n.projectParams)&&ea(r.portageFormula,n.portageFormula)&&o.jsx("div",{className:"text-sm text-gray-600 italic",children:"Aucune diffrence dtecte dans les champs principaux."})]})]}),o.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 space-y-3",children:[o.jsx("p",{className:"text-sm text-red-800 font-semibold",children:" Attention : Choix irrversible !"}),o.jsxs("div",{className:"text-sm text-red-700 space-y-2",children:[o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx($o,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),o.jsxs("div",{children:[o.jsx("strong",{children:'"Garder mes modifications"'})," : crase TOUTES les modifications distantes avec vos donnes locales."]})]}),o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx(da,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),o.jsxs("div",{children:[o.jsx("strong",{children:'"Accepter les modifications distantes"'})," : Supprime TOUTES vos modifications locales et charge les donnes distantes."]})]}),o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx(Br,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),o.jsxs("div",{children:[o.jsx("strong",{children:'"Annuler"'})," : Ferme ce dialogue sans rien changer. Le conflit restera actif."]})]})]}),o.jsx("p",{className:"text-sm text-red-800 italic",children:" Conseil : Exportez vos donnes importantes avant de choisir, ou coordonnez-vous avec l'autre utilisateur."})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[o.jsxs("button",{onClick:()=>e("local"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:[o.jsx($o,{className:"w-5 h-5"}),"Garder mes modifications"]}),o.jsxs("button",{onClick:()=>e("remote"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors",children:[o.jsx(da,{className:"w-5 h-5"}),"Accepter les modifications distantes"]}),o.jsxs("button",{onClick:()=>e("cancel"),className:"flex items-center justify-center gap-2 px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors",children:[o.jsx(Br,{className:"w-5 h-5"}),"Annuler"]})]}),o.jsx("div",{className:"text-xs text-gray-500 text-center",children:o.jsxs("p",{children:[o.jsx("strong",{children:"Conseil :"}),` Si vous n'tes pas sr, choisissez "Accepter les modifications distantes" pour viter d'craser le travail d'un autre utilisateur.`]})})]})]})})}const Wp=k.createContext(null);function KE(){const t=k.useContext(Wp);if(!t)throw new Error("useCalculator must be used within CalculatorProvider");return t}function XE(){const[t,e]=k.useState(!1),[r,n]=k.useState(!1),{state:s,actions:a}=KE(),{participants:i,projectParams:l,deedDate:c,portageFormula:u,pinnedParticipant:h,fullscreenParticipantIndex:f,versionMismatch:m,syncMode:p,isSyncing:x,lastSyncedAt:g,conflictState:y,syncError:I,activeUsers:P,calculations:A,unitDetails:D}=s,{setParticipants:V,setProjectParams:H,handleDeedDateChange:w,handleRenovationStartDateChange:E,setPortageFormula:_,setFullscreenParticipantIndex:N,setVersionMismatch:T,handlePinParticipant:R,handleUnpinParticipant:S,addParticipant:se,updateParticipant:te,updateParticipantName:me,updateParticipantSurface:ce,removeParticipant:le,downloadScenario:Ae,loadScenario:Oe,resetToDefaults:Je,exportToExcel:U,resolveConflict:Y}=a,[q,W]=k.useState(null),{unlockedBy:ae}=ql(),{changes:be,clearChanges:ye}=$E(),pe=k.useRef(0);k.useEffect(()=>{const he=P.length,Re=pe.current;if(he>Re&&he>0){const ue=P[he-1];ir.custom(ke=>o.jsx(WE,{user:ue,action:"joined",onDismiss:()=>ir.dismiss(ke.id)}),{duration:5e3,position:"top-right"})}pe.current=he},[P]),k.useEffect(()=>{be.length>0&&(be.forEach(he=>{ir.custom(Re=>o.jsx(HE,{change:he,onReload:()=>{window.location.reload(),ir.dismiss(Re.id)},onMerge:void 0,onDismiss:()=>ir.dismiss(Re.id)}),{duration:1/0,position:"top-right"})}),ye())},[be,ye]);const xe=()=>{const he=nl();if(he){const Re=JSON.stringify(he,null,2),ue=new Blob([Re],{type:"application/json"}),ke=URL.createObjectURL(ue),He=document.createElement("a");He.href=ke,He.download=`credit-castor-backup-v${he.storedVersion||"unknown"}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(He),He.click(),document.body.removeChild(He),URL.revokeObjectURL(ke)}jp(),Je(),setTimeout(()=>window.location.reload(),500)},We=()=>{T({show:!1})},Ve=vb(A,h),nt=()=>{n(!0),setTimeout(()=>{window.print(),setTimeout(()=>n(!1),1e3)},100)},qe=(he,Re)=>{V({updateCapital:(ke,He,wt)=>{const yt=[...ke];return yt[He]={...yt[He],capitalApporte:wt},yt}}.updateCapital(i,he,Re))},hr=(he,Re)=>{const ue=[...i];ue[he]={...ue[he],registrationFeesRate:Re},V(ue)},Xe=(he,Re)=>{const ue=[...i];ue[he]={...ue[he],interestRate:Re},V(ue)},Ne=(he,Re)=>{const ue=[...i];ue[he]={...ue[he],durationYears:Re},V(ue)},jt=(he,Re)=>{const ue=[...i];ue[he]={...ue[he],quantity:Re},V(ue)},tt=(he,Re)=>{const ue=[...i];ue[he]={...ue[he],parachevementsPerM2:Re},V(ue)},ct=(he,Re)=>{const ue=[...i];ue[he]={...ue[he],cascoSqm:Re},V(ue)},dr=(he,Re)=>{const ue=[...i];ue[he]={...ue[he],parachevementsSqm:Re},V(ue)},On=(he,Re=[])=>{const ue=l.maxTotalLots??10,ke=Rp(i,Re,ue);if(!ke.isValid){ir.error(ke.error||"Cannot add lot: Maximum total lots reached");return}const He=A.participantBreakdown[he],wt=[...i],yt=wt[he].lotsOwned||[],vr=yt.length>0?Math.max(...yt.map(Fe=>Fe.lotId))+1:1,Pe=yt.length>0?yt[0].unitId:0;wt[he]={...wt[he],lotsOwned:[...yt,{lotId:vr,unitId:Pe,surface:80,isPortage:!0,allocatedSurface:80,acquiredDate:new Date(c),originalPrice:He?.purchaseShare||0,originalNotaryFees:He?.droitEnregistrements||0,originalConstructionCost:He?.casco||0}]},V(wt)},Jr=(he,Re)=>{const ue=[...i],ke=ue[he].lotsOwned||[];ue[he]={...ue[he],lotsOwned:ke.filter(He=>He.lotId!==Re)},V(ue)},rr=(he,Re,ue)=>{const ke=[...i],He=ke[he].lotsOwned||[];ke[he]={...ke[he],lotsOwned:He.map(wt=>wt.lotId===Re?{...wt,surface:ue,allocatedSurface:ue}:wt)},V(ke)},xr=(he,Re,ue,ke)=>{const He=[...i],wt=He[he].lotsOwned||[];He[he]={...He[he],lotsOwned:wt.map(yt=>yt.lotId===Re?{...yt,founderPaysCasco:ue,founderPaysParachvement:ke}:yt)},V(He)};return o.jsx(xp,{children:o.jsxs(J2,{children:[o.jsx(BE,{}),m.show&&o.jsx(gb,{storedVersion:m.storedVersion,currentVersion:Fa,onExportAndReset:xe,onDismiss:We}),y.hasConflict&&o.jsx(YE,{conflictState:y,onResolve:Y}),o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-100 p-6",children:[o.jsx("div",{className:"fixed top-6 left-6 z-40 no-print",children:o.jsx(Qb,{})}),ae&&o.jsx("div",{className:"fixed top-6 right-6 z-40 no-print",children:o.jsxs("div",{className:"bg-white rounded-lg shadow-md px-3 py-2 text-xs",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[p==="firestore"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:`w-2 h-2 rounded-full ${x?"bg-yellow-500 animate-pulse":"bg-green-500"}`}),o.jsx("span",{className:"text-gray-700 font-medium",children:x?"Synchronisation...":"Synchronis"})]}),p==="localStorage"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),o.jsx("span",{className:"text-gray-700 font-medium",children:"Local"})]}),p==="offline"&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-400"}),o.jsx("span",{className:"text-gray-700 font-medium",children:"Hors ligne"})]})]}),g&&p==="firestore"&&o.jsxs("div",{className:"text-gray-500 mt-1",children:["Dernire sync: ",new Date(g).toLocaleTimeString("fr-BE")]}),I&&o.jsxs("div",{className:"text-red-600 mt-1",children:[" ",I]})]})}),o.jsxs("div",{className:"max-w-7xl mx-auto",children:[o.jsxs("div",{className:"print-header hidden",children:[o.jsx("h1",{className:"text-2xl font-bold",children:"Achat Ferme du Temple - Rapport de Division"}),o.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Gnr le ",new Date().toLocaleDateString("fr-BE",{day:"numeric",month:"long",year:"numeric"})]})]}),o.jsx($w,{calculations:A,participants:i}),o.jsx(Hw,{onDownloadScenario:Ae,onLoadScenario:Oe,onExportToExcel:U,onPrintAllFounders:nt}),o.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[o.jsxs("button",{onClick:()=>e(!t),className:"flex items-center justify-between w-full mb-4 bg-white rounded p-1 -ml-1 transition-colors",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Dcomposition des Cots"}),o.jsx("div",{className:"flex items-center gap-2",children:t?o.jsx(Ol,{className:"w-5 h-5 text-gray-500"}):o.jsx(kl,{className:"w-5 h-5 text-gray-500"})})]}),o.jsxs("div",{className:"flex items-center justify-center gap-3",children:[o.jsxs("div",{className:"p-3 bg-white rounded-lg border border-gray-200 flex-1",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Achat Total"}),o.jsx("p",{className:"text-lg font-bold text-gray-900",children:K(A.totals.purchase)}),o.jsx("p",{className:"text-xs text-blue-600 mt-1",children:o.jsxs(ci,{formula:qw(A.totals,A.totalSurface),children:[K(A.pricePerM2),"/m"]})})]}),o.jsx("div",{className:"text-2xl font-bold text-gray-400 flex-shrink-0",children:"+"}),o.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-200 flex-1",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Commun Infrastr."}),o.jsx("p",{className:"text-lg font-bold text-purple-700",children:K(A.sharedCosts+bn(l))}),o.jsxs("p",{className:"text-xs text-purple-500 mt-1",children:[K((A.sharedCosts+bn(l))/i.length),"/pers"]})]}),o.jsx("div",{className:"text-2xl font-bold text-gray-400 flex-shrink-0",children:"+"}),o.jsxs("div",{className:"p-3 bg-white rounded-lg border border-orange-200 flex-1",children:[o.jsx(ci,{formula:["Rnovations personnelles",`CASCO (gros uvre): ${K(A.participantBreakdown.reduce((he,Re)=>he+Re.casco,0))}`,`+ Parachvements: ${K(A.participantBreakdown.reduce((he,Re)=>he+Re.parachevements,0))}`,`= ${K(A.participantBreakdown.reduce((he,Re)=>he+Re.personalRenovationCost,0))}`],children:o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Rnovations Perso."})}),o.jsx("p",{className:"text-lg font-bold text-orange-700",children:K(A.participantBreakdown.reduce((he,Re)=>he+Re.personalRenovationCost,0))}),o.jsx("p",{className:"text-xs text-orange-500 mt-1",children:"CASCO + Parachv."})]}),o.jsx("div",{className:"text-2xl font-bold text-gray-400 flex-shrink-0",children:"+"}),o.jsxs("div",{className:"p-3 bg-white rounded-lg border border-gray-200 flex-1",children:[o.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Frais d'enregistrements"}),o.jsx("p",{className:"text-lg font-bold text-gray-900",children:K(A.totals.totalDroitEnregistrements)}),o.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"taux individuels"})]}),o.jsx("div",{className:"text-2xl font-bold text-gray-400 flex-shrink-0",children:"="}),o.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-300 flex-1",children:[o.jsx("p",{className:"text-xs text-gray-600 uppercase tracking-wide mb-1 font-semibold",children:"TOTAL"}),o.jsx("p",{className:"text-lg font-bold text-gray-900",children:o.jsx(ci,{formula:Gw(),children:K(A.totals.total)})})]})]}),t&&o.jsxs("div",{className:"mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[o.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-3",children:"Dtail Commun"}),l.expenseCategories&&o.jsx(ib,{expenseCategories:l.expenseCategories,projectParams:l,sharedCosts:A.sharedCosts,onUpdateProjectParams:H,participants:i,unitDetails:D}),o.jsxs("div",{className:"mt-4 p-3 bg-purple-100 rounded-lg border border-purple-300",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Total commun:"}),o.jsx("p",{className:"text-lg font-bold text-purple-800",children:K(A.sharedCosts+bn(l))})]}),o.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[K((A.sharedCosts+bn(l))/i.length)," par personne"]})]})]})]}),o.jsx(zb,{participants:i,projectParams:l,calculations:A,deedDate:c,onOpenParticipantDetails:N,onOpenCoproDetails:W,onAddParticipant:se,onUpdateParticipant:te,coproReservesShare:u.coproReservesShare}),f!==null&&(()=>{const he=f,Re=Ve.find(ue=>ue.name===i[he].name);return Re?o.jsx(eb,{isOpen:!0,onClose:()=>N(null),participantIndex:he,participant:i[he],participantBreakdown:Re,deedDate:c,allParticipants:i,calculations:A,projectParams:l,unitDetails:D,formulaParams:u,isPinned:h===Re.name,onPin:()=>R(Re.name),onUnpin:S,onUpdateName:ue=>me(he,ue),onUpdateSurface:ue=>ce(he,ue),onUpdateCapital:ue=>qe(he,ue),onUpdateNotaryRate:ue=>hr(he,ue),onUpdateInterestRate:ue=>Xe(he,ue),onUpdateDuration:ue=>Ne(he,ue),onUpdateQuantity:ue=>jt(he,ue),onUpdateParachevementsPerM2:ue=>tt(he,ue),onUpdateCascoSqm:ue=>ct(he,ue),onUpdateParachevementsSqm:ue=>dr(he,ue),onUpdateParticipant:ue=>{const ke=[...i],He=ke[he];ke[he]=ue;const wt=He.entryDate?new Date(He.entryDate).getTime():null,yt=ue.entryDate?new Date(ue.entryDate).getTime():null,vr=wt!==yt,Pe=He.purchaseDetails,Fe=ue.purchaseDetails;if(Fe?.buyingFrom&&Fe?.lotId&&Fe.buyingFrom!=="Coproprit"){const Ce=ke.findIndex(Ze=>Ze.name===Fe.buyingFrom);if(Ce!==-1&&ke[Ce].lotsOwned){const Ze=ke[Ce];ke[Ce]={...Ze,lotsOwned:Ze.lotsOwned?.map(nr=>nr.lotId===Fe.lotId?{...nr,soldDate:ue.entryDate}:nr)},console.log(" Recalculating portage price for",ue.name,{oldDate:He.entryDate?.toISOString(),newDate:ue.entryDate?.toISOString(),entryDateChanged:vr,oldPrice:ke[he].purchaseDetails?.purchasePrice}),ke[he]=Kb(ke[he],ke[Ce],c,u),console.log(" New purchase price:",ke[he].purchaseDetails?.purchasePrice)}}else if(!(Fe?.buyingFrom==="Coproprit"&&Fe?.lotId)){if(Pe?.buyingFrom&&Pe?.lotId&&!Fe){const Ce=ke.findIndex(Ze=>Ze.name===Pe.buyingFrom);Ce!==-1&&ke[Ce].lotsOwned&&(ke[Ce]={...ke[Ce],lotsOwned:ke[Ce].lotsOwned?.map(Ze=>Ze.lotId===Pe.lotId?{...Ze,soldDate:void 0}:Ze)})}}V(ke)},onAddPortageLot:()=>On(he),onRemovePortageLot:ue=>Jr(he,ue),onUpdatePortageLotSurface:(ue,ke)=>rr(he,ue,ke),onUpdatePortageLotConstructionPayment:(ue,ke,He)=>xr(he,ue,ke,He),onRemove:()=>le(he),totalParticipants:i.length}):null})(),q&&o.jsx(rb,{isOpen:!0,onClose:()=>W(null),snapshot:q,coproReservesShare:u.coproReservesShare,allParticipants:i,deedDate:c}),r&&(()=>{const he=i.filter(ue=>ue.isFounder),Re=he.map(ue=>Ve.find(He=>He.name===ue.name)||A.participantBreakdown.find(He=>He.name===ue.name)).filter(ue=>ue!==void 0);return he.length===0||Re.length===0?null:o.jsx(nb,{founders:he,founderCalculations:Re,deedDate:c,allParticipants:i,calculations:A,projectParams:l,unitDetails:D,formulaParams:u})})(),o.jsx(Uw,{participants:i,deedDate:c,renovationStartDate:l.renovationStartDate,onDeedDateChange:w,onRenovationStartDateChange:E,onUpdateParticipant:te}),o.jsx("div",{className:"mt-8",children:o.jsx(ob,{formulaParams:u,onUpdateParams:_,deedDate:new Date(c)})}),o.jsx("div",{className:"mt-8",children:o.jsx(Ep,{availableLots:Ip(i,[],A),deedDate:new Date(c),formulaParams:u})})]})]})]})})}function QE({onUnlock:t}){const[e,r]=k.useState(""),[n,s]=k.useState(!1),a=i=>{i.preventDefault(),e==="castor2025"?(s(!1),localStorage.setItem("authenticated","true"),t()):(s(!0),r(""))};return o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-800 to-blue-900 flex items-center justify-center p-6",children:o.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-8 w-full max-w-md",children:[o.jsxs("div",{className:"flex flex-col items-center mb-8",children:[o.jsx("div",{className:"bg-blue-100 rounded-full p-4 mb-4",children:o.jsx(bm,{className:"w-12 h-12 text-blue-600"})}),o.jsx("h1",{className:"text-3xl font-bold text-gray-800 text-center",children:"Achat en Division"}),o.jsx("p",{className:"text-gray-600 text-center mt-2",children:"Entrez le mot de passe pour accder"})]}),o.jsxs("form",{onSubmit:a,className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Mot de passe"}),o.jsx("input",{id:"password",type:"password",value:e,onChange:i=>{r(i.target.value),s(!1)},className:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none transition-colors ${n?"border-red-500 focus:border-red-600":"border-gray-300 focus:border-blue-500"}`,placeholder:"Entrez le mot de passe",autoFocus:!0}),n&&o.jsx("p",{className:"mt-2 text-sm text-red-600",children:"Mot de passe incorrect. Veuillez ressayer."})]}),o.jsx("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg transition-colors",children:"Accder"})]}),o.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:o.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Cette page est protge pour viter l'indexation par les moteurs de recherche"})})]})})}function JE(t,e){if(!t.isFounder)return null;const r=t.surface||0;if(r===0)return null;const n=e.filter(f=>f.isFounder===!0).reduce((f,m)=>f+(m.surface||0),0);if(n===0)return null;const s=r/n,a=Math.round(s*1e3),i=1e3,l=(f,m)=>m===0?f:l(m,f%m),c=l(a,i),u=a/c,h=i/c;return`${u}/${h}`}function ZE(t,e,r,n=new Date().toLocaleDateString("fr-FR")){const s=[],a=t.participantBreakdown,i=(_,N,T,R)=>{s.push({row:_,col:N,data:{value:T,formula:R}})};i(1,"A","ACHAT EN DIVISION - CALCULATEUR IMMOBILIER"),i(2,"A",`Wallonie, Belgique - ${n}`),i(4,"A","PARAMETRES DU PROJET"),i(5,"A","Prix achat total"),i(5,"B",e.totalPurchase),i(6,"A","Surface totale (m2)"),i(6,"B",t.totalSurface),i(7,"A","Prix par m2"),i(7,"B",null,"B5/B6"),i(9,"A","COUTS PARTAGES"),i(10,"A","Mesures conservatoires"),i(10,"B",e.mesuresConservatoires),i(11,"A","Demolition"),i(11,"B",e.demolition),i(12,"A","Infrastructures"),i(12,"B",e.infrastructures),i(13,"A","Etudes preparatoires"),i(13,"B",e.etudesPreparatoires),i(14,"A","Frais Etudes preparatoires"),i(14,"B",e.fraisEtudesPreparatoires),i(15,"A","Frais Generaux 3 ans"),i(15,"B",e.fraisGeneraux3ans),i(16,"A","Prix CASCO/m2 Global"),i(16,"B",e.globalCascoPerM2),i(17,"A","Date dbut rnovations"),i(17,"B",e.renovationStartDate||"");let l=18;if(e.expenseCategories){i(19,"A","DETAIL DEPENSES COMMUNES");let _=20;i(_,"A","CONSERVATOIRE"),_++,e.expenseCategories.conservatoire.forEach(N=>{i(_,"A",`  ${N.label}`),i(_,"B",N.amount),_++}),i(_,"A","HABITABILITE SOMMAIRE"),_++,e.expenseCategories.habitabiliteSommaire.forEach(N=>{i(_,"A",`  ${N.label}`),i(_,"B",N.amount),_++}),i(_,"A","PREMIER TRAVAUX"),_++,e.expenseCategories.premierTravaux.forEach(N=>{i(_,"A",`  ${N.label}`),i(_,"B",N.amount),_++}),l=_}i(l,"A","Total commun"),e.expenseCategories?i(l,"B",t.sharedCosts):i(l,"B",null,"B10+B11+B12+B13+B14+B15"),i(l+1,"A","Commun par personne"),i(l+1,"B",null,`B${l}/${a.length}`);const c=l+3;i(c,"A","TRAVAUX COMMUNS");const u=bn(e);let h=c+1;e.travauxCommuns?.enabled&&e.travauxCommuns.items.length>0&&(i(h,"A","Travaux additionnels (personnalisables)"),h++,e.travauxCommuns.items.forEach(_=>{const N=Ju(_);i(h,"A",`  ${_.label}`),i(h,"B",N),i(h,"C",`${_.sqm}m  (${_.cascoPricePerSqm} CASCO + ${_.parachevementPricePerSqm} Parach.)`),h++})),i(h,"A","Batiment fondation (conservatoire)"),i(h,"B",e.batimentFondationConservatoire),h++,i(h,"A","Batiment fondation (complete)"),i(h,"B",e.batimentFondationComplete),h++,i(h,"A","Batiment copro (conservatoire)"),i(h,"B",e.batimentCoproConservatoire),h++,i(h,"A","Total travaux communs"),i(h,"B",u),h++,i(h,"A","Par personne"),i(h,"B",a.length>0?u/a.length:0);const f=h+2,m=ms(a,e);i(f,"A","FRAIS GENERAUX (3 ANS) - DETAIL");let p=f+1;i(p,"A","HONORAIRES (15%  30% CASCO hors TVA sur 3 ans)"),p++,i(p,"A","  Base CASCO hors TVA"),i(p,"B",m.totalCasco),p++,i(p,"A","  Honoraires par an"),i(p,"B",m.honorairesYearly),p++,i(p,"A","  Honoraires total 3 ans"),i(p,"B",m.honorairesTotal3Years),p++,i(p,"A","FRAIS RECURRENTS (3 ans)"),p++,i(p,"A","  Prcompte immobilier"),i(p,"B",m.recurringYearly.precompteImmobilier),i(p,"C",`${m.recurringYearly.precompteImmobilier}/an  3 ans`),p++,i(p,"A","  Comptable"),i(p,"B",m.recurringYearly.comptable),i(p,"C",`${m.recurringYearly.comptable}/an  3 ans`),p++,i(p,"A","  Podio abonnement"),i(p,"B",m.recurringYearly.podioAbonnement),i(p,"C",`${m.recurringYearly.podioAbonnement}/an  3 ans`),p++,i(p,"A","  Assurance btiment"),i(p,"B",m.recurringYearly.assuranceBatiment),i(p,"C",`${m.recurringYearly.assuranceBatiment}/an  3 ans`),p++,i(p,"A","  Frais rservation"),i(p,"B",m.recurringYearly.fraisReservation),i(p,"C",`${m.recurringYearly.fraisReservation}/an  3 ans`),p++,i(p,"A","  Imprvus"),i(p,"B",m.recurringYearly.imprevus),i(p,"C",`${m.recurringYearly.imprevus}/an  3 ans`),p++,i(p,"A","  Total rcurrents 3 ans"),i(p,"B",m.recurringTotal3Years),p++,i(p,"A","FRAIS PONCTUELS"),p++,i(p,"A","  Frais dossier crdit"),i(p,"B",m.oneTimeCosts.fraisDossierCredit),p++,i(p,"A","  Frais gestion crdit"),i(p,"B",m.oneTimeCosts.fraisGestionCredit),p++,i(p,"A","  Frais notaire base partage"),i(p,"B",m.oneTimeCosts.fraisNotaireBasePartagee),p++,i(p,"A","  Total ponctuels"),i(p,"B",m.oneTimeCosts.total),p++,i(p,"A","TOTAL FRAIS GENERAUX"),i(p,"B",m.total);let x=p+2;if(r){i(x+1,"A","DETAILS PAR TYPE D UNITE");let _=x+2;Object.entries(r).forEach(([N,T])=>{i(_,"A",`Unite ${N}`),i(_,"B",`CASCO: ${T.casco}, Parachvements: ${T.parachevements}`),_++}),x=_}const g=x+2;i(g,"A","DECOMPOSITION DES COUTS"),i(g+1,"A","Achat Total"),i(g+1,"B",null,"B5");const y=g+6;i(g+2,"A","Droit enreg. + Frais notaire"),i(g+2,"B",null,`SUM(J${y}:K${y-1+a.length})`),i(g+3,"A","Construction"),i(g+3,"B",null,`SUM(O${y}:O${y-1+a.length})`),i(g+4,"A","Commun Infrastructure"),i(g+4,"B",null,`B${l}`),i(g+5,"A","TOTAL PROJET"),i(g+5,"B",null,`B${g+1}+B${g+2}+B${g+3}+B${g+4}`);const I=y-1,P=["Nom","Unite","Surface","Qty","Capital","Taux notaire","Taux interet","Duree (ans)","Part achat","Droit enreg.","Frais notaire","CASCO","Parachevements","Travaux communs","Construction","Commun","TOTAL","Emprunt","Mensualite","Total rembourse","Reno perso","CASCO m2","Parachev m2","CASCO sqm","Parachev sqm","Fondateur","Quotit","Date entree","Lots detenus","Date vente lot","Achete de","Lot ID achete","Prix achat lot","2 prets","Pret1 montant","Pret1 mens","Pret1 interets","Pret2 montant","Pret2 mens","Pret2 interets","Pret2 duree","Pret2 delai","Reno pret2","Capital pret1","Capital pret2","Porteur paie CASCO","Porteur paie Parachev"],A=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","AA","AB","AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL","AM","AN","AO","AP","AQ","AR","AS","AT","AU"];P.forEach((_,N)=>{i(I,A[N],_)}),a.forEach((_,N)=>{const T=y+N;i(T,"A",_.name),i(T,"B",_.unitId),i(T,"C",_.surface),i(T,"D",_.quantity||1),i(T,"E",_.capitalApporte),i(T,"F",_.registrationFeesRate),i(T,"G",_.interestRate),i(T,"H",_.durationYears),i(T,"I",null,`C${T}*$B$7`),i(T,"J",null,`I${T}*F${T}/100`),i(T,"K",null,`D${T}*1000`),i(T,"L",_.casco),i(T,"M",_.parachevements),i(T,"N",null,`$B$${c+5}`),i(T,"O",null,`(L${T}+M${T})+N${T}*D${T}`),i(T,"P",null,`$B$${l+1}`),i(T,"Q",null,`I${T}+J${T}+K${T}+O${T}+P${T}`),i(T,"R",null,`Q${T}-E${T}`),i(T,"S",null,`PMT(G${T}/100/12,H${T}*12,R${T})*-1`),i(T,"T",null,`S${T}*H${T}*12`),i(T,"U",_.personalRenovationCost),i(T,"V",e.globalCascoPerM2),i(T,"W",_.parachevementsPerM2),i(T,"X",_.cascoSqm),i(T,"Y",_.parachevementsSqm),i(T,"Z",_.isFounder?"Oui":"Non");const R=JE(_,a);if(i(T,"AA",R||""),i(T,"AB",_.entryDate?new Date(_.entryDate).toLocaleDateString("fr-BE"):""),_.lotsOwned&&_.lotsOwned.length>0){const S=_.lotsOwned.map(te=>`Lot ${te.lotId}${te.isPortage?" (portage)":""}: ${te.surface}m`).join("; ");i(T,"AC",S);const se=_.lotsOwned.filter(te=>te.soldDate).map(te=>`Lot ${te.lotId}: ${new Date(te.soldDate).toLocaleDateString("fr-BE")}`).join("; ");i(T,"AD",se||"")}else i(T,"AC",""),i(T,"AD","");if(i(T,"AE",_.purchaseDetails?.buyingFrom||""),i(T,"AF",_.purchaseDetails?.lotId||""),i(T,"AG",_.purchaseDetails?.purchasePrice||""),_.useTwoLoans?(i(T,"AH","Oui"),i(T,"AI",_.loan1Amount),i(T,"AJ",_.loan1MonthlyPayment),i(T,"AK",_.loan1Interest),i(T,"AL",_.loan2Amount),i(T,"AM",_.loan2MonthlyPayment),i(T,"AN",_.loan2Interest),i(T,"AO",_.loan2DurationYears?`${_.loan2DurationYears} ans`:""),i(T,"AP",_.loan2DelayYears||2),i(T,"AQ",_.loan2RenovationAmount),i(T,"AR",_.capitalForLoan1),i(T,"AS",_.capitalForLoan2)):(i(T,"AH","Non"),i(T,"AI",""),i(T,"AJ",""),i(T,"AK",""),i(T,"AL",""),i(T,"AM",""),i(T,"AN",""),i(T,"AO",""),i(T,"AP",""),i(T,"AQ",""),i(T,"AR",""),i(T,"AS","")),_.purchaseDetails?.lotId){const S=a.flatMap(se=>se.lotsOwned||[]).find(se=>se.lotId===_.purchaseDetails.lotId&&se.isPortage);S?(i(T,"AT",S.founderPaysCasco?"Oui":"Non"),i(T,"AU",S.founderPaysParachvement?"Oui":"Non")):(i(T,"AT",""),i(T,"AU",""))}else i(T,"AT",""),i(T,"AU","")});const D=y+a.length,V=y,H=D-1;i(D,"A","TOTAL"),i(D,"B",""),i(D,"C",null,`SUM(C${V}:C${H})`),i(D,"D",null,`SUM(D${V}:D${H})`),i(D,"E",null,`SUM(E${V}:E${H})`),i(D,"F",""),i(D,"G",""),i(D,"H",""),i(D,"I",null,`SUM(I${V}:I${H})`),i(D,"J",null,`SUM(J${V}:J${H})`),i(D,"K",null,`SUM(K${V}:K${H})`),i(D,"L",null,`SUM(L${V}:L${H})`),i(D,"M",null,`SUM(M${V}:M${H})`),i(D,"N",null,`SUM(N${V}:N${H})`),i(D,"O",null,`SUM(O${V}:O${H})`),i(D,"P",null,`SUM(P${V}:P${H})`),i(D,"Q",null,`SUM(Q${V}:Q${H})`),i(D,"R",""),i(D,"S",null,`SUM(S${V}:S${H})`),i(D,"T",null,`SUM(T${V}:T${H})`),i(D,"U",""),i(D,"V",""),i(D,"W",""),i(D,"X",""),i(D,"Y",""),i(D,"Z",""),i(D,"AA",""),i(D,"AB",""),i(D,"AC",""),i(D,"AD",""),i(D,"AE",""),i(D,"AF",""),i(D,"AG",""),i(D,"AH",""),i(D,"AI",""),i(D,"AJ",""),i(D,"AK",""),i(D,"AL",""),i(D,"AM",""),i(D,"AN",""),i(D,"AO",""),i(D,"AP",""),i(D,"AQ",""),i(D,"AR",""),i(D,"AS",""),i(D,"AT",""),i(D,"AU","");const w=D+2;return i(w+1,"A","SYNTHESE GLOBALE"),i(w+2,"A","Cout total projet"),i(w+2,"B",null,`P${D}`),i(w+3,"A","Capital total apporte"),i(w+3,"B",null,`E${D}`),i(w+4,"A","Total emprunts necessaires"),i(w+4,"B",null,`Q${D}`),i(w+5,"A","Emprunt moyen"),i(w+5,"B",null,`AVERAGE(Q${V}:Q${H})`),i(w+6,"A","Emprunt minimum"),i(w+6,"B",null,`MIN(Q${V}:Q${H})`),i(w+7,"A","Emprunt maximum"),i(w+7,"B",null,`MAX(Q${V}:Q${H})`),{name:"Calculateur Division",cells:s,columnWidths:[{col:0,width:25},{col:1,width:8},{col:2,width:10},{col:3,width:8},{col:4,width:15},{col:5,width:14},{col:6,width:12},{col:7,width:12},{col:8,width:15},{col:9,width:15},{col:10,width:15},{col:11,width:15},{col:12,width:15},{col:13,width:15},{col:14,width:15},{col:15,width:15},{col:16,width:15},{col:17,width:15},{col:18,width:15},{col:19,width:15},{col:20,width:12},{col:21,width:12},{col:22,width:12},{col:23,width:12},{col:24,width:10},{col:25,width:12},{col:26,width:12},{col:27,width:20},{col:28,width:30},{col:29,width:20},{col:30,width:12},{col:31,width:15},{col:32,width:15},{col:33,width:10},{col:34,width:15},{col:35,width:15},{col:36,width:15},{col:37,width:15},{col:38,width:15},{col:39,width:15},{col:40,width:15},{col:41,width:12},{col:42,width:15},{col:43,width:15},{col:44,width:15},{col:45,width:18},{col:46,width:20}]}}function eT(t,e){const r=[],n=(u,h,f)=>{r.push({row:u,col:h,data:{value:f}})},s=["Date","Participant","Total Cost","Loan Needed","Monthly Payment","Is T0","Transaction Type","Seller","Buyer","Lot ID","Delta Total Cost","Delta Loan","Delta Reason"],a=["A","B","C","D","E","F","G","H","I","J","K","L","M"];s.forEach((u,h)=>{n(1,a[h],u)});const i=[];t.forEach((u,h)=>{const f=e.find(m=>m.name===h);f&&u.forEach(m=>{i.push({snapshot:m,participant:f})})}),i.sort((u,h)=>{const f=u.snapshot.date.getTime()-h.snapshot.date.getTime();return f!==0?f:u.snapshot.participantIndex-h.snapshot.participantIndex});let l=2;return i.forEach(({snapshot:u,participant:h})=>{if(n(l,"A",u.date.toLocaleDateString("fr-BE")),n(l,"B",u.participantName),n(l,"C",u.totalCost),n(l,"D",u.loanNeeded),n(l,"E",u.monthlyPayment),n(l,"F",u.isT0?"Yes":"No"),u.transaction){const f=u.transaction;n(l,"G",f.type),n(l,"H",f.seller||""),n(l,"I",f.buyer||""),n(l,"J",h.purchaseDetails?.lotId||""),n(l,"K",f.delta.totalCost),n(l,"L",f.delta.loanNeeded),n(l,"M",f.delta.reason)}else n(l,"G",""),n(l,"H",""),n(l,"I",""),n(l,"J",""),n(l,"K",""),n(l,"L",""),n(l,"M","");l++}),{name:"Timeline Snapshots",cells:r,columnWidths:[{col:0,width:12},{col:1,width:20},{col:2,width:15},{col:3,width:15},{col:4,width:15},{col:5,width:8},{col:6,width:18},{col:7,width:20},{col:8,width:20},{col:9,width:10},{col:10,width:15},{col:11,width:15},{col:12,width:30}]}}function tT(t,e,r,n,s="Calculateur_Division_"+new Date().toLocaleDateString("fr-FR").replace(/\//g,"-")+".xlsx",a){const i=n.createWorkbook(),l=ZE(t,e,r);if(n.addSheet(i,l),a?.timelineSnapshots&&a?.participants){const c=eT(a.timelineSnapshots,a.participants);n.addSheet(i,c)}return n.write(i,s)}/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var al={};al.version="0.18.5";var qp=1252,rT=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],Gp=function(t){rT.indexOf(t)!=-1&&(qp=t)};function nT(){Gp(1252)}var Ni=function(t){Gp(t)};function sT(){Ni(1200),nT()}var No=function(e){return String.fromCharCode(e)},mf=function(e){return String.fromCharCode(e)},il,zn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Ci(t){for(var e="",r=0,n=0,s=0,a=0,i=0,l=0,c=0,u=0;u<t.length;)r=t.charCodeAt(u++),a=r>>2,n=t.charCodeAt(u++),i=(r&3)<<4|n>>4,s=t.charCodeAt(u++),l=(n&15)<<2|s>>6,c=s&63,isNaN(n)?l=c=64:isNaN(s)&&(c=64),e+=zn.charAt(a)+zn.charAt(i)+zn.charAt(l)+zn.charAt(c);return e}function Pn(t){var e="",r=0,n=0,s=0,a=0,i=0,l=0,c=0;t=t.replace(/[^\w\+\/\=]/g,"");for(var u=0;u<t.length;)a=zn.indexOf(t.charAt(u++)),i=zn.indexOf(t.charAt(u++)),r=a<<2|i>>4,e+=String.fromCharCode(r),l=zn.indexOf(t.charAt(u++)),n=(i&15)<<4|l>>2,l!==64&&(e+=String.fromCharCode(n)),c=zn.indexOf(t.charAt(u++)),s=(l&3)<<6|c,c!==64&&(e+=String.fromCharCode(s));return e}var et=(function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node})(),kn=(function(){if(typeof Buffer<"u"){var t=!Buffer.from;if(!t)try{Buffer.from("foo","utf8")}catch{t=!0}return t?function(e,r){return r?new Buffer(e,r):new Buffer(e)}:Buffer.from.bind(Buffer)}return function(){}})();function ks(t){return et?Buffer.alloc?Buffer.alloc(t):new Buffer(t):typeof Uint8Array<"u"?new Uint8Array(t):new Array(t)}function pf(t){return et?Buffer.allocUnsafe?Buffer.allocUnsafe(t):new Buffer(t):typeof Uint8Array<"u"?new Uint8Array(t):new Array(t)}var qr=function(e){return et?kn(e,"binary"):e.split("").map(function(r){return r.charCodeAt(0)&255})};function Kl(t){if(typeof ArrayBuffer>"u")return qr(t);for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n!=t.length;++n)r[n]=t.charCodeAt(n)&255;return e}function Xi(t){if(Array.isArray(t))return t.map(function(n){return String.fromCharCode(n)}).join("");for(var e=[],r=0;r<t.length;++r)e[r]=String.fromCharCode(t[r]);return e.join("")}function aT(t){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(t)}var Kt=et?function(t){return Buffer.concat(t.map(function(e){return Buffer.isBuffer(e)?e:kn(e)}))}:function(t){if(typeof Uint8Array<"u"){var e=0,r=0;for(e=0;e<t.length;++e)r+=t[e].length;var n=new Uint8Array(r),s=0;for(e=0,r=0;e<t.length;r+=s,++e)if(s=t[e].length,t[e]instanceof Uint8Array)n.set(t[e],r);else{if(typeof t[e]=="string")throw"wtf";n.set(new Uint8Array(t[e]),r)}return n}return[].concat.apply([],t.map(function(a){return Array.isArray(a)?a:[].slice.call(a)}))};function iT(t){for(var e=[],r=0,n=t.length+250,s=ks(t.length+255),a=0;a<t.length;++a){var i=t.charCodeAt(a);if(i<128)s[r++]=i;else if(i<2048)s[r++]=192|i>>6&31,s[r++]=128|i&63;else if(i>=55296&&i<57344){i=(i&1023)+64;var l=t.charCodeAt(++a)&1023;s[r++]=240|i>>8&7,s[r++]=128|i>>2&63,s[r++]=128|l>>6&15|(i&3)<<4,s[r++]=128|l&63}else s[r++]=224|i>>12&15,s[r++]=128|i>>6&63,s[r++]=128|i&63;r>n&&(e.push(s.slice(0,r)),r=0,s=ks(65535),n=65530)}return e.push(s.slice(0,r)),Kt(e)}var ui=/\u0000/g,Co=/[\u0001-\u0006]/g;function ma(t){for(var e="",r=t.length-1;r>=0;)e+=t.charAt(r--);return e}function Gr(t,e){var r=""+t;return r.length>=e?r:Et("0",e-r.length)+r}function rh(t,e){var r=""+t;return r.length>=e?r:Et(" ",e-r.length)+r}function ol(t,e){var r=""+t;return r.length>=e?r:r+Et(" ",e-r.length)}function oT(t,e){var r=""+Math.round(t);return r.length>=e?r:Et("0",e-r.length)+r}function lT(t,e){var r=""+t;return r.length>=e?r:Et("0",e-r.length)+r}var gf=Math.pow(2,32);function ta(t,e){if(t>gf||t<-gf)return oT(t,e);var r=Math.round(t);return lT(r,e)}function ll(t,e){return e=e||0,t.length>=7+e&&(t.charCodeAt(e)|32)===103&&(t.charCodeAt(e+1)|32)===101&&(t.charCodeAt(e+2)|32)===110&&(t.charCodeAt(e+3)|32)===101&&(t.charCodeAt(e+4)|32)===114&&(t.charCodeAt(e+5)|32)===97&&(t.charCodeAt(e+6)|32)===108}var xf=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],kc=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function cT(t){return t||(t={}),t[0]="General",t[1]="0",t[2]="0.00",t[3]="#,##0",t[4]="#,##0.00",t[9]="0%",t[10]="0.00%",t[11]="0.00E+00",t[12]="# ?/?",t[13]="# ??/??",t[14]="m/d/yy",t[15]="d-mmm-yy",t[16]="d-mmm",t[17]="mmm-yy",t[18]="h:mm AM/PM",t[19]="h:mm:ss AM/PM",t[20]="h:mm",t[21]="h:mm:ss",t[22]="m/d/yy h:mm",t[37]="#,##0 ;(#,##0)",t[38]="#,##0 ;[Red](#,##0)",t[39]="#,##0.00;(#,##0.00)",t[40]="#,##0.00;[Red](#,##0.00)",t[45]="mm:ss",t[46]="[h]:mm:ss",t[47]="mmss.0",t[48]="##0.0E+0",t[49]="@",t[56]='"/ "hh""mm""ss" "',t}var At={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"/ "hh""mm""ss" "'},vf={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},uT={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function cl(t,e,r){for(var n=t<0?-1:1,s=t*n,a=0,i=1,l=0,c=1,u=0,h=0,f=Math.floor(s);u<e&&(f=Math.floor(s),l=f*i+a,h=f*u+c,!(s-f<5e-8));)s=1/(s-f),a=i,i=l,c=u,u=h;if(h>e&&(u>e?(h=c,l=a):(h=u,l=i)),!r)return[0,n*l,h];var m=Math.floor(n*l/h);return[m,n*l-m*h,h]}function Io(t,e,r){if(t>2958465||t<0)return null;var n=t|0,s=Math.floor(86400*(t-n)),a=0,i=[],l={D:n,T:s,u:86400*(t-n)-s,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(l.u)<1e-6&&(l.u=0),e&&e.date1904&&(n+=1462),l.u>.9999&&(l.u=0,++s==86400&&(l.T=s=0,++n,++l.D)),n===60)i=r?[1317,10,29]:[1900,2,29],a=3;else if(n===0)i=r?[1317,8,29]:[1900,1,0],a=6;else{n>60&&--n;var c=new Date(1900,0,1);c.setDate(c.getDate()+n-1),i=[c.getFullYear(),c.getMonth()+1,c.getDate()],a=c.getDay(),n<60&&(a=(a+6)%7),r&&(a=xT(c,i))}return l.y=i[0],l.m=i[1],l.d=i[2],l.S=s%60,s=Math.floor(s/60),l.M=s%60,s=Math.floor(s/60),l.H=s,l.q=a,l}var zp=new Date(1899,11,31,0,0,0),hT=zp.getTime(),dT=new Date(1900,2,1,0,0,0);function Yp(t,e){var r=t.getTime();return e?r-=1461*24*60*60*1e3:t>=dT&&(r+=1440*60*1e3),(r-(hT+(t.getTimezoneOffset()-zp.getTimezoneOffset())*6e4))/(1440*60*1e3)}function nh(t){return t.indexOf(".")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function fT(t){return t.indexOf("E")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function mT(t){var e=t<0?12:11,r=nh(t.toFixed(12));return r.length<=e||(r=t.toPrecision(10),r.length<=e)?r:t.toExponential(5)}function pT(t){var e=nh(t.toFixed(11));return e.length>(t<0?12:11)||e==="0"||e==="-0"?t.toPrecision(6):e}function gT(t){var e=Math.floor(Math.log(Math.abs(t))*Math.LOG10E),r;return e>=-4&&e<=-1?r=t.toPrecision(10+e):Math.abs(e)<=9?r=mT(t):e===10?r=t.toFixed(10).substr(0,12):r=pT(t),nh(fT(r.toUpperCase()))}function du(t,e){switch(typeof t){case"string":return t;case"boolean":return t?"TRUE":"FALSE";case"number":return(t|0)===t?t.toString(10):gT(t);case"undefined":return"";case"object":if(t==null)return"";if(t instanceof Date)return ns(14,Yp(t,e&&e.date1904),e)}throw new Error("unsupported value in General format: "+t)}function xT(t,e){e[0]-=581;var r=t.getDay();return t<60&&(r=(r+6)%7),r}function vT(t,e,r,n){var s="",a=0,i=0,l=r.y,c,u=0;switch(t){case 98:l=r.y+543;case 121:switch(e.length){case 1:case 2:c=l%100,u=2;break;default:c=l%1e4,u=4;break}break;case 109:switch(e.length){case 1:case 2:c=r.m,u=e.length;break;case 3:return kc[r.m-1][1];case 5:return kc[r.m-1][0];default:return kc[r.m-1][2]}break;case 100:switch(e.length){case 1:case 2:c=r.d,u=e.length;break;case 3:return xf[r.q][0];default:return xf[r.q][1]}break;case 104:switch(e.length){case 1:case 2:c=1+(r.H+11)%12,u=e.length;break;default:throw"bad hour format: "+e}break;case 72:switch(e.length){case 1:case 2:c=r.H,u=e.length;break;default:throw"bad hour format: "+e}break;case 77:switch(e.length){case 1:case 2:c=r.M,u=e.length;break;default:throw"bad minute format: "+e}break;case 115:if(e!="s"&&e!="ss"&&e!=".0"&&e!=".00"&&e!=".000")throw"bad second format: "+e;return r.u===0&&(e=="s"||e=="ss")?Gr(r.S,e.length):(n>=2?i=n===3?1e3:100:i=n===1?10:1,a=Math.round(i*(r.S+r.u)),a>=60*i&&(a=0),e==="s"?a===0?"0":""+a/i:(s=Gr(a,2+n),e==="ss"?s.substr(0,2):"."+s.substr(2,e.length-1)));case 90:switch(e){case"[h]":case"[hh]":c=r.D*24+r.H;break;case"[m]":case"[mm]":c=(r.D*24+r.H)*60+r.M;break;case"[s]":case"[ss]":c=((r.D*24+r.H)*60+r.M)*60+Math.round(r.S+r.u);break;default:throw"bad abstime format: "+e}u=e.length===3?1:2;break;case 101:c=l,u=1;break}var h=u>0?Gr(c,u):"";return h}function Yn(t){var e=3;if(t.length<=e)return t;for(var r=t.length%e,n=t.substr(0,r);r!=t.length;r+=e)n+=(n.length>0?",":"")+t.substr(r,e);return n}var Kp=/%/g;function yT(t,e,r){var n=e.replace(Kp,""),s=e.length-n.length;return En(t,n,r*Math.pow(10,2*s))+Et("%",s)}function _T(t,e,r){for(var n=e.length-1;e.charCodeAt(n-1)===44;)--n;return En(t,e.substr(0,n),r/Math.pow(10,3*(e.length-n)))}function Xp(t,e){var r,n=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(e==0)return"0.0E+0";if(e<0)return"-"+Xp(t,-e);var s=t.indexOf(".");s===-1&&(s=t.indexOf("E"));var a=Math.floor(Math.log(e)*Math.LOG10E)%s;if(a<0&&(a+=s),r=(e/Math.pow(10,a)).toPrecision(n+1+(s+a)%s),r.indexOf("e")===-1){var i=Math.floor(Math.log(e)*Math.LOG10E);for(r.indexOf(".")===-1?r=r.charAt(0)+"."+r.substr(1)+"E+"+(i-r.length+a):r+="E+"+(i-a);r.substr(0,2)==="0.";)r=r.charAt(0)+r.substr(2,s)+"."+r.substr(2+s),r=r.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,c,u,h){return c+u+h.substr(0,(s+a)%s)+"."+h.substr(a)+"E"})}else r=e.toExponential(n);return t.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),t.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}var Qp=/# (\?+)( ?)\/( ?)(\d+)/;function wT(t,e,r){var n=parseInt(t[4],10),s=Math.round(e*n),a=Math.floor(s/n),i=s-a*n,l=n;return r+(a===0?"":""+a)+" "+(i===0?Et(" ",t[1].length+1+t[4].length):rh(i,t[1].length)+t[2]+"/"+t[3]+Gr(l,t[4].length))}function bT(t,e,r){return r+(e===0?"":""+e)+Et(" ",t[1].length+2+t[4].length)}var Jp=/^#*0*\.([0#]+)/,Zp=/\).*[0#]/,eg=/\(###\) ###\\?-####/;function mr(t){for(var e="",r,n=0;n!=t.length;++n)switch(r=t.charCodeAt(n)){case 35:break;case 63:e+=" ";break;case 48:e+="0";break;default:e+=String.fromCharCode(r)}return e}function yf(t,e){var r=Math.pow(10,e);return""+Math.round(t*r)/r}function _f(t,e){var r=t-Math.floor(t),n=Math.pow(10,e);return e<(""+Math.round(r*n)).length?0:Math.round(r*n)}function ET(t,e){return e<(""+Math.round((t-Math.floor(t))*Math.pow(10,e))).length?1:0}function TT(t){return t<2147483647&&t>-2147483648?""+(t>=0?t|0:t-1|0):""+Math.floor(t)}function Or(t,e,r){if(t.charCodeAt(0)===40&&!e.match(Zp)){var n=e.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?Or("n",n,r):"("+Or("n",n,-r)+")"}if(e.charCodeAt(e.length-1)===44)return _T(t,e,r);if(e.indexOf("%")!==-1)return yT(t,e,r);if(e.indexOf("E")!==-1)return Xp(e,r);if(e.charCodeAt(0)===36)return"$"+Or(t,e.substr(e.charAt(1)==" "?2:1),r);var s,a,i,l,c=Math.abs(r),u=r<0?"-":"";if(e.match(/^00+$/))return u+ta(c,e.length);if(e.match(/^[#?]+$/))return s=ta(r,0),s==="0"&&(s=""),s.length>e.length?s:mr(e.substr(0,e.length-s.length))+s;if(a=e.match(Qp))return wT(a,c,u);if(e.match(/^#+0+$/))return u+ta(c,e.length-e.indexOf("0"));if(a=e.match(Jp))return s=yf(r,a[1].length).replace(/^([^\.]+)$/,"$1."+mr(a[1])).replace(/\.$/,"."+mr(a[1])).replace(/\.(\d*)$/,function(x,g){return"."+g+Et("0",mr(a[1]).length-g.length)}),e.indexOf("0.")!==-1?s:s.replace(/^0\./,".");if(e=e.replace(/^#+([0.])/,"$1"),a=e.match(/^(0*)\.(#*)$/))return u+yf(c,a[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,a[1].length?"0.":".");if(a=e.match(/^#{1,3},##0(\.?)$/))return u+Yn(ta(c,0));if(a=e.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+Or(t,e,-r):Yn(""+(Math.floor(r)+ET(r,a[1].length)))+"."+Gr(_f(r,a[1].length),a[1].length);if(a=e.match(/^#,#*,#0/))return Or(t,e.replace(/^#,#*,/,""),r);if(a=e.match(/^([0#]+)(\\?-([0#]+))+$/))return s=ma(Or(t,e.replace(/[\\-]/g,""),r)),i=0,ma(ma(e.replace(/\\/g,"")).replace(/[0#]/g,function(x){return i<s.length?s.charAt(i++):x==="0"?"0":""}));if(e.match(eg))return s=Or(t,"##########",r),"("+s.substr(0,3)+") "+s.substr(3,3)+"-"+s.substr(6);var h="";if(a=e.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(a[4].length,7),l=cl(c,Math.pow(10,i)-1,!1),s=""+u,h=En("n",a[1],l[1]),h.charAt(h.length-1)==" "&&(h=h.substr(0,h.length-1)+"0"),s+=h+a[2]+"/"+a[3],h=ol(l[2],i),h.length<a[4].length&&(h=mr(a[4].substr(a[4].length-h.length))+h),s+=h,s;if(a=e.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(Math.max(a[1].length,a[4].length),7),l=cl(c,Math.pow(10,i)-1,!0),u+(l[0]||(l[1]?"":"0"))+" "+(l[1]?rh(l[1],i)+a[2]+"/"+a[3]+ol(l[2],i):Et(" ",2*i+1+a[2].length+a[3].length));if(a=e.match(/^[#0?]+$/))return s=ta(r,0),e.length<=s.length?s:mr(e.substr(0,e.length-s.length))+s;if(a=e.match(/^([#0?]+)\.([#0]+)$/)){s=""+r.toFixed(Math.min(a[2].length,10)).replace(/([^0])0+$/,"$1"),i=s.indexOf(".");var f=e.indexOf(".")-i,m=e.length-s.length-f;return mr(e.substr(0,f)+s+e.substr(e.length-m))}if(a=e.match(/^00,000\.([#0]*0)$/))return i=_f(r,a[1].length),r<0?"-"+Or(t,e,-r):Yn(TT(r)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(x){return"00,"+(x.length<3?Gr(0,3-x.length):"")+x})+"."+Gr(i,a[1].length);switch(e){case"###,##0.00":return Or(t,"#,##0.00",r);case"###,###":case"##,###":case"#,###":var p=Yn(ta(c,0));return p!=="0"?u+p:"";case"###,###.00":return Or(t,"###,##0.00",r).replace(/^0\./,".");case"#,###.00":return Or(t,"#,##0.00",r).replace(/^0\./,".")}throw new Error("unsupported format |"+e+"|")}function AT(t,e,r){for(var n=e.length-1;e.charCodeAt(n-1)===44;)--n;return En(t,e.substr(0,n),r/Math.pow(10,3*(e.length-n)))}function ST(t,e,r){var n=e.replace(Kp,""),s=e.length-n.length;return En(t,n,r*Math.pow(10,2*s))+Et("%",s)}function tg(t,e){var r,n=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(e==0)return"0.0E+0";if(e<0)return"-"+tg(t,-e);var s=t.indexOf(".");s===-1&&(s=t.indexOf("E"));var a=Math.floor(Math.log(e)*Math.LOG10E)%s;if(a<0&&(a+=s),r=(e/Math.pow(10,a)).toPrecision(n+1+(s+a)%s),!r.match(/[Ee]/)){var i=Math.floor(Math.log(e)*Math.LOG10E);r.indexOf(".")===-1?r=r.charAt(0)+"."+r.substr(1)+"E+"+(i-r.length+a):r+="E+"+(i-a),r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,c,u,h){return c+u+h.substr(0,(s+a)%s)+"."+h.substr(a)+"E"})}else r=e.toExponential(n);return t.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),t.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}function nn(t,e,r){if(t.charCodeAt(0)===40&&!e.match(Zp)){var n=e.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?nn("n",n,r):"("+nn("n",n,-r)+")"}if(e.charCodeAt(e.length-1)===44)return AT(t,e,r);if(e.indexOf("%")!==-1)return ST(t,e,r);if(e.indexOf("E")!==-1)return tg(e,r);if(e.charCodeAt(0)===36)return"$"+nn(t,e.substr(e.charAt(1)==" "?2:1),r);var s,a,i,l,c=Math.abs(r),u=r<0?"-":"";if(e.match(/^00+$/))return u+Gr(c,e.length);if(e.match(/^[#?]+$/))return s=""+r,r===0&&(s=""),s.length>e.length?s:mr(e.substr(0,e.length-s.length))+s;if(a=e.match(Qp))return bT(a,c,u);if(e.match(/^#+0+$/))return u+Gr(c,e.length-e.indexOf("0"));if(a=e.match(Jp))return s=(""+r).replace(/^([^\.]+)$/,"$1."+mr(a[1])).replace(/\.$/,"."+mr(a[1])),s=s.replace(/\.(\d*)$/,function(x,g){return"."+g+Et("0",mr(a[1]).length-g.length)}),e.indexOf("0.")!==-1?s:s.replace(/^0\./,".");if(e=e.replace(/^#+([0.])/,"$1"),a=e.match(/^(0*)\.(#*)$/))return u+(""+c).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,a[1].length?"0.":".");if(a=e.match(/^#{1,3},##0(\.?)$/))return u+Yn(""+c);if(a=e.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+nn(t,e,-r):Yn(""+r)+"."+Et("0",a[1].length);if(a=e.match(/^#,#*,#0/))return nn(t,e.replace(/^#,#*,/,""),r);if(a=e.match(/^([0#]+)(\\?-([0#]+))+$/))return s=ma(nn(t,e.replace(/[\\-]/g,""),r)),i=0,ma(ma(e.replace(/\\/g,"")).replace(/[0#]/g,function(x){return i<s.length?s.charAt(i++):x==="0"?"0":""}));if(e.match(eg))return s=nn(t,"##########",r),"("+s.substr(0,3)+") "+s.substr(3,3)+"-"+s.substr(6);var h="";if(a=e.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(a[4].length,7),l=cl(c,Math.pow(10,i)-1,!1),s=""+u,h=En("n",a[1],l[1]),h.charAt(h.length-1)==" "&&(h=h.substr(0,h.length-1)+"0"),s+=h+a[2]+"/"+a[3],h=ol(l[2],i),h.length<a[4].length&&(h=mr(a[4].substr(a[4].length-h.length))+h),s+=h,s;if(a=e.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(Math.max(a[1].length,a[4].length),7),l=cl(c,Math.pow(10,i)-1,!0),u+(l[0]||(l[1]?"":"0"))+" "+(l[1]?rh(l[1],i)+a[2]+"/"+a[3]+ol(l[2],i):Et(" ",2*i+1+a[2].length+a[3].length));if(a=e.match(/^[#0?]+$/))return s=""+r,e.length<=s.length?s:mr(e.substr(0,e.length-s.length))+s;if(a=e.match(/^([#0]+)\.([#0]+)$/)){s=""+r.toFixed(Math.min(a[2].length,10)).replace(/([^0])0+$/,"$1"),i=s.indexOf(".");var f=e.indexOf(".")-i,m=e.length-s.length-f;return mr(e.substr(0,f)+s+e.substr(e.length-m))}if(a=e.match(/^00,000\.([#0]*0)$/))return r<0?"-"+nn(t,e,-r):Yn(""+r).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(x){return"00,"+(x.length<3?Gr(0,3-x.length):"")+x})+"."+Gr(0,a[1].length);switch(e){case"###,###":case"##,###":case"#,###":var p=Yn(""+c);return p!=="0"?u+p:"";default:if(e.match(/\.[0#?]*$/))return nn(t,e.slice(0,e.lastIndexOf(".")),r)+mr(e.slice(e.lastIndexOf(".")))}throw new Error("unsupported format |"+e+"|")}function En(t,e,r){return(r|0)===r?nn(t,e,r):Or(t,e,r)}function NT(t){for(var e=[],r=!1,n=0,s=0;n<t.length;++n)switch(t.charCodeAt(n)){case 34:r=!r;break;case 95:case 42:case 92:++n;break;case 59:e[e.length]=t.substr(s,n-s),s=n+1}if(e[e.length]=t.substr(s),r===!0)throw new Error("Format |"+t+"| unterminated string ");return e}var rg=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function ng(t){for(var e=0,r="",n="";e<t.length;)switch(r=t.charAt(e)){case"G":ll(t,e)&&(e+=6),e++;break;case'"':for(;t.charCodeAt(++e)!==34&&e<t.length;);++e;break;case"\\":e+=2;break;case"_":e+=2;break;case"@":++e;break;case"B":case"b":if(t.charAt(e+1)==="1"||t.charAt(e+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"":if(t.substr(e,3).toUpperCase()==="A/P"||t.substr(e,5).toUpperCase()==="AM/PM"||t.substr(e,5).toUpperCase()==="/")return!0;++e;break;case"[":for(n=r;t.charAt(e++)!=="]"&&e<t.length;)n+=t.charAt(e);if(n.match(rg))return!0;break;case".":case"0":case"#":for(;e<t.length&&("0#?.,E+-%".indexOf(r=t.charAt(++e))>-1||r=="\\"&&t.charAt(e+1)=="-"&&"0#".indexOf(t.charAt(e+2))>-1););break;case"?":for(;t.charAt(++e)===r;);break;case"*":++e,(t.charAt(e)==" "||t.charAt(e)=="*")&&++e;break;case"(":case")":++e;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;e<t.length&&"0123456789".indexOf(t.charAt(++e))>-1;);break;case" ":++e;break;default:++e;break}return!1}function CT(t,e,r,n){for(var s=[],a="",i=0,l="",c="t",u,h,f,m="H";i<t.length;)switch(l=t.charAt(i)){case"G":if(!ll(t,i))throw new Error("unrecognized character "+l+" in "+t);s[s.length]={t:"G",v:"General"},i+=7;break;case'"':for(a="";(f=t.charCodeAt(++i))!==34&&i<t.length;)a+=String.fromCharCode(f);s[s.length]={t:"t",v:a},++i;break;case"\\":var p=t.charAt(++i),x=p==="("||p===")"?p:"t";s[s.length]={t:x,v:p},++i;break;case"_":s[s.length]={t:"t",v:" "},i+=2;break;case"@":s[s.length]={t:"T",v:e},++i;break;case"B":case"b":if(t.charAt(i+1)==="1"||t.charAt(i+1)==="2"){if(u==null&&(u=Io(e,r,t.charAt(i+1)==="2"),u==null))return"";s[s.length]={t:"X",v:t.substr(i,2)},c=l,i+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":l=l.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(e<0||u==null&&(u=Io(e,r),u==null))return"";for(a=l;++i<t.length&&t.charAt(i).toLowerCase()===l;)a+=l;l==="m"&&c.toLowerCase()==="h"&&(l="M"),l==="h"&&(l=m),s[s.length]={t:l,v:a},c=l;break;case"A":case"a":case"":var g={t:l,v:l};if(u==null&&(u=Io(e,r)),t.substr(i,3).toUpperCase()==="A/P"?(u!=null&&(g.v=u.H>=12?"P":"A"),g.t="T",m="h",i+=3):t.substr(i,5).toUpperCase()==="AM/PM"?(u!=null&&(g.v=u.H>=12?"PM":"AM"),g.t="T",i+=5,m="h"):t.substr(i,5).toUpperCase()==="/"?(u!=null&&(g.v=u.H>=12?"":""),g.t="T",i+=5,m="h"):(g.t="t",++i),u==null&&g.t==="T")return"";s[s.length]=g,c=l;break;case"[":for(a=l;t.charAt(i++)!=="]"&&i<t.length;)a+=t.charAt(i);if(a.slice(-1)!=="]")throw'unterminated "[" block: |'+a+"|";if(a.match(rg)){if(u==null&&(u=Io(e,r),u==null))return"";s[s.length]={t:"Z",v:a.toLowerCase()},c=a.charAt(1)}else a.indexOf("$")>-1&&(a=(a.match(/\$([^-\[\]]*)/)||[])[1]||"$",ng(t)||(s[s.length]={t:"t",v:a}));break;case".":if(u!=null){for(a=l;++i<t.length&&(l=t.charAt(i))==="0";)a+=l;s[s.length]={t:"s",v:a};break}case"0":case"#":for(a=l;++i<t.length&&"0#?.,E+-%".indexOf(l=t.charAt(i))>-1;)a+=l;s[s.length]={t:"n",v:a};break;case"?":for(a=l;t.charAt(++i)===l;)a+=l;s[s.length]={t:l,v:a},c=l;break;case"*":++i,(t.charAt(i)==" "||t.charAt(i)=="*")&&++i;break;case"(":case")":s[s.length]={t:n===1?"t":l,v:l},++i;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(a=l;i<t.length&&"0123456789".indexOf(t.charAt(++i))>-1;)a+=t.charAt(i);s[s.length]={t:"D",v:a};break;case" ":s[s.length]={t:l,v:l},++i;break;case"$":s[s.length]={t:"t",v:"$"},++i;break;default:if(",$-+/():!^&'~{}<>=acfijklopqrtuvwxzP".indexOf(l)===-1)throw new Error("unrecognized character "+l+" in "+t);s[s.length]={t:"t",v:l},++i;break}var y=0,I=0,P;for(i=s.length-1,c="t";i>=0;--i)switch(s[i].t){case"h":case"H":s[i].t=m,c="h",y<1&&(y=1);break;case"s":(P=s[i].v.match(/\.0+$/))&&(I=Math.max(I,P[0].length-1)),y<3&&(y=3);case"d":case"y":case"M":case"e":c=s[i].t;break;case"m":c==="s"&&(s[i].t="M",y<2&&(y=2));break;case"X":break;case"Z":y<1&&s[i].v.match(/[Hh]/)&&(y=1),y<2&&s[i].v.match(/[Mm]/)&&(y=2),y<3&&s[i].v.match(/[Ss]/)&&(y=3)}switch(y){case 0:break;case 1:u.u>=.5&&(u.u=0,++u.S),u.S>=60&&(u.S=0,++u.M),u.M>=60&&(u.M=0,++u.H);break;case 2:u.u>=.5&&(u.u=0,++u.S),u.S>=60&&(u.S=0,++u.M);break}var A="",D;for(i=0;i<s.length;++i)switch(s[i].t){case"t":case"T":case" ":case"D":break;case"X":s[i].v="",s[i].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":s[i].v=vT(s[i].t.charCodeAt(0),s[i].v,u,I),s[i].t="t";break;case"n":case"?":for(D=i+1;s[D]!=null&&((l=s[D].t)==="?"||l==="D"||(l===" "||l==="t")&&s[D+1]!=null&&(s[D+1].t==="?"||s[D+1].t==="t"&&s[D+1].v==="/")||s[i].t==="("&&(l===" "||l==="n"||l===")")||l==="t"&&(s[D].v==="/"||s[D].v===" "&&s[D+1]!=null&&s[D+1].t=="?"));)s[i].v+=s[D].v,s[D]={v:"",t:";"},++D;A+=s[i].v,i=D-1;break;case"G":s[i].t="t",s[i].v=du(e,r);break}var V="",H,w;if(A.length>0){A.charCodeAt(0)==40?(H=e<0&&A.charCodeAt(0)===45?-e:e,w=En("n",A,H)):(H=e<0&&n>1?-e:e,w=En("n",A,H),H<0&&s[0]&&s[0].t=="t"&&(w=w.substr(1),s[0].v="-"+s[0].v)),D=w.length-1;var E=s.length;for(i=0;i<s.length;++i)if(s[i]!=null&&s[i].t!="t"&&s[i].v.indexOf(".")>-1){E=i;break}var _=s.length;if(E===s.length&&w.indexOf("E")===-1){for(i=s.length-1;i>=0;--i)s[i]==null||"n?".indexOf(s[i].t)===-1||(D>=s[i].v.length-1?(D-=s[i].v.length,s[i].v=w.substr(D+1,s[i].v.length)):D<0?s[i].v="":(s[i].v=w.substr(0,D+1),D=-1),s[i].t="t",_=i);D>=0&&_<s.length&&(s[_].v=w.substr(0,D+1)+s[_].v)}else if(E!==s.length&&w.indexOf("E")===-1){for(D=w.indexOf(".")-1,i=E;i>=0;--i)if(!(s[i]==null||"n?".indexOf(s[i].t)===-1)){for(h=s[i].v.indexOf(".")>-1&&i===E?s[i].v.indexOf(".")-1:s[i].v.length-1,V=s[i].v.substr(h+1);h>=0;--h)D>=0&&(s[i].v.charAt(h)==="0"||s[i].v.charAt(h)==="#")&&(V=w.charAt(D--)+V);s[i].v=V,s[i].t="t",_=i}for(D>=0&&_<s.length&&(s[_].v=w.substr(0,D+1)+s[_].v),D=w.indexOf(".")+1,i=E;i<s.length;++i)if(!(s[i]==null||"n?(".indexOf(s[i].t)===-1&&i!==E)){for(h=s[i].v.indexOf(".")>-1&&i===E?s[i].v.indexOf(".")+1:0,V=s[i].v.substr(0,h);h<s[i].v.length;++h)D<w.length&&(V+=w.charAt(D++));s[i].v=V,s[i].t="t",_=i}}}for(i=0;i<s.length;++i)s[i]!=null&&"n?".indexOf(s[i].t)>-1&&(H=n>1&&e<0&&i>0&&s[i-1].v==="-"?-e:e,s[i].v=En(s[i].t,s[i].v,H),s[i].t="t");var N="";for(i=0;i!==s.length;++i)s[i]!=null&&(N+=s[i].v);return N}var wf=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function bf(t,e){if(e==null)return!1;var r=parseFloat(e[2]);switch(e[1]){case"=":if(t==r)return!0;break;case">":if(t>r)return!0;break;case"<":if(t<r)return!0;break;case"<>":if(t!=r)return!0;break;case">=":if(t>=r)return!0;break;case"<=":if(t<=r)return!0;break}return!1}function IT(t,e){var r=NT(t),n=r.length,s=r[n-1].indexOf("@");if(n<4&&s>-1&&--n,r.length>4)throw new Error("cannot find right format for |"+r.join("|")+"|");if(typeof e!="number")return[4,r.length===4||s>-1?r[r.length-1]:"@"];switch(r.length){case 1:r=s>-1?["General","General","General",r[0]]:[r[0],r[0],r[0],"@"];break;case 2:r=s>-1?[r[0],r[0],r[0],r[1]]:[r[0],r[1],r[0],"@"];break;case 3:r=s>-1?[r[0],r[1],r[0],r[2]]:[r[0],r[1],r[2],"@"];break}var a=e>0?r[0]:e<0?r[1]:r[2];if(r[0].indexOf("[")===-1&&r[1].indexOf("[")===-1)return[n,a];if(r[0].match(/\[[=<>]/)!=null||r[1].match(/\[[=<>]/)!=null){var i=r[0].match(wf),l=r[1].match(wf);return bf(e,i)?[n,r[0]]:bf(e,l)?[n,r[1]]:[n,r[i!=null&&l!=null?2:1]]}return[n,a]}function ns(t,e,r){r==null&&(r={});var n="";switch(typeof t){case"string":t=="m/d/yy"&&r.dateNF?n=r.dateNF:n=t;break;case"number":t==14&&r.dateNF?n=r.dateNF:n=(r.table!=null?r.table:At)[t],n==null&&(n=r.table&&r.table[vf[t]]||At[vf[t]]),n==null&&(n=uT[t]||"General");break}if(ll(n,0))return du(e,r);e instanceof Date&&(e=Yp(e,r.date1904));var s=IT(n,e);if(ll(s[1]))return du(e,r);if(e===!0)e="TRUE";else if(e===!1)e="FALSE";else if(e===""||e==null)return"";return CT(s[1],e,r,s[0])}function sg(t,e){if(typeof e!="number"){e=+e||-1;for(var r=0;r<392;++r){if(At[r]==null){e<0&&(e=r);continue}if(At[r]==t){e=r;break}}e<0&&(e=391)}return At[e]=t,e}function Xl(t){for(var e=0;e!=392;++e)t[e]!==void 0&&sg(t[e],e)}function Ql(){At=cT()}var ag=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function PT(t){var e=typeof t=="number"?At[t]:t;return e=e.replace(ag,"(\\d+)"),new RegExp("^"+e+"$")}function RT(t,e,r){var n=-1,s=-1,a=-1,i=-1,l=-1,c=-1;(e.match(ag)||[]).forEach(function(f,m){var p=parseInt(r[m+1],10);switch(f.toLowerCase().charAt(0)){case"y":n=p;break;case"d":a=p;break;case"h":i=p;break;case"s":c=p;break;case"m":i>=0?l=p:s=p;break}}),c>=0&&l==-1&&s>=0&&(l=s,s=-1);var u=(""+(n>=0?n:new Date().getFullYear())).slice(-4)+"-"+("00"+(s>=1?s:1)).slice(-2)+"-"+("00"+(a>=1?a:1)).slice(-2);u.length==7&&(u="0"+u),u.length==8&&(u="20"+u);var h=("00"+(i>=0?i:0)).slice(-2)+":"+("00"+(l>=0?l:0)).slice(-2)+":"+("00"+(c>=0?c:0)).slice(-2);return i==-1&&l==-1&&c==-1?u:n==-1&&s==-1&&a==-1?h:u+"T"+h}var DT=(function(){var t={};t.version="1.2.0";function e(){for(var w=0,E=new Array(256),_=0;_!=256;++_)w=_,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,w=w&1?-306674912^w>>>1:w>>>1,E[_]=w;return typeof Int32Array<"u"?new Int32Array(E):E}var r=e();function n(w){var E=0,_=0,N=0,T=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(N=0;N!=256;++N)T[N]=w[N];for(N=0;N!=256;++N)for(_=w[N],E=256+N;E<4096;E+=256)_=T[E]=_>>>8^w[_&255];var R=[];for(N=1;N!=16;++N)R[N-1]=typeof Int32Array<"u"?T.subarray(N*256,N*256+256):T.slice(N*256,N*256+256);return R}var s=n(r),a=s[0],i=s[1],l=s[2],c=s[3],u=s[4],h=s[5],f=s[6],m=s[7],p=s[8],x=s[9],g=s[10],y=s[11],I=s[12],P=s[13],A=s[14];function D(w,E){for(var _=E^-1,N=0,T=w.length;N<T;)_=_>>>8^r[(_^w.charCodeAt(N++))&255];return~_}function V(w,E){for(var _=E^-1,N=w.length-15,T=0;T<N;)_=A[w[T++]^_&255]^P[w[T++]^_>>8&255]^I[w[T++]^_>>16&255]^y[w[T++]^_>>>24]^g[w[T++]]^x[w[T++]]^p[w[T++]]^m[w[T++]]^f[w[T++]]^h[w[T++]]^u[w[T++]]^c[w[T++]]^l[w[T++]]^i[w[T++]]^a[w[T++]]^r[w[T++]];for(N+=15;T<N;)_=_>>>8^r[(_^w[T++])&255];return~_}function H(w,E){for(var _=E^-1,N=0,T=w.length,R=0,S=0;N<T;)R=w.charCodeAt(N++),R<128?_=_>>>8^r[(_^R)&255]:R<2048?(_=_>>>8^r[(_^(192|R>>6&31))&255],_=_>>>8^r[(_^(128|R&63))&255]):R>=55296&&R<57344?(R=(R&1023)+64,S=w.charCodeAt(N++)&1023,_=_>>>8^r[(_^(240|R>>8&7))&255],_=_>>>8^r[(_^(128|R>>2&63))&255],_=_>>>8^r[(_^(128|S>>6&15|(R&3)<<4))&255],_=_>>>8^r[(_^(128|S&63))&255]):(_=_>>>8^r[(_^(224|R>>12&15))&255],_=_>>>8^r[(_^(128|R>>6&63))&255],_=_>>>8^r[(_^(128|R&63))&255]);return~_}return t.table=r,t.bstr=D,t.buf=V,t.str=H,t})(),lt=(function(){var e={};e.version="1.2.1";function r(C,M){for(var j=C.split("/"),O=M.split("/"),L=0,B=0,X=Math.min(j.length,O.length);L<X;++L){if(B=j[L].length-O[L].length)return B;if(j[L]!=O[L])return j[L]<O[L]?-1:1}return j.length-O.length}function n(C){if(C.charAt(C.length-1)=="/")return C.slice(0,-1).indexOf("/")===-1?C:n(C.slice(0,-1));var M=C.lastIndexOf("/");return M===-1?C:C.slice(0,M+1)}function s(C){if(C.charAt(C.length-1)=="/")return s(C.slice(0,-1));var M=C.lastIndexOf("/");return M===-1?C:C.slice(M+1)}function a(C,M){typeof M=="string"&&(M=new Date(M));var j=M.getHours();j=j<<6|M.getMinutes(),j=j<<5|M.getSeconds()>>>1,C.write_shift(2,j);var O=M.getFullYear()-1980;O=O<<4|M.getMonth()+1,O=O<<5|M.getDate(),C.write_shift(2,O)}function i(C){var M=C.read_shift(2)&65535,j=C.read_shift(2)&65535,O=new Date,L=j&31;j>>>=5;var B=j&15;j>>>=4,O.setMilliseconds(0),O.setFullYear(j+1980),O.setMonth(B-1),O.setDate(L);var X=M&31;M>>>=5;var re=M&63;return M>>>=6,O.setHours(M),O.setMinutes(re),O.setSeconds(X<<1),O}function l(C){Nr(C,0);for(var M={},j=0;C.l<=C.length-4;){var O=C.read_shift(2),L=C.read_shift(2),B=C.l+L,X={};switch(O){case 21589:j=C.read_shift(1),j&1&&(X.mtime=C.read_shift(4)),L>5&&(j&2&&(X.atime=C.read_shift(4)),j&4&&(X.ctime=C.read_shift(4))),X.mtime&&(X.mt=new Date(X.mtime*1e3));break}C.l=B,M[O]=X}return M}var c;function u(){return c||(c={})}function h(C,M){if(C[0]==80&&C[1]==75)return vt(C,M);if((C[0]|32)==109&&(C[1]|32)==105)return bc(C,M);if(C.length<512)throw new Error("CFB file size "+C.length+" < 512");var j=3,O=512,L=0,B=0,X=0,re=0,z=0,Q=[],J=C.slice(0,512);Nr(J,0);var de=f(J);switch(j=de[0],j){case 3:O=512;break;case 4:O=4096;break;case 0:if(de[1]==0)return vt(C,M);default:throw new Error("Major Version: Expected 3 or 4 saw "+j)}O!==512&&(J=C.slice(0,O),Nr(J,28));var _e=C.slice(0,O);m(J,j);var Se=J.read_shift(4,"i");if(j===3&&Se!==0)throw new Error("# Directory Sectors: Expected 0 saw "+Se);J.l+=4,X=J.read_shift(4,"i"),J.l+=4,J.chk("00100000","Mini Stream Cutoff Size: "),re=J.read_shift(4,"i"),L=J.read_shift(4,"i"),z=J.read_shift(4,"i"),B=J.read_shift(4,"i");for(var fe=-1,Ee=0;Ee<109&&(fe=J.read_shift(4,"i"),!(fe<0));++Ee)Q[Ee]=fe;var Me=p(C,O);y(z,B,Me,O,Q);var dt=P(Me,X,Q,O);dt[X].name="!Directory",L>0&&re!==S&&(dt[re].name="!MiniFAT"),dt[Q[0]].name="!FAT",dt.fat_addrs=Q,dt.ssz=O;var ft={},kt=[],vn=[],yn=[];A(X,dt,Me,kt,L,ft,vn,re),x(vn,yn,kt),kt.shift();var Bn={FileIndex:vn,FullPaths:yn};return M&&M.raw&&(Bn.raw={header:_e,sectors:Me}),Bn}function f(C){if(C[C.l]==80&&C[C.l+1]==75)return[0,0];C.chk(se,"Header Signature: "),C.l+=16;var M=C.read_shift(2,"u");return[C.read_shift(2,"u"),M]}function m(C,M){var j=9;switch(C.l+=2,j=C.read_shift(2)){case 9:if(M!=3)throw new Error("Sector Shift: Expected 9 saw "+j);break;case 12:if(M!=4)throw new Error("Sector Shift: Expected 12 saw "+j);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+j)}C.chk("0600","Mini Sector Shift: "),C.chk("000000000000","Reserved: ")}function p(C,M){for(var j=Math.ceil(C.length/M)-1,O=[],L=1;L<j;++L)O[L-1]=C.slice(L*M,(L+1)*M);return O[j-1]=C.slice(j*M),O}function x(C,M,j){for(var O=0,L=0,B=0,X=0,re=0,z=j.length,Q=[],J=[];O<z;++O)Q[O]=J[O]=O,M[O]=j[O];for(;re<J.length;++re)O=J[re],L=C[O].L,B=C[O].R,X=C[O].C,Q[O]===O&&(L!==-1&&Q[L]!==L&&(Q[O]=Q[L]),B!==-1&&Q[B]!==B&&(Q[O]=Q[B])),X!==-1&&(Q[X]=O),L!==-1&&O!=Q[O]&&(Q[L]=Q[O],J.lastIndexOf(L)<re&&J.push(L)),B!==-1&&O!=Q[O]&&(Q[B]=Q[O],J.lastIndexOf(B)<re&&J.push(B));for(O=1;O<z;++O)Q[O]===O&&(B!==-1&&Q[B]!==B?Q[O]=Q[B]:L!==-1&&Q[L]!==L&&(Q[O]=Q[L]));for(O=1;O<z;++O)if(C[O].type!==0){if(re=O,re!=Q[re])do re=Q[re],M[O]=M[re]+"/"+M[O];while(re!==0&&Q[re]!==-1&&re!=Q[re]);Q[O]=-1}for(M[0]+="/",O=1;O<z;++O)C[O].type!==2&&(M[O]+="/")}function g(C,M,j){for(var O=C.start,L=C.size,B=[],X=O;j&&L>0&&X>=0;)B.push(M.slice(X*R,X*R+R)),L-=R,X=Ns(j,X*4);return B.length===0?ee(0):Kt(B).slice(0,C.size)}function y(C,M,j,O,L){var B=S;if(C===S){if(M!==0)throw new Error("DIFAT chain shorter than expected")}else if(C!==-1){var X=j[C],re=(O>>>2)-1;if(!X)return;for(var z=0;z<re&&(B=Ns(X,z*4))!==S;++z)L.push(B);y(Ns(X,O-4),M-1,j,O,L)}}function I(C,M,j,O,L){var B=[],X=[];L||(L=[]);var re=O-1,z=0,Q=0;for(z=M;z>=0;){L[z]=!0,B[B.length]=z,X.push(C[z]);var J=j[Math.floor(z*4/O)];if(Q=z*4&re,O<4+Q)throw new Error("FAT boundary crossed: "+z+" 4 "+O);if(!C[J])break;z=Ns(C[J],Q)}return{nodes:B,data:Pf([X])}}function P(C,M,j,O){var L=C.length,B=[],X=[],re=[],z=[],Q=O-1,J=0,de=0,_e=0,Se=0;for(J=0;J<L;++J)if(re=[],_e=J+M,_e>=L&&(_e-=L),!X[_e]){z=[];var fe=[];for(de=_e;de>=0;){fe[de]=!0,X[de]=!0,re[re.length]=de,z.push(C[de]);var Ee=j[Math.floor(de*4/O)];if(Se=de*4&Q,O<4+Se)throw new Error("FAT boundary crossed: "+de+" 4 "+O);if(!C[Ee]||(de=Ns(C[Ee],Se),fe[de]))break}B[_e]={nodes:re,data:Pf([z])}}return B}function A(C,M,j,O,L,B,X,re){for(var z=0,Q=O.length?2:0,J=M[C].data,de=0,_e=0,Se;de<J.length;de+=128){var fe=J.slice(de,de+128);Nr(fe,64),_e=fe.read_shift(2),Se=lh(fe,0,_e-Q),O.push(Se);var Ee={name:Se,type:fe.read_shift(1),color:fe.read_shift(1),L:fe.read_shift(4,"i"),R:fe.read_shift(4,"i"),C:fe.read_shift(4,"i"),clsid:fe.read_shift(16),state:fe.read_shift(4,"i"),start:0,size:0},Me=fe.read_shift(2)+fe.read_shift(2)+fe.read_shift(2)+fe.read_shift(2);Me!==0&&(Ee.ct=D(fe,fe.l-8));var dt=fe.read_shift(2)+fe.read_shift(2)+fe.read_shift(2)+fe.read_shift(2);dt!==0&&(Ee.mt=D(fe,fe.l-8)),Ee.start=fe.read_shift(4,"i"),Ee.size=fe.read_shift(4,"i"),Ee.size<0&&Ee.start<0&&(Ee.size=Ee.type=0,Ee.start=S,Ee.name=""),Ee.type===5?(z=Ee.start,L>0&&z!==S&&(M[z].name="!StreamData")):Ee.size>=4096?(Ee.storage="fat",M[Ee.start]===void 0&&(M[Ee.start]=I(j,Ee.start,M.fat_addrs,M.ssz)),M[Ee.start].name=Ee.name,Ee.content=M[Ee.start].data.slice(0,Ee.size)):(Ee.storage="minifat",Ee.size<0?Ee.size=0:z!==S&&Ee.start!==S&&M[z]&&(Ee.content=g(Ee,M[z].data,(M[re]||{}).data))),Ee.content&&Nr(Ee.content,0),B[Se]=Ee,X.push(Ee)}}function D(C,M){return new Date((Pr(C,M+4)/1e7*Math.pow(2,32)+Pr(C,M)/1e7-11644473600)*1e3)}function V(C,M){return u(),h(c.readFileSync(C),M)}function H(C,M){var j=M&&M.type;switch(j||et&&Buffer.isBuffer(C)&&(j="buffer"),j||"base64"){case"file":return V(C,M);case"base64":return h(qr(Pn(C)),M);case"binary":return h(qr(C),M)}return h(C,M)}function w(C,M){var j=M||{},O=j.root||"Root Entry";if(C.FullPaths||(C.FullPaths=[]),C.FileIndex||(C.FileIndex=[]),C.FullPaths.length!==C.FileIndex.length)throw new Error("inconsistent CFB structure");C.FullPaths.length===0&&(C.FullPaths[0]=O+"/",C.FileIndex[0]={name:O,type:5}),j.CLSID&&(C.FileIndex[0].clsid=j.CLSID),E(C)}function E(C){var M="Sh33tJ5";if(!lt.find(C,"/"+M)){var j=ee(4);j[0]=55,j[1]=j[3]=50,j[2]=54,C.FileIndex.push({name:M,type:2,content:j,size:4,L:69,R:69,C:69}),C.FullPaths.push(C.FullPaths[0]+M),_(C)}}function _(C,M){w(C);for(var j=!1,O=!1,L=C.FullPaths.length-1;L>=0;--L){var B=C.FileIndex[L];switch(B.type){case 0:O?j=!0:(C.FileIndex.pop(),C.FullPaths.pop());break;case 1:case 2:case 5:O=!0,isNaN(B.R*B.L*B.C)&&(j=!0),B.R>-1&&B.L>-1&&B.R==B.L&&(j=!0);break;default:j=!0;break}}if(!(!j&&!M)){var X=new Date(1987,1,19),re=0,z=Object.create?Object.create(null):{},Q=[];for(L=0;L<C.FullPaths.length;++L)z[C.FullPaths[L]]=!0,C.FileIndex[L].type!==0&&Q.push([C.FullPaths[L],C.FileIndex[L]]);for(L=0;L<Q.length;++L){var J=n(Q[L][0]);O=z[J],O||(Q.push([J,{name:s(J).replace("/",""),type:1,clsid:me,ct:X,mt:X,content:null}]),z[J]=!0)}for(Q.sort(function(Se,fe){return r(Se[0],fe[0])}),C.FullPaths=[],C.FileIndex=[],L=0;L<Q.length;++L)C.FullPaths[L]=Q[L][0],C.FileIndex[L]=Q[L][1];for(L=0;L<Q.length;++L){var de=C.FileIndex[L],_e=C.FullPaths[L];if(de.name=s(_e).replace("/",""),de.L=de.R=de.C=-(de.color=1),de.size=de.content?de.content.length:0,de.start=0,de.clsid=de.clsid||me,L===0)de.C=Q.length>1?1:-1,de.size=0,de.type=5;else if(_e.slice(-1)=="/"){for(re=L+1;re<Q.length&&n(C.FullPaths[re])!=_e;++re);for(de.C=re>=Q.length?-1:re,re=L+1;re<Q.length&&n(C.FullPaths[re])!=n(_e);++re);de.R=re>=Q.length?-1:re,de.type=1}else n(C.FullPaths[L+1]||"")==n(_e)&&(de.R=L+1),de.type=2}}}function N(C,M){var j=M||{};if(j.fileType=="mad")return Ec(C,j);switch(_(C),j.fileType){case"zip":return St(C,j)}var O=(function(Se){for(var fe=0,Ee=0,Me=0;Me<Se.FileIndex.length;++Me){var dt=Se.FileIndex[Me];if(dt.content){var ft=dt.content.length;ft>0&&(ft<4096?fe+=ft+63>>6:Ee+=ft+511>>9)}}for(var kt=Se.FullPaths.length+3>>2,vn=fe+7>>3,yn=fe+127>>7,Bn=vn+Ee+kt+yn,en=Bn+127>>7,Qs=en<=109?0:Math.ceil((en-109)/127);Bn+en+Qs+127>>7>en;)Qs=++en<=109?0:Math.ceil((en-109)/127);var $r=[1,Qs,en,yn,kt,Ee,fe,0];return Se.FileIndex[0].size=fe<<6,$r[7]=(Se.FileIndex[0].start=$r[0]+$r[1]+$r[2]+$r[3]+$r[4]+$r[5])+($r[6]+7>>3),$r})(C),L=ee(O[7]<<9),B=0,X=0;{for(B=0;B<8;++B)L.write_shift(1,te[B]);for(B=0;B<8;++B)L.write_shift(2,0);for(L.write_shift(2,62),L.write_shift(2,3),L.write_shift(2,65534),L.write_shift(2,9),L.write_shift(2,6),B=0;B<3;++B)L.write_shift(2,0);for(L.write_shift(4,0),L.write_shift(4,O[2]),L.write_shift(4,O[0]+O[1]+O[2]+O[3]-1),L.write_shift(4,0),L.write_shift(4,4096),L.write_shift(4,O[3]?O[0]+O[1]+O[2]-1:S),L.write_shift(4,O[3]),L.write_shift(-4,O[1]?O[0]-1:S),L.write_shift(4,O[1]),B=0;B<109;++B)L.write_shift(-4,B<O[2]?O[1]+B:-1)}if(O[1])for(X=0;X<O[1];++X){for(;B<236+X*127;++B)L.write_shift(-4,B<O[2]?O[1]+B:-1);L.write_shift(-4,X===O[1]-1?S:X+1)}var re=function(Se){for(X+=Se;B<X-1;++B)L.write_shift(-4,B+1);Se&&(++B,L.write_shift(-4,S))};for(X=B=0,X+=O[1];B<X;++B)L.write_shift(-4,ce.DIFSECT);for(X+=O[2];B<X;++B)L.write_shift(-4,ce.FATSECT);re(O[3]),re(O[4]);for(var z=0,Q=0,J=C.FileIndex[0];z<C.FileIndex.length;++z)J=C.FileIndex[z],J.content&&(Q=J.content.length,!(Q<4096)&&(J.start=X,re(Q+511>>9)));for(re(O[6]+7>>3);L.l&511;)L.write_shift(-4,ce.ENDOFCHAIN);for(X=B=0,z=0;z<C.FileIndex.length;++z)J=C.FileIndex[z],J.content&&(Q=J.content.length,!(!Q||Q>=4096)&&(J.start=X,re(Q+63>>6)));for(;L.l&511;)L.write_shift(-4,ce.ENDOFCHAIN);for(B=0;B<O[4]<<2;++B){var de=C.FullPaths[B];if(!de||de.length===0){for(z=0;z<17;++z)L.write_shift(4,0);for(z=0;z<3;++z)L.write_shift(4,-1);for(z=0;z<12;++z)L.write_shift(4,0);continue}J=C.FileIndex[B],B===0&&(J.start=J.size?J.start-1:S);var _e=B===0&&j.root||J.name;if(Q=2*(_e.length+1),L.write_shift(64,_e,"utf16le"),L.write_shift(2,Q),L.write_shift(1,J.type),L.write_shift(1,J.color),L.write_shift(-4,J.L),L.write_shift(-4,J.R),L.write_shift(-4,J.C),J.clsid)L.write_shift(16,J.clsid,"hex");else for(z=0;z<4;++z)L.write_shift(4,0);L.write_shift(4,J.state||0),L.write_shift(4,0),L.write_shift(4,0),L.write_shift(4,0),L.write_shift(4,0),L.write_shift(4,J.start),L.write_shift(4,J.size),L.write_shift(4,0)}for(B=1;B<C.FileIndex.length;++B)if(J=C.FileIndex[B],J.size>=4096)if(L.l=J.start+1<<9,et&&Buffer.isBuffer(J.content))J.content.copy(L,L.l,0,J.size),L.l+=J.size+511&-512;else{for(z=0;z<J.size;++z)L.write_shift(1,J.content[z]);for(;z&511;++z)L.write_shift(1,0)}for(B=1;B<C.FileIndex.length;++B)if(J=C.FileIndex[B],J.size>0&&J.size<4096)if(et&&Buffer.isBuffer(J.content))J.content.copy(L,L.l,0,J.size),L.l+=J.size+63&-64;else{for(z=0;z<J.size;++z)L.write_shift(1,J.content[z]);for(;z&63;++z)L.write_shift(1,0)}if(et)L.l=L.length;else for(;L.l<L.length;)L.write_shift(1,0);return L}function T(C,M){var j=C.FullPaths.map(function(z){return z.toUpperCase()}),O=j.map(function(z){var Q=z.split("/");return Q[Q.length-(z.slice(-1)=="/"?2:1)]}),L=!1;M.charCodeAt(0)===47?(L=!0,M=j[0].slice(0,-1)+M):L=M.indexOf("/")!==-1;var B=M.toUpperCase(),X=L===!0?j.indexOf(B):O.indexOf(B);if(X!==-1)return C.FileIndex[X];var re=!B.match(Co);for(B=B.replace(ui,""),re&&(B=B.replace(Co,"!")),X=0;X<j.length;++X)if((re?j[X].replace(Co,"!"):j[X]).replace(ui,"")==B||(re?O[X].replace(Co,"!"):O[X]).replace(ui,"")==B)return C.FileIndex[X];return null}var R=64,S=-2,se="d0cf11e0a1b11ae1",te=[208,207,17,224,161,177,26,225],me="00000000000000000000000000000000",ce={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:S,FREESECT:-1,HEADER_SIGNATURE:se,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:me,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function le(C,M,j){u();var O=N(C,j);c.writeFileSync(M,O)}function Ae(C){for(var M=new Array(C.length),j=0;j<C.length;++j)M[j]=String.fromCharCode(C[j]);return M.join("")}function Oe(C,M){var j=N(C,M);switch(M&&M.type||"buffer"){case"file":return u(),c.writeFileSync(M.filename,j),j;case"binary":return typeof j=="string"?j:Ae(j);case"base64":return Ci(typeof j=="string"?j:Ae(j));case"buffer":if(et)return Buffer.isBuffer(j)?j:kn(j);case"array":return typeof j=="string"?qr(j):j}return j}var Je;function U(C){try{var M=C.InflateRaw,j=new M;if(j._processChunk(new Uint8Array([3,0]),j._finishFlushFlag),j.bytesRead)Je=C;else throw new Error("zlib does not expose bytesRead")}catch(O){console.error("cannot use native zlib: "+(O.message||O))}}function Y(C,M){if(!Je)return nr(C,M);var j=Je.InflateRaw,O=new j,L=O._processChunk(C.slice(C.l),O._finishFlushFlag);return C.l+=O.bytesRead,L}function q(C){return Je?Je.deflateRawSync(C):He(C)}var W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ae=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],be=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function ye(C){var M=(C<<1|C<<11)&139536|(C<<5|C<<15)&558144;return(M>>16|M>>8|M)&255}for(var pe=typeof Uint8Array<"u",xe=pe?new Uint8Array(256):[],We=0;We<256;++We)xe[We]=ye(We);function Ve(C,M){var j=xe[C&255];return M<=8?j>>>8-M:(j=j<<8|xe[C>>8&255],M<=16?j>>>16-M:(j=j<<8|xe[C>>16&255],j>>>24-M))}function nt(C,M){var j=M&7,O=M>>>3;return(C[O]|(j<=6?0:C[O+1]<<8))>>>j&3}function qe(C,M){var j=M&7,O=M>>>3;return(C[O]|(j<=5?0:C[O+1]<<8))>>>j&7}function hr(C,M){var j=M&7,O=M>>>3;return(C[O]|(j<=4?0:C[O+1]<<8))>>>j&15}function Xe(C,M){var j=M&7,O=M>>>3;return(C[O]|(j<=3?0:C[O+1]<<8))>>>j&31}function Ne(C,M){var j=M&7,O=M>>>3;return(C[O]|(j<=1?0:C[O+1]<<8))>>>j&127}function jt(C,M,j){var O=M&7,L=M>>>3,B=(1<<j)-1,X=C[L]>>>O;return j<8-O||(X|=C[L+1]<<8-O,j<16-O)||(X|=C[L+2]<<16-O,j<24-O)||(X|=C[L+3]<<24-O),X&B}function tt(C,M,j){var O=M&7,L=M>>>3;return O<=5?C[L]|=(j&7)<<O:(C[L]|=j<<O&255,C[L+1]=(j&7)>>8-O),M+3}function ct(C,M,j){var O=M&7,L=M>>>3;return j=(j&1)<<O,C[L]|=j,M+1}function dr(C,M,j){var O=M&7,L=M>>>3;return j<<=O,C[L]|=j&255,j>>>=8,C[L+1]=j,M+8}function On(C,M,j){var O=M&7,L=M>>>3;return j<<=O,C[L]|=j&255,j>>>=8,C[L+1]=j&255,C[L+2]=j>>>8,M+16}function Jr(C,M){var j=C.length,O=2*j>M?2*j:M+5,L=0;if(j>=M)return C;if(et){var B=pf(O);if(C.copy)C.copy(B);else for(;L<C.length;++L)B[L]=C[L];return B}else if(pe){var X=new Uint8Array(O);if(X.set)X.set(C);else for(;L<j;++L)X[L]=C[L];return X}return C.length=O,C}function rr(C){for(var M=new Array(C),j=0;j<C;++j)M[j]=0;return M}function xr(C,M,j){var O=1,L=0,B=0,X=0,re=0,z=C.length,Q=pe?new Uint16Array(32):rr(32);for(B=0;B<32;++B)Q[B]=0;for(B=z;B<j;++B)C[B]=0;z=C.length;var J=pe?new Uint16Array(z):rr(z);for(B=0;B<z;++B)Q[L=C[B]]++,O<L&&(O=L),J[B]=0;for(Q[0]=0,B=1;B<=O;++B)Q[B+16]=re=re+Q[B-1]<<1;for(B=0;B<z;++B)re=C[B],re!=0&&(J[B]=Q[re+16]++);var de=0;for(B=0;B<z;++B)if(de=C[B],de!=0)for(re=Ve(J[B],O)>>O-de,X=(1<<O+4-de)-1;X>=0;--X)M[re|X<<de]=de&15|B<<4;return O}var he=pe?new Uint16Array(512):rr(512),Re=pe?new Uint16Array(32):rr(32);if(!pe){for(var ue=0;ue<512;++ue)he[ue]=0;for(ue=0;ue<32;++ue)Re[ue]=0}(function(){for(var C=[],M=0;M<32;M++)C.push(5);xr(C,Re,32);var j=[];for(M=0;M<=143;M++)j.push(8);for(;M<=255;M++)j.push(9);for(;M<=279;M++)j.push(7);for(;M<=287;M++)j.push(8);xr(j,he,288)})();var ke=(function(){for(var M=pe?new Uint8Array(32768):[],j=0,O=0;j<be.length-1;++j)for(;O<be[j+1];++O)M[O]=j;for(;O<32768;++O)M[O]=29;var L=pe?new Uint8Array(259):[];for(j=0,O=0;j<ae.length-1;++j)for(;O<ae[j+1];++O)L[O]=j;function B(re,z){for(var Q=0;Q<re.length;){var J=Math.min(65535,re.length-Q),de=Q+J==re.length;for(z.write_shift(1,+de),z.write_shift(2,J),z.write_shift(2,~J&65535);J-- >0;)z[z.l++]=re[Q++]}return z.l}function X(re,z){for(var Q=0,J=0,de=pe?new Uint16Array(32768):[];J<re.length;){var _e=Math.min(65535,re.length-J);if(_e<10){for(Q=tt(z,Q,+(J+_e==re.length)),Q&7&&(Q+=8-(Q&7)),z.l=Q/8|0,z.write_shift(2,_e),z.write_shift(2,~_e&65535);_e-- >0;)z[z.l++]=re[J++];Q=z.l*8;continue}Q=tt(z,Q,+(J+_e==re.length)+2);for(var Se=0;_e-- >0;){var fe=re[J];Se=(Se<<5^fe)&32767;var Ee=-1,Me=0;if((Ee=de[Se])&&(Ee|=J&-32768,Ee>J&&(Ee-=32768),Ee<J))for(;re[Ee+Me]==re[J+Me]&&Me<250;)++Me;if(Me>2){fe=L[Me],fe<=22?Q=dr(z,Q,xe[fe+1]>>1)-1:(dr(z,Q,3),Q+=5,dr(z,Q,xe[fe-23]>>5),Q+=3);var dt=fe<8?0:fe-4>>2;dt>0&&(On(z,Q,Me-ae[fe]),Q+=dt),fe=M[J-Ee],Q=dr(z,Q,xe[fe]>>3),Q-=3;var ft=fe<4?0:fe-2>>1;ft>0&&(On(z,Q,J-Ee-be[fe]),Q+=ft);for(var kt=0;kt<Me;++kt)de[Se]=J&32767,Se=(Se<<5^re[J])&32767,++J;_e-=Me-1}else fe<=143?fe=fe+48:Q=ct(z,Q,1),Q=dr(z,Q,xe[fe]),de[Se]=J&32767,++J}Q=dr(z,Q,0)-1}return z.l=(Q+7)/8|0,z.l}return function(z,Q){return z.length<8?B(z,Q):X(z,Q)}})();function He(C){var M=ee(50+Math.floor(C.length*1.1)),j=ke(C,M);return M.slice(0,j)}var wt=pe?new Uint16Array(32768):rr(32768),yt=pe?new Uint16Array(32768):rr(32768),vr=pe?new Uint16Array(128):rr(128),Pe=1,Fe=1;function Ce(C,M){var j=Xe(C,M)+257;M+=5;var O=Xe(C,M)+1;M+=5;var L=hr(C,M)+4;M+=4;for(var B=0,X=pe?new Uint8Array(19):rr(19),re=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],z=1,Q=pe?new Uint8Array(8):rr(8),J=pe?new Uint8Array(8):rr(8),de=X.length,_e=0;_e<L;++_e)X[W[_e]]=B=qe(C,M),z<B&&(z=B),Q[B]++,M+=3;var Se=0;for(Q[0]=0,_e=1;_e<=z;++_e)J[_e]=Se=Se+Q[_e-1]<<1;for(_e=0;_e<de;++_e)(Se=X[_e])!=0&&(re[_e]=J[Se]++);var fe=0;for(_e=0;_e<de;++_e)if(fe=X[_e],fe!=0){Se=xe[re[_e]]>>8-fe;for(var Ee=(1<<7-fe)-1;Ee>=0;--Ee)vr[Se|Ee<<fe]=fe&7|_e<<3}var Me=[];for(z=1;Me.length<j+O;)switch(Se=vr[Ne(C,M)],M+=Se&7,Se>>>=3){case 16:for(B=3+nt(C,M),M+=2,Se=Me[Me.length-1];B-- >0;)Me.push(Se);break;case 17:for(B=3+qe(C,M),M+=3;B-- >0;)Me.push(0);break;case 18:for(B=11+Ne(C,M),M+=7;B-- >0;)Me.push(0);break;default:Me.push(Se),z<Se&&(z=Se);break}var dt=Me.slice(0,j),ft=Me.slice(j);for(_e=j;_e<286;++_e)dt[_e]=0;for(_e=O;_e<30;++_e)ft[_e]=0;return Pe=xr(dt,wt,286),Fe=xr(ft,yt,30),M}function Ze(C,M){if(C[0]==3&&!(C[1]&3))return[ks(M),2];for(var j=0,O=0,L=pf(M||1<<18),B=0,X=L.length>>>0,re=0,z=0;(O&1)==0;){if(O=qe(C,j),j+=3,O>>>1)O>>1==1?(re=9,z=5):(j=Ce(C,j),re=Pe,z=Fe);else{j&7&&(j+=8-(j&7));var Q=C[j>>>3]|C[(j>>>3)+1]<<8;if(j+=32,Q>0)for(!M&&X<B+Q&&(L=Jr(L,B+Q),X=L.length);Q-- >0;)L[B++]=C[j>>>3],j+=8;continue}for(;;){!M&&X<B+32767&&(L=Jr(L,B+32767),X=L.length);var J=jt(C,j,re),de=O>>>1==1?he[J]:wt[J];if(j+=de&15,de>>>=4,(de>>>8&255)===0)L[B++]=de;else{if(de==256)break;de-=257;var _e=de<8?0:de-4>>2;_e>5&&(_e=0);var Se=B+ae[de];_e>0&&(Se+=jt(C,j,_e),j+=_e),J=jt(C,j,z),de=O>>>1==1?Re[J]:yt[J],j+=de&15,de>>>=4;var fe=de<4?0:de-2>>1,Ee=be[de];for(fe>0&&(Ee+=jt(C,j,fe),j+=fe),!M&&X<Se&&(L=Jr(L,Se+100),X=L.length);B<Se;)L[B]=L[B-Ee],++B}}}return M?[L,j+7>>>3]:[L.slice(0,B),j+7>>>3]}function nr(C,M){var j=C.slice(C.l||0),O=Ze(j,M);return C.l+=O[1],O[0]}function sr(C,M){if(C)typeof console<"u"&&console.error(M);else throw new Error(M)}function vt(C,M){var j=C;Nr(j,0);var O=[],L=[],B={FileIndex:O,FullPaths:L};w(B,{root:M.root});for(var X=j.length-4;(j[X]!=80||j[X+1]!=75||j[X+2]!=5||j[X+3]!=6)&&X>=0;)--X;j.l=X+4,j.l+=4;var re=j.read_shift(2);j.l+=6;var z=j.read_shift(4);for(j.l=z,X=0;X<re;++X){j.l+=20;var Q=j.read_shift(4),J=j.read_shift(4),de=j.read_shift(2),_e=j.read_shift(2),Se=j.read_shift(2);j.l+=8;var fe=j.read_shift(4),Ee=l(j.slice(j.l+de,j.l+de+_e));j.l+=de+_e+Se;var Me=j.l;j.l=fe+4,fr(j,Q,J,B,Ee),j.l=Me}return B}function fr(C,M,j,O,L){C.l+=2;var B=C.read_shift(2),X=C.read_shift(2),re=i(C);if(B&8257)throw new Error("Unsupported ZIP encryption");for(var z=C.read_shift(4),Q=C.read_shift(4),J=C.read_shift(4),de=C.read_shift(2),_e=C.read_shift(2),Se="",fe=0;fe<de;++fe)Se+=String.fromCharCode(C[C.l++]);if(_e){var Ee=l(C.slice(C.l,C.l+_e));(Ee[21589]||{}).mt&&(re=Ee[21589].mt),((L||{})[21589]||{}).mt&&(re=L[21589].mt)}C.l+=_e;var Me=C.slice(C.l,C.l+Q);switch(X){case 8:Me=Y(C,J);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+X)}var dt=!1;B&8&&(z=C.read_shift(4),z==134695760&&(z=C.read_shift(4),dt=!0),Q=C.read_shift(4),J=C.read_shift(4)),Q!=M&&sr(dt,"Bad compressed size: "+M+" != "+Q),J!=j&&sr(dt,"Bad uncompressed size: "+j+" != "+J),Xs(O,Se,Me,{unsafe:!0,mt:re})}function St(C,M){var j=M||{},O=[],L=[],B=ee(1),X=j.compression?8:0,re=0,z=0,Q=0,J=0,de=0,_e=C.FullPaths[0],Se=_e,fe=C.FileIndex[0],Ee=[],Me=0;for(z=1;z<C.FullPaths.length;++z)if(Se=C.FullPaths[z].slice(_e.length),fe=C.FileIndex[z],!(!fe.size||!fe.content||Se=="Sh33tJ5")){var dt=J,ft=ee(Se.length);for(Q=0;Q<Se.length;++Q)ft.write_shift(1,Se.charCodeAt(Q)&127);ft=ft.slice(0,ft.l),Ee[de]=DT.buf(fe.content,0);var kt=fe.content;X==8&&(kt=q(kt)),B=ee(30),B.write_shift(4,67324752),B.write_shift(2,20),B.write_shift(2,re),B.write_shift(2,X),fe.mt?a(B,fe.mt):B.write_shift(4,0),B.write_shift(-4,Ee[de]),B.write_shift(4,kt.length),B.write_shift(4,fe.content.length),B.write_shift(2,ft.length),B.write_shift(2,0),J+=B.length,O.push(B),J+=ft.length,O.push(ft),J+=kt.length,O.push(kt),B=ee(46),B.write_shift(4,33639248),B.write_shift(2,0),B.write_shift(2,20),B.write_shift(2,re),B.write_shift(2,X),B.write_shift(4,0),B.write_shift(-4,Ee[de]),B.write_shift(4,kt.length),B.write_shift(4,fe.content.length),B.write_shift(2,ft.length),B.write_shift(2,0),B.write_shift(2,0),B.write_shift(2,0),B.write_shift(2,0),B.write_shift(4,0),B.write_shift(4,dt),Me+=B.l,L.push(B),Me+=ft.length,L.push(ft),++de}return B=ee(22),B.write_shift(4,101010256),B.write_shift(2,0),B.write_shift(2,0),B.write_shift(2,de),B.write_shift(2,de),B.write_shift(4,Me),B.write_shift(4,J),B.write_shift(2,0),Kt([Kt(O),Kt(L),B])}var Zr={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Mn(C,M){if(C.ctype)return C.ctype;var j=C.name||"",O=j.match(/\.([^\.]+)$/);return O&&Zr[O[1]]||M&&(O=(j=M).match(/[\.\\]([^\.\\])+$/),O&&Zr[O[1]])?Zr[O[1]]:"application/octet-stream"}function _s(C){for(var M=Ci(C),j=[],O=0;O<M.length;O+=76)j.push(M.slice(O,O+76));return j.join(`\r
`)+`\r
`}function _c(C){var M=C.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(Q){var J=Q.charCodeAt(0).toString(16).toUpperCase();return"="+(J.length==1?"0"+J:J)});M=M.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),M.charAt(0)==`
`&&(M="=0D"+M.slice(1)),M=M.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var j=[],O=M.split(`\r
`),L=0;L<O.length;++L){var B=O[L];if(B.length==0){j.push("");continue}for(var X=0;X<B.length;){var re=76,z=B.slice(X,X+re);z.charAt(re-1)=="="?re--:z.charAt(re-2)=="="?re-=2:z.charAt(re-3)=="="&&(re-=3),z=B.slice(X,X+re),X+=re,X<B.length&&(z+="="),j.push(z)}}return j.join(`\r
`)}function wc(C){for(var M=[],j=0;j<C.length;++j){for(var O=C[j];j<=C.length&&O.charAt(O.length-1)=="=";)O=O.slice(0,O.length-1)+C[++j];M.push(O)}for(var L=0;L<M.length;++L)M[L]=M[L].replace(/[=][0-9A-Fa-f]{2}/g,function(B){return String.fromCharCode(parseInt(B.slice(1),16))});return qr(M.join(`\r
`))}function Ln(C,M,j){for(var O="",L="",B="",X,re=0;re<10;++re){var z=M[re];if(!z||z.match(/^\s*$/))break;var Q=z.match(/^(.*?):\s*([^\s].*)$/);if(Q)switch(Q[1].toLowerCase()){case"content-location":O=Q[2].trim();break;case"content-type":B=Q[2].trim();break;case"content-transfer-encoding":L=Q[2].trim();break}}switch(++re,L.toLowerCase()){case"base64":X=qr(Pn(M.slice(re).join("")));break;case"quoted-printable":X=wc(M.slice(re));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+L)}var J=Xs(C,O.slice(j.length),X,{unsafe:!0});B&&(J.ctype=B)}function bc(C,M){if(Ae(C.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var j=M&&M.root||"",O=(et&&Buffer.isBuffer(C)?C.toString("binary"):Ae(C)).split(`\r
`),L=0,B="";for(L=0;L<O.length;++L)if(B=O[L],!!/^Content-Location:/i.test(B)&&(B=B.slice(B.indexOf("file")),j||(j=B.slice(0,B.lastIndexOf("/")+1)),B.slice(0,j.length)!=j))for(;j.length>0&&(j=j.slice(0,j.length-1),j=j.slice(0,j.lastIndexOf("/")+1),B.slice(0,j.length)!=j););var X=(O[1]||"").match(/boundary="(.*?)"/);if(!X)throw new Error("MAD cannot find boundary");var re="--"+(X[1]||""),z=[],Q=[],J={FileIndex:z,FullPaths:Q};w(J);var de,_e=0;for(L=0;L<O.length;++L){var Se=O[L];Se!==re&&Se!==re+"--"||(_e++&&Ln(J,O.slice(de,L),j),de=L)}return J}function Ec(C,M){var j=M||{},O=j.boundary||"SheetJS";O="------="+O;for(var L=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+O.slice(2)+'"',"","",""],B=C.FullPaths[0],X=B,re=C.FileIndex[0],z=1;z<C.FullPaths.length;++z)if(X=C.FullPaths[z].slice(B.length),re=C.FileIndex[z],!(!re.size||!re.content||X=="Sh33tJ5")){X=X.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(Me){return"_x"+Me.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(Me){return"_u"+Me.charCodeAt(0).toString(16)+"_"});for(var Q=re.content,J=et&&Buffer.isBuffer(Q)?Q.toString("binary"):Ae(Q),de=0,_e=Math.min(1024,J.length),Se=0,fe=0;fe<=_e;++fe)(Se=J.charCodeAt(fe))>=32&&Se<128&&++de;var Ee=de>=_e*4/5;L.push(O),L.push("Content-Location: "+(j.root||"file:///C:/SheetJS/")+X),L.push("Content-Transfer-Encoding: "+(Ee?"quoted-printable":"base64")),L.push("Content-Type: "+Mn(re,X)),L.push(""),L.push(Ee?_c(J):_s(J))}return L.push(O+`--\r
`),L.join(`\r
`)}function Ks(C){var M={};return w(M,C),M}function Xs(C,M,j,O){var L=O&&O.unsafe;L||w(C);var B=!L&&lt.find(C,M);if(!B){var X=C.FullPaths[0];M.slice(0,X.length)==X?X=M:(X.slice(-1)!="/"&&(X+="/"),X=(X+M).replace("//","/")),B={name:s(M),type:2},C.FileIndex.push(B),C.FullPaths.push(X),L||lt.utils.cfb_gc(C)}return B.content=j,B.size=j?j.length:0,O&&(O.CLSID&&(B.clsid=O.CLSID),O.mt&&(B.mt=O.mt),O.ct&&(B.ct=O.ct)),B}function ho(C,M){w(C);var j=lt.find(C,M);if(j){for(var O=0;O<C.FileIndex.length;++O)if(C.FileIndex[O]==j)return C.FileIndex.splice(O,1),C.FullPaths.splice(O,1),!0}return!1}function Wa(C,M,j){w(C);var O=lt.find(C,M);if(O){for(var L=0;L<C.FileIndex.length;++L)if(C.FileIndex[L]==O)return C.FileIndex[L].name=s(j),C.FullPaths[L]=j,!0}return!1}function ws(C){_(C,!0)}return e.find=T,e.read=H,e.parse=h,e.write=Oe,e.writeFile=le,e.utils={cfb_new:Ks,cfb_add:Xs,cfb_del:ho,cfb_mov:Wa,cfb_gc:ws,ReadShift:di,CheckField:Eg,prep_blob:Nr,bconcat:Kt,use_zlib:U,_deflateRaw:He,_inflateRaw:nr,consts:ce},e})();function FT(t){return typeof t=="string"?Kl(t):Array.isArray(t)?aT(t):t}function Qi(t,e,r){if(typeof Deno<"u"){if(r&&typeof e=="string")switch(r){case"utf8":e=new TextEncoder(r).encode(e);break;case"binary":e=Kl(e);break;default:throw new Error("Unsupported encoding "+r)}return Deno.writeFileSync(t,e)}var n=r=="utf8"?Pi(e):e;if(typeof IE_SaveFile<"u")return IE_SaveFile(n,t);if(typeof Blob<"u"){var s=new Blob([FT(n)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(s,t);if(typeof saveAs<"u")return saveAs(s,t);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var a=URL.createObjectURL(s);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(a)},6e4),chrome.downloads.download({url:a,filename:t,saveAs:!0});var i=document.createElement("a");if(i.download!=null)return i.download=t,i.href=a,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(a)},6e4),a}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var l=File(t);return l.open("w"),l.encoding="binary",Array.isArray(e)&&(e=Xi(e)),l.write(e),l.close(),e}catch(c){if(!c.message||!c.message.match(/onstruct/))throw c}throw new Error("cannot save file "+t)}function Zt(t){for(var e=Object.keys(t),r=[],n=0;n<e.length;++n)Object.prototype.hasOwnProperty.call(t,e[n])&&r.push(e[n]);return r}function Ef(t,e){for(var r=[],n=Zt(t),s=0;s!==n.length;++s)r[t[n[s]][e]]==null&&(r[t[n[s]][e]]=n[s]);return r}function sh(t){for(var e=[],r=Zt(t),n=0;n!==r.length;++n)e[t[r[n]]]=r[n];return e}function Jl(t){for(var e=[],r=Zt(t),n=0;n!==r.length;++n)e[t[r[n]]]=parseInt(r[n],10);return e}function jT(t){for(var e=[],r=Zt(t),n=0;n!==r.length;++n)e[t[r[n]]]==null&&(e[t[r[n]]]=[]),e[t[r[n]]].push(r[n]);return e}var ul=new Date(1899,11,30,0,0,0);function br(t,e){var r=t.getTime(),n=ul.getTime()+(t.getTimezoneOffset()-ul.getTimezoneOffset())*6e4;return(r-n)/(1440*60*1e3)}var ig=new Date,kT=ul.getTime()+(ig.getTimezoneOffset()-ul.getTimezoneOffset())*6e4,Tf=ig.getTimezoneOffset();function og(t){var e=new Date;return e.setTime(t*24*60*60*1e3+kT),e.getTimezoneOffset()!==Tf&&e.setTime(e.getTime()+(e.getTimezoneOffset()-Tf)*6e4),e}var Af=new Date("2017-02-19T19:06:09.000Z"),lg=isNaN(Af.getFullYear())?new Date("2/19/17"):Af,OT=lg.getFullYear()==2017;function gr(t,e){var r=new Date(t);if(OT)return e>0?r.setTime(r.getTime()+r.getTimezoneOffset()*60*1e3):e<0&&r.setTime(r.getTime()-r.getTimezoneOffset()*60*1e3),r;if(t instanceof Date)return t;if(lg.getFullYear()==1917&&!isNaN(r.getFullYear())){var n=r.getFullYear();return t.indexOf(""+n)>-1||r.setFullYear(r.getFullYear()+100),r}var s=t.match(/\d+/g)||["2017","2","19","0","0","0"],a=new Date(+s[0],+s[1]-1,+s[2],+s[3]||0,+s[4]||0,+s[5]||0);return t.indexOf("Z")>-1&&(a=new Date(a.getTime()-a.getTimezoneOffset()*60*1e3)),a}function Zl(t,e){if(et&&Buffer.isBuffer(t))return t.toString("binary");if(typeof TextDecoder<"u")try{var r={"":"","":"",:"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"","":"","":"","":"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"",:""};return Array.isArray(t)&&(t=new Uint8Array(t)),new TextDecoder("latin1").decode(t).replace(/[]/g,function(a){return r[a]||a})}catch{}for(var n=[],s=0;s!=t.length;++s)n.push(String.fromCharCode(t[s]));return n.join("")}function Er(t){if(typeof JSON<"u"&&!Array.isArray(t))return JSON.parse(JSON.stringify(t));if(typeof t!="object"||t==null)return t;if(t instanceof Date)return new Date(t.getTime());var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=Er(t[r]));return e}function Et(t,e){for(var r="";r.length<e;)r+=t;return r}function Tn(t){var e=Number(t);if(!isNaN(e))return isFinite(e)?e:NaN;if(!/\d/.test(t))return e;var r=1,n=t.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return r*=100,""});return!isNaN(e=Number(n))||(n=n.replace(/[(](.*)[)]/,function(s,a){return r=-r,a}),!isNaN(e=Number(n)))?e/r:e}var MT=["january","february","march","april","may","june","july","august","september","october","november","december"];function Ii(t){var e=new Date(t),r=new Date(NaN),n=e.getYear(),s=e.getMonth(),a=e.getDate();if(isNaN(a))return r;var i=t.toLowerCase();if(i.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(i=i.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),i.length>3&&MT.indexOf(i)==-1)return r}else if(i.match(/[a-z]/))return r;return n<0||n>8099?r:(s>0||a>1)&&n!=101?e:t.match(/[^-0-9:,\/\\]/)?r:e}function $e(t,e,r){if(t.FullPaths){if(typeof r=="string"){var n;return et?n=kn(r):n=iT(r),lt.utils.cfb_add(t,e,n)}lt.utils.cfb_add(t,e,r)}else t.file(e,r)}function ah(){return lt.utils.cfb_new()}var Ft=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,LT={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},ih=sh(LT),oh=/[&<>'"]/g,BT=/[\u0000-\u0008\u000b-\u001f]/g;function it(t){var e=t+"";return e.replace(oh,function(r){return ih[r]}).replace(BT,function(r){return"_x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+"_"})}function Sf(t){return it(t).replace(/ /g,"_x0020_")}var cg=/[\u0000-\u001f]/g;function VT(t){var e=t+"";return e.replace(oh,function(r){return ih[r]}).replace(/\n/g,"<br/>").replace(cg,function(r){return"&#x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+";"})}function UT(t){var e=t+"";return e.replace(oh,function(r){return ih[r]}).replace(cg,function(r){return"&#x"+r.charCodeAt(0).toString(16).toUpperCase()+";"})}function $T(t){return t.replace(/(\r\n|[\r\n])/g,"&#10;")}function HT(t){switch(t){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function Oc(t){for(var e="",r=0,n=0,s=0,a=0,i=0,l=0;r<t.length;){if(n=t.charCodeAt(r++),n<128){e+=String.fromCharCode(n);continue}if(s=t.charCodeAt(r++),n>191&&n<224){i=(n&31)<<6,i|=s&63,e+=String.fromCharCode(i);continue}if(a=t.charCodeAt(r++),n<240){e+=String.fromCharCode((n&15)<<12|(s&63)<<6|a&63);continue}i=t.charCodeAt(r++),l=((n&7)<<18|(s&63)<<12|(a&63)<<6|i&63)-65536,e+=String.fromCharCode(55296+(l>>>10&1023)),e+=String.fromCharCode(56320+(l&1023))}return e}function Nf(t){var e=ks(2*t.length),r,n,s=1,a=0,i=0,l;for(n=0;n<t.length;n+=s)s=1,(l=t.charCodeAt(n))<128?r=l:l<224?(r=(l&31)*64+(t.charCodeAt(n+1)&63),s=2):l<240?(r=(l&15)*4096+(t.charCodeAt(n+1)&63)*64+(t.charCodeAt(n+2)&63),s=3):(s=4,r=(l&7)*262144+(t.charCodeAt(n+1)&63)*4096+(t.charCodeAt(n+2)&63)*64+(t.charCodeAt(n+3)&63),r-=65536,i=55296+(r>>>10&1023),r=56320+(r&1023)),i!==0&&(e[a++]=i&255,e[a++]=i>>>8,i=0),e[a++]=r%256,e[a++]=r>>>8;return e.slice(0,a).toString("ucs2")}function Cf(t){return kn(t,"binary").toString("utf8")}var Po="foo bar baz",hi=et&&(Cf(Po)==Oc(Po)&&Cf||Nf(Po)==Oc(Po)&&Nf)||Oc,Pi=et?function(t){return kn(t,"utf8").toString("binary")}:function(t){for(var e=[],r=0,n=0,s=0;r<t.length;)switch(n=t.charCodeAt(r++),!0){case n<128:e.push(String.fromCharCode(n));break;case n<2048:e.push(String.fromCharCode(192+(n>>6))),e.push(String.fromCharCode(128+(n&63)));break;case(n>=55296&&n<57344):n-=55296,s=t.charCodeAt(r++)-56320+(n<<10),e.push(String.fromCharCode(240+(s>>18&7))),e.push(String.fromCharCode(144+(s>>12&63))),e.push(String.fromCharCode(128+(s>>6&63))),e.push(String.fromCharCode(128+(s&63)));break;default:e.push(String.fromCharCode(224+(n>>12))),e.push(String.fromCharCode(128+(n>>6&63))),e.push(String.fromCharCode(128+(n&63)))}return e.join("")},WT=(function(){var t=[["nbsp"," "],["middot",""],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(e){return[new RegExp("&"+e[0]+";","ig"),e[1]]});return function(r){for(var n=r.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),s=0;s<t.length;++s)n=n.replace(t[s][0],t[s][1]);return n}})(),ug=/(^\s|\s$|\n)/;function Xt(t,e){return"<"+t+(e.match(ug)?' xml:space="preserve"':"")+">"+e+"</"+t+">"}function Ri(t){return Zt(t).map(function(e){return" "+e+'="'+t[e]+'"'}).join("")}function ge(t,e,r){return"<"+t+(r!=null?Ri(r):"")+(e!=null?(e.match(ug)?' xml:space="preserve"':"")+">"+e+"</"+t:"/")+">"}function fu(t,e){try{return t.toISOString().replace(/\.\d*/,"")}catch(r){if(e)throw r}return""}function qT(t,e){switch(typeof t){case"string":var r=ge("vt:lpwstr",it(t));return r=r.replace(/&quot;/g,"_x0022_"),r;case"number":return ge((t|0)==t?"vt:i4":"vt:r8",it(String(t)));case"boolean":return ge("vt:bool",t?"true":"false")}if(t instanceof Date)return ge("vt:filetime",fu(t));throw new Error("Unable to serialize "+t)}var $t={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},ja=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],Ir={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function GT(t,e){for(var r=1-2*(t[e+7]>>>7),n=((t[e+7]&127)<<4)+(t[e+6]>>>4&15),s=t[e+6]&15,a=5;a>=0;--a)s=s*256+t[e+a];return n==2047?s==0?r*(1/0):NaN:(n==0?n=-1022:(n-=1023,s+=Math.pow(2,52)),r*Math.pow(2,n-52)*s)}function zT(t,e,r){var n=(e<0||1/e==-1/0?1:0)<<7,s=0,a=0,i=n?-e:e;isFinite(i)?i==0?s=a=0:(s=Math.floor(Math.log(i)/Math.LN2),a=i*Math.pow(2,52-s),s<=-1023&&(!isFinite(a)||a<Math.pow(2,52))?s=-1022:(a-=Math.pow(2,52),s+=1023)):(s=2047,a=isNaN(e)?26985:0);for(var l=0;l<=5;++l,a/=256)t[r+l]=a&255;t[r+6]=(s&15)<<4|a&15,t[r+7]=s>>4|n}var If=function(t){for(var e=[],r=10240,n=0;n<t[0].length;++n)if(t[0][n])for(var s=0,a=t[0][n].length;s<a;s+=r)e.push.apply(e,t[0][n].slice(s,s+r));return e},Pf=et?function(t){return t[0].length>0&&Buffer.isBuffer(t[0][0])?Buffer.concat(t[0].map(function(e){return Buffer.isBuffer(e)?e:kn(e)})):If(t)}:If,Rf=function(t,e,r){for(var n=[],s=e;s<r;s+=2)n.push(String.fromCharCode(si(t,s)));return n.join("").replace(ui,"")},lh=et?function(t,e,r){return Buffer.isBuffer(t)?t.toString("utf16le",e,r).replace(ui,""):Rf(t,e,r)}:Rf,Df=function(t,e,r){for(var n=[],s=e;s<e+r;++s)n.push(("0"+t[s].toString(16)).slice(-2));return n.join("")},hg=et?function(t,e,r){return Buffer.isBuffer(t)?t.toString("hex",e,e+r):Df(t,e,r)}:Df,Ff=function(t,e,r){for(var n=[],s=e;s<r;s++)n.push(String.fromCharCode(aa(t,s)));return n.join("")},Ji=et?function(e,r,n){return Buffer.isBuffer(e)?e.toString("utf8",r,n):Ff(e,r,n)}:Ff,dg=function(t,e){var r=Pr(t,e);return r>0?Ji(t,e+4,e+4+r-1):""},fg=dg,mg=function(t,e){var r=Pr(t,e);return r>0?Ji(t,e+4,e+4+r-1):""},pg=mg,gg=function(t,e){var r=2*Pr(t,e);return r>0?Ji(t,e+4,e+4+r-1):""},xg=gg,vg=function(e,r){var n=Pr(e,r);return n>0?lh(e,r+4,r+4+n):""},yg=vg,_g=function(t,e){var r=Pr(t,e);return r>0?Ji(t,e+4,e+4+r):""},wg=_g,bg=function(t,e){return GT(t,e)},hl=bg,ch=function(e){return Array.isArray(e)||typeof Uint8Array<"u"&&e instanceof Uint8Array};et&&(fg=function(e,r){if(!Buffer.isBuffer(e))return dg(e,r);var n=e.readUInt32LE(r);return n>0?e.toString("utf8",r+4,r+4+n-1):""},pg=function(e,r){if(!Buffer.isBuffer(e))return mg(e,r);var n=e.readUInt32LE(r);return n>0?e.toString("utf8",r+4,r+4+n-1):""},xg=function(e,r){if(!Buffer.isBuffer(e))return gg(e,r);var n=2*e.readUInt32LE(r);return e.toString("utf16le",r+4,r+4+n-1)},yg=function(e,r){if(!Buffer.isBuffer(e))return vg(e,r);var n=e.readUInt32LE(r);return e.toString("utf16le",r+4,r+4+n)},wg=function(e,r){if(!Buffer.isBuffer(e))return _g(e,r);var n=e.readUInt32LE(r);return e.toString("utf8",r+4,r+4+n)},hl=function(e,r){return Buffer.isBuffer(e)?e.readDoubleLE(r):bg(e,r)},ch=function(e){return Buffer.isBuffer(e)||Array.isArray(e)||typeof Uint8Array<"u"&&e instanceof Uint8Array});var aa=function(t,e){return t[e]},si=function(t,e){return t[e+1]*256+t[e]},YT=function(t,e){var r=t[e+1]*256+t[e];return r<32768?r:(65535-r+1)*-1},Pr=function(t,e){return t[e+3]*(1<<24)+(t[e+2]<<16)+(t[e+1]<<8)+t[e]},Ns=function(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]},KT=function(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]};function di(t,e){var r="",n,s,a=[],i,l,c,u;switch(e){case"dbcs":if(u=this.l,et&&Buffer.isBuffer(this))r=this.slice(this.l,this.l+2*t).toString("utf16le");else for(c=0;c<t;++c)r+=String.fromCharCode(si(this,u)),u+=2;t*=2;break;case"utf8":r=Ji(this,this.l,this.l+t);break;case"utf16le":t*=2,r=lh(this,this.l,this.l+t);break;case"wstr":return di.call(this,t,"dbcs");case"lpstr-ansi":r=fg(this,this.l),t=4+Pr(this,this.l);break;case"lpstr-cp":r=pg(this,this.l),t=4+Pr(this,this.l);break;case"lpwstr":r=xg(this,this.l),t=4+2*Pr(this,this.l);break;case"lpp4":t=4+Pr(this,this.l),r=yg(this,this.l),t&2&&(t+=2);break;case"8lpp4":t=4+Pr(this,this.l),r=wg(this,this.l),t&3&&(t+=4-(t&3));break;case"cstr":for(t=0,r="";(i=aa(this,this.l+t++))!==0;)a.push(No(i));r=a.join("");break;case"_wstr":for(t=0,r="";(i=si(this,this.l+t))!==0;)a.push(No(i)),t+=2;t+=2,r=a.join("");break;case"dbcs-cont":for(r="",u=this.l,c=0;c<t;++c){if(this.lens&&this.lens.indexOf(u)!==-1)return i=aa(this,u),this.l=u+1,l=di.call(this,t-c,i?"dbcs-cont":"sbcs-cont"),a.join("")+l;a.push(No(si(this,u))),u+=2}r=a.join(""),t*=2;break;case"cpstr":case"sbcs-cont":for(r="",u=this.l,c=0;c!=t;++c){if(this.lens&&this.lens.indexOf(u)!==-1)return i=aa(this,u),this.l=u+1,l=di.call(this,t-c,i?"dbcs-cont":"sbcs-cont"),a.join("")+l;a.push(No(aa(this,u))),u+=1}r=a.join("");break;default:switch(t){case 1:return n=aa(this,this.l),this.l++,n;case 2:return n=(e==="i"?YT:si)(this,this.l),this.l+=2,n;case 4:case-4:return e==="i"||(this[this.l+3]&128)===0?(n=(t>0?Ns:KT)(this,this.l),this.l+=4,n):(s=Pr(this,this.l),this.l+=4,s);case 8:case-8:if(e==="f")return t==8?s=hl(this,this.l):s=hl([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,s;t=8;case 16:r=hg(this,this.l,t);break}}return this.l+=t,r}var XT=function(t,e,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24&255},QT=function(t,e,r){t[r]=e&255,t[r+1]=e>>8&255,t[r+2]=e>>16&255,t[r+3]=e>>24&255},JT=function(t,e,r){t[r]=e&255,t[r+1]=e>>>8&255};function ZT(t,e,r){var n=0,s=0;if(r==="dbcs"){for(s=0;s!=e.length;++s)JT(this,e.charCodeAt(s),this.l+2*s);n=2*e.length}else if(r==="sbcs"){for(e=e.replace(/[^\x00-\x7F]/g,"_"),s=0;s!=e.length;++s)this[this.l+s]=e.charCodeAt(s)&255;n=e.length}else if(r==="hex"){for(;s<t;++s)this[this.l++]=parseInt(e.slice(2*s,2*s+2),16)||0;return this}else if(r==="utf16le"){var a=Math.min(this.l+t,this.length);for(s=0;s<Math.min(e.length,t);++s){var i=e.charCodeAt(s);this[this.l++]=i&255,this[this.l++]=i>>8}for(;this.l<a;)this[this.l++]=0;return this}else switch(t){case 1:n=1,this[this.l]=e&255;break;case 2:n=2,this[this.l]=e&255,e>>>=8,this[this.l+1]=e&255;break;case 3:n=3,this[this.l]=e&255,e>>>=8,this[this.l+1]=e&255,e>>>=8,this[this.l+2]=e&255;break;case 4:n=4,XT(this,e,this.l);break;case 8:if(n=8,r==="f"){zT(this,e,this.l);break}case 16:break;case-4:n=4,QT(this,e,this.l);break}return this.l+=n,this}function Eg(t,e){var r=hg(this,this.l,t.length>>1);if(r!==t)throw new Error(e+"Expected "+t+" saw "+r);this.l+=t.length>>1}function Nr(t,e){t.l=e,t.read_shift=di,t.chk=Eg,t.write_shift=ZT}function pn(t,e){t.l+=e}function ee(t){var e=ks(t);return Nr(e,0),e}function wr(){var t=[],e=et?256:2048,r=function(u){var h=ee(u);return Nr(h,0),h},n=r(e),s=function(){n&&(n.length>n.l&&(n=n.slice(0,n.l),n.l=n.length),n.length>0&&t.push(n),n=null)},a=function(u){return n&&u<n.length-n.l?n:(s(),n=r(Math.max(u+1,e)))},i=function(){return s(),Kt(t)},l=function(u){s(),n=u,n.l==null&&(n.l=n.length),a(e)};return{next:a,push:l,end:i,_bufs:t}}function oe(t,e,r,n){var s=+e,a;if(!isNaN(s)){n||(n=GI[s].p||(r||[]).length||0),a=1+(s>=128?1:0)+1,n>=128&&++a,n>=16384&&++a,n>=2097152&&++a;var i=t.next(a);s<=127?i.write_shift(1,s):(i.write_shift(1,(s&127)+128),i.write_shift(1,s>>7));for(var l=0;l!=4;++l)if(n>=128)i.write_shift(1,(n&127)+128),n>>=7;else{i.write_shift(1,n);break}n>0&&ch(r)&&t.push(r)}}function fi(t,e,r){var n=Er(t);if(e.s?(n.cRel&&(n.c+=e.s.c),n.rRel&&(n.r+=e.s.r)):(n.cRel&&(n.c+=e.c),n.rRel&&(n.r+=e.r)),!r||r.biff<12){for(;n.c>=256;)n.c-=256;for(;n.r>=65536;)n.r-=65536}return n}function jf(t,e,r){var n=Er(t);return n.s=fi(n.s,e.s,r),n.e=fi(n.e,e.s,r),n}function mi(t,e){if(t.cRel&&t.c<0)for(t=Er(t);t.c<0;)t.c+=e>8?16384:256;if(t.rRel&&t.r<0)for(t=Er(t);t.r<0;)t.r+=e>8?1048576:e>5?65536:16384;var r=ot(t);return!t.cRel&&t.cRel!=null&&(r=rA(r)),!t.rRel&&t.rRel!=null&&(r=eA(r)),r}function Mc(t,e){return t.s.r==0&&!t.s.rRel&&t.e.r==(e.biff>=12?1048575:e.biff>=8?65536:16384)&&!t.e.rRel?(t.s.cRel?"":"$")+cr(t.s.c)+":"+(t.e.cRel?"":"$")+cr(t.e.c):t.s.c==0&&!t.s.cRel&&t.e.c==(e.biff>=12?16383:255)&&!t.e.cRel?(t.s.rRel?"":"$")+Jt(t.s.r)+":"+(t.e.rRel?"":"$")+Jt(t.e.r):mi(t.s,e.biff)+":"+mi(t.e,e.biff)}function uh(t){return parseInt(tA(t),10)-1}function Jt(t){return""+(t+1)}function eA(t){return t.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function tA(t){return t.replace(/\$(\d+)$/,"$1")}function hh(t){for(var e=nA(t),r=0,n=0;n!==e.length;++n)r=26*r+e.charCodeAt(n)-64;return r-1}function cr(t){if(t<0)throw new Error("invalid column "+t);var e="";for(++t;t;t=Math.floor((t-1)/26))e=String.fromCharCode((t-1)%26+65)+e;return e}function rA(t){return t.replace(/^([A-Z])/,"$$$1")}function nA(t){return t.replace(/^\$([A-Z])/,"$1")}function sA(t){return t.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function Ht(t){for(var e=0,r=0,n=0;n<t.length;++n){var s=t.charCodeAt(n);s>=48&&s<=57?e=10*e+(s-48):s>=65&&s<=90&&(r=26*r+(s-64))}return{c:r-1,r:e-1}}function ot(t){for(var e=t.c+1,r="";e;e=(e-1)/26|0)r=String.fromCharCode((e-1)%26+65)+r;return r+(t.r+1)}function kr(t){var e=t.indexOf(":");return e==-1?{s:Ht(t),e:Ht(t)}:{s:Ht(t.slice(0,e)),e:Ht(t.slice(e+1))}}function Dt(t,e){return typeof e>"u"||typeof e=="number"?Dt(t.s,t.e):(typeof t!="string"&&(t=ot(t)),typeof e!="string"&&(e=ot(e)),t==e?t:t+":"+e)}function xt(t){var e={s:{c:0,r:0},e:{c:0,r:0}},r=0,n=0,s=0,a=t.length;for(r=0;n<a&&!((s=t.charCodeAt(n)-64)<1||s>26);++n)r=26*r+s;for(e.s.c=--r,r=0;n<a&&!((s=t.charCodeAt(n)-48)<0||s>9);++n)r=10*r+s;if(e.s.r=--r,n===a||s!=10)return e.e.c=e.s.c,e.e.r=e.s.r,e;for(++n,r=0;n!=a&&!((s=t.charCodeAt(n)-64)<1||s>26);++n)r=26*r+s;for(e.e.c=--r,r=0;n!=a&&!((s=t.charCodeAt(n)-48)<0||s>9);++n)r=10*r+s;return e.e.r=--r,e}function kf(t,e){var r=t.t=="d"&&e instanceof Date;if(t.z!=null)try{return t.w=ns(t.z,r?br(e):e)}catch{}try{return t.w=ns((t.XF||{}).numFmtId||(r?14:0),r?br(e):e)}catch{return""+e}}function Rn(t,e,r){return t==null||t.t==null||t.t=="z"?"":t.w!==void 0?t.w:(t.t=="d"&&!t.z&&r&&r.dateNF&&(t.z=r.dateNF),t.t=="e"?Zi[t.v]||t.v:e==null?kf(t,t.v):kf(t,e))}function $s(t,e){var r=e&&e.sheet?e.sheet:"Sheet1",n={};return n[r]=t,{SheetNames:[r],Sheets:n}}function Tg(t,e,r){var n=r||{},s=t?Array.isArray(t):n.dense,a=t||(s?[]:{}),i=0,l=0;if(a&&n.origin!=null){if(typeof n.origin=="number")i=n.origin;else{var c=typeof n.origin=="string"?Ht(n.origin):n.origin;i=c.r,l=c.c}a["!ref"]||(a["!ref"]="A1:A1")}var u={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(a["!ref"]){var h=xt(a["!ref"]);u.s.c=h.s.c,u.s.r=h.s.r,u.e.c=Math.max(u.e.c,h.e.c),u.e.r=Math.max(u.e.r,h.e.r),i==-1&&(u.e.r=i=h.e.r+1)}for(var f=0;f!=e.length;++f)if(e[f]){if(!Array.isArray(e[f]))throw new Error("aoa_to_sheet expects an array of arrays");for(var m=0;m!=e[f].length;++m)if(!(typeof e[f][m]>"u")){var p={v:e[f][m]},x=i+f,g=l+m;if(u.s.r>x&&(u.s.r=x),u.s.c>g&&(u.s.c=g),u.e.r<x&&(u.e.r=x),u.e.c<g&&(u.e.c=g),e[f][m]&&typeof e[f][m]=="object"&&!Array.isArray(e[f][m])&&!(e[f][m]instanceof Date))p=e[f][m];else if(Array.isArray(p.v)&&(p.f=e[f][m][1],p.v=p.v[0]),p.v===null)if(p.f)p.t="n";else if(n.nullError)p.t="e",p.v=0;else if(n.sheetStubs)p.t="z";else continue;else typeof p.v=="number"?p.t="n":typeof p.v=="boolean"?p.t="b":p.v instanceof Date?(p.z=n.dateNF||At[14],n.cellDates?(p.t="d",p.w=ns(p.z,br(p.v))):(p.t="n",p.v=br(p.v),p.w=ns(p.z,p.v))):p.t="s";if(s)a[x]||(a[x]=[]),a[x][g]&&a[x][g].z&&(p.z=a[x][g].z),a[x][g]=p;else{var y=ot({c:g,r:x});a[y]&&a[y].z&&(p.z=a[y].z),a[y]=p}}}return u.s.c<1e7&&(a["!ref"]=Dt(u)),a}function ka(t,e){return Tg(null,t,e)}function aA(t){return t.read_shift(4,"i")}function Yr(t,e){return e||(e=ee(4)),e.write_shift(4,t),e}function ur(t){var e=t.read_shift(4);return e===0?"":t.read_shift(e,"dbcs")}function Wt(t,e){var r=!1;return e==null&&(r=!0,e=ee(4+2*t.length)),e.write_shift(4,t.length),t.length>0&&e.write_shift(0,t,"dbcs"),r?e.slice(0,e.l):e}function iA(t){return{ich:t.read_shift(2),ifnt:t.read_shift(2)}}function oA(t,e){return e||(e=ee(4)),e.write_shift(2,0),e.write_shift(2,0),e}function dh(t,e){var r=t.l,n=t.read_shift(1),s=ur(t),a=[],i={t:s,h:s};if((n&1)!==0){for(var l=t.read_shift(4),c=0;c!=l;++c)a.push(iA(t));i.r=a}else i.r=[{ich:0,ifnt:0}];return t.l=r+e,i}function lA(t,e){var r=!1;return e==null&&(r=!0,e=ee(15+4*t.t.length)),e.write_shift(1,0),Wt(t.t,e),r?e.slice(0,e.l):e}var cA=dh;function uA(t,e){var r=!1;return e==null&&(r=!0,e=ee(23+4*t.t.length)),e.write_shift(1,1),Wt(t.t,e),e.write_shift(4,1),oA({},e),r?e.slice(0,e.l):e}function Ur(t){var e=t.read_shift(4),r=t.read_shift(2);return r+=t.read_shift(1)<<16,t.l++,{c:e,iStyleRef:r}}function Hs(t,e){return e==null&&(e=ee(8)),e.write_shift(-4,t.c),e.write_shift(3,t.iStyleRef||t.s),e.write_shift(1,0),e}function Ws(t){var e=t.read_shift(2);return e+=t.read_shift(1)<<16,t.l++,{c:-1,iStyleRef:e}}function qs(t,e){return e==null&&(e=ee(4)),e.write_shift(3,t.iStyleRef||t.s),e.write_shift(1,0),e}var hA=ur,Ag=Wt;function fh(t){var e=t.read_shift(4);return e===0||e===4294967295?"":t.read_shift(e,"dbcs")}function dl(t,e){var r=!1;return e==null&&(r=!0,e=ee(127)),e.write_shift(4,t.length>0?t.length:4294967295),t.length>0&&e.write_shift(0,t,"dbcs"),r?e.slice(0,e.l):e}var dA=ur,mu=fh,mh=dl;function Sg(t){var e=t.slice(t.l,t.l+4),r=e[0]&1,n=e[0]&2;t.l+=4;var s=n===0?hl([0,0,0,0,e[0]&252,e[1],e[2],e[3]],0):Ns(e,0)>>2;return r?s/100:s}function Ng(t,e){e==null&&(e=ee(4));var r=0,n=0,s=t*100;if(t==(t|0)&&t>=-536870912&&t<1<<29?n=1:s==(s|0)&&s>=-536870912&&s<1<<29&&(n=1,r=1),n)e.write_shift(-4,((r?s:t)<<2)+(r+2));else throw new Error("unsupported RkNumber "+t)}function Cg(t){var e={s:{},e:{}};return e.s.r=t.read_shift(4),e.e.r=t.read_shift(4),e.s.c=t.read_shift(4),e.e.c=t.read_shift(4),e}function fA(t,e){return e||(e=ee(16)),e.write_shift(4,t.s.r),e.write_shift(4,t.e.r),e.write_shift(4,t.s.c),e.write_shift(4,t.e.c),e}var Gs=Cg,Oa=fA;function Ma(t){if(t.length-t.l<8)throw"XLS Xnum Buffer underflow";return t.read_shift(8,"f")}function Os(t,e){return(e||ee(8)).write_shift(8,t,"f")}function mA(t){var e={},r=t.read_shift(1),n=r>>>1,s=t.read_shift(1),a=t.read_shift(2,"i"),i=t.read_shift(1),l=t.read_shift(1),c=t.read_shift(1);switch(t.l++,n){case 0:e.auto=1;break;case 1:e.index=s;var u=EA[s];u&&(e.rgb=Gf(u));break;case 2:e.rgb=Gf([i,l,c]);break;case 3:e.theme=s;break}return a!=0&&(e.tint=a>0?a/32767:a/32768),e}function fl(t,e){if(e||(e=ee(8)),!t||t.auto)return e.write_shift(4,0),e.write_shift(4,0),e;t.index!=null?(e.write_shift(1,2),e.write_shift(1,t.index)):t.theme!=null?(e.write_shift(1,6),e.write_shift(1,t.theme)):(e.write_shift(1,5),e.write_shift(1,0));var r=t.tint||0;if(r>0?r*=32767:r<0&&(r*=32768),e.write_shift(2,r),!t.rgb||t.theme!=null)e.write_shift(2,0),e.write_shift(1,0),e.write_shift(1,0);else{var n=t.rgb||"FFFFFF";typeof n=="number"&&(n=("000000"+n.toString(16)).slice(-6)),e.write_shift(1,parseInt(n.slice(0,2),16)),e.write_shift(1,parseInt(n.slice(2,4),16)),e.write_shift(1,parseInt(n.slice(4,6),16)),e.write_shift(1,255)}return e}function pA(t){var e=t.read_shift(1);t.l++;var r={fBold:e&1,fItalic:e&2,fUnderline:e&4,fStrikeout:e&8,fOutline:e&16,fShadow:e&32,fCondense:e&64,fExtend:e&128};return r}function gA(t,e){e||(e=ee(2));var r=(t.italic?2:0)|(t.strike?8:0)|(t.outline?16:0)|(t.shadow?32:0)|(t.condense?64:0)|(t.extend?128:0);return e.write_shift(1,r),e.write_shift(1,0),e}var Ig=2,Sr=3,Ro=11,ml=19,Do=64,xA=65,vA=71,yA=4108,_A=4126,zt=80,Of={1:{n:"CodePage",t:Ig},2:{n:"Category",t:zt},3:{n:"PresentationFormat",t:zt},4:{n:"ByteCount",t:Sr},5:{n:"LineCount",t:Sr},6:{n:"ParagraphCount",t:Sr},7:{n:"SlideCount",t:Sr},8:{n:"NoteCount",t:Sr},9:{n:"HiddenCount",t:Sr},10:{n:"MultimediaClipCount",t:Sr},11:{n:"ScaleCrop",t:Ro},12:{n:"HeadingPairs",t:yA},13:{n:"TitlesOfParts",t:_A},14:{n:"Manager",t:zt},15:{n:"Company",t:zt},16:{n:"LinksUpToDate",t:Ro},17:{n:"CharacterCount",t:Sr},19:{n:"SharedDoc",t:Ro},22:{n:"HyperlinksChanged",t:Ro},23:{n:"AppVersion",t:Sr,p:"version"},24:{n:"DigSig",t:xA},26:{n:"ContentType",t:zt},27:{n:"ContentStatus",t:zt},28:{n:"Language",t:zt},29:{n:"Version",t:zt},255:{},2147483648:{n:"Locale",t:ml},2147483651:{n:"Behavior",t:ml},1919054434:{}},Mf={1:{n:"CodePage",t:Ig},2:{n:"Title",t:zt},3:{n:"Subject",t:zt},4:{n:"Author",t:zt},5:{n:"Keywords",t:zt},6:{n:"Comments",t:zt},7:{n:"Template",t:zt},8:{n:"LastAuthor",t:zt},9:{n:"RevNumber",t:zt},10:{n:"EditTime",t:Do},11:{n:"LastPrinted",t:Do},12:{n:"CreatedDate",t:Do},13:{n:"ModifiedDate",t:Do},14:{n:"PageCount",t:Sr},15:{n:"WordCount",t:Sr},16:{n:"CharCount",t:Sr},17:{n:"Thumbnail",t:vA},18:{n:"Application",t:zt},19:{n:"DocSecurity",t:Sr},255:{},2147483648:{n:"Locale",t:ml},2147483651:{n:"Behavior",t:ml},1919054434:{}};function wA(t){return t.map(function(e){return[e>>16&255,e>>8&255,e&255]})}var bA=wA([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),EA=Er(bA),Zi={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},TA={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},Fo={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function Pg(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function Rg(t,e){var r=jT(TA),n=[],s;n[n.length]=Ft,n[n.length]=ge("Types",null,{xmlns:$t.CT,"xmlns:xsd":$t.xsd,"xmlns:xsi":$t.xsi}),n=n.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(c){return ge("Default",null,{Extension:c[0],ContentType:c[1]})}));var a=function(c){t[c]&&t[c].length>0&&(s=t[c][0],n[n.length]=ge("Override",null,{PartName:(s[0]=="/"?"":"/")+s,ContentType:Fo[c][e.bookType]||Fo[c].xlsx}))},i=function(c){(t[c]||[]).forEach(function(u){n[n.length]=ge("Override",null,{PartName:(u[0]=="/"?"":"/")+u,ContentType:Fo[c][e.bookType]||Fo[c].xlsx})})},l=function(c){(t[c]||[]).forEach(function(u){n[n.length]=ge("Override",null,{PartName:(u[0]=="/"?"":"/")+u,ContentType:r[c][0]})})};return a("workbooks"),i("sheets"),i("charts"),l("themes"),["strs","styles"].forEach(a),["coreprops","extprops","custprops"].forEach(l),l("vba"),l("comments"),l("threadedcomments"),l("drawings"),i("metadata"),l("people"),n.length>2&&(n[n.length]="</Types>",n[1]=n[1].replace("/>",">")),n.join("")}var Qe={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function Dg(t){var e=t.lastIndexOf("/");return t.slice(0,e+1)+"_rels/"+t.slice(e+1)+".rels"}function pa(t){var e=[Ft,ge("Relationships",null,{xmlns:$t.RELS})];return Zt(t["!id"]).forEach(function(r){e[e.length]=ge("Relationship",null,t["!id"][r])}),e.length>2&&(e[e.length]="</Relationships>",e[1]=e[1].replace("/>",">")),e.join("")}function at(t,e,r,n,s,a){if(s||(s={}),t["!id"]||(t["!id"]={}),t["!idx"]||(t["!idx"]=1),e<0)for(e=t["!idx"];t["!id"]["rId"+e];++e);if(t["!idx"]=e+1,s.Id="rId"+e,s.Type=n,s.Target=r,[Qe.HLINK,Qe.XPATH,Qe.XMISS].indexOf(s.Type)>-1&&(s.TargetMode="External"),t["!id"][s.Id])throw new Error("Cannot rewrite rId "+e);return t["!id"][s.Id]=s,t[("/"+s.Target).replace("//","/")]=s,e}function AA(t){var e=[Ft];e.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),e.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var r=0;r<t.length;++r)e.push('  <manifest:file-entry manifest:full-path="'+t[r][0]+'" manifest:media-type="'+t[r][1]+`"/>
`);return e.push("</manifest:manifest>"),e.join("")}function Lf(t,e,r){return['  <rdf:Description rdf:about="'+t+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(r||"odf")+"#"+e+`"/>
`,`  </rdf:Description>
`].join("")}function SA(t,e){return['  <rdf:Description rdf:about="'+t+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+e+`"/>
`,`  </rdf:Description>
`].join("")}function NA(t){var e=[Ft];e.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var r=0;r!=t.length;++r)e.push(Lf(t[r][0],t[r][1])),e.push(SA("",t[r][0]));return e.push(Lf("","Document","pkg")),e.push("</rdf:RDF>"),e.join("")}function Fg(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+al.version+"</meta:generator></office:meta></office:document-meta>"}var Ps=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function Lc(t,e,r,n,s){s[t]!=null||e==null||e===""||(s[t]=e,e=it(e),n[n.length]=r?ge(t,e,r):Xt(t,e))}function jg(t,e){var r=e||{},n=[Ft,ge("cp:coreProperties",null,{"xmlns:cp":$t.CORE_PROPS,"xmlns:dc":$t.dc,"xmlns:dcterms":$t.dcterms,"xmlns:dcmitype":$t.dcmitype,"xmlns:xsi":$t.xsi})],s={};if(!t&&!r.Props)return n.join("");t&&(t.CreatedDate!=null&&Lc("dcterms:created",typeof t.CreatedDate=="string"?t.CreatedDate:fu(t.CreatedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},n,s),t.ModifiedDate!=null&&Lc("dcterms:modified",typeof t.ModifiedDate=="string"?t.ModifiedDate:fu(t.ModifiedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},n,s));for(var a=0;a!=Ps.length;++a){var i=Ps[a],l=r.Props&&r.Props[i[1]]!=null?r.Props[i[1]]:t?t[i[1]]:null;l===!0?l="1":l===!1?l="0":typeof l=="number"&&(l=String(l)),l!=null&&Lc(i[0],l,null,n,s)}return n.length>2&&(n[n.length]="</cp:coreProperties>",n[1]=n[1].replace("/>",">")),n.join("")}var ga=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],kg=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function Og(t){var e=[],r=ge;return t||(t={}),t.Application="SheetJS",e[e.length]=Ft,e[e.length]=ge("Properties",null,{xmlns:$t.EXT_PROPS,"xmlns:vt":$t.vt}),ga.forEach(function(n){if(t[n[1]]!==void 0){var s;switch(n[2]){case"string":s=it(String(t[n[1]]));break;case"bool":s=t[n[1]]?"true":"false";break}s!==void 0&&(e[e.length]=r(n[0],s))}}),e[e.length]=r("HeadingPairs",r("vt:vector",r("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+r("vt:variant",r("vt:i4",String(t.Worksheets))),{size:2,baseType:"variant"})),e[e.length]=r("TitlesOfParts",r("vt:vector",t.SheetNames.map(function(n){return"<vt:lpstr>"+it(n)+"</vt:lpstr>"}).join(""),{size:t.Worksheets,baseType:"lpstr"})),e.length>2&&(e[e.length]="</Properties>",e[1]=e[1].replace("/>",">")),e.join("")}function Mg(t){var e=[Ft,ge("Properties",null,{xmlns:$t.CUST_PROPS,"xmlns:vt":$t.vt})];if(!t)return e.join("");var r=1;return Zt(t).forEach(function(s){++r,e[e.length]=ge("property",qT(t[s]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:r,name:it(s)})}),e.length>2&&(e[e.length]="</Properties>",e[1]=e[1].replace("/>",">")),e.join("")}var Bf={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function CA(t,e){var r=[];return Zt(Bf).map(function(n){for(var s=0;s<Ps.length;++s)if(Ps[s][1]==n)return Ps[s];for(s=0;s<ga.length;++s)if(ga[s][1]==n)return ga[s];throw n}).forEach(function(n){if(t[n[1]]!=null){var s=e&&e.Props&&e.Props[n[1]]!=null?e.Props[n[1]]:t[n[1]];switch(n[2]){case"date":s=new Date(s).toISOString().replace(/\.\d*Z/,"Z");break}typeof s=="number"?s=String(s):s===!0||s===!1?s=s?"1":"0":s instanceof Date&&(s=new Date(s).toISOString().replace(/\.\d*Z/,"")),r.push(Xt(Bf[n[1]]||n[1],s))}}),ge("DocumentProperties",r.join(""),{xmlns:Ir.o})}function IA(t,e){var r=["Worksheets","SheetNames"],n="CustomDocumentProperties",s=[];return t&&Zt(t).forEach(function(a){if(Object.prototype.hasOwnProperty.call(t,a)){for(var i=0;i<Ps.length;++i)if(a==Ps[i][1])return;for(i=0;i<ga.length;++i)if(a==ga[i][1])return;for(i=0;i<r.length;++i)if(a==r[i])return;var l=t[a],c="string";typeof l=="number"?(c="float",l=String(l)):l===!0||l===!1?(c="boolean",l=l?"1":"0"):l=String(l),s.push(ge(Sf(a),l,{"dt:dt":c}))}}),e&&Zt(e).forEach(function(a){if(Object.prototype.hasOwnProperty.call(e,a)&&!(t&&Object.prototype.hasOwnProperty.call(t,a))){var i=e[a],l="string";typeof i=="number"?(l="float",i=String(i)):i===!0||i===!1?(l="boolean",i=i?"1":"0"):i instanceof Date?(l="dateTime.tz",i=i.toISOString()):i=String(i),s.push(ge(Sf(a),i,{"dt:dt":l}))}}),"<"+n+' xmlns="'+Ir.o+'">'+s.join("")+"</"+n+">"}function PA(t){var e=typeof t=="string"?new Date(Date.parse(t)):t,r=e.getTime()/1e3+11644473600,n=r%Math.pow(2,32),s=(r-n)/Math.pow(2,32);n*=1e7,s*=1e7;var a=n/Math.pow(2,32)|0;a>0&&(n=n%Math.pow(2,32),s+=a);var i=ee(8);return i.write_shift(4,n),i.write_shift(4,s),i}function Vf(t,e){var r=ee(4),n=ee(4);switch(r.write_shift(4,t==80?31:t),t){case 3:n.write_shift(-4,e);break;case 5:n=ee(8),n.write_shift(8,e,"f");break;case 11:n.write_shift(4,e?1:0);break;case 64:n=PA(e);break;case 31:case 80:for(n=ee(4+2*(e.length+1)+(e.length%2?0:2)),n.write_shift(4,e.length+1),n.write_shift(0,e,"dbcs");n.l!=n.length;)n.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+t+" "+e)}return Kt([r,n])}var Lg=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function RA(t){switch(typeof t){case"boolean":return 11;case"number":return(t|0)==t?3:5;case"string":return 31;case"object":if(t instanceof Date)return 64;break}return-1}function Uf(t,e,r){var n=ee(8),s=[],a=[],i=8,l=0,c=ee(8),u=ee(8);if(c.write_shift(4,2),c.write_shift(4,1200),u.write_shift(4,1),a.push(c),s.push(u),i+=8+c.length,!e){u=ee(8),u.write_shift(4,0),s.unshift(u);var h=[ee(4)];for(h[0].write_shift(4,t.length),l=0;l<t.length;++l){var f=t[l][0];for(c=ee(8+2*(f.length+1)+(f.length%2?0:2)),c.write_shift(4,l+2),c.write_shift(4,f.length+1),c.write_shift(0,f,"dbcs");c.l!=c.length;)c.write_shift(1,0);h.push(c)}c=Kt(h),a.unshift(c),i+=8+c.length}for(l=0;l<t.length;++l)if(!(e&&!e[t[l][0]])&&!(Lg.indexOf(t[l][0])>-1||kg.indexOf(t[l][0])>-1)&&t[l][1]!=null){var m=t[l][1],p=0;if(e){p=+e[t[l][0]];var x=r[p];if(x.p=="version"&&typeof m=="string"){var g=m.split(".");m=(+g[0]<<16)+(+g[1]||0)}c=Vf(x.t,m)}else{var y=RA(m);y==-1&&(y=31,m=String(m)),c=Vf(y,m)}a.push(c),u=ee(8),u.write_shift(4,e?p:2+l),s.push(u),i+=8+c.length}var I=8*(a.length+1);for(l=0;l<a.length;++l)s[l].write_shift(4,I),I+=a[l].length;return n.write_shift(4,i),n.write_shift(4,a.length),Kt([n].concat(s).concat(a))}function $f(t,e,r,n,s,a){var i=ee(s?68:48),l=[i];i.write_shift(2,65534),i.write_shift(2,0),i.write_shift(4,842412599),i.write_shift(16,lt.utils.consts.HEADER_CLSID,"hex"),i.write_shift(4,s?2:1),i.write_shift(16,e,"hex"),i.write_shift(4,s?68:48);var c=Uf(t,r,n);if(l.push(c),s){var u=Uf(s,null,null);i.write_shift(16,a,"hex"),i.write_shift(4,68+c.length),l.push(u)}return Kt(l)}function DA(t,e){e||(e=ee(t));for(var r=0;r<t;++r)e.write_shift(1,0);return e}function FA(t,e){return t.read_shift(e)===1}function pr(t,e){return e||(e=ee(2)),e.write_shift(2,+!!t),e}function Bg(t){return t.read_shift(2,"u")}function Mr(t,e){return e||(e=ee(2)),e.write_shift(2,t),e}function Vg(t,e,r){return r||(r=ee(2)),r.write_shift(1,e=="e"?+t:+!!t),r.write_shift(1,e=="e"?1:0),r}function Ug(t,e,r){var n=t.read_shift(r&&r.biff>=12?2:1),s="sbcs-cont";if(r&&r.biff>=8,!r||r.biff==8){var a=t.read_shift(1);a&&(s="dbcs-cont")}else r.biff==12&&(s="wstr");r.biff>=2&&r.biff<=5&&(s="cpstr");var i=n?t.read_shift(n,s):"";return i}function jA(t){var e=t.t||"",r=ee(3);r.write_shift(2,e.length),r.write_shift(1,1);var n=ee(2*e.length);n.write_shift(2*e.length,e,"utf16le");var s=[r,n];return Kt(s)}function kA(t,e,r){var n;if(r){if(r.biff>=2&&r.biff<=5)return t.read_shift(e,"cpstr");if(r.biff>=12)return t.read_shift(e,"dbcs-cont")}var s=t.read_shift(1);return s===0?n=t.read_shift(e,"sbcs-cont"):n=t.read_shift(e,"dbcs-cont"),n}function OA(t,e,r){var n=t.read_shift(r&&r.biff==2?1:2);return n===0?(t.l++,""):kA(t,n,r)}function MA(t,e,r){if(r.biff>5)return OA(t,e,r);var n=t.read_shift(1);return n===0?(t.l++,""):t.read_shift(n,r.biff<=4||!t.lens?"cpstr":"sbcs-cont")}function $g(t,e,r){return r||(r=ee(3+2*t.length)),r.write_shift(2,t.length),r.write_shift(1,1),r.write_shift(31,t,"utf16le"),r}function Hf(t,e){e||(e=ee(6+t.length*2)),e.write_shift(4,1+t.length);for(var r=0;r<t.length;++r)e.write_shift(2,t.charCodeAt(r));return e.write_shift(2,0),e}function LA(t){var e=ee(512),r=0,n=t.Target;n.slice(0,7)=="file://"&&(n=n.slice(7));var s=n.indexOf("#"),a=s>-1?31:23;switch(n.charAt(0)){case"#":a=28;break;case".":a&=-3;break}e.write_shift(4,2),e.write_shift(4,a);var i=[8,6815827,6619237,4849780,83];for(r=0;r<i.length;++r)e.write_shift(4,i[r]);if(a==28)n=n.slice(1),Hf(n,e);else if(a&2){for(i="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),r=0;r<i.length;++r)e.write_shift(1,parseInt(i[r],16));var l=s>-1?n.slice(0,s):n;for(e.write_shift(4,2*(l.length+1)),r=0;r<l.length;++r)e.write_shift(2,l.charCodeAt(r));e.write_shift(2,0),a&8&&Hf(s>-1?n.slice(s+1):"",e)}else{for(i="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),r=0;r<i.length;++r)e.write_shift(1,parseInt(i[r],16));for(var c=0;n.slice(c*3,c*3+3)=="../"||n.slice(c*3,c*3+3)=="..\\";)++c;for(e.write_shift(2,c),e.write_shift(4,n.length-3*c+1),r=0;r<n.length-3*c;++r)e.write_shift(1,n.charCodeAt(r+3*c)&255);for(e.write_shift(1,0),e.write_shift(2,65535),e.write_shift(2,57005),r=0;r<6;++r)e.write_shift(4,0)}return e.slice(0,e.l)}function Ms(t,e,r,n){return n||(n=ee(6)),n.write_shift(2,t),n.write_shift(2,e),n.write_shift(2,r||0),n}function BA(t,e,r){var n=r.biff>8?4:2,s=t.read_shift(n),a=t.read_shift(n,"i"),i=t.read_shift(n,"i");return[s,a,i]}function VA(t){var e=t.read_shift(2),r=t.read_shift(2),n=t.read_shift(2),s=t.read_shift(2);return{s:{c:n,r:e},e:{c:s,r}}}function Hg(t,e){return e||(e=ee(8)),e.write_shift(2,t.s.r),e.write_shift(2,t.e.r),e.write_shift(2,t.s.c),e.write_shift(2,t.e.c),e}function ph(t,e,r){var n=1536,s=16;switch(r.bookType){case"biff8":break;case"biff5":n=1280,s=8;break;case"biff4":n=4,s=6;break;case"biff3":n=3,s=6;break;case"biff2":n=2,s=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var a=ee(s);return a.write_shift(2,n),a.write_shift(2,e),s>4&&a.write_shift(2,29282),s>6&&a.write_shift(2,1997),s>8&&(a.write_shift(2,49161),a.write_shift(2,1),a.write_shift(2,1798),a.write_shift(2,0)),a}function UA(t,e){var r=!e||e.biff==8,n=ee(r?112:54);for(n.write_shift(e.biff==8?2:1,7),r&&n.write_shift(1,0),n.write_shift(4,859007059),n.write_shift(4,5458548|(r?0:536870912));n.l<n.length;)n.write_shift(1,r?0:32);return n}function $A(t,e){var r=!e||e.biff>=8?2:1,n=ee(8+r*t.name.length);n.write_shift(4,t.pos),n.write_shift(1,t.hs||0),n.write_shift(1,t.dt),n.write_shift(1,t.name.length),e.biff>=8&&n.write_shift(1,1),n.write_shift(r*t.name.length,t.name,e.biff<8?"sbcs":"utf16le");var s=n.slice(0,n.l);return s.l=n.l,s}function HA(t,e){var r=ee(8);r.write_shift(4,t.Count),r.write_shift(4,t.Unique);for(var n=[],s=0;s<t.length;++s)n[s]=jA(t[s]);var a=Kt([r].concat(n));return a.parts=[r.length].concat(n.map(function(i){return i.length})),a}function WA(){var t=ee(18);return t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,29280),t.write_shift(2,17600),t.write_shift(2,56),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,1),t.write_shift(2,500),t}function qA(t){var e=ee(18),r=1718;return t&&t.RTL&&(r|=64),e.write_shift(2,r),e.write_shift(4,0),e.write_shift(4,64),e.write_shift(4,0),e.write_shift(4,0),e}function GA(t,e){var r=t.name||"Arial",n=e&&e.biff==5,s=n?15+r.length:16+2*r.length,a=ee(s);return a.write_shift(2,t.sz*20),a.write_shift(4,0),a.write_shift(2,400),a.write_shift(4,0),a.write_shift(2,0),a.write_shift(1,r.length),n||a.write_shift(1,1),a.write_shift((n?1:2)*r.length,r,n?"sbcs":"utf16le"),a}function zA(t,e,r,n){var s=ee(10);return Ms(t,e,n,s),s.write_shift(4,r),s}function YA(t,e,r,n,s){var a=!s||s.biff==8,i=ee(8+ +a+(1+a)*r.length);return Ms(t,e,n,i),i.write_shift(2,r.length),a&&i.write_shift(1,1),i.write_shift((1+a)*r.length,r,a?"utf16le":"sbcs"),i}function KA(t,e,r,n){var s=r&&r.biff==5;n||(n=ee(s?3+e.length:5+2*e.length)),n.write_shift(2,t),n.write_shift(s?1:2,e.length),s||n.write_shift(1,1),n.write_shift((s?1:2)*e.length,e,s?"sbcs":"utf16le");var a=n.length>n.l?n.slice(0,n.l):n;return a.l==null&&(a.l=a.length),a}function XA(t,e){var r=e.biff==8||!e.biff?4:2,n=ee(2*r+6);return n.write_shift(r,t.s.r),n.write_shift(r,t.e.r+1),n.write_shift(2,t.s.c),n.write_shift(2,t.e.c+1),n.write_shift(2,0),n}function Wf(t,e,r,n){var s=r&&r.biff==5;n||(n=ee(s?16:20)),n.write_shift(2,0),t.style?(n.write_shift(2,t.numFmtId||0),n.write_shift(2,65524)):(n.write_shift(2,t.numFmtId||0),n.write_shift(2,e<<4));var a=0;return t.numFmtId>0&&s&&(a|=1024),n.write_shift(4,a),n.write_shift(4,0),s||n.write_shift(4,0),n.write_shift(2,0),n}function QA(t){var e=ee(8);return e.write_shift(4,0),e.write_shift(2,0),e.write_shift(2,0),e}function JA(t,e,r,n,s,a){var i=ee(8);return Ms(t,e,n,i),Vg(r,a,i),i}function ZA(t,e,r,n){var s=ee(14);return Ms(t,e,n,s),Os(r,s),s}function eS(t,e,r){if(r.biff<8)return tS(t,e,r);for(var n=[],s=t.l+e,a=t.read_shift(r.biff>8?4:2);a--!==0;)n.push(BA(t,r.biff>8?12:6,r));if(t.l!=s)throw new Error("Bad ExternSheet: "+t.l+" != "+s);return n}function tS(t,e,r){t[t.l+1]==3&&t[t.l]++;var n=Ug(t,e,r);return n.charCodeAt(0)==3?n.slice(1):n}function rS(t){var e=ee(2+t.length*8);e.write_shift(2,t.length);for(var r=0;r<t.length;++r)Hg(t[r],e);return e}function nS(t){var e=ee(24),r=Ht(t[0]);e.write_shift(2,r.r),e.write_shift(2,r.r),e.write_shift(2,r.c),e.write_shift(2,r.c);for(var n="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),s=0;s<16;++s)e.write_shift(1,parseInt(n[s],16));return Kt([e,LA(t[1])])}function sS(t){var e=t[1].Tooltip,r=ee(10+2*(e.length+1));r.write_shift(2,2048);var n=Ht(t[0]);r.write_shift(2,n.r),r.write_shift(2,n.r),r.write_shift(2,n.c),r.write_shift(2,n.c);for(var s=0;s<e.length;++s)r.write_shift(2,e.charCodeAt(s));return r.write_shift(2,0),r}function aS(t){return t||(t=ee(4)),t.write_shift(2,1),t.write_shift(2,1),t}function iS(t,e,r){if(!r.cellStyles)return pn(t,e);var n=r&&r.biff>=12?4:2,s=t.read_shift(n),a=t.read_shift(n),i=t.read_shift(n),l=t.read_shift(n),c=t.read_shift(2);n==2&&(t.l+=2);var u={s,e:a,w:i,ixfe:l,flags:c};return(r.biff>=5||!r.biff)&&(u.level=c>>8&7),u}function oS(t,e){var r=ee(12);r.write_shift(2,e),r.write_shift(2,e),r.write_shift(2,t.width*256),r.write_shift(2,0);var n=0;return t.hidden&&(n|=1),r.write_shift(1,n),n=t.level||0,r.write_shift(1,n),r.write_shift(2,0),r}function lS(t){for(var e=ee(2*t),r=0;r<t;++r)e.write_shift(2,r+1);return e}function cS(t,e,r){var n=ee(15);return to(n,t,e),n.write_shift(8,r,"f"),n}function uS(t,e,r){var n=ee(9);return to(n,t,e),n.write_shift(2,r),n}var hS=(function(){var t={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},e=sh({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function r(l,c){var u=[],h=ks(1);switch(c.type){case"base64":h=qr(Pn(l));break;case"binary":h=qr(l);break;case"buffer":case"array":h=l;break}Nr(h,0);var f=h.read_shift(1),m=!!(f&136),p=!1,x=!1;switch(f){case 2:break;case 3:break;case 48:p=!0,m=!0;break;case 49:p=!0,m=!0;break;case 131:break;case 139:break;case 140:x=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+f.toString(16))}var g=0,y=521;f==2&&(g=h.read_shift(2)),h.l+=3,f!=2&&(g=h.read_shift(4)),g>1048576&&(g=1e6),f!=2&&(y=h.read_shift(2));var I=h.read_shift(2),P=c.codepage||1252;f!=2&&(h.l+=16,h.read_shift(1),h[h.l]!==0&&(P=t[h[h.l]]),h.l+=1,h.l+=2),x&&(h.l+=36);for(var A=[],D={},V=Math.min(h.length,f==2?521:y-10-(p?264:0)),H=x?32:11;h.l<V&&h[h.l]!=13;)switch(D={},D.name=il.utils.decode(P,h.slice(h.l,h.l+H)).replace(/[\u0000\r\n].*$/g,""),h.l+=H,D.type=String.fromCharCode(h.read_shift(1)),f!=2&&!x&&(D.offset=h.read_shift(4)),D.len=h.read_shift(1),f==2&&(D.offset=h.read_shift(2)),D.dec=h.read_shift(1),D.name.length&&A.push(D),f!=2&&(h.l+=x?13:14),D.type){case"B":(!p||D.len!=8)&&c.WTF&&console.log("Skipping "+D.name+":"+D.type);break;case"G":case"P":c.WTF&&console.log("Skipping "+D.name+":"+D.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+D.type)}if(h[h.l]!==13&&(h.l=y-1),h.read_shift(1)!==13)throw new Error("DBF Terminator not found "+h.l+" "+h[h.l]);h.l=y;var w=0,E=0;for(u[0]=[],E=0;E!=A.length;++E)u[0][E]=A[E].name;for(;g-- >0;){if(h[h.l]===42){h.l+=I;continue}for(++h.l,u[++w]=[],E=0,E=0;E!=A.length;++E){var _=h.slice(h.l,h.l+A[E].len);h.l+=A[E].len,Nr(_,0);var N=il.utils.decode(P,_);switch(A[E].type){case"C":N.trim().length&&(u[w][E]=N.replace(/\s+$/,""));break;case"D":N.length===8?u[w][E]=new Date(+N.slice(0,4),+N.slice(4,6)-1,+N.slice(6,8)):u[w][E]=N;break;case"F":u[w][E]=parseFloat(N.trim());break;case"+":case"I":u[w][E]=x?_.read_shift(-4,"i")^2147483648:_.read_shift(4,"i");break;case"L":switch(N.trim().toUpperCase()){case"Y":case"T":u[w][E]=!0;break;case"N":case"F":u[w][E]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+N+"|")}break;case"M":if(!m)throw new Error("DBF Unexpected MEMO for type "+f.toString(16));u[w][E]="##MEMO##"+(x?parseInt(N.trim(),10):_.read_shift(4));break;case"N":N=N.replace(/\u0000/g,"").trim(),N&&N!="."&&(u[w][E]=+N||0);break;case"@":u[w][E]=new Date(_.read_shift(-8,"f")-621356832e5);break;case"T":u[w][E]=new Date((_.read_shift(4)-2440588)*864e5+_.read_shift(4));break;case"Y":u[w][E]=_.read_shift(4,"i")/1e4+_.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":u[w][E]=-_.read_shift(-8,"f");break;case"B":if(p&&A[E].len==8){u[w][E]=_.read_shift(8,"f");break}case"G":case"P":_.l+=A[E].len;break;case"0":if(A[E].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+A[E].type)}}}if(f!=2&&h.l<h.length&&h[h.l++]!=26)throw new Error("DBF EOF Marker missing "+(h.l-1)+" of "+h.length+" "+h[h.l-1].toString(16));return c&&c.sheetRows&&(u=u.slice(0,c.sheetRows)),c.DBF=A,u}function n(l,c){var u=c||{};u.dateNF||(u.dateNF="yyyymmdd");var h=ka(r(l,u),u);return h["!cols"]=u.DBF.map(function(f){return{wch:f.len,DBF:f}}),delete u.DBF,h}function s(l,c){try{return $s(n(l,c),c)}catch(u){if(c&&c.WTF)throw u}return{SheetNames:[],Sheets:{}}}var a={B:8,C:250,L:1,D:8,"?":0,"":0};function i(l,c){var u=c||{};if(+u.codepage>=0&&Ni(+u.codepage),u.type=="string")throw new Error("Cannot write DBF to JS string");var h=wr(),f=yl(l,{header:1,raw:!0,cellDates:!0}),m=f[0],p=f.slice(1),x=l["!cols"]||[],g=0,y=0,I=0,P=1;for(g=0;g<m.length;++g){if(((x[g]||{}).DBF||{}).name){m[g]=x[g].DBF.name,++I;continue}if(m[g]!=null){if(++I,typeof m[g]=="number"&&(m[g]=m[g].toString(10)),typeof m[g]!="string")throw new Error("DBF Invalid column name "+m[g]+" |"+typeof m[g]+"|");if(m.indexOf(m[g])!==g){for(y=0;y<1024;++y)if(m.indexOf(m[g]+"_"+y)==-1){m[g]+="_"+y;break}}}}var A=xt(l["!ref"]),D=[],V=[],H=[];for(g=0;g<=A.e.c-A.s.c;++g){var w="",E="",_=0,N=[];for(y=0;y<p.length;++y)p[y][g]!=null&&N.push(p[y][g]);if(N.length==0||m[g]==null){D[g]="?";continue}for(y=0;y<N.length;++y){switch(typeof N[y]){case"number":E="B";break;case"string":E="C";break;case"boolean":E="L";break;case"object":E=N[y]instanceof Date?"D":"C";break;default:E="C"}_=Math.max(_,String(N[y]).length),w=w&&w!=E?"C":E}_>250&&(_=250),E=((x[g]||{}).DBF||{}).type,E=="C"&&x[g].DBF.len>_&&(_=x[g].DBF.len),w=="B"&&E=="N"&&(w="N",H[g]=x[g].DBF.dec,_=x[g].DBF.len),V[g]=w=="C"||E=="N"?_:a[w]||0,P+=V[g],D[g]=w}var T=h.next(32);for(T.write_shift(4,318902576),T.write_shift(4,p.length),T.write_shift(2,296+32*I),T.write_shift(2,P),g=0;g<4;++g)T.write_shift(4,0);for(T.write_shift(4,0|(+e[qp]||3)<<8),g=0,y=0;g<m.length;++g)if(m[g]!=null){var R=h.next(32),S=(m[g].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);R.write_shift(1,S,"sbcs"),R.write_shift(1,D[g]=="?"?"C":D[g],"sbcs"),R.write_shift(4,y),R.write_shift(1,V[g]||a[D[g]]||0),R.write_shift(1,H[g]||0),R.write_shift(1,2),R.write_shift(4,0),R.write_shift(1,0),R.write_shift(4,0),R.write_shift(4,0),y+=V[g]||a[D[g]]||0}var se=h.next(264);for(se.write_shift(4,13),g=0;g<65;++g)se.write_shift(4,0);for(g=0;g<p.length;++g){var te=h.next(P);for(te.write_shift(1,0),y=0;y<m.length;++y)if(m[y]!=null)switch(D[y]){case"L":te.write_shift(1,p[g][y]==null?63:p[g][y]?84:70);break;case"B":te.write_shift(8,p[g][y]||0,"f");break;case"N":var me="0";for(typeof p[g][y]=="number"&&(me=p[g][y].toFixed(H[y]||0)),I=0;I<V[y]-me.length;++I)te.write_shift(1,32);te.write_shift(1,me,"sbcs");break;case"D":p[g][y]?(te.write_shift(4,("0000"+p[g][y].getFullYear()).slice(-4),"sbcs"),te.write_shift(2,("00"+(p[g][y].getMonth()+1)).slice(-2),"sbcs"),te.write_shift(2,("00"+p[g][y].getDate()).slice(-2),"sbcs")):te.write_shift(8,"00000000","sbcs");break;case"C":var ce=String(p[g][y]!=null?p[g][y]:"").slice(0,V[y]);for(te.write_shift(1,ce,"sbcs"),I=0;I<V[y]-ce.length;++I)te.write_shift(1,32);break}}return h.next(1).write_shift(1,26),h.end()}return{to_workbook:s,to_sheet:n,from_sheet:i}})(),dS=(function(){var t={AA:"",BA:"",CA:"",DA:195,HA:"",JA:197,AE:"",BE:"",CE:"",HE:"",AI:"",BI:"",CI:"",HI:"",AO:"",BO:"",CO:"",DO:213,HO:"",AU:"",BU:"",CU:"",HU:"",Aa:"",Ba:"",Ca:"",Da:227,Ha:"",Ja:229,Ae:"",Be:"",Ce:"",He:"",Ai:"",Bi:"",Ci:"",Hi:"",Ao:"",Bo:"",Co:"",Do:245,Ho:"",Au:"",Bu:"",Cu:"",Hu:"",KC:"",Kc:"",q:"",z:"",a:"",j:"",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},e=new RegExp("\x1BN("+Zt(t).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),r=function(m,p){var x=t[p];return typeof x=="number"?mf(x):x},n=function(m,p,x){var g=p.charCodeAt(0)-32<<4|x.charCodeAt(0)-48;return g==59?m:mf(g)};t["|"]=254;function s(m,p){switch(p.type){case"base64":return a(Pn(m),p);case"binary":return a(m,p);case"buffer":return a(et&&Buffer.isBuffer(m)?m.toString("binary"):Xi(m),p);case"array":return a(Zl(m),p)}throw new Error("Unrecognized type "+p.type)}function a(m,p){var x=m.split(/[\n\r]+/),g=-1,y=-1,I=0,P=0,A=[],D=[],V=null,H={},w=[],E=[],_=[],N=0,T;for(+p.codepage>=0&&Ni(+p.codepage);I!==x.length;++I){N=0;var R=x[I].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,n).replace(e,r),S=R.replace(/;;/g,"\0").split(";").map(function(W){return W.replace(/\u0000/g,";")}),se=S[0],te;if(R.length>0)switch(se){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":S[1].charAt(0)=="P"&&D.push(R.slice(3).replace(/;;/g,";"));break;case"C":var me=!1,ce=!1,le=!1,Ae=!1,Oe=-1,Je=-1;for(P=1;P<S.length;++P)switch(S[P].charAt(0)){case"A":break;case"X":y=parseInt(S[P].slice(1))-1,ce=!0;break;case"Y":for(g=parseInt(S[P].slice(1))-1,ce||(y=0),T=A.length;T<=g;++T)A[T]=[];break;case"K":te=S[P].slice(1),te.charAt(0)==='"'?te=te.slice(1,te.length-1):te==="TRUE"?te=!0:te==="FALSE"?te=!1:isNaN(Tn(te))?isNaN(Ii(te).getDate())||(te=gr(te)):(te=Tn(te),V!==null&&ng(V)&&(te=og(te))),me=!0;break;case"E":Ae=!0;var U=uN(S[P].slice(1),{r:g,c:y});A[g][y]=[A[g][y],U];break;case"S":le=!0,A[g][y]=[A[g][y],"S5S"];break;case"G":break;case"R":Oe=parseInt(S[P].slice(1))-1;break;case"C":Je=parseInt(S[P].slice(1))-1;break;default:if(p&&p.WTF)throw new Error("SYLK bad record "+R)}if(me&&(A[g][y]&&A[g][y].length==2?A[g][y][0]=te:A[g][y]=te,V=null),le){if(Ae)throw new Error("SYLK shared formula cannot have own formula");var Y=Oe>-1&&A[Oe][Je];if(!Y||!Y[1])throw new Error("SYLK shared formula cannot find base");A[g][y][1]=hN(Y[1],{r:g-Oe,c:y-Je})}break;case"F":var q=0;for(P=1;P<S.length;++P)switch(S[P].charAt(0)){case"X":y=parseInt(S[P].slice(1))-1,++q;break;case"Y":for(g=parseInt(S[P].slice(1))-1,T=A.length;T<=g;++T)A[T]=[];break;case"M":N=parseInt(S[P].slice(1))/20;break;case"F":break;case"G":break;case"P":V=D[parseInt(S[P].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(_=S[P].slice(1).split(" "),T=parseInt(_[0],10);T<=parseInt(_[1],10);++T)N=parseInt(_[2],10),E[T-1]=N===0?{hidden:!0}:{wch:N},gh(E[T-1]);break;case"C":y=parseInt(S[P].slice(1))-1,E[y]||(E[y]={});break;case"R":g=parseInt(S[P].slice(1))-1,w[g]||(w[g]={}),N>0?(w[g].hpt=N,w[g].hpx=Yg(N)):N===0&&(w[g].hidden=!0);break;default:if(p&&p.WTF)throw new Error("SYLK bad record "+R)}q<1&&(V=null);break;default:if(p&&p.WTF)throw new Error("SYLK bad record "+R)}}return w.length>0&&(H["!rows"]=w),E.length>0&&(H["!cols"]=E),p&&p.sheetRows&&(A=A.slice(0,p.sheetRows)),[A,H]}function i(m,p){var x=s(m,p),g=x[0],y=x[1],I=ka(g,p);return Zt(y).forEach(function(P){I[P]=y[P]}),I}function l(m,p){return $s(i(m,p),p)}function c(m,p,x,g){var y="C;Y"+(x+1)+";X"+(g+1)+";K";switch(m.t){case"n":y+=m.v||0,m.f&&!m.F&&(y+=";E"+vh(m.f,{r:x,c:g}));break;case"b":y+=m.v?"TRUE":"FALSE";break;case"e":y+=m.w||m.v;break;case"d":y+='"'+(m.w||m.v)+'"';break;case"s":y+='"'+m.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return y}function u(m,p){p.forEach(function(x,g){var y="F;W"+(g+1)+" "+(g+1)+" ";x.hidden?y+="0":(typeof x.width=="number"&&!x.wpx&&(x.wpx=pl(x.width)),typeof x.wpx=="number"&&!x.wch&&(x.wch=gl(x.wpx)),typeof x.wch=="number"&&(y+=Math.round(x.wch))),y.charAt(y.length-1)!=" "&&m.push(y)})}function h(m,p){p.forEach(function(x,g){var y="F;";x.hidden?y+="M0;":x.hpt?y+="M"+20*x.hpt+";":x.hpx&&(y+="M"+20*xl(x.hpx)+";"),y.length>2&&m.push(y+"R"+(g+1))})}function f(m,p){var x=["ID;PWXL;N;E"],g=[],y=xt(m["!ref"]),I,P=Array.isArray(m),A=`\r
`;x.push("P;PGeneral"),x.push("F;P0;DG0G8;M255"),m["!cols"]&&u(x,m["!cols"]),m["!rows"]&&h(x,m["!rows"]),x.push("B;Y"+(y.e.r-y.s.r+1)+";X"+(y.e.c-y.s.c+1)+";D"+[y.s.c,y.s.r,y.e.c,y.e.r].join(" "));for(var D=y.s.r;D<=y.e.r;++D)for(var V=y.s.c;V<=y.e.c;++V){var H=ot({r:D,c:V});I=P?(m[D]||[])[V]:m[H],!(!I||I.v==null&&(!I.f||I.F))&&g.push(c(I,m,D,V))}return x.join(A)+A+g.join(A)+A+"E"+A}return{to_workbook:l,to_sheet:i,from_sheet:f}})(),fS=(function(){function t(a,i){switch(i.type){case"base64":return e(Pn(a),i);case"binary":return e(a,i);case"buffer":return e(et&&Buffer.isBuffer(a)?a.toString("binary"):Xi(a),i);case"array":return e(Zl(a),i)}throw new Error("Unrecognized type "+i.type)}function e(a,i){for(var l=a.split(`
`),c=-1,u=-1,h=0,f=[];h!==l.length;++h){if(l[h].trim()==="BOT"){f[++c]=[],u=0;continue}if(!(c<0)){var m=l[h].trim().split(","),p=m[0],x=m[1];++h;for(var g=l[h]||"";(g.match(/["]/g)||[]).length&1&&h<l.length-1;)g+=`
`+l[++h];switch(g=g.trim(),+p){case-1:if(g==="BOT"){f[++c]=[],u=0;continue}else if(g!=="EOD")throw new Error("Unrecognized DIF special command "+g);break;case 0:g==="TRUE"?f[c][u]=!0:g==="FALSE"?f[c][u]=!1:isNaN(Tn(x))?isNaN(Ii(x).getDate())?f[c][u]=x:f[c][u]=gr(x):f[c][u]=Tn(x),++u;break;case 1:g=g.slice(1,g.length-1),g=g.replace(/""/g,'"'),g&&g.match(/^=".*"$/)&&(g=g.slice(2,-1)),f[c][u++]=g!==""?g:null;break}if(g==="EOD")break}}return i&&i.sheetRows&&(f=f.slice(0,i.sheetRows)),f}function r(a,i){return ka(t(a,i),i)}function n(a,i){return $s(r(a,i),i)}var s=(function(){var a=function(c,u,h,f,m){c.push(u),c.push(h+","+f),c.push('"'+m.replace(/"/g,'""')+'"')},i=function(c,u,h,f){c.push(u+","+h),c.push(u==1?'"'+f.replace(/"/g,'""')+'"':f)};return function(c){var u=[],h=xt(c["!ref"]),f,m=Array.isArray(c);a(u,"TABLE",0,1,"sheetjs"),a(u,"VECTORS",0,h.e.r-h.s.r+1,""),a(u,"TUPLES",0,h.e.c-h.s.c+1,""),a(u,"DATA",0,0,"");for(var p=h.s.r;p<=h.e.r;++p){i(u,-1,0,"BOT");for(var x=h.s.c;x<=h.e.c;++x){var g=ot({r:p,c:x});if(f=m?(c[p]||[])[x]:c[g],!f){i(u,1,0,"");continue}switch(f.t){case"n":var y=f.w;!y&&f.v!=null&&(y=f.v),y==null?f.f&&!f.F?i(u,1,0,"="+f.f):i(u,1,0,""):i(u,0,y,"V");break;case"b":i(u,0,f.v?1:0,f.v?"TRUE":"FALSE");break;case"s":i(u,1,0,isNaN(f.v)?f.v:'="'+f.v+'"');break;case"d":f.w||(f.w=ns(f.z||At[14],br(gr(f.v)))),i(u,0,f.w,"V");break;default:i(u,1,0,"")}}}i(u,-1,0,"EOD");var I=`\r
`,P=u.join(I);return P}})();return{to_workbook:n,to_sheet:r,from_sheet:s}})(),Wg=(function(){function t(f){return f.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function e(f){return f.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function r(f,m){for(var p=f.split(`
`),x=-1,g=-1,y=0,I=[];y!==p.length;++y){var P=p[y].trim().split(":");if(P[0]==="cell"){var A=Ht(P[1]);if(I.length<=A.r)for(x=I.length;x<=A.r;++x)I[x]||(I[x]=[]);switch(x=A.r,g=A.c,P[2]){case"t":I[x][g]=t(P[3]);break;case"v":I[x][g]=+P[3];break;case"vtf":var D=P[P.length-1];case"vtc":switch(P[3]){case"nl":I[x][g]=!!+P[4];break;default:I[x][g]=+P[4];break}P[2]=="vtf"&&(I[x][g]=[I[x][g],D])}}}return m&&m.sheetRows&&(I=I.slice(0,m.sheetRows)),I}function n(f,m){return ka(r(f,m),m)}function s(f,m){return $s(n(f,m),m)}var a=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),i=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,l=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),c="--SocialCalcSpreadsheetControlSave--";function u(f){if(!f||!f["!ref"])return"";for(var m=[],p=[],x,g="",y=kr(f["!ref"]),I=Array.isArray(f),P=y.s.r;P<=y.e.r;++P)for(var A=y.s.c;A<=y.e.c;++A)if(g=ot({r:P,c:A}),x=I?(f[P]||[])[A]:f[g],!(!x||x.v==null||x.t==="z")){switch(p=["cell",g,"t"],x.t){case"s":case"str":p.push(e(x.v));break;case"n":x.f?(p[2]="vtf",p[3]="n",p[4]=x.v,p[5]=e(x.f)):(p[2]="v",p[3]=x.v);break;case"b":p[2]="vt"+(x.f?"f":"c"),p[3]="nl",p[4]=x.v?"1":"0",p[5]=e(x.f||(x.v?"TRUE":"FALSE"));break;case"d":var D=br(gr(x.v));p[2]="vtc",p[3]="nd",p[4]=""+D,p[5]=x.w||ns(x.z||At[14],D);break;case"e":continue}m.push(p.join(":"))}return m.push("sheet:c:"+(y.e.c-y.s.c+1)+":r:"+(y.e.r-y.s.r+1)+":tvf:1"),m.push("valueformat:1:text-wiki"),m.join(`
`)}function h(f){return[a,i,l,i,u(f),c].join(`
`)}return{to_workbook:s,to_sheet:n,from_sheet:h}})(),mS=(function(){function t(h,f,m,p,x){x.raw?f[m][p]=h:h===""||(h==="TRUE"?f[m][p]=!0:h==="FALSE"?f[m][p]=!1:isNaN(Tn(h))?isNaN(Ii(h).getDate())?f[m][p]=h:f[m][p]=gr(h):f[m][p]=Tn(h))}function e(h,f){var m=f||{},p=[];if(!h||h.length===0)return p;for(var x=h.split(/[\r\n]/),g=x.length-1;g>=0&&x[g].length===0;)--g;for(var y=10,I=0,P=0;P<=g;++P)I=x[P].indexOf(" "),I==-1?I=x[P].length:I++,y=Math.max(y,I);for(P=0;P<=g;++P){p[P]=[];var A=0;for(t(x[P].slice(0,y).trim(),p,P,A,m),A=1;A<=(x[P].length-y)/10+1;++A)t(x[P].slice(y+(A-1)*10,y+A*10).trim(),p,P,A,m)}return m.sheetRows&&(p=p.slice(0,m.sheetRows)),p}var r={44:",",9:"	",59:";",124:"|"},n={44:3,9:2,59:1,124:0};function s(h){for(var f={},m=!1,p=0,x=0;p<h.length;++p)(x=h.charCodeAt(p))==34?m=!m:!m&&x in r&&(f[x]=(f[x]||0)+1);x=[];for(p in f)Object.prototype.hasOwnProperty.call(f,p)&&x.push([f[p],p]);if(!x.length){f=n;for(p in f)Object.prototype.hasOwnProperty.call(f,p)&&x.push([f[p],p])}return x.sort(function(g,y){return g[0]-y[0]||n[g[1]]-n[y[1]]}),r[x.pop()[1]]||44}function a(h,f){var m=f||{},p="",x=m.dense?[]:{},g={s:{c:0,r:0},e:{c:0,r:0}};h.slice(0,4)=="sep="?h.charCodeAt(5)==13&&h.charCodeAt(6)==10?(p=h.charAt(4),h=h.slice(7)):h.charCodeAt(5)==13||h.charCodeAt(5)==10?(p=h.charAt(4),h=h.slice(6)):p=s(h.slice(0,1024)):m&&m.FS?p=m.FS:p=s(h.slice(0,1024));var y=0,I=0,P=0,A=0,D=0,V=p.charCodeAt(0),H=!1,w=0,E=h.charCodeAt(0);h=h.replace(/\r\n/mg,`
`);var _=m.dateNF!=null?PT(m.dateNF):null;function N(){var T=h.slice(A,D),R={};if(T.charAt(0)=='"'&&T.charAt(T.length-1)=='"'&&(T=T.slice(1,-1).replace(/""/g,'"')),T.length===0)R.t="z";else if(m.raw)R.t="s",R.v=T;else if(T.trim().length===0)R.t="s",R.v=T;else if(T.charCodeAt(0)==61)T.charCodeAt(1)==34&&T.charCodeAt(T.length-1)==34?(R.t="s",R.v=T.slice(2,-1).replace(/""/g,'"')):dN(T)?(R.t="n",R.f=T.slice(1)):(R.t="s",R.v=T);else if(T=="TRUE")R.t="b",R.v=!0;else if(T=="FALSE")R.t="b",R.v=!1;else if(!isNaN(P=Tn(T)))R.t="n",m.cellText!==!1&&(R.w=T),R.v=P;else if(!isNaN(Ii(T).getDate())||_&&T.match(_)){R.z=m.dateNF||At[14];var S=0;_&&T.match(_)&&(T=RT(T,m.dateNF,T.match(_)||[]),S=1),m.cellDates?(R.t="d",R.v=gr(T,S)):(R.t="n",R.v=br(gr(T,S))),m.cellText!==!1&&(R.w=ns(R.z,R.v instanceof Date?br(R.v):R.v)),m.cellNF||delete R.z}else R.t="s",R.v=T;if(R.t=="z"||(m.dense?(x[y]||(x[y]=[]),x[y][I]=R):x[ot({c:I,r:y})]=R),A=D+1,E=h.charCodeAt(A),g.e.c<I&&(g.e.c=I),g.e.r<y&&(g.e.r=y),w==V)++I;else if(I=0,++y,m.sheetRows&&m.sheetRows<=y)return!0}e:for(;D<h.length;++D)switch(w=h.charCodeAt(D)){case 34:E===34&&(H=!H);break;case V:case 10:case 13:if(!H&&N())break e;break}return D-A>0&&N(),x["!ref"]=Dt(g),x}function i(h,f){return!(f&&f.PRN)||f.FS||h.slice(0,4)=="sep="||h.indexOf("	")>=0||h.indexOf(",")>=0||h.indexOf(";")>=0?a(h,f):ka(e(h,f),f)}function l(h,f){var m="",p=f.type=="string"?[0,0,0,0]:SP(h,f);switch(f.type){case"base64":m=Pn(h);break;case"binary":m=h;break;case"buffer":f.codepage==65001?m=h.toString("utf8"):f.codepage&&typeof il<"u"||(m=et&&Buffer.isBuffer(h)?h.toString("binary"):Xi(h));break;case"array":m=Zl(h);break;case"string":m=h;break;default:throw new Error("Unrecognized type "+f.type)}return p[0]==239&&p[1]==187&&p[2]==191?m=hi(m.slice(3)):f.type!="string"&&f.type!="buffer"&&f.codepage==65001?m=hi(m):f.type=="binary"&&typeof il<"u",m.slice(0,19)=="socialcalc:version:"?Wg.to_sheet(f.type=="string"?m:hi(m),f):i(m,f)}function c(h,f){return $s(l(h,f),f)}function u(h){for(var f=[],m=xt(h["!ref"]),p,x=Array.isArray(h),g=m.s.r;g<=m.e.r;++g){for(var y=[],I=m.s.c;I<=m.e.c;++I){var P=ot({r:g,c:I});if(p=x?(h[g]||[])[I]:h[P],!p||p.v==null){y.push("          ");continue}for(var A=(p.w||(Rn(p),p.w)||"").slice(0,10);A.length<10;)A+=" ";y.push(A+(I===0?" ":""))}f.push(y.join(""))}return f.join(`
`)}return{to_workbook:c,to_sheet:l,from_sheet:u}})(),qf=(function(){function t(U,Y,q){if(U){Nr(U,U.l||0);for(var W=q.Enum||Oe;U.l<U.length;){var ae=U.read_shift(2),be=W[ae]||W[65535],ye=U.read_shift(2),pe=U.l+ye,xe=be.f&&be.f(U,ye,q);if(U.l=pe,Y(xe,be,ae))return}}}function e(U,Y){switch(Y.type){case"base64":return r(qr(Pn(U)),Y);case"binary":return r(qr(U),Y);case"buffer":case"array":return r(U,Y)}throw"Unsupported type "+Y.type}function r(U,Y){if(!U)return U;var q=Y||{},W=q.dense?[]:{},ae="Sheet1",be="",ye=0,pe={},xe=[],We=[],Ve={s:{r:0,c:0},e:{r:0,c:0}},nt=q.sheetRows||0;if(U[2]==0&&(U[3]==8||U[3]==9)&&U.length>=16&&U[14]==5&&U[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(U[2]==2)q.Enum=Oe,t(U,function(Ne,jt,tt){switch(tt){case 0:q.vers=Ne,Ne>=4096&&(q.qpro=!0);break;case 6:Ve=Ne;break;case 204:Ne&&(be=Ne);break;case 222:be=Ne;break;case 15:case 51:q.qpro||(Ne[1].v=Ne[1].v.slice(1));case 13:case 14:case 16:tt==14&&(Ne[2]&112)==112&&(Ne[2]&15)>1&&(Ne[2]&15)<15&&(Ne[1].z=q.dateNF||At[14],q.cellDates&&(Ne[1].t="d",Ne[1].v=og(Ne[1].v))),q.qpro&&Ne[3]>ye&&(W["!ref"]=Dt(Ve),pe[ae]=W,xe.push(ae),W=q.dense?[]:{},Ve={s:{r:0,c:0},e:{r:0,c:0}},ye=Ne[3],ae=be||"Sheet"+(ye+1),be="");var ct=q.dense?(W[Ne[0].r]||[])[Ne[0].c]:W[ot(Ne[0])];if(ct){ct.t=Ne[1].t,ct.v=Ne[1].v,Ne[1].z!=null&&(ct.z=Ne[1].z),Ne[1].f!=null&&(ct.f=Ne[1].f);break}q.dense?(W[Ne[0].r]||(W[Ne[0].r]=[]),W[Ne[0].r][Ne[0].c]=Ne[1]):W[ot(Ne[0])]=Ne[1];break}},q);else if(U[2]==26||U[2]==14)q.Enum=Je,U[2]==14&&(q.qpro=!0,U.l=0),t(U,function(Ne,jt,tt){switch(tt){case 204:ae=Ne;break;case 22:Ne[1].v=Ne[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(Ne[3]>ye&&(W["!ref"]=Dt(Ve),pe[ae]=W,xe.push(ae),W=q.dense?[]:{},Ve={s:{r:0,c:0},e:{r:0,c:0}},ye=Ne[3],ae="Sheet"+(ye+1)),nt>0&&Ne[0].r>=nt)break;q.dense?(W[Ne[0].r]||(W[Ne[0].r]=[]),W[Ne[0].r][Ne[0].c]=Ne[1]):W[ot(Ne[0])]=Ne[1],Ve.e.c<Ne[0].c&&(Ve.e.c=Ne[0].c),Ve.e.r<Ne[0].r&&(Ve.e.r=Ne[0].r);break;case 27:Ne[14e3]&&(We[Ne[14e3][0]]=Ne[14e3][1]);break;case 1537:We[Ne[0]]=Ne[1],Ne[0]==ye&&(ae=Ne[1]);break}},q);else throw new Error("Unrecognized LOTUS BOF "+U[2]);if(W["!ref"]=Dt(Ve),pe[be||ae]=W,xe.push(be||ae),!We.length)return{SheetNames:xe,Sheets:pe};for(var qe={},hr=[],Xe=0;Xe<We.length;++Xe)pe[xe[Xe]]?(hr.push(We[Xe]||xe[Xe]),qe[We[Xe]]=pe[We[Xe]]||pe[xe[Xe]]):(hr.push(We[Xe]),qe[We[Xe]]={"!ref":"A1"});return{SheetNames:hr,Sheets:qe}}function n(U,Y){var q=Y||{};if(+q.codepage>=0&&Ni(+q.codepage),q.type=="string")throw new Error("Cannot write WK1 to JS string");var W=wr(),ae=xt(U["!ref"]),be=Array.isArray(U),ye=[];ve(W,0,a(1030)),ve(W,6,c(ae));for(var pe=Math.min(ae.e.r,8191),xe=ae.s.r;xe<=pe;++xe)for(var We=Jt(xe),Ve=ae.s.c;Ve<=ae.e.c;++Ve){xe===ae.s.r&&(ye[Ve]=cr(Ve));var nt=ye[Ve]+We,qe=be?(U[xe]||[])[Ve]:U[nt];if(!(!qe||qe.t=="z"))if(qe.t=="n")(qe.v|0)==qe.v&&qe.v>=-32768&&qe.v<=32767?ve(W,13,p(xe,Ve,qe.v)):ve(W,14,g(xe,Ve,qe.v));else{var hr=Rn(qe);ve(W,15,f(xe,Ve,hr.slice(0,239)))}}return ve(W,1),W.end()}function s(U,Y){var q=Y||{};if(+q.codepage>=0&&Ni(+q.codepage),q.type=="string")throw new Error("Cannot write WK3 to JS string");var W=wr();ve(W,0,i(U));for(var ae=0,be=0;ae<U.SheetNames.length;++ae)(U.Sheets[U.SheetNames[ae]]||{})["!ref"]&&ve(W,27,Ae(U.SheetNames[ae],be++));var ye=0;for(ae=0;ae<U.SheetNames.length;++ae){var pe=U.Sheets[U.SheetNames[ae]];if(!(!pe||!pe["!ref"])){for(var xe=xt(pe["!ref"]),We=Array.isArray(pe),Ve=[],nt=Math.min(xe.e.r,8191),qe=xe.s.r;qe<=nt;++qe)for(var hr=Jt(qe),Xe=xe.s.c;Xe<=xe.e.c;++Xe){qe===xe.s.r&&(Ve[Xe]=cr(Xe));var Ne=Ve[Xe]+hr,jt=We?(pe[qe]||[])[Xe]:pe[Ne];if(!(!jt||jt.t=="z"))if(jt.t=="n")ve(W,23,N(qe,Xe,ye,jt.v));else{var tt=Rn(jt);ve(W,22,w(qe,Xe,ye,tt.slice(0,239)))}}++ye}}return ve(W,1),W.end()}function a(U){var Y=ee(2);return Y.write_shift(2,U),Y}function i(U){var Y=ee(26);Y.write_shift(2,4096),Y.write_shift(2,4),Y.write_shift(4,0);for(var q=0,W=0,ae=0,be=0;be<U.SheetNames.length;++be){var ye=U.SheetNames[be],pe=U.Sheets[ye];if(!(!pe||!pe["!ref"])){++ae;var xe=kr(pe["!ref"]);q<xe.e.r&&(q=xe.e.r),W<xe.e.c&&(W=xe.e.c)}}return q>8191&&(q=8191),Y.write_shift(2,q),Y.write_shift(1,ae),Y.write_shift(1,W),Y.write_shift(2,0),Y.write_shift(2,0),Y.write_shift(1,1),Y.write_shift(1,2),Y.write_shift(4,0),Y.write_shift(4,0),Y}function l(U,Y,q){var W={s:{c:0,r:0},e:{c:0,r:0}};return Y==8&&q.qpro?(W.s.c=U.read_shift(1),U.l++,W.s.r=U.read_shift(2),W.e.c=U.read_shift(1),U.l++,W.e.r=U.read_shift(2),W):(W.s.c=U.read_shift(2),W.s.r=U.read_shift(2),Y==12&&q.qpro&&(U.l+=2),W.e.c=U.read_shift(2),W.e.r=U.read_shift(2),Y==12&&q.qpro&&(U.l+=2),W.s.c==65535&&(W.s.c=W.e.c=W.s.r=W.e.r=0),W)}function c(U){var Y=ee(8);return Y.write_shift(2,U.s.c),Y.write_shift(2,U.s.r),Y.write_shift(2,U.e.c),Y.write_shift(2,U.e.r),Y}function u(U,Y,q){var W=[{c:0,r:0},{t:"n",v:0},0,0];return q.qpro&&q.vers!=20768?(W[0].c=U.read_shift(1),W[3]=U.read_shift(1),W[0].r=U.read_shift(2),U.l+=2):(W[2]=U.read_shift(1),W[0].c=U.read_shift(2),W[0].r=U.read_shift(2)),W}function h(U,Y,q){var W=U.l+Y,ae=u(U,Y,q);if(ae[1].t="s",q.vers==20768){U.l++;var be=U.read_shift(1);return ae[1].v=U.read_shift(be,"utf8"),ae}return q.qpro&&U.l++,ae[1].v=U.read_shift(W-U.l,"cstr"),ae}function f(U,Y,q){var W=ee(7+q.length);W.write_shift(1,255),W.write_shift(2,Y),W.write_shift(2,U),W.write_shift(1,39);for(var ae=0;ae<W.length;++ae){var be=q.charCodeAt(ae);W.write_shift(1,be>=128?95:be)}return W.write_shift(1,0),W}function m(U,Y,q){var W=u(U,Y,q);return W[1].v=U.read_shift(2,"i"),W}function p(U,Y,q){var W=ee(7);return W.write_shift(1,255),W.write_shift(2,Y),W.write_shift(2,U),W.write_shift(2,q,"i"),W}function x(U,Y,q){var W=u(U,Y,q);return W[1].v=U.read_shift(8,"f"),W}function g(U,Y,q){var W=ee(13);return W.write_shift(1,255),W.write_shift(2,Y),W.write_shift(2,U),W.write_shift(8,q,"f"),W}function y(U,Y,q){var W=U.l+Y,ae=u(U,Y,q);if(ae[1].v=U.read_shift(8,"f"),q.qpro)U.l=W;else{var be=U.read_shift(2);D(U.slice(U.l,U.l+be),ae),U.l+=be}return ae}function I(U,Y,q){var W=Y&32768;return Y&=-32769,Y=(W?U:0)+(Y>=8192?Y-16384:Y),(W?"":"$")+(q?cr(Y):Jt(Y))}var P={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},A=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function D(U,Y){Nr(U,0);for(var q=[],W=0,ae="",be="",ye="",pe="";U.l<U.length;){var xe=U[U.l++];switch(xe){case 0:q.push(U.read_shift(8,"f"));break;case 1:be=I(Y[0].c,U.read_shift(2),!0),ae=I(Y[0].r,U.read_shift(2),!1),q.push(be+ae);break;case 2:{var We=I(Y[0].c,U.read_shift(2),!0),Ve=I(Y[0].r,U.read_shift(2),!1);be=I(Y[0].c,U.read_shift(2),!0),ae=I(Y[0].r,U.read_shift(2),!1),q.push(We+Ve+":"+be+ae)}break;case 3:if(U.l<U.length){console.error("WK1 premature formula end");return}break;case 4:q.push("("+q.pop()+")");break;case 5:q.push(U.read_shift(2));break;case 6:{for(var nt="";xe=U[U.l++];)nt+=String.fromCharCode(xe);q.push('"'+nt.replace(/"/g,'""')+'"')}break;case 8:q.push("-"+q.pop());break;case 23:q.push("+"+q.pop());break;case 22:q.push("NOT("+q.pop()+")");break;case 20:case 21:pe=q.pop(),ye=q.pop(),q.push(["AND","OR"][xe-20]+"("+ye+","+pe+")");break;default:if(xe<32&&A[xe])pe=q.pop(),ye=q.pop(),q.push(ye+A[xe]+pe);else if(P[xe]){if(W=P[xe][1],W==69&&(W=U[U.l++]),W>q.length){console.error("WK1 bad formula parse 0x"+xe.toString(16)+":|"+q.join("|")+"|");return}var qe=q.slice(-W);q.length-=W,q.push(P[xe][0]+"("+qe.join(",")+")")}else return xe<=7?console.error("WK1 invalid opcode "+xe.toString(16)):xe<=24?console.error("WK1 unsupported op "+xe.toString(16)):xe<=30?console.error("WK1 invalid opcode "+xe.toString(16)):xe<=115?console.error("WK1 unsupported function opcode "+xe.toString(16)):console.error("WK1 unrecognized opcode "+xe.toString(16))}}q.length==1?Y[1].f=""+q[0]:console.error("WK1 bad formula parse |"+q.join("|")+"|")}function V(U){var Y=[{c:0,r:0},{t:"n",v:0},0];return Y[0].r=U.read_shift(2),Y[3]=U[U.l++],Y[0].c=U[U.l++],Y}function H(U,Y){var q=V(U);return q[1].t="s",q[1].v=U.read_shift(Y-4,"cstr"),q}function w(U,Y,q,W){var ae=ee(6+W.length);ae.write_shift(2,U),ae.write_shift(1,q),ae.write_shift(1,Y),ae.write_shift(1,39);for(var be=0;be<W.length;++be){var ye=W.charCodeAt(be);ae.write_shift(1,ye>=128?95:ye)}return ae.write_shift(1,0),ae}function E(U,Y){var q=V(U);q[1].v=U.read_shift(2);var W=q[1].v>>1;if(q[1].v&1)switch(W&7){case 0:W=(W>>3)*5e3;break;case 1:W=(W>>3)*500;break;case 2:W=(W>>3)/20;break;case 3:W=(W>>3)/200;break;case 4:W=(W>>3)/2e3;break;case 5:W=(W>>3)/2e4;break;case 6:W=(W>>3)/16;break;case 7:W=(W>>3)/64;break}return q[1].v=W,q}function _(U,Y){var q=V(U),W=U.read_shift(4),ae=U.read_shift(4),be=U.read_shift(2);if(be==65535)return W===0&&ae===3221225472?(q[1].t="e",q[1].v=15):W===0&&ae===3489660928?(q[1].t="e",q[1].v=42):q[1].v=0,q;var ye=be&32768;return be=(be&32767)-16446,q[1].v=(1-ye*2)*(ae*Math.pow(2,be+32)+W*Math.pow(2,be)),q}function N(U,Y,q,W){var ae=ee(14);if(ae.write_shift(2,U),ae.write_shift(1,q),ae.write_shift(1,Y),W==0)return ae.write_shift(4,0),ae.write_shift(4,0),ae.write_shift(2,65535),ae;var be=0,ye=0,pe=0,xe=0;return W<0&&(be=1,W=-W),ye=Math.log2(W)|0,W/=Math.pow(2,ye-31),xe=W>>>0,(xe&2147483648)==0&&(W/=2,++ye,xe=W>>>0),W-=xe,xe|=2147483648,xe>>>=0,W*=Math.pow(2,32),pe=W>>>0,ae.write_shift(4,pe),ae.write_shift(4,xe),ye+=16383+(be?32768:0),ae.write_shift(2,ye),ae}function T(U,Y){var q=_(U);return U.l+=Y-14,q}function R(U,Y){var q=V(U),W=U.read_shift(4);return q[1].v=W>>6,q}function S(U,Y){var q=V(U),W=U.read_shift(8,"f");return q[1].v=W,q}function se(U,Y){var q=S(U);return U.l+=Y-10,q}function te(U,Y){return U[U.l+Y-1]==0?U.read_shift(Y,"cstr"):""}function me(U,Y){var q=U[U.l++];q>Y-1&&(q=Y-1);for(var W="";W.length<q;)W+=String.fromCharCode(U[U.l++]);return W}function ce(U,Y,q){if(!(!q.qpro||Y<21)){var W=U.read_shift(1);U.l+=17,U.l+=1,U.l+=2;var ae=U.read_shift(Y-21,"cstr");return[W,ae]}}function le(U,Y){for(var q={},W=U.l+Y;U.l<W;){var ae=U.read_shift(2);if(ae==14e3){for(q[ae]=[0,""],q[ae][0]=U.read_shift(2);U[U.l];)q[ae][1]+=String.fromCharCode(U[U.l]),U.l++;U.l++}}return q}function Ae(U,Y){var q=ee(5+U.length);q.write_shift(2,14e3),q.write_shift(2,Y);for(var W=0;W<U.length;++W){var ae=U.charCodeAt(W);q[q.l++]=ae>127?95:ae}return q[q.l++]=0,q}var Oe={0:{n:"BOF",f:Bg},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:l},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:m},14:{n:"NUMBER",f:x},15:{n:"LABEL",f:h},16:{n:"FORMULA",f:y},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:h},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:te},222:{n:"SHEETNAMELP",f:me},65535:{n:""}},Je={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:H},23:{n:"NUMBER17",f:_},24:{n:"NUMBER18",f:E},25:{n:"FORMULA19",f:T},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:le},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:R},38:{n:"??"},39:{n:"NUMBER27",f:S},40:{n:"FORMULA28",f:se},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:te},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:ce},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:n,book_to_wk3:s,to_workbook:e}})(),pS=/^\s|\s$|[\t\n\r]/;function qg(t,e){if(!e.bookSST)return"";var r=[Ft];r[r.length]=ge("sst",null,{xmlns:ja[0],count:t.Count,uniqueCount:t.Unique});for(var n=0;n!=t.length;++n)if(t[n]!=null){var s=t[n],a="<si>";s.r?a+=s.r:(a+="<t",s.t||(s.t=""),s.t.match(pS)&&(a+=' xml:space="preserve"'),a+=">"+it(s.t)+"</t>"),a+="</si>",r[r.length]=a}return r.length>2&&(r[r.length]="</sst>",r[1]=r[1].replace("/>",">")),r.join("")}function gS(t){return[t.read_shift(4),t.read_shift(4)]}function xS(t,e){return e||(e=ee(8)),e.write_shift(4,t.Count),e.write_shift(4,t.Unique),e}var vS=lA;function yS(t){var e=wr();oe(e,159,xS(t));for(var r=0;r<t.length;++r)oe(e,19,vS(t[r]));return oe(e,160),e.end()}function _S(t){for(var e=[],r=t.split(""),n=0;n<r.length;++n)e[n]=r[n].charCodeAt(0);return e}function Gg(t){var e=0,r,n=_S(t),s=n.length+1,a,i,l,c,u;for(r=ks(s),r[0]=n.length,a=1;a!=s;++a)r[a]=n[a-1];for(a=s-1;a>=0;--a)i=r[a],l=(e&16384)===0?0:1,c=e<<1&32767,u=l|c,e=u^i;return e^52811}var wS=(function(){function t(s,a){switch(a.type){case"base64":return e(Pn(s),a);case"binary":return e(s,a);case"buffer":return e(et&&Buffer.isBuffer(s)?s.toString("binary"):Xi(s),a);case"array":return e(Zl(s),a)}throw new Error("Unrecognized type "+a.type)}function e(s,a){var i=a||{},l=i.dense?[]:{},c=s.match(/\\trowd.*?\\row\b/g);if(!c.length)throw new Error("RTF missing table");var u={s:{c:0,r:0},e:{c:0,r:c.length-1}};return c.forEach(function(h,f){Array.isArray(l)&&(l[f]=[]);for(var m=/\\\w+\b/g,p=0,x,g=-1;x=m.exec(h);){switch(x[0]){case"\\cell":var y=h.slice(p,m.lastIndex-x[0].length);if(y[0]==" "&&(y=y.slice(1)),++g,y.length){var I={v:y,t:"s"};Array.isArray(l)?l[f][g]=I:l[ot({r:f,c:g})]=I}break}p=m.lastIndex}g>u.e.c&&(u.e.c=g)}),l["!ref"]=Dt(u),l}function r(s,a){return $s(t(s,a),a)}function n(s){for(var a=["{\\rtf1\\ansi"],i=xt(s["!ref"]),l,c=Array.isArray(s),u=i.s.r;u<=i.e.r;++u){a.push("\\trowd\\trautofit1");for(var h=i.s.c;h<=i.e.c;++h)a.push("\\cellx"+(h+1));for(a.push("\\pard\\intbl"),h=i.s.c;h<=i.e.c;++h){var f=ot({r:u,c:h});l=c?(s[u]||[])[h]:s[f],!(!l||l.v==null&&(!l.f||l.F))&&(a.push(" "+(l.w||(Rn(l),l.w))),a.push("\\cell"))}a.push("\\pard\\intbl\\row")}return a.join("")+"}"}return{to_workbook:r,to_sheet:t,from_sheet:n}})();function Gf(t){for(var e=0,r=1;e!=3;++e)r=r*256+(t[e]>255?255:t[e]<0?0:t[e]);return r.toString(16).toUpperCase().slice(1)}var bS=6,An=bS;function pl(t){return Math.floor((t+Math.round(128/An)/256)*An)}function gl(t){return Math.floor((t-5)/An*100+.5)/100}function pu(t){return Math.round((t*An+5)/An*256)/256}function gh(t){t.width?(t.wpx=pl(t.width),t.wch=gl(t.wpx),t.MDW=An):t.wpx?(t.wch=gl(t.wpx),t.width=pu(t.wch),t.MDW=An):typeof t.wch=="number"&&(t.width=pu(t.wch),t.wpx=pl(t.width),t.MDW=An),t.customWidth&&delete t.customWidth}var ES=96,zg=ES;function xl(t){return t*96/zg}function Yg(t){return t*zg/96}function TS(t){var e=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var n=r[0];n<=r[1];++n)t[n]!=null&&(e[e.length]=ge("numFmt",null,{numFmtId:n,formatCode:it(t[n])}))}),e.length===1?"":(e[e.length]="</numFmts>",e[0]=ge("numFmts",null,{count:e.length-2}).replace("/>",">"),e.join(""))}function AS(t){var e=[];return e[e.length]=ge("cellXfs",null),t.forEach(function(r){e[e.length]=ge("xf",null,r)}),e[e.length]="</cellXfs>",e.length===2?"":(e[0]=ge("cellXfs",null,{count:e.length-2}).replace("/>",">"),e.join(""))}function Kg(t,e){var r=[Ft,ge("styleSheet",null,{xmlns:ja[0],"xmlns:vt":$t.vt})],n;return t.SSF&&(n=TS(t.SSF))!=null&&(r[r.length]=n),r[r.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',r[r.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',r[r.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',r[r.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(n=AS(e.cellXfs))&&(r[r.length]=n),r[r.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',r[r.length]='<dxfs count="0"/>',r[r.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',r.length>2&&(r[r.length]="</styleSheet>",r[1]=r[1].replace("/>",">")),r.join("")}function SS(t,e){var r=t.read_shift(2),n=ur(t);return[r,n]}function NS(t,e,r){r||(r=ee(6+4*e.length)),r.write_shift(2,t),Wt(e,r);var n=r.length>r.l?r.slice(0,r.l):r;return r.l==null&&(r.l=r.length),n}function CS(t,e,r){var n={};n.sz=t.read_shift(2)/20;var s=pA(t);s.fItalic&&(n.italic=1),s.fCondense&&(n.condense=1),s.fExtend&&(n.extend=1),s.fShadow&&(n.shadow=1),s.fOutline&&(n.outline=1),s.fStrikeout&&(n.strike=1);var a=t.read_shift(2);switch(a===700&&(n.bold=1),t.read_shift(2)){case 1:n.vertAlign="superscript";break;case 2:n.vertAlign="subscript";break}var i=t.read_shift(1);i!=0&&(n.underline=i);var l=t.read_shift(1);l>0&&(n.family=l);var c=t.read_shift(1);switch(c>0&&(n.charset=c),t.l++,n.color=mA(t),t.read_shift(1)){case 1:n.scheme="major";break;case 2:n.scheme="minor";break}return n.name=ur(t),n}function IS(t,e){e||(e=ee(153)),e.write_shift(2,t.sz*20),gA(t,e),e.write_shift(2,t.bold?700:400);var r=0;t.vertAlign=="superscript"?r=1:t.vertAlign=="subscript"&&(r=2),e.write_shift(2,r),e.write_shift(1,t.underline||0),e.write_shift(1,t.family||0),e.write_shift(1,t.charset||0),e.write_shift(1,0),fl(t.color,e);var n=0;return n=2,e.write_shift(1,n),Wt(t.name,e),e.length>e.l?e.slice(0,e.l):e}var PS=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],Bc,RS=pn;function zf(t,e){e||(e=ee(84)),Bc||(Bc=sh(PS));var r=Bc[t.patternType];r==null&&(r=40),e.write_shift(4,r);var n=0;if(r!=40)for(fl({auto:1},e),fl({auto:1},e);n<12;++n)e.write_shift(4,0);else{for(;n<4;++n)e.write_shift(4,0);for(;n<12;++n)e.write_shift(4,0)}return e.length>e.l?e.slice(0,e.l):e}function DS(t,e){var r=t.l+e,n=t.read_shift(2),s=t.read_shift(2);return t.l=r,{ixfe:n,numFmtId:s}}function Xg(t,e,r){r||(r=ee(16)),r.write_shift(2,e||0),r.write_shift(2,t.numFmtId||0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(1,0),r.write_shift(1,0);var n=0;return r.write_shift(1,n),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(1,0),r}function ti(t,e){return e||(e=ee(10)),e.write_shift(1,0),e.write_shift(1,0),e.write_shift(4,0),e.write_shift(4,0),e}var FS=pn;function jS(t,e){return e||(e=ee(51)),e.write_shift(1,0),ti(null,e),ti(null,e),ti(null,e),ti(null,e),ti(null,e),e.length>e.l?e.slice(0,e.l):e}function kS(t,e){return e||(e=ee(52)),e.write_shift(4,t.xfId),e.write_shift(2,1),e.write_shift(1,0),e.write_shift(1,0),dl(t.name||"",e),e.length>e.l?e.slice(0,e.l):e}function OS(t,e,r){var n=ee(2052);return n.write_shift(4,t),dl(e,n),dl(r,n),n.length>n.l?n.slice(0,n.l):n}function MS(t,e){if(e){var r=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var s=n[0];s<=n[1];++s)e[s]!=null&&++r}),r!=0&&(oe(t,615,Yr(r)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var s=n[0];s<=n[1];++s)e[s]!=null&&oe(t,44,NS(s,e[s]))}),oe(t,616))}}function LS(t){var e=1;oe(t,611,Yr(e)),oe(t,43,IS({sz:12,color:{theme:1},name:"Calibri",family:2})),oe(t,612)}function BS(t){var e=2;oe(t,603,Yr(e)),oe(t,45,zf({patternType:"none"})),oe(t,45,zf({patternType:"gray125"})),oe(t,604)}function VS(t){var e=1;oe(t,613,Yr(e)),oe(t,46,jS()),oe(t,614)}function US(t){var e=1;oe(t,626,Yr(e)),oe(t,47,Xg({numFmtId:0},65535)),oe(t,627)}function $S(t,e){oe(t,617,Yr(e.length)),e.forEach(function(r){oe(t,47,Xg(r,0))}),oe(t,618)}function HS(t){var e=1;oe(t,619,Yr(e)),oe(t,48,kS({xfId:0,name:"Normal"})),oe(t,620)}function WS(t){var e=0;oe(t,505,Yr(e)),oe(t,506)}function qS(t){var e=0;oe(t,508,OS(e,"TableStyleMedium9","PivotStyleMedium4")),oe(t,509)}function GS(t,e){var r=wr();return oe(r,278),MS(r,t.SSF),LS(r),BS(r),VS(r),US(r),$S(r,e.cellXfs),HS(r),WS(r),qS(r),oe(r,279),r.end()}function Qg(t,e){if(e&&e.themeXLSX)return e.themeXLSX;if(t&&typeof t.raw=="string")return t.raw;var r=[Ft];return r[r.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',r[r.length]="<a:themeElements>",r[r.length]='<a:clrScheme name="Office">',r[r.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',r[r.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',r[r.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',r[r.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',r[r.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',r[r.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',r[r.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',r[r.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',r[r.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',r[r.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',r[r.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',r[r.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',r[r.length]="</a:clrScheme>",r[r.length]='<a:fontScheme name="Office">',r[r.length]="<a:majorFont>",r[r.length]='<a:latin typeface="Cambria"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface=" "/>',r[r.length]='<a:font script="Hang" typeface=" "/>',r[r.length]='<a:font script="Hans" typeface=""/>',r[r.length]='<a:font script="Hant" typeface=""/>',r[r.length]='<a:font script="Arab" typeface="Times New Roman"/>',r[r.length]='<a:font script="Hebr" typeface="Times New Roman"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="MoolBoran"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Times New Roman"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:majorFont>",r[r.length]="<a:minorFont>",r[r.length]='<a:latin typeface="Calibri"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface=" "/>',r[r.length]='<a:font script="Hang" typeface=" "/>',r[r.length]='<a:font script="Hans" typeface=""/>',r[r.length]='<a:font script="Hant" typeface=""/>',r[r.length]='<a:font script="Arab" typeface="Arial"/>',r[r.length]='<a:font script="Hebr" typeface="Arial"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="DaunPenh"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Arial"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:minorFont>",r[r.length]="</a:fontScheme>",r[r.length]='<a:fmtScheme name="Office">',r[r.length]="<a:fillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="1"/>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="0"/>',r[r.length]="</a:gradFill>",r[r.length]="</a:fillStyleLst>",r[r.length]="<a:lnStyleLst>",r[r.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]="</a:lnStyleLst>",r[r.length]="<a:effectStyleLst>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',r[r.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',r[r.length]="</a:effectStyle>",r[r.length]="</a:effectStyleLst>",r[r.length]="<a:bgFillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]="</a:bgFillStyleLst>",r[r.length]="</a:fmtScheme>",r[r.length]="</a:themeElements>",r[r.length]="<a:objectDefaults>",r[r.length]="<a:spDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',r[r.length]="</a:spDef>",r[r.length]="<a:lnDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',r[r.length]="</a:lnDef>",r[r.length]="</a:objectDefaults>",r[r.length]="<a:extraClrSchemeLst/>",r[r.length]="</a:theme>",r.join("")}function zS(t,e){return{flags:t.read_shift(4),version:t.read_shift(4),name:ur(t)}}function YS(t){var e=ee(12+2*t.name.length);return e.write_shift(4,t.flags),e.write_shift(4,t.version),Wt(t.name,e),e.slice(0,e.l)}function KS(t){for(var e=[],r=t.read_shift(4);r-- >0;)e.push([t.read_shift(4),t.read_shift(4)]);return e}function XS(t){var e=ee(4+8*t.length);e.write_shift(4,t.length);for(var r=0;r<t.length;++r)e.write_shift(4,t[r][0]),e.write_shift(4,t[r][1]);return e}function QS(t,e){var r=ee(8+2*e.length);return r.write_shift(4,t),Wt(e,r),r.slice(0,r.l)}function JS(t){return t.l+=4,t.read_shift(4)!=0}function ZS(t,e){var r=ee(8);return r.write_shift(4,t),r.write_shift(4,1),r}function eN(){var t=wr();return oe(t,332),oe(t,334,Yr(1)),oe(t,335,YS({name:"XLDAPR",version:12e4,flags:3496657072})),oe(t,336),oe(t,339,QS(1,"XLDAPR")),oe(t,52),oe(t,35,Yr(514)),oe(t,4096,Yr(0)),oe(t,4097,Mr(1)),oe(t,36),oe(t,53),oe(t,340),oe(t,337,ZS(1)),oe(t,51,XS([[1,0]])),oe(t,338),oe(t,333),t.end()}function Jg(){var t=[Ft];return t.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),t.join("")}function tN(t){var e={};e.i=t.read_shift(4);var r={};r.r=t.read_shift(4),r.c=t.read_shift(4),e.r=ot(r);var n=t.read_shift(1);return n&2&&(e.l="1"),n&8&&(e.a="1"),e}var ua=1024;function Zg(t,e){for(var r=[21600,21600],n=["m0,0l0",r[1],r[0],r[1],r[0],"0xe"].join(","),s=[ge("xml",null,{"xmlns:v":Ir.v,"xmlns:o":Ir.o,"xmlns:x":Ir.x,"xmlns:mv":Ir.mv}).replace(/\/>/,">"),ge("o:shapelayout",ge("o:idmap",null,{"v:ext":"edit",data:t}),{"v:ext":"edit"}),ge("v:shapetype",[ge("v:stroke",null,{joinstyle:"miter"}),ge("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:r.join(","),path:n})];ua<t*1e3;)ua+=1e3;return e.forEach(function(a){var i=Ht(a[0]),l={color2:"#BEFF82",type:"gradient"};l.type=="gradient"&&(l.angle="-180");var c=l.type=="gradient"?ge("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,u=ge("v:fill",c,l),h={on:"t",obscured:"t"};++ua,s=s.concat(["<v:shape"+Ri({id:"_x0000_s"+ua,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(a[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",u,ge("v:shadow",null,h),ge("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",Xt("x:Anchor",[i.c+1,0,i.r+1,0,i.c+3,20,i.r+5,20].join(",")),Xt("x:AutoFill","False"),Xt("x:Row",String(i.r)),Xt("x:Column",String(i.c)),a[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),s.push("</xml>"),s.join("")}function ex(t){var e=[Ft,ge("comments",null,{xmlns:ja[0]})],r=[];return e.push("<authors>"),t.forEach(function(n){n[1].forEach(function(s){var a=it(s.a);r.indexOf(a)==-1&&(r.push(a),e.push("<author>"+a+"</author>")),s.T&&s.ID&&r.indexOf("tc="+s.ID)==-1&&(r.push("tc="+s.ID),e.push("<author>tc="+s.ID+"</author>"))})}),r.length==0&&(r.push("SheetJ5"),e.push("<author>SheetJ5</author>")),e.push("</authors>"),e.push("<commentList>"),t.forEach(function(n){var s=0,a=[];if(n[1][0]&&n[1][0].T&&n[1][0].ID?s=r.indexOf("tc="+n[1][0].ID):n[1].forEach(function(c){c.a&&(s=r.indexOf(it(c.a))),a.push(c.t||"")}),e.push('<comment ref="'+n[0]+'" authorId="'+s+'"><text>'),a.length<=1)e.push(Xt("t",it(a[0]||"")));else{for(var i=`Comment:
    `+a[0]+`
`,l=1;l<a.length;++l)i+=`Reply:
    `+a[l]+`
`;e.push(Xt("t",it(i)))}e.push("</text></comment>")}),e.push("</commentList>"),e.length>2&&(e[e.length]="</comments>",e[1]=e[1].replace("/>",">")),e.join("")}function rN(t,e,r){var n=[Ft,ge("ThreadedComments",null,{xmlns:$t.TCMNT}).replace(/[\/]>/,">")];return t.forEach(function(s){var a="";(s[1]||[]).forEach(function(i,l){if(!i.T){delete i.ID;return}i.a&&e.indexOf(i.a)==-1&&e.push(i.a);var c={ref:s[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+r.tcid++).slice(-12)+"}"};l==0?a=c.id:c.parentId=a,i.ID=c.id,i.a&&(c.personId="{54EE7950-7262-4200-6969-"+("000000000000"+e.indexOf(i.a)).slice(-12)+"}"),n.push(ge("threadedComment",Xt("text",i.t||""),c))})}),n.push("</ThreadedComments>"),n.join("")}function nN(t){var e=[Ft,ge("personList",null,{xmlns:$t.TCMNT,"xmlns:x":ja[0]}).replace(/[\/]>/,">")];return t.forEach(function(r,n){e.push(ge("person",null,{displayName:r,id:"{54EE7950-7262-4200-6969-"+("000000000000"+n).slice(-12)+"}",userId:r,providerId:"None"}))}),e.push("</personList>"),e.join("")}function sN(t){var e={};e.iauthor=t.read_shift(4);var r=Gs(t);return e.rfx=r.s,e.ref=ot(r.s),t.l+=16,e}function aN(t,e){return e==null&&(e=ee(36)),e.write_shift(4,t[1].iauthor),Oa(t[0],e),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(4,0),e}var iN=ur;function oN(t){return Wt(t.slice(0,54))}function lN(t){var e=wr(),r=[];return oe(e,628),oe(e,630),t.forEach(function(n){n[1].forEach(function(s){r.indexOf(s.a)>-1||(r.push(s.a.slice(0,54)),oe(e,632,oN(s.a)))})}),oe(e,631),oe(e,633),t.forEach(function(n){n[1].forEach(function(s){s.iauthor=r.indexOf(s.a);var a={s:Ht(n[0]),e:Ht(n[0])};oe(e,635,aN([a,s])),s.t&&s.t.length>0&&oe(e,637,uA(s)),oe(e,636),delete s.iauthor})}),oe(e,634),oe(e,629),e.end()}function cN(t,e){e.FullPaths.forEach(function(r,n){if(n!=0){var s=r.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");s.slice(-1)!=="/"&&lt.utils.cfb_add(t,s,e.FileIndex[n].content)}})}var tx=["xlsb","xlsm","xlam","biff8","xla"],uN=(function(){var t=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,e={r:0,c:0};function r(n,s,a,i){var l=!1,c=!1;a.length==0?c=!0:a.charAt(0)=="["&&(c=!0,a=a.slice(1,-1)),i.length==0?l=!0:i.charAt(0)=="["&&(l=!0,i=i.slice(1,-1));var u=a.length>0?parseInt(a,10)|0:0,h=i.length>0?parseInt(i,10)|0:0;return l?h+=e.c:--h,c?u+=e.r:--u,s+(l?"":"$")+cr(h)+(c?"":"$")+Jt(u)}return function(s,a){return e=a,s.replace(t,r)}})(),xh=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,vh=(function(){return function(e,r){return e.replace(xh,function(n,s,a,i,l,c){var u=hh(i)-(a?0:r.c),h=uh(c)-(l?0:r.r),f=h==0?"":l?h+1:"["+h+"]",m=u==0?"":a?u+1:"["+u+"]";return s+"R"+f+"C"+m})}})();function hN(t,e){return t.replace(xh,function(r,n,s,a,i,l){return n+(s=="$"?s+a:cr(hh(a)+e.c))+(i=="$"?i+l:Jt(uh(l)+e.r))})}function dN(t){return t.length!=1}function Ct(t){t.l+=1}function ss(t,e){var r=t.read_shift(2);return[r&16383,r>>14&1,r>>15&1]}function rx(t,e,r){var n=2;if(r){if(r.biff>=2&&r.biff<=5)return nx(t);r.biff==12&&(n=4)}var s=t.read_shift(n),a=t.read_shift(n),i=ss(t),l=ss(t);return{s:{r:s,c:i[0],cRel:i[1],rRel:i[2]},e:{r:a,c:l[0],cRel:l[1],rRel:l[2]}}}function nx(t){var e=ss(t),r=ss(t),n=t.read_shift(1),s=t.read_shift(1);return{s:{r:e[0],c:n,cRel:e[1],rRel:e[2]},e:{r:r[0],c:s,cRel:r[1],rRel:r[2]}}}function fN(t,e,r){if(r.biff<8)return nx(t);var n=t.read_shift(r.biff==12?4:2),s=t.read_shift(r.biff==12?4:2),a=ss(t),i=ss(t);return{s:{r:n,c:a[0],cRel:a[1],rRel:a[2]},e:{r:s,c:i[0],cRel:i[1],rRel:i[2]}}}function sx(t,e,r){if(r&&r.biff>=2&&r.biff<=5)return mN(t);var n=t.read_shift(r&&r.biff==12?4:2),s=ss(t);return{r:n,c:s[0],cRel:s[1],rRel:s[2]}}function mN(t){var e=ss(t),r=t.read_shift(1);return{r:e[0],c:r,cRel:e[1],rRel:e[2]}}function pN(t){var e=t.read_shift(2),r=t.read_shift(2);return{r:e,c:r&255,fQuoted:!!(r&16384),cRel:r>>15,rRel:r>>15}}function gN(t,e,r){var n=r&&r.biff?r.biff:8;if(n>=2&&n<=5)return xN(t);var s=t.read_shift(n>=12?4:2),a=t.read_shift(2),i=(a&16384)>>14,l=(a&32768)>>15;if(a&=16383,l==1)for(;s>524287;)s-=1048576;if(i==1)for(;a>8191;)a=a-16384;return{r:s,c:a,cRel:i,rRel:l}}function xN(t){var e=t.read_shift(2),r=t.read_shift(1),n=(e&32768)>>15,s=(e&16384)>>14;return e&=16383,n==1&&e>=8192&&(e=e-16384),s==1&&r>=128&&(r=r-256),{r:e,c:r,cRel:s,rRel:n}}function vN(t,e,r){var n=(t[t.l++]&96)>>5,s=rx(t,r.biff>=2&&r.biff<=5?6:8,r);return[n,s]}function yN(t,e,r){var n=(t[t.l++]&96)>>5,s=t.read_shift(2,"i"),a=8;if(r)switch(r.biff){case 5:t.l+=12,a=6;break;case 12:a=12;break}var i=rx(t,a,r);return[n,s,i]}function _N(t,e,r){var n=(t[t.l++]&96)>>5;return t.l+=r&&r.biff>8?12:r.biff<8?6:8,[n]}function wN(t,e,r){var n=(t[t.l++]&96)>>5,s=t.read_shift(2),a=8;if(r)switch(r.biff){case 5:t.l+=12,a=6;break;case 12:a=12;break}return t.l+=a,[n,s]}function bN(t,e,r){var n=(t[t.l++]&96)>>5,s=fN(t,e-1,r);return[n,s]}function EN(t,e,r){var n=(t[t.l++]&96)>>5;return t.l+=r.biff==2?6:r.biff==12?14:7,[n]}function Yf(t){var e=t[t.l+1]&1,r=1;return t.l+=4,[e,r]}function TN(t,e,r){t.l+=2;for(var n=t.read_shift(r&&r.biff==2?1:2),s=[],a=0;a<=n;++a)s.push(t.read_shift(r&&r.biff==2?1:2));return s}function AN(t,e,r){var n=t[t.l+1]&255?1:0;return t.l+=2,[n,t.read_shift(r&&r.biff==2?1:2)]}function SN(t,e,r){var n=t[t.l+1]&255?1:0;return t.l+=2,[n,t.read_shift(r&&r.biff==2?1:2)]}function NN(t){var e=t[t.l+1]&255?1:0;return t.l+=2,[e,t.read_shift(2)]}function CN(t,e,r){var n=t[t.l+1]&255?1:0;return t.l+=r&&r.biff==2?3:4,[n]}function ax(t){var e=t.read_shift(1),r=t.read_shift(1);return[e,r]}function IN(t){return t.read_shift(2),ax(t)}function PN(t){return t.read_shift(2),ax(t)}function RN(t,e,r){var n=(t[t.l]&96)>>5;t.l+=1;var s=sx(t,0,r);return[n,s]}function DN(t,e,r){var n=(t[t.l]&96)>>5;t.l+=1;var s=gN(t,0,r);return[n,s]}function FN(t,e,r){var n=(t[t.l]&96)>>5;t.l+=1;var s=t.read_shift(2);r&&r.biff==5&&(t.l+=12);var a=sx(t,0,r);return[n,s,a]}function jN(t,e,r){var n=(t[t.l]&96)>>5;t.l+=1;var s=t.read_shift(r&&r.biff<=3?1:2);return[jC[s],lx[s],n]}function kN(t,e,r){var n=t[t.l++],s=t.read_shift(1),a=r&&r.biff<=3?[n==88?-1:0,t.read_shift(1)]:ON(t);return[s,(a[0]===0?lx:FC)[a[1]]]}function ON(t){return[t[t.l+1]>>7,t.read_shift(2)&32767]}function MN(t,e,r){t.l+=r&&r.biff==2?3:4}function LN(t,e,r){if(t.l++,r&&r.biff==12)return[t.read_shift(4,"i"),0];var n=t.read_shift(2),s=t.read_shift(r&&r.biff==2?1:2);return[n,s]}function BN(t){return t.l++,Zi[t.read_shift(1)]}function VN(t){return t.l++,t.read_shift(2)}function UN(t){return t.l++,t.read_shift(1)!==0}function $N(t){return t.l++,Ma(t)}function HN(t,e,r){return t.l++,Ug(t,e-1,r)}function WN(t,e){var r=[t.read_shift(1)];if(e==12)switch(r[0]){case 2:r[0]=4;break;case 4:r[0]=16;break;case 0:r[0]=1;break;case 1:r[0]=2;break}switch(r[0]){case 4:r[1]=FA(t,1)?"TRUE":"FALSE",e!=12&&(t.l+=7);break;case 37:case 16:r[1]=Zi[t[t.l]],t.l+=e==12?4:8;break;case 0:t.l+=8;break;case 1:r[1]=Ma(t);break;case 2:r[1]=MA(t,0,{biff:e>0&&e<8?2:e});break;default:throw new Error("Bad SerAr: "+r[0])}return r}function qN(t,e,r){for(var n=t.read_shift(r.biff==12?4:2),s=[],a=0;a!=n;++a)s.push((r.biff==12?Gs:VA)(t));return s}function GN(t,e,r){var n=0,s=0;r.biff==12?(n=t.read_shift(4),s=t.read_shift(4)):(s=1+t.read_shift(1),n=1+t.read_shift(2)),r.biff>=2&&r.biff<8&&(--n,--s==0&&(s=256));for(var a=0,i=[];a!=n&&(i[a]=[]);++a)for(var l=0;l!=s;++l)i[a][l]=WN(t,r.biff);return i}function zN(t,e,r){var n=t.read_shift(1)>>>5&3,s=!r||r.biff>=8?4:2,a=t.read_shift(s);switch(r.biff){case 2:t.l+=5;break;case 3:case 4:t.l+=8;break;case 5:t.l+=12;break}return[n,0,a]}function YN(t,e,r){if(r.biff==5)return KN(t);var n=t.read_shift(1)>>>5&3,s=t.read_shift(2),a=t.read_shift(4);return[n,s,a]}function KN(t){var e=t.read_shift(1)>>>5&3,r=t.read_shift(2,"i");t.l+=8;var n=t.read_shift(2);return t.l+=12,[e,r,n]}function XN(t,e,r){var n=t.read_shift(1)>>>5&3;t.l+=r&&r.biff==2?3:4;var s=t.read_shift(r&&r.biff==2?1:2);return[n,s]}function QN(t,e,r){var n=t.read_shift(1)>>>5&3,s=t.read_shift(r&&r.biff==2?1:2);return[n,s]}function JN(t,e,r){var n=t.read_shift(1)>>>5&3;return t.l+=4,r.biff<8&&t.l--,r.biff==12&&(t.l+=2),[n]}function ZN(t,e,r){var n=(t[t.l++]&96)>>5,s=t.read_shift(2),a=4;if(r)switch(r.biff){case 5:a=15;break;case 12:a=6;break}return t.l+=a,[n,s]}var eC=pn,tC=pn,rC=pn;function eo(t,e,r){return t.l+=2,[pN(t)]}function yh(t){return t.l+=6,[]}var nC=eo,sC=yh,aC=yh,iC=eo;function ix(t){return t.l+=2,[Bg(t),t.read_shift(2)&1]}var oC=eo,lC=ix,cC=yh,uC=eo,hC=eo,dC=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function fC(t){t.l+=2;var e=t.read_shift(2),r=t.read_shift(2),n=t.read_shift(4),s=t.read_shift(2),a=t.read_shift(2),i=dC[r>>2&31];return{ixti:e,coltype:r&3,rt:i,idx:n,c:s,C:a}}function mC(t){return t.l+=2,[t.read_shift(4)]}function pC(t,e,r){return t.l+=5,t.l+=2,t.l+=r.biff==2?1:4,["PTGSHEET"]}function gC(t,e,r){return t.l+=r.biff==2?4:5,["PTGENDSHEET"]}function xC(t){var e=t.read_shift(1)>>>5&3,r=t.read_shift(2);return[e,r]}function vC(t){var e=t.read_shift(1)>>>5&3,r=t.read_shift(2);return[e,r]}function yC(t){return t.l+=4,[0,0]}var Kf={1:{n:"PtgExp",f:LN},2:{n:"PtgTbl",f:rC},3:{n:"PtgAdd",f:Ct},4:{n:"PtgSub",f:Ct},5:{n:"PtgMul",f:Ct},6:{n:"PtgDiv",f:Ct},7:{n:"PtgPower",f:Ct},8:{n:"PtgConcat",f:Ct},9:{n:"PtgLt",f:Ct},10:{n:"PtgLe",f:Ct},11:{n:"PtgEq",f:Ct},12:{n:"PtgGe",f:Ct},13:{n:"PtgGt",f:Ct},14:{n:"PtgNe",f:Ct},15:{n:"PtgIsect",f:Ct},16:{n:"PtgUnion",f:Ct},17:{n:"PtgRange",f:Ct},18:{n:"PtgUplus",f:Ct},19:{n:"PtgUminus",f:Ct},20:{n:"PtgPercent",f:Ct},21:{n:"PtgParen",f:Ct},22:{n:"PtgMissArg",f:Ct},23:{n:"PtgStr",f:HN},26:{n:"PtgSheet",f:pC},27:{n:"PtgEndSheet",f:gC},28:{n:"PtgErr",f:BN},29:{n:"PtgBool",f:UN},30:{n:"PtgInt",f:VN},31:{n:"PtgNum",f:$N},32:{n:"PtgArray",f:EN},33:{n:"PtgFunc",f:jN},34:{n:"PtgFuncVar",f:kN},35:{n:"PtgName",f:zN},36:{n:"PtgRef",f:RN},37:{n:"PtgArea",f:vN},38:{n:"PtgMemArea",f:XN},39:{n:"PtgMemErr",f:eC},40:{n:"PtgMemNoMem",f:tC},41:{n:"PtgMemFunc",f:QN},42:{n:"PtgRefErr",f:JN},43:{n:"PtgAreaErr",f:_N},44:{n:"PtgRefN",f:DN},45:{n:"PtgAreaN",f:bN},46:{n:"PtgMemAreaN",f:xC},47:{n:"PtgMemNoMemN",f:vC},57:{n:"PtgNameX",f:YN},58:{n:"PtgRef3d",f:FN},59:{n:"PtgArea3d",f:yN},60:{n:"PtgRefErr3d",f:ZN},61:{n:"PtgAreaErr3d",f:wN},255:{}},_C={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},wC={1:{n:"PtgElfLel",f:ix},2:{n:"PtgElfRw",f:uC},3:{n:"PtgElfCol",f:nC},6:{n:"PtgElfRwV",f:hC},7:{n:"PtgElfColV",f:iC},10:{n:"PtgElfRadical",f:oC},11:{n:"PtgElfRadicalS",f:cC},13:{n:"PtgElfColS",f:sC},15:{n:"PtgElfColSV",f:aC},16:{n:"PtgElfRadicalLel",f:lC},25:{n:"PtgList",f:fC},29:{n:"PtgSxName",f:mC},255:{}},bC={0:{n:"PtgAttrNoop",f:yC},1:{n:"PtgAttrSemi",f:CN},2:{n:"PtgAttrIf",f:SN},4:{n:"PtgAttrChoose",f:TN},8:{n:"PtgAttrGoto",f:AN},16:{n:"PtgAttrSum",f:MN},32:{n:"PtgAttrBaxcel",f:Yf},33:{n:"PtgAttrBaxcel",f:Yf},64:{n:"PtgAttrSpace",f:IN},65:{n:"PtgAttrSpaceSemi",f:PN},128:{n:"PtgAttrIfError",f:NN},255:{}};function EC(t,e,r,n){if(n.biff<8)return pn(t,e);for(var s=t.l+e,a=[],i=0;i!==r.length;++i)switch(r[i][0]){case"PtgArray":r[i][1]=GN(t,0,n),a.push(r[i][1]);break;case"PtgMemArea":r[i][2]=qN(t,r[i][1],n),a.push(r[i][2]);break;case"PtgExp":n&&n.biff==12&&(r[i][1][1]=t.read_shift(4),a.push(r[i][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+r[i][0]}return e=s-t.l,e!==0&&a.push(pn(t,e)),a}function TC(t,e,r){for(var n=t.l+e,s,a,i=[];n!=t.l;)e=n-t.l,a=t[t.l],s=Kf[a]||Kf[_C[a]],(a===24||a===25)&&(s=(a===24?wC:bC)[t[t.l+1]]),!s||!s.f?pn(t,e):i.push([s.n,s.f(t,e,r)]);return i}function AC(t){for(var e=[],r=0;r<t.length;++r){for(var n=t[r],s=[],a=0;a<n.length;++a){var i=n[a];if(i)switch(i[0]){case 2:s.push('"'+i[1].replace(/"/g,'""')+'"');break;default:s.push(i[1])}else s.push("")}e.push(s.join(","))}return e.join(";")}var SC={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function NC(t,e){if(!t&&!(e&&e.biff<=5&&e.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(t)?"'"+t+"'":t}function ox(t,e,r){if(!t)return"SH33TJSERR0";if(r.biff>8&&(!t.XTI||!t.XTI[e]))return t.SheetNames[e];if(!t.XTI)return"SH33TJSERR6";var n=t.XTI[e];if(r.biff<8)return e>1e4&&(e-=65536),e<0&&(e=-e),e==0?"":t.XTI[e-1];if(!n)return"SH33TJSERR1";var s="";if(r.biff>8)switch(t[n[0]][0]){case 357:return s=n[1]==-1?"#REF":t.SheetNames[n[1]],n[1]==n[2]?s:s+":"+t.SheetNames[n[2]];case 358:return r.SID!=null?t.SheetNames[r.SID]:"SH33TJSSAME"+t[n[0]][0];case 355:default:return"SH33TJSSRC"+t[n[0]][0]}switch(t[n[0]][0][0]){case 1025:return s=n[1]==-1?"#REF":t.SheetNames[n[1]]||"SH33TJSERR3",n[1]==n[2]?s:s+":"+t.SheetNames[n[2]];case 14849:return t[n[0]].slice(1).map(function(a){return a.Name}).join(";;");default:return t[n[0]][0][3]?(s=n[1]==-1?"#REF":t[n[0]][0][3][n[1]]||"SH33TJSERR4",n[1]==n[2]?s:s+":"+t[n[0]][0][3][n[2]]):"SH33TJSERR2"}}function Xf(t,e,r){var n=ox(t,e,r);return n=="#REF"?n:NC(n,r)}function Ea(t,e,r,n,s){var a=s&&s.biff||8,i={s:{c:0,r:0}},l=[],c,u,h,f=0,m=0,p,x="";if(!t[0]||!t[0][0])return"";for(var g=-1,y="",I=0,P=t[0].length;I<P;++I){var A=t[0][I];switch(A[0]){case"PtgUminus":l.push("-"+l.pop());break;case"PtgUplus":l.push("+"+l.pop());break;case"PtgPercent":l.push(l.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(c=l.pop(),u=l.pop(),g>=0){switch(t[0][g][1][0]){case 0:y=Et(" ",t[0][g][1][1]);break;case 1:y=Et("\r",t[0][g][1][1]);break;default:if(y="",s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][g][1][0])}u=u+y,g=-1}l.push(u+SC[A[0]]+c);break;case"PtgIsect":c=l.pop(),u=l.pop(),l.push(u+" "+c);break;case"PtgUnion":c=l.pop(),u=l.pop(),l.push(u+","+c);break;case"PtgRange":c=l.pop(),u=l.pop(),l.push(u+":"+c);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":h=fi(A[1][1],i,s),l.push(mi(h,a));break;case"PtgRefN":h=r?fi(A[1][1],r,s):A[1][1],l.push(mi(h,a));break;case"PtgRef3d":f=A[1][1],h=fi(A[1][2],i,s),x=Xf(n,f,s),l.push(x+"!"+mi(h,a));break;case"PtgFunc":case"PtgFuncVar":var D=A[1][0],V=A[1][1];D||(D=0),D&=127;var H=D==0?[]:l.slice(-D);l.length-=D,V==="User"&&(V=H.shift()),l.push(V+"("+H.join(",")+")");break;case"PtgBool":l.push(A[1]?"TRUE":"FALSE");break;case"PtgInt":l.push(A[1]);break;case"PtgNum":l.push(String(A[1]));break;case"PtgStr":l.push('"'+A[1].replace(/"/g,'""')+'"');break;case"PtgErr":l.push(A[1]);break;case"PtgAreaN":p=jf(A[1][1],r?{s:r}:i,s),l.push(Mc(p,s));break;case"PtgArea":p=jf(A[1][1],i,s),l.push(Mc(p,s));break;case"PtgArea3d":f=A[1][1],p=A[1][2],x=Xf(n,f,s),l.push(x+"!"+Mc(p,s));break;case"PtgAttrSum":l.push("SUM("+l.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":m=A[1][2];var w=(n.names||[])[m-1]||(n[0]||[])[m],E=w?w.Name:"SH33TJSNAME"+String(m);E&&E.slice(0,6)=="_xlfn."&&!s.xlfn&&(E=E.slice(6)),l.push(E);break;case"PtgNameX":var _=A[1][1];m=A[1][2];var N;if(s.biff<=5)_<0&&(_=-_),n[_]&&(N=n[_][m]);else{var T="";if(((n[_]||[])[0]||[])[0]==14849||(((n[_]||[])[0]||[])[0]==1025?n[_][m]&&n[_][m].itab>0&&(T=n.SheetNames[n[_][m].itab-1]+"!"):T=n.SheetNames[m-1]+"!"),n[_]&&n[_][m])T+=n[_][m].Name;else if(n[0]&&n[0][m])T+=n[0][m].Name;else{var R=(ox(n,_,s)||"").split(";;");R[m-1]?T=R[m-1]:T+="SH33TJSERRX"}l.push(T);break}N||(N={Name:"SH33TJSERRY"}),l.push(N.Name);break;case"PtgParen":var S="(",se=")";if(g>=0){switch(y="",t[0][g][1][0]){case 2:S=Et(" ",t[0][g][1][1])+S;break;case 3:S=Et("\r",t[0][g][1][1])+S;break;case 4:se=Et(" ",t[0][g][1][1])+se;break;case 5:se=Et("\r",t[0][g][1][1])+se;break;default:if(s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][g][1][0])}g=-1}l.push(S+l.pop()+se);break;case"PtgRefErr":l.push("#REF!");break;case"PtgRefErr3d":l.push("#REF!");break;case"PtgExp":h={c:A[1][1],r:A[1][0]};var te={c:r.c,r:r.r};if(n.sharedf[ot(h)]){var me=n.sharedf[ot(h)];l.push(Ea(me,i,te,n,s))}else{var ce=!1;for(c=0;c!=n.arrayf.length;++c)if(u=n.arrayf[c],!(h.c<u[0].s.c||h.c>u[0].e.c)&&!(h.r<u[0].s.r||h.r>u[0].e.r)){l.push(Ea(u[1],i,te,n,s)),ce=!0;break}ce||l.push(A[1])}break;case"PtgArray":l.push("{"+AC(A[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":g=I;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":l.push("");break;case"PtgAreaErr":l.push("#REF!");break;case"PtgAreaErr3d":l.push("#REF!");break;case"PtgList":l.push("Table"+A[1].idx+"[#"+A[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(A));default:throw new Error("Unrecognized Formula Token: "+String(A))}var le=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(s.biff!=3&&g>=0&&le.indexOf(t[0][I][0])==-1){A=t[0][g];var Ae=!0;switch(A[1][0]){case 4:Ae=!1;case 0:y=Et(" ",A[1][1]);break;case 5:Ae=!1;case 1:y=Et("\r",A[1][1]);break;default:if(y="",s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+A[1][0])}l.push((Ae?y:"")+l.pop()+(Ae?"":y)),g=-1}}if(l.length>1&&s.WTF)throw new Error("bad formula stack");return l[0]}function CC(t){if(t==null){var e=ee(8);return e.write_shift(1,3),e.write_shift(1,0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,65535),e}else if(typeof t=="number")return Os(t);return Os(0)}function IC(t,e,r,n,s){var a=Ms(e,r,s),i=CC(t.v),l=ee(6),c=33;l.write_shift(2,c),l.write_shift(4,0);for(var u=ee(t.bf.length),h=0;h<t.bf.length;++h)u[h]=t.bf[h];var f=Kt([a,i,l,u]);return f}function ec(t,e,r){var n=t.read_shift(4),s=TC(t,n,r),a=t.read_shift(4),i=a>0?EC(t,a,s,r):null;return[s,i]}var PC=ec,tc=ec,RC=ec,DC=ec,FC={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},lx={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},jC={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function kC(t){var e="of:="+t.replace(xh,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return e.replace(/;/g,"|").replace(/,/g,";")}function OC(t){return t.replace(/\./,"!")}var pi=typeof Map<"u";function _h(t,e,r){var n=0,s=t.length;if(r){if(pi?r.has(e):Object.prototype.hasOwnProperty.call(r,e)){for(var a=pi?r.get(e):r[e];n<a.length;++n)if(t[a[n]].t===e)return t.Count++,a[n]}}else for(;n<s;++n)if(t[n].t===e)return t.Count++,n;return t[s]={t:e},t.Count++,t.Unique++,r&&(pi?(r.has(e)||r.set(e,[]),r.get(e).push(s)):(Object.prototype.hasOwnProperty.call(r,e)||(r[e]=[]),r[e].push(s))),s}function rc(t,e){var r={min:t+1,max:t+1},n=-1;return e.MDW&&(An=e.MDW),e.width!=null?r.customWidth=1:e.wpx!=null?n=gl(e.wpx):e.wch!=null&&(n=e.wch),n>-1?(r.width=pu(n),r.customWidth=1):e.width!=null&&(r.width=e.width),e.hidden&&(r.hidden=!0),e.level!=null&&(r.outlineLevel=r.level=e.level),r}function cx(t,e){if(t){var r=[.7,.7,.75,.75,.3,.3];t.left==null&&(t.left=r[0]),t.right==null&&(t.right=r[1]),t.top==null&&(t.top=r[2]),t.bottom==null&&(t.bottom=r[3]),t.header==null&&(t.header=r[4]),t.footer==null&&(t.footer=r[5])}}function gs(t,e,r){var n=r.revssf[e.z!=null?e.z:"General"],s=60,a=t.length;if(n==null&&r.ssf){for(;s<392;++s)if(r.ssf[s]==null){sg(e.z,s),r.ssf[s]=e.z,r.revssf[e.z]=n=s;break}}for(s=0;s!=a;++s)if(t[s].numFmtId===n)return s;return t[a]={numFmtId:n,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},a}function MC(t,e,r){if(t&&t["!ref"]){var n=xt(t["!ref"]);if(n.e.c<n.s.c||n.e.r<n.s.r)throw new Error("Bad range ("+r+"): "+t["!ref"])}}function LC(t){if(t.length===0)return"";for(var e='<mergeCells count="'+t.length+'">',r=0;r!=t.length;++r)e+='<mergeCell ref="'+Dt(t[r])+'"/>';return e+"</mergeCells>"}function BC(t,e,r,n,s){var a=!1,i={},l=null;if(n.bookType!=="xlsx"&&e.vbaraw){var c=e.SheetNames[r];try{e.Workbook&&(c=e.Workbook.Sheets[r].CodeName||c)}catch{}a=!0,i.codeName=Pi(it(c))}if(t&&t["!outline"]){var u={summaryBelow:1,summaryRight:1};t["!outline"].above&&(u.summaryBelow=0),t["!outline"].left&&(u.summaryRight=0),l=(l||"")+ge("outlinePr",null,u)}!a&&!l||(s[s.length]=ge("sheetPr",l,i))}var VC=["objects","scenarios","selectLockedCells","selectUnlockedCells"],UC=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function $C(t){var e={sheet:1};return VC.forEach(function(r){t[r]!=null&&t[r]&&(e[r]="1")}),UC.forEach(function(r){t[r]!=null&&!t[r]&&(e[r]="0")}),t.password&&(e.password=Gg(t.password).toString(16).toUpperCase()),ge("sheetProtection",null,e)}function HC(t){return cx(t),ge("pageMargins",null,t)}function WC(t,e){for(var r=["<cols>"],n,s=0;s!=e.length;++s)(n=e[s])&&(r[r.length]=ge("col",null,rc(s,n)));return r[r.length]="</cols>",r.join("")}function qC(t,e,r,n){var s=typeof t.ref=="string"?t.ref:Dt(t.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var a=r.Workbook.Names,i=kr(s);i.s.r==i.e.r&&(i.e.r=kr(e["!ref"]).e.r,s=Dt(i));for(var l=0;l<a.length;++l){var c=a[l];if(c.Name=="_xlnm._FilterDatabase"&&c.Sheet==n){c.Ref="'"+r.SheetNames[n]+"'!"+s;break}}return l==a.length&&a.push({Name:"_xlnm._FilterDatabase",Sheet:n,Ref:"'"+r.SheetNames[n]+"'!"+s}),ge("autoFilter",null,{ref:s})}function GC(t,e,r,n){var s={workbookViewId:"0"};return(((n||{}).Workbook||{}).Views||[])[0]&&(s.rightToLeft=n.Workbook.Views[0].RTL?"1":"0"),ge("sheetViews",ge("sheetView",null,s),{})}function zC(t,e,r,n){if(t.c&&r["!comments"].push([e,t.c]),t.v===void 0&&typeof t.f!="string"||t.t==="z"&&!t.f)return"";var s="",a=t.t,i=t.v;if(t.t!=="z")switch(t.t){case"b":s=t.v?"1":"0";break;case"n":s=""+t.v;break;case"e":s=Zi[t.v];break;case"d":n&&n.cellDates?s=gr(t.v,-1).toISOString():(t=Er(t),t.t="n",s=""+(t.v=br(gr(t.v)))),typeof t.z>"u"&&(t.z=At[14]);break;default:s=t.v;break}var l=Xt("v",it(s)),c={r:e},u=gs(n.cellXfs,t,n);switch(u!==0&&(c.s=u),t.t){case"n":break;case"d":c.t="d";break;case"b":c.t="b";break;case"e":c.t="e";break;case"z":break;default:if(t.v==null){delete t.t;break}if(t.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(n&&n.bookSST){l=Xt("v",""+_h(n.Strings,t.v,n.revStrings)),c.t="s";break}c.t="str";break}if(t.t!=a&&(t.t=a,t.v=i),typeof t.f=="string"&&t.f){var h=t.F&&t.F.slice(0,e.length)==e?{t:"array",ref:t.F}:null;l=ge("f",it(t.f),h)+(t.v!=null?l:"")}return t.l&&r["!links"].push([e,t.l]),t.D&&(c.cm=1),ge("c",l,c)}function YC(t,e,r,n){var s=[],a=[],i=xt(t["!ref"]),l="",c,u="",h=[],f=0,m=0,p=t["!rows"],x=Array.isArray(t),g={r:u},y,I=-1;for(m=i.s.c;m<=i.e.c;++m)h[m]=cr(m);for(f=i.s.r;f<=i.e.r;++f){for(a=[],u=Jt(f),m=i.s.c;m<=i.e.c;++m){c=h[m]+u;var P=x?(t[f]||[])[m]:t[c];P!==void 0&&(l=zC(P,c,t,e))!=null&&a.push(l)}(a.length>0||p&&p[f])&&(g={r:u},p&&p[f]&&(y=p[f],y.hidden&&(g.hidden=1),I=-1,y.hpx?I=xl(y.hpx):y.hpt&&(I=y.hpt),I>-1&&(g.ht=I,g.customHeight=1),y.level&&(g.outlineLevel=y.level)),s[s.length]=ge("row",a.join(""),g))}if(p)for(;f<p.length;++f)p&&p[f]&&(g={r:f+1},y=p[f],y.hidden&&(g.hidden=1),I=-1,y.hpx?I=xl(y.hpx):y.hpt&&(I=y.hpt),I>-1&&(g.ht=I,g.customHeight=1),y.level&&(g.outlineLevel=y.level),s[s.length]=ge("row","",g));return s.join("")}function ux(t,e,r,n){var s=[Ft,ge("worksheet",null,{xmlns:ja[0],"xmlns:r":$t.r})],a=r.SheetNames[t],i=0,l="",c=r.Sheets[a];c==null&&(c={});var u=c["!ref"]||"A1",h=xt(u);if(h.e.c>16383||h.e.r>1048575){if(e.WTF)throw new Error("Range "+u+" exceeds format limit A1:XFD1048576");h.e.c=Math.min(h.e.c,16383),h.e.r=Math.min(h.e.c,1048575),u=Dt(h)}n||(n={}),c["!comments"]=[];var f=[];BC(c,r,t,e,s),s[s.length]=ge("dimension",null,{ref:u}),s[s.length]=GC(c,e,t,r),e.sheetFormat&&(s[s.length]=ge("sheetFormatPr",null,{defaultRowHeight:e.sheetFormat.defaultRowHeight||"16",baseColWidth:e.sheetFormat.baseColWidth||"10",outlineLevelRow:e.sheetFormat.outlineLevelRow||"7"})),c["!cols"]!=null&&c["!cols"].length>0&&(s[s.length]=WC(c,c["!cols"])),s[i=s.length]="<sheetData/>",c["!links"]=[],c["!ref"]!=null&&(l=YC(c,e),l.length>0&&(s[s.length]=l)),s.length>i+1&&(s[s.length]="</sheetData>",s[i]=s[i].replace("/>",">")),c["!protect"]&&(s[s.length]=$C(c["!protect"])),c["!autofilter"]!=null&&(s[s.length]=qC(c["!autofilter"],c,r,t)),c["!merges"]!=null&&c["!merges"].length>0&&(s[s.length]=LC(c["!merges"]));var m=-1,p,x=-1;return c["!links"].length>0&&(s[s.length]="<hyperlinks>",c["!links"].forEach(function(g){g[1].Target&&(p={ref:g[0]},g[1].Target.charAt(0)!="#"&&(x=at(n,-1,it(g[1].Target).replace(/#.*$/,""),Qe.HLINK),p["r:id"]="rId"+x),(m=g[1].Target.indexOf("#"))>-1&&(p.location=it(g[1].Target.slice(m+1))),g[1].Tooltip&&(p.tooltip=it(g[1].Tooltip)),s[s.length]=ge("hyperlink",null,p))}),s[s.length]="</hyperlinks>"),delete c["!links"],c["!margins"]!=null&&(s[s.length]=HC(c["!margins"])),(!e||e.ignoreEC||e.ignoreEC==null)&&(s[s.length]=Xt("ignoredErrors",ge("ignoredError",null,{numberStoredAsText:1,sqref:u}))),f.length>0&&(x=at(n,-1,"../drawings/drawing"+(t+1)+".xml",Qe.DRAW),s[s.length]=ge("drawing",null,{"r:id":"rId"+x}),c["!drawing"]=f),c["!comments"].length>0&&(x=at(n,-1,"../drawings/vmlDrawing"+(t+1)+".vml",Qe.VML),s[s.length]=ge("legacyDrawing",null,{"r:id":"rId"+x}),c["!legacy"]=x),s.length>1&&(s[s.length]="</worksheet>",s[1]=s[1].replace("/>",">")),s.join("")}function KC(t,e){var r={},n=t.l+e;r.r=t.read_shift(4),t.l+=4;var s=t.read_shift(2);t.l+=1;var a=t.read_shift(1);return t.l=n,a&7&&(r.level=a&7),a&16&&(r.hidden=!0),a&32&&(r.hpt=s/20),r}function XC(t,e,r){var n=ee(145),s=(r["!rows"]||[])[t]||{};n.write_shift(4,t),n.write_shift(4,0);var a=320;s.hpx?a=xl(s.hpx)*20:s.hpt&&(a=s.hpt*20),n.write_shift(2,a),n.write_shift(1,0);var i=0;s.level&&(i|=s.level),s.hidden&&(i|=16),(s.hpx||s.hpt)&&(i|=32),n.write_shift(1,i),n.write_shift(1,0);var l=0,c=n.l;n.l+=4;for(var u={r:t,c:0},h=0;h<16;++h)if(!(e.s.c>h+1<<10||e.e.c<h<<10)){for(var f=-1,m=-1,p=h<<10;p<h+1<<10;++p){u.c=p;var x=Array.isArray(r)?(r[u.r]||[])[u.c]:r[ot(u)];x&&(f<0&&(f=p),m=p)}f<0||(++l,n.write_shift(4,f),n.write_shift(4,m))}var g=n.l;return n.l=c,n.write_shift(4,l),n.l=g,n.length>n.l?n.slice(0,n.l):n}function QC(t,e,r,n){var s=XC(n,r,e);(s.length>17||(e["!rows"]||[])[n])&&oe(t,0,s)}var JC=Gs,ZC=Oa;function e4(){}function t4(t,e){var r={},n=t[t.l];return++t.l,r.above=!(n&64),r.left=!(n&128),t.l+=18,r.name=hA(t),r}function r4(t,e,r){r==null&&(r=ee(84+4*t.length));var n=192;e&&(e.above&&(n&=-65),e.left&&(n&=-129)),r.write_shift(1,n);for(var s=1;s<3;++s)r.write_shift(1,0);return fl({auto:1},r),r.write_shift(-4,-1),r.write_shift(-4,-1),Ag(t,r),r.slice(0,r.l)}function n4(t){var e=Ur(t);return[e]}function s4(t,e,r){return r==null&&(r=ee(8)),Hs(e,r)}function a4(t){var e=Ws(t);return[e]}function i4(t,e,r){return r==null&&(r=ee(4)),qs(e,r)}function o4(t){var e=Ur(t),r=t.read_shift(1);return[e,r,"b"]}function l4(t,e,r){return r==null&&(r=ee(9)),Hs(e,r),r.write_shift(1,t.v?1:0),r}function c4(t){var e=Ws(t),r=t.read_shift(1);return[e,r,"b"]}function u4(t,e,r){return r==null&&(r=ee(5)),qs(e,r),r.write_shift(1,t.v?1:0),r}function h4(t){var e=Ur(t),r=t.read_shift(1);return[e,r,"e"]}function d4(t,e,r){return r==null&&(r=ee(9)),Hs(e,r),r.write_shift(1,t.v),r}function f4(t){var e=Ws(t),r=t.read_shift(1);return[e,r,"e"]}function m4(t,e,r){return r==null&&(r=ee(8)),qs(e,r),r.write_shift(1,t.v),r.write_shift(2,0),r.write_shift(1,0),r}function p4(t){var e=Ur(t),r=t.read_shift(4);return[e,r,"s"]}function g4(t,e,r){return r==null&&(r=ee(12)),Hs(e,r),r.write_shift(4,e.v),r}function x4(t){var e=Ws(t),r=t.read_shift(4);return[e,r,"s"]}function v4(t,e,r){return r==null&&(r=ee(8)),qs(e,r),r.write_shift(4,e.v),r}function y4(t){var e=Ur(t),r=Ma(t);return[e,r,"n"]}function _4(t,e,r){return r==null&&(r=ee(16)),Hs(e,r),Os(t.v,r),r}function w4(t){var e=Ws(t),r=Ma(t);return[e,r,"n"]}function b4(t,e,r){return r==null&&(r=ee(12)),qs(e,r),Os(t.v,r),r}function E4(t){var e=Ur(t),r=Sg(t);return[e,r,"n"]}function T4(t,e,r){return r==null&&(r=ee(12)),Hs(e,r),Ng(t.v,r),r}function A4(t){var e=Ws(t),r=Sg(t);return[e,r,"n"]}function S4(t,e,r){return r==null&&(r=ee(8)),qs(e,r),Ng(t.v,r),r}function N4(t){var e=Ur(t),r=dh(t);return[e,r,"is"]}function C4(t){var e=Ur(t),r=ur(t);return[e,r,"str"]}function I4(t,e,r){return r==null&&(r=ee(12+4*t.v.length)),Hs(e,r),Wt(t.v,r),r.length>r.l?r.slice(0,r.l):r}function P4(t){var e=Ws(t),r=ur(t);return[e,r,"str"]}function R4(t,e,r){return r==null&&(r=ee(8+4*t.v.length)),qs(e,r),Wt(t.v,r),r.length>r.l?r.slice(0,r.l):r}function D4(t,e,r){var n=t.l+e,s=Ur(t);s.r=r["!row"];var a=t.read_shift(1),i=[s,a,"b"];if(r.cellFormula){t.l+=2;var l=tc(t,n-t.l,r);i[3]=Ea(l,null,s,r.supbooks,r)}else t.l=n;return i}function F4(t,e,r){var n=t.l+e,s=Ur(t);s.r=r["!row"];var a=t.read_shift(1),i=[s,a,"e"];if(r.cellFormula){t.l+=2;var l=tc(t,n-t.l,r);i[3]=Ea(l,null,s,r.supbooks,r)}else t.l=n;return i}function j4(t,e,r){var n=t.l+e,s=Ur(t);s.r=r["!row"];var a=Ma(t),i=[s,a,"n"];if(r.cellFormula){t.l+=2;var l=tc(t,n-t.l,r);i[3]=Ea(l,null,s,r.supbooks,r)}else t.l=n;return i}function k4(t,e,r){var n=t.l+e,s=Ur(t);s.r=r["!row"];var a=ur(t),i=[s,a,"str"];if(r.cellFormula){t.l+=2;var l=tc(t,n-t.l,r);i[3]=Ea(l,null,s,r.supbooks,r)}else t.l=n;return i}var O4=Gs,M4=Oa;function L4(t,e){return e==null&&(e=ee(4)),e.write_shift(4,t),e}function B4(t,e){var r=t.l+e,n=Gs(t),s=fh(t),a=ur(t),i=ur(t),l=ur(t);t.l=r;var c={rfx:n,relId:s,loc:a,display:l};return i&&(c.Tooltip=i),c}function V4(t,e){var r=ee(50+4*(t[1].Target.length+(t[1].Tooltip||"").length));Oa({s:Ht(t[0]),e:Ht(t[0])},r),mh("rId"+e,r);var n=t[1].Target.indexOf("#"),s=n==-1?"":t[1].Target.slice(n+1);return Wt(s||"",r),Wt(t[1].Tooltip||"",r),Wt("",r),r.slice(0,r.l)}function U4(){}function $4(t,e,r){var n=t.l+e,s=Cg(t),a=t.read_shift(1),i=[s];if(i[2]=a,r.cellFormula){var l=PC(t,n-t.l,r);i[1]=l}else t.l=n;return i}function H4(t,e,r){var n=t.l+e,s=Gs(t),a=[s];if(r.cellFormula){var i=DC(t,n-t.l,r);a[1]=i,t.l=n}else t.l=n;return a}function W4(t,e,r){r==null&&(r=ee(18));var n=rc(t,e);r.write_shift(-4,t),r.write_shift(-4,t),r.write_shift(4,(n.width||10)*256),r.write_shift(4,0);var s=0;return e.hidden&&(s|=1),typeof n.width=="number"&&(s|=2),e.level&&(s|=e.level<<8),r.write_shift(2,s),r}var hx=["left","right","top","bottom","header","footer"];function q4(t){var e={};return hx.forEach(function(r){e[r]=Ma(t)}),e}function G4(t,e){return e==null&&(e=ee(48)),cx(t),hx.forEach(function(r){Os(t[r],e)}),e}function z4(t){var e=t.read_shift(2);return t.l+=28,{RTL:e&32}}function Y4(t,e,r){r==null&&(r=ee(30));var n=924;return(((e||{}).Views||[])[0]||{}).RTL&&(n|=32),r.write_shift(2,n),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(2,0),r.write_shift(2,100),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(4,0),r}function K4(t){var e=ee(24);return e.write_shift(4,4),e.write_shift(4,1),Oa(t,e),e}function X4(t,e){return e==null&&(e=ee(66)),e.write_shift(2,t.password?Gg(t.password):0),e.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(r){r[1]?e.write_shift(4,t[r[0]]!=null&&!t[r[0]]?1:0):e.write_shift(4,t[r[0]]!=null&&t[r[0]]?0:1)}),e}function Q4(){}function J4(){}function Z4(t,e,r,n,s,a,i){if(e.v===void 0)return!1;var l="";switch(e.t){case"b":l=e.v?"1":"0";break;case"d":e=Er(e),e.z=e.z||At[14],e.v=br(gr(e.v)),e.t="n";break;case"n":case"e":l=""+e.v;break;default:l=e.v;break}var c={r,c:n};switch(c.s=gs(s.cellXfs,e,s),e.l&&a["!links"].push([ot(c),e.l]),e.c&&a["!comments"].push([ot(c),e.c]),e.t){case"s":case"str":return s.bookSST?(l=_h(s.Strings,e.v,s.revStrings),c.t="s",c.v=l,i?oe(t,18,v4(e,c)):oe(t,7,g4(e,c))):(c.t="str",i?oe(t,17,R4(e,c)):oe(t,6,I4(e,c))),!0;case"n":return e.v==(e.v|0)&&e.v>-1e3&&e.v<1e3?i?oe(t,13,S4(e,c)):oe(t,2,T4(e,c)):i?oe(t,16,b4(e,c)):oe(t,5,_4(e,c)),!0;case"b":return c.t="b",i?oe(t,15,u4(e,c)):oe(t,4,l4(e,c)),!0;case"e":return c.t="e",i?oe(t,14,m4(e,c)):oe(t,3,d4(e,c)),!0}return i?oe(t,12,i4(e,c)):oe(t,1,s4(e,c)),!0}function eI(t,e,r,n){var s=xt(e["!ref"]||"A1"),a,i="",l=[];oe(t,145);var c=Array.isArray(e),u=s.e.r;e["!rows"]&&(u=Math.max(s.e.r,e["!rows"].length-1));for(var h=s.s.r;h<=u;++h){i=Jt(h),QC(t,e,s,h);var f=!1;if(h<=s.e.r)for(var m=s.s.c;m<=s.e.c;++m){h===s.s.r&&(l[m]=cr(m)),a=l[m]+i;var p=c?(e[h]||[])[m]:e[a];if(!p){f=!1;continue}f=Z4(t,p,h,m,n,e,f)}}oe(t,146)}function tI(t,e){!e||!e["!merges"]||(oe(t,177,L4(e["!merges"].length)),e["!merges"].forEach(function(r){oe(t,176,M4(r))}),oe(t,178))}function rI(t,e){!e||!e["!cols"]||(oe(t,390),e["!cols"].forEach(function(r,n){r&&oe(t,60,W4(n,r))}),oe(t,391))}function nI(t,e){!e||!e["!ref"]||(oe(t,648),oe(t,649,K4(xt(e["!ref"]))),oe(t,650))}function sI(t,e,r){e["!links"].forEach(function(n){if(n[1].Target){var s=at(r,-1,n[1].Target.replace(/#.*$/,""),Qe.HLINK);oe(t,494,V4(n,s))}}),delete e["!links"]}function aI(t,e,r,n){if(e["!comments"].length>0){var s=at(n,-1,"../drawings/vmlDrawing"+(r+1)+".vml",Qe.VML);oe(t,551,mh("rId"+s)),e["!legacy"]=s}}function iI(t,e,r,n){if(e["!autofilter"]){var s=e["!autofilter"],a=typeof s.ref=="string"?s.ref:Dt(s.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var i=r.Workbook.Names,l=kr(a);l.s.r==l.e.r&&(l.e.r=kr(e["!ref"]).e.r,a=Dt(l));for(var c=0;c<i.length;++c){var u=i[c];if(u.Name=="_xlnm._FilterDatabase"&&u.Sheet==n){u.Ref="'"+r.SheetNames[n]+"'!"+a;break}}c==i.length&&i.push({Name:"_xlnm._FilterDatabase",Sheet:n,Ref:"'"+r.SheetNames[n]+"'!"+a}),oe(t,161,Oa(xt(a))),oe(t,162)}}function oI(t,e,r){oe(t,133),oe(t,137,Y4(e,r)),oe(t,138),oe(t,134)}function lI(t,e){e["!protect"]&&oe(t,535,X4(e["!protect"]))}function cI(t,e,r,n){var s=wr(),a=r.SheetNames[t],i=r.Sheets[a]||{},l=a;try{r&&r.Workbook&&(l=r.Workbook.Sheets[t].CodeName||l)}catch{}var c=xt(i["!ref"]||"A1");if(c.e.c>16383||c.e.r>1048575){if(e.WTF)throw new Error("Range "+(i["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");c.e.c=Math.min(c.e.c,16383),c.e.r=Math.min(c.e.c,1048575)}return i["!links"]=[],i["!comments"]=[],oe(s,129),(r.vbaraw||i["!outline"])&&oe(s,147,r4(l,i["!outline"])),oe(s,148,ZC(c)),oI(s,i,r.Workbook),rI(s,i),eI(s,i,t,e),lI(s,i),iI(s,i,r,t),tI(s,i),sI(s,i,n),i["!margins"]&&oe(s,476,G4(i["!margins"])),(!e||e.ignoreEC||e.ignoreEC==null)&&nI(s,i),aI(s,i,t,n),oe(s,130),s.end()}function uI(t,e){t.l+=10;var r=ur(t);return{name:r}}var hI=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];function dI(t){return!t.Workbook||!t.Workbook.WBProps?"false":HT(t.Workbook.WBProps.date1904)?"true":"false"}var fI="][*?/\\".split("");function dx(t,e){if(t.length>31)throw new Error("Sheet names cannot exceed 31 chars");var r=!0;return fI.forEach(function(n){if(t.indexOf(n)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),r}function mI(t,e,r){t.forEach(function(n,s){dx(n);for(var a=0;a<s;++a)if(n==t[a])throw new Error("Duplicate Sheet Name: "+n);if(r){var i=e&&e[s]&&e[s].CodeName||n;if(i.charCodeAt(0)==95&&i.length>22)throw new Error("Bad Code Name: Worksheet"+i)}})}function pI(t){if(!t||!t.SheetNames||!t.Sheets)throw new Error("Invalid Workbook");if(!t.SheetNames.length)throw new Error("Workbook is empty");var e=t.Workbook&&t.Workbook.Sheets||[];mI(t.SheetNames,e,!!t.vbaraw);for(var r=0;r<t.SheetNames.length;++r)MC(t.Sheets[t.SheetNames[r]],t.SheetNames[r],r)}function fx(t){var e=[Ft];e[e.length]=ge("workbook",null,{xmlns:ja[0],"xmlns:r":$t.r});var r=t.Workbook&&(t.Workbook.Names||[]).length>0,n={codeName:"ThisWorkbook"};t.Workbook&&t.Workbook.WBProps&&(hI.forEach(function(l){t.Workbook.WBProps[l[0]]!=null&&t.Workbook.WBProps[l[0]]!=l[1]&&(n[l[0]]=t.Workbook.WBProps[l[0]])}),t.Workbook.WBProps.CodeName&&(n.codeName=t.Workbook.WBProps.CodeName,delete n.CodeName)),e[e.length]=ge("workbookPr",null,n);var s=t.Workbook&&t.Workbook.Sheets||[],a=0;if(s&&s[0]&&s[0].Hidden){for(e[e.length]="<bookViews>",a=0;a!=t.SheetNames.length&&!(!s[a]||!s[a].Hidden);++a);a==t.SheetNames.length&&(a=0),e[e.length]='<workbookView firstSheet="'+a+'" activeTab="'+a+'"/>',e[e.length]="</bookViews>"}for(e[e.length]="<sheets>",a=0;a!=t.SheetNames.length;++a){var i={name:it(t.SheetNames[a].slice(0,31))};if(i.sheetId=""+(a+1),i["r:id"]="rId"+(a+1),s[a])switch(s[a].Hidden){case 1:i.state="hidden";break;case 2:i.state="veryHidden";break}e[e.length]=ge("sheet",null,i)}return e[e.length]="</sheets>",r&&(e[e.length]="<definedNames>",t.Workbook&&t.Workbook.Names&&t.Workbook.Names.forEach(function(l){var c={name:l.Name};l.Comment&&(c.comment=l.Comment),l.Sheet!=null&&(c.localSheetId=""+l.Sheet),l.Hidden&&(c.hidden="1"),l.Ref&&(e[e.length]=ge("definedName",it(l.Ref),c))}),e[e.length]="</definedNames>"),e.length>2&&(e[e.length]="</workbook>",e[1]=e[1].replace("/>",">")),e.join("")}function gI(t,e){var r={};return r.Hidden=t.read_shift(4),r.iTabID=t.read_shift(4),r.strRelID=mu(t),r.name=ur(t),r}function xI(t,e){return e||(e=ee(127)),e.write_shift(4,t.Hidden),e.write_shift(4,t.iTabID),mh(t.strRelID,e),Wt(t.name.slice(0,31),e),e.length>e.l?e.slice(0,e.l):e}function vI(t,e){var r={},n=t.read_shift(4);r.defaultThemeVersion=t.read_shift(4);var s=e>8?ur(t):"";return s.length>0&&(r.CodeName=s),r.autoCompressPictures=!!(n&65536),r.backupFile=!!(n&64),r.checkCompatibility=!!(n&4096),r.date1904=!!(n&1),r.filterPrivacy=!!(n&8),r.hidePivotFieldList=!!(n&1024),r.promptedSolutions=!!(n&16),r.publishItems=!!(n&2048),r.refreshAllConnections=!!(n&262144),r.saveExternalLinkValues=!!(n&128),r.showBorderUnselectedTables=!!(n&4),r.showInkAnnotation=!!(n&32),r.showObjects=["all","placeholders","none"][n>>13&3],r.showPivotChartFilter=!!(n&32768),r.updateLinks=["userSet","never","always"][n>>8&3],r}function yI(t,e){e||(e=ee(72));var r=0;return t&&t.filterPrivacy&&(r|=8),e.write_shift(4,r),e.write_shift(4,0),Ag(t&&t.CodeName||"ThisWorkbook",e),e.slice(0,e.l)}function _I(t,e,r){var n=t.l+e;t.l+=4,t.l+=1;var s=t.read_shift(4),a=dA(t),i=RC(t,0,r),l=fh(t);t.l=n;var c={Name:a,Ptg:i};return s<268435455&&(c.Sheet=s),l&&(c.Comment=l),c}function wI(t,e){oe(t,143);for(var r=0;r!=e.SheetNames.length;++r){var n=e.Workbook&&e.Workbook.Sheets&&e.Workbook.Sheets[r]&&e.Workbook.Sheets[r].Hidden||0,s={Hidden:n,iTabID:r+1,strRelID:"rId"+(r+1),name:e.SheetNames[r]};oe(t,156,xI(s))}oe(t,144)}function bI(t,e){e||(e=ee(127));for(var r=0;r!=4;++r)e.write_shift(4,0);return Wt("SheetJS",e),Wt(al.version,e),Wt(al.version,e),Wt("7262",e),e.length>e.l?e.slice(0,e.l):e}function EI(t,e){e||(e=ee(29)),e.write_shift(-4,0),e.write_shift(-4,460),e.write_shift(4,28800),e.write_shift(4,17600),e.write_shift(4,500),e.write_shift(4,t),e.write_shift(4,t);var r=120;return e.write_shift(1,r),e.length>e.l?e.slice(0,e.l):e}function TI(t,e){if(!(!e.Workbook||!e.Workbook.Sheets)){for(var r=e.Workbook.Sheets,n=0,s=-1,a=-1;n<r.length;++n)!r[n]||!r[n].Hidden&&s==-1?s=n:r[n].Hidden==1&&a==-1&&(a=n);a>s||(oe(t,135),oe(t,158,EI(s)),oe(t,136))}}function AI(t,e){var r=wr();return oe(r,131),oe(r,128,bI()),oe(r,153,yI(t.Workbook&&t.Workbook.WBProps||null)),TI(r,t),wI(r,t),oe(r,132),r.end()}function SI(t,e,r){return(e.slice(-4)===".bin"?AI:fx)(t)}function NI(t,e,r,n,s){return(e.slice(-4)===".bin"?cI:ux)(t,r,n,s)}function CI(t,e,r){return(e.slice(-4)===".bin"?GS:Kg)(t,r)}function II(t,e,r){return(e.slice(-4)===".bin"?yS:qg)(t,r)}function PI(t,e,r){return(e.slice(-4)===".bin"?lN:ex)(t)}function RI(t){return(t.slice(-4)===".bin"?eN:Jg)()}function DI(t,e){var r=[];return t.Props&&r.push(CA(t.Props,e)),t.Custprops&&r.push(IA(t.Props,t.Custprops)),r.join("")}function FI(){return""}function jI(t,e){var r=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return e.cellXfs.forEach(function(n,s){var a=[];a.push(ge("NumberFormat",null,{"ss:Format":it(At[n.numFmtId])}));var i={"ss:ID":"s"+(21+s)};r.push(ge("Style",a.join(""),i))}),ge("Styles",r.join(""))}function mx(t){return ge("NamedRange",null,{"ss:Name":t.Name,"ss:RefersTo":"="+vh(t.Ref,{r:0,c:0})})}function kI(t){if(!((t||{}).Workbook||{}).Names)return"";for(var e=t.Workbook.Names,r=[],n=0;n<e.length;++n){var s=e[n];s.Sheet==null&&(s.Name.match(/^_xlfn\./)||r.push(mx(s)))}return ge("Names",r.join(""))}function OI(t,e,r,n){if(!t||!((n||{}).Workbook||{}).Names)return"";for(var s=n.Workbook.Names,a=[],i=0;i<s.length;++i){var l=s[i];l.Sheet==r&&(l.Name.match(/^_xlfn\./)||a.push(mx(l)))}return a.join("")}function MI(t,e,r,n){if(!t)return"";var s=[];if(t["!margins"]&&(s.push("<PageSetup>"),t["!margins"].header&&s.push(ge("Header",null,{"x:Margin":t["!margins"].header})),t["!margins"].footer&&s.push(ge("Footer",null,{"x:Margin":t["!margins"].footer})),s.push(ge("PageMargins",null,{"x:Bottom":t["!margins"].bottom||"0.75","x:Left":t["!margins"].left||"0.7","x:Right":t["!margins"].right||"0.7","x:Top":t["!margins"].top||"0.75"})),s.push("</PageSetup>")),n&&n.Workbook&&n.Workbook.Sheets&&n.Workbook.Sheets[r])if(n.Workbook.Sheets[r].Hidden)s.push(ge("Visible",n.Workbook.Sheets[r].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var a=0;a<r&&!(n.Workbook.Sheets[a]&&!n.Workbook.Sheets[a].Hidden);++a);a==r&&s.push("<Selected/>")}return((((n||{}).Workbook||{}).Views||[])[0]||{}).RTL&&s.push("<DisplayRightToLeft/>"),t["!protect"]&&(s.push(Xt("ProtectContents","True")),t["!protect"].objects&&s.push(Xt("ProtectObjects","True")),t["!protect"].scenarios&&s.push(Xt("ProtectScenarios","True")),t["!protect"].selectLockedCells!=null&&!t["!protect"].selectLockedCells?s.push(Xt("EnableSelection","NoSelection")):t["!protect"].selectUnlockedCells!=null&&!t["!protect"].selectUnlockedCells&&s.push(Xt("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(i){t["!protect"][i[0]]&&s.push("<"+i[1]+"/>")})),s.length==0?"":ge("WorksheetOptions",s.join(""),{xmlns:Ir.x})}function LI(t){return t.map(function(e){var r=$T(e.t||""),n=ge("ss:Data",r,{xmlns:"http://www.w3.org/TR/REC-html40"});return ge("Comment",n,{"ss:Author":e.a})}).join("")}function BI(t,e,r,n,s,a,i){if(!t||t.v==null&&t.f==null)return"";var l={};if(t.f&&(l["ss:Formula"]="="+it(vh(t.f,i))),t.F&&t.F.slice(0,e.length)==e){var c=Ht(t.F.slice(e.length+1));l["ss:ArrayRange"]="RC:R"+(c.r==i.r?"":"["+(c.r-i.r)+"]")+"C"+(c.c==i.c?"":"["+(c.c-i.c)+"]")}if(t.l&&t.l.Target&&(l["ss:HRef"]=it(t.l.Target),t.l.Tooltip&&(l["x:HRefScreenTip"]=it(t.l.Tooltip))),r["!merges"])for(var u=r["!merges"],h=0;h!=u.length;++h)u[h].s.c!=i.c||u[h].s.r!=i.r||(u[h].e.c>u[h].s.c&&(l["ss:MergeAcross"]=u[h].e.c-u[h].s.c),u[h].e.r>u[h].s.r&&(l["ss:MergeDown"]=u[h].e.r-u[h].s.r));var f="",m="";switch(t.t){case"z":if(!n.sheetStubs)return"";break;case"n":f="Number",m=String(t.v);break;case"b":f="Boolean",m=t.v?"1":"0";break;case"e":f="Error",m=Zi[t.v];break;case"d":f="DateTime",m=new Date(t.v).toISOString(),t.z==null&&(t.z=t.z||At[14]);break;case"s":f="String",m=UT(t.v||"");break}var p=gs(n.cellXfs,t,n);l["ss:StyleID"]="s"+(21+p),l["ss:Index"]=i.c+1;var x=t.v!=null?m:"",g=t.t=="z"?"":'<Data ss:Type="'+f+'">'+x+"</Data>";return(t.c||[]).length>0&&(g+=LI(t.c)),ge("Cell",g,l)}function VI(t,e){var r='<Row ss:Index="'+(t+1)+'"';return e&&(e.hpt&&!e.hpx&&(e.hpx=Yg(e.hpt)),e.hpx&&(r+=' ss:AutoFitHeight="0" ss:Height="'+e.hpx+'"'),e.hidden&&(r+=' ss:Hidden="1"')),r+">"}function UI(t,e,r,n){if(!t["!ref"])return"";var s=xt(t["!ref"]),a=t["!merges"]||[],i=0,l=[];t["!cols"]&&t["!cols"].forEach(function(y,I){gh(y);var P=!!y.width,A=rc(I,y),D={"ss:Index":I+1};P&&(D["ss:Width"]=pl(A.width)),y.hidden&&(D["ss:Hidden"]="1"),l.push(ge("Column",null,D))});for(var c=Array.isArray(t),u=s.s.r;u<=s.e.r;++u){for(var h=[VI(u,(t["!rows"]||[])[u])],f=s.s.c;f<=s.e.c;++f){var m=!1;for(i=0;i!=a.length;++i)if(!(a[i].s.c>f)&&!(a[i].s.r>u)&&!(a[i].e.c<f)&&!(a[i].e.r<u)){(a[i].s.c!=f||a[i].s.r!=u)&&(m=!0);break}if(!m){var p={r:u,c:f},x=ot(p),g=c?(t[u]||[])[f]:t[x];h.push(BI(g,x,t,e,r,n,p))}}h.push("</Row>"),h.length>2&&l.push(h.join(""))}return l.join("")}function $I(t,e,r){var n=[],s=r.SheetNames[t],a=r.Sheets[s],i=a?OI(a,e,t,r):"";return i.length>0&&n.push("<Names>"+i+"</Names>"),i=a?UI(a,e,t,r):"",i.length>0&&n.push("<Table>"+i+"</Table>"),n.push(MI(a,e,t,r)),n.join("")}function HI(t,e){e||(e={}),t.SSF||(t.SSF=Er(At)),t.SSF&&(Ql(),Xl(t.SSF),e.revssf=Jl(t.SSF),e.revssf[t.SSF[65535]]=0,e.ssf=t.SSF,e.cellXfs=[],gs(e.cellXfs,{},{revssf:{General:0}}));var r=[];r.push(DI(t,e)),r.push(FI()),r.push(""),r.push("");for(var n=0;n<t.SheetNames.length;++n)r.push(ge("Worksheet",$I(n,e,t),{"ss:Name":it(t.SheetNames[n])}));return r[2]=jI(t,e),r[3]=kI(t),Ft+ge("Workbook",r.join(""),{xmlns:Ir.ss,"xmlns:o":Ir.o,"xmlns:x":Ir.x,"xmlns:ss":Ir.ss,"xmlns:dt":Ir.dt,"xmlns:html":Ir.html})}var Vc={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function WI(t,e){var r=[],n=[],s=[],a=0,i,l=Ef(Of,"n"),c=Ef(Mf,"n");if(t.Props)for(i=Zt(t.Props),a=0;a<i.length;++a)(Object.prototype.hasOwnProperty.call(l,i[a])?r:Object.prototype.hasOwnProperty.call(c,i[a])?n:s).push([i[a],t.Props[i[a]]]);if(t.Custprops)for(i=Zt(t.Custprops),a=0;a<i.length;++a)Object.prototype.hasOwnProperty.call(t.Props||{},i[a])||(Object.prototype.hasOwnProperty.call(l,i[a])?r:Object.prototype.hasOwnProperty.call(c,i[a])?n:s).push([i[a],t.Custprops[i[a]]]);var u=[];for(a=0;a<s.length;++a)Lg.indexOf(s[a][0])>-1||kg.indexOf(s[a][0])>-1||s[a][1]!=null&&u.push(s[a]);n.length&&lt.utils.cfb_add(e,"/SummaryInformation",$f(n,Vc.SI,c,Mf)),(r.length||u.length)&&lt.utils.cfb_add(e,"/DocumentSummaryInformation",$f(r,Vc.DSI,l,Of,u.length?u:null,Vc.UDI))}function qI(t,e){var r=e||{},n=lt.utils.cfb_new({root:"R"}),s="/Workbook";switch(r.bookType||"xls"){case"xls":r.bookType="biff8";case"xla":r.bookType||(r.bookType="xla");case"biff8":s="/Workbook",r.biff=8;break;case"biff5":s="/Book",r.biff=5;break;default:throw new Error("invalid type "+r.bookType+" for XLS CFB")}return lt.utils.cfb_add(n,s,px(t,r)),r.biff==8&&(t.Props||t.Custprops)&&WI(t,n),r.biff==8&&t.vbaraw&&cN(n,lt.read(t.vbaraw,{type:typeof t.vbaraw=="string"?"binary":"buffer"})),n}var GI={0:{f:KC},1:{f:n4},2:{f:E4},3:{f:h4},4:{f:o4},5:{f:y4},6:{f:C4},7:{f:p4},8:{f:k4},9:{f:j4},10:{f:D4},11:{f:F4},12:{f:a4},13:{f:A4},14:{f:f4},15:{f:c4},16:{f:w4},17:{f:P4},18:{f:x4},19:{f:dh},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:_I},40:{},42:{},43:{f:CS},44:{f:SS},45:{f:RS},46:{f:FS},47:{f:DS},48:{},49:{f:aA},50:{},51:{f:KS},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:iS},62:{f:N4},63:{f:tN},64:{f:Q4},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:pn,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:z4},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:t4},148:{f:JC,p:16},151:{f:U4},152:{},153:{f:vI},154:{},155:{},156:{f:gI},157:{},158:{},159:{T:1,f:gS},160:{T:-1},161:{T:1,f:Gs},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:O4},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:zS},336:{T:-1},337:{f:JS,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:mu},357:{},358:{},359:{},360:{T:1},361:{},362:{f:eS},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:$4},427:{f:H4},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:q4},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:e4},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:B4},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:mu},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:iN},633:{T:1},634:{T:-1},635:{T:1,f:sN},636:{T:-1},637:{f:cA},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:uI},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:J4},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function ve(t,e,r,n){var s=e;if(!isNaN(s)){var a=n||(r||[]).length||0,i=t.next(4);i.write_shift(2,s),i.write_shift(2,a),a>0&&ch(r)&&t.push(r)}}function zI(t,e,r,n){var s=(r||[]).length||0;if(s<=8224)return ve(t,e,r,s);var a=e;if(!isNaN(a)){for(var i=r.parts||[],l=0,c=0,u=0;u+(i[l]||8224)<=8224;)u+=i[l]||8224,l++;var h=t.next(4);for(h.write_shift(2,a),h.write_shift(2,u),t.push(r.slice(c,c+u)),c+=u;c<s;){for(h=t.next(4),h.write_shift(2,60),u=0;u+(i[l]||8224)<=8224;)u+=i[l]||8224,l++;h.write_shift(2,u),t.push(r.slice(c,c+u)),c+=u}}}function to(t,e,r){return t||(t=ee(7)),t.write_shift(2,e),t.write_shift(2,r),t.write_shift(2,0),t.write_shift(1,0),t}function YI(t,e,r,n){var s=ee(9);return to(s,t,e),Vg(r,n||"b",s),s}function KI(t,e,r){var n=ee(8+2*r.length);return to(n,t,e),n.write_shift(1,r.length),n.write_shift(r.length,r,"sbcs"),n.l<n.length?n.slice(0,n.l):n}function XI(t,e,r,n){if(e.v!=null)switch(e.t){case"d":case"n":var s=e.t=="d"?br(gr(e.v)):e.v;s==(s|0)&&s>=0&&s<65536?ve(t,2,uS(r,n,s)):ve(t,3,cS(r,n,s));return;case"b":case"e":ve(t,5,YI(r,n,e.v,e.t));return;case"s":case"str":ve(t,4,KI(r,n,(e.v||"").slice(0,255)));return}ve(t,1,to(null,r,n))}function QI(t,e,r,n){var s=Array.isArray(e),a=xt(e["!ref"]||"A1"),i,l="",c=[];if(a.e.c>255||a.e.r>16383){if(n.WTF)throw new Error("Range "+(e["!ref"]||"A1")+" exceeds format limit A1:IV16384");a.e.c=Math.min(a.e.c,255),a.e.r=Math.min(a.e.c,16383),i=Dt(a)}for(var u=a.s.r;u<=a.e.r;++u){l=Jt(u);for(var h=a.s.c;h<=a.e.c;++h){u===a.s.r&&(c[h]=cr(h)),i=c[h]+l;var f=s?(e[u]||[])[h]:e[i];f&&XI(t,f,u,h)}}}function JI(t,e){for(var r=e||{},n=wr(),s=0,a=0;a<t.SheetNames.length;++a)t.SheetNames[a]==r.sheet&&(s=a);if(s==0&&r.sheet&&t.SheetNames[0]!=r.sheet)throw new Error("Sheet not found: "+r.sheet);return ve(n,r.biff==4?1033:r.biff==3?521:9,ph(t,16,r)),QI(n,t.Sheets[t.SheetNames[s]],s,r),ve(n,10),n.end()}function ZI(t,e,r){ve(t,49,GA({sz:12,name:"Arial"},r))}function eP(t,e,r){e&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var s=n[0];s<=n[1];++s)e[s]!=null&&ve(t,1054,KA(s,e[s],r))})}function tP(t,e){var r=ee(19);r.write_shift(4,2151),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,1),r.write_shift(4,0),ve(t,2151,r),r=ee(39),r.write_shift(4,2152),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,0),r.write_shift(4,0),r.write_shift(2,1),r.write_shift(4,4),r.write_shift(2,0),Hg(xt(e["!ref"]||"A1"),r),r.write_shift(4,4),ve(t,2152,r)}function rP(t,e){for(var r=0;r<16;++r)ve(t,224,Wf({numFmtId:0,style:!0},0,e));e.cellXfs.forEach(function(n){ve(t,224,Wf(n,0,e))})}function nP(t,e){for(var r=0;r<e["!links"].length;++r){var n=e["!links"][r];ve(t,440,nS(n)),n[1].Tooltip&&ve(t,2048,sS(n))}delete e["!links"]}function sP(t,e){if(e){var r=0;e.forEach(function(n,s){++r<=256&&n&&ve(t,125,oS(rc(s,n),s))})}}function aP(t,e,r,n,s){var a=16+gs(s.cellXfs,e,s);if(e.v==null&&!e.bf){ve(t,513,Ms(r,n,a));return}if(e.bf)ve(t,6,IC(e,r,n,s,a));else switch(e.t){case"d":case"n":var i=e.t=="d"?br(gr(e.v)):e.v;ve(t,515,ZA(r,n,i,a));break;case"b":case"e":ve(t,517,JA(r,n,e.v,a,s,e.t));break;case"s":case"str":if(s.bookSST){var l=_h(s.Strings,e.v,s.revStrings);ve(t,253,zA(r,n,l,a))}else ve(t,516,YA(r,n,(e.v||"").slice(0,255),a,s));break;default:ve(t,513,Ms(r,n,a))}}function iP(t,e,r){var n=wr(),s=r.SheetNames[t],a=r.Sheets[s]||{},i=(r||{}).Workbook||{},l=(i.Sheets||[])[t]||{},c=Array.isArray(a),u=e.biff==8,h,f="",m=[],p=xt(a["!ref"]||"A1"),x=u?65536:16384;if(p.e.c>255||p.e.r>=x){if(e.WTF)throw new Error("Range "+(a["!ref"]||"A1")+" exceeds format limit A1:IV16384");p.e.c=Math.min(p.e.c,255),p.e.r=Math.min(p.e.c,x-1)}ve(n,2057,ph(r,16,e)),ve(n,13,Mr(1)),ve(n,12,Mr(100)),ve(n,15,pr(!0)),ve(n,17,pr(!1)),ve(n,16,Os(.001)),ve(n,95,pr(!0)),ve(n,42,pr(!1)),ve(n,43,pr(!1)),ve(n,130,Mr(1)),ve(n,128,QA()),ve(n,131,pr(!1)),ve(n,132,pr(!1)),u&&sP(n,a["!cols"]),ve(n,512,XA(p,e)),u&&(a["!links"]=[]);for(var g=p.s.r;g<=p.e.r;++g){f=Jt(g);for(var y=p.s.c;y<=p.e.c;++y){g===p.s.r&&(m[y]=cr(y)),h=m[y]+f;var I=c?(a[g]||[])[y]:a[h];I&&(aP(n,I,g,y,e),u&&I.l&&a["!links"].push([h,I.l]))}}var P=l.CodeName||l.name||s;return u&&ve(n,574,qA((i.Views||[])[0])),u&&(a["!merges"]||[]).length&&ve(n,229,rS(a["!merges"])),u&&nP(n,a),ve(n,442,$g(P)),u&&tP(n,a),ve(n,10),n.end()}function oP(t,e,r){var n=wr(),s=(t||{}).Workbook||{},a=s.Sheets||[],i=s.WBProps||{},l=r.biff==8,c=r.biff==5;if(ve(n,2057,ph(t,5,r)),r.bookType=="xla"&&ve(n,135),ve(n,225,l?Mr(1200):null),ve(n,193,DA(2)),c&&ve(n,191),c&&ve(n,192),ve(n,226),ve(n,92,UA("SheetJS",r)),ve(n,66,Mr(l?1200:1252)),l&&ve(n,353,Mr(0)),l&&ve(n,448),ve(n,317,lS(t.SheetNames.length)),l&&t.vbaraw&&ve(n,211),l&&t.vbaraw){var u=i.CodeName||"ThisWorkbook";ve(n,442,$g(u))}ve(n,156,Mr(17)),ve(n,25,pr(!1)),ve(n,18,pr(!1)),ve(n,19,Mr(0)),l&&ve(n,431,pr(!1)),l&&ve(n,444,Mr(0)),ve(n,61,WA()),ve(n,64,pr(!1)),ve(n,141,Mr(0)),ve(n,34,pr(dI(t)=="true")),ve(n,14,pr(!0)),l&&ve(n,439,pr(!1)),ve(n,218,Mr(0)),ZI(n,t,r),eP(n,t.SSF,r),rP(n,r),l&&ve(n,352,pr(!1));var h=n.end(),f=wr();l&&ve(f,140,aS()),l&&r.Strings&&zI(f,252,HA(r.Strings)),ve(f,10);var m=f.end(),p=wr(),x=0,g=0;for(g=0;g<t.SheetNames.length;++g)x+=(l?12:11)+(l?2:1)*t.SheetNames[g].length;var y=h.length+x+m.length;for(g=0;g<t.SheetNames.length;++g){var I=a[g]||{};ve(p,133,$A({pos:y,hs:I.Hidden||0,dt:0,name:t.SheetNames[g]},r)),y+=e[g].length}var P=p.end();if(x!=P.length)throw new Error("BS8 "+x+" != "+P.length);var A=[];return h.length&&A.push(h),P.length&&A.push(P),m.length&&A.push(m),Kt(A)}function lP(t,e){var r=e||{},n=[];t&&!t.SSF&&(t.SSF=Er(At)),t&&t.SSF&&(Ql(),Xl(t.SSF),r.revssf=Jl(t.SSF),r.revssf[t.SSF[65535]]=0,r.ssf=t.SSF),r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,wh(r),r.cellXfs=[],gs(r.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={});for(var s=0;s<t.SheetNames.length;++s)n[n.length]=iP(s,r,t);return n.unshift(oP(t,n,r)),Kt(n)}function px(t,e){for(var r=0;r<=t.SheetNames.length;++r){var n=t.Sheets[t.SheetNames[r]];if(!(!n||!n["!ref"])){var s=kr(n["!ref"]);s.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+t.SheetNames[r]+"' extends beyond column IV (255).  Data may be lost.")}}var a=e||{};switch(a.biff||2){case 8:case 5:return lP(t,e);case 4:case 3:case 2:return JI(t,e)}throw new Error("invalid type "+a.bookType+" for BIFF")}function cP(t,e,r,n){for(var s=t["!merges"]||[],a=[],i=e.s.c;i<=e.e.c;++i){for(var l=0,c=0,u=0;u<s.length;++u)if(!(s[u].s.r>r||s[u].s.c>i)&&!(s[u].e.r<r||s[u].e.c<i)){if(s[u].s.r<r||s[u].s.c<i){l=-1;break}l=s[u].e.r-s[u].s.r+1,c=s[u].e.c-s[u].s.c+1;break}if(!(l<0)){var h=ot({r,c:i}),f=n.dense?(t[r]||[])[i]:t[h],m=f&&f.v!=null&&(f.h||VT(f.w||(Rn(f),f.w)||""))||"",p={};l>1&&(p.rowspan=l),c>1&&(p.colspan=c),n.editable?m='<span contenteditable="true">'+m+"</span>":f&&(p["data-t"]=f&&f.t||"z",f.v!=null&&(p["data-v"]=f.v),f.z!=null&&(p["data-z"]=f.z),f.l&&(f.l.Target||"#").charAt(0)!="#"&&(m='<a href="'+f.l.Target+'">'+m+"</a>")),p.id=(n.id||"sjs")+"-"+h,a.push(ge("td",m,p))}}var x="<tr>";return x+a.join("")+"</tr>"}var uP='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',hP="</body></html>";function dP(t,e,r){var n=[];return n.join("")+"<table"+(r&&r.id?' id="'+r.id+'"':"")+">"}function gx(t,e){var r=e||{},n=r.header!=null?r.header:uP,s=r.footer!=null?r.footer:hP,a=[n],i=kr(t["!ref"]);r.dense=Array.isArray(t),a.push(dP(t,i,r));for(var l=i.s.r;l<=i.e.r;++l)a.push(cP(t,i,l,r));return a.push("</table>"+s),a.join("")}function xx(t,e,r){var n=r||{},s=0,a=0;if(n.origin!=null)if(typeof n.origin=="number")s=n.origin;else{var i=typeof n.origin=="string"?Ht(n.origin):n.origin;s=i.r,a=i.c}var l=e.getElementsByTagName("tr"),c=Math.min(n.sheetRows||1e7,l.length),u={s:{r:0,c:0},e:{r:s,c:a}};if(t["!ref"]){var h=kr(t["!ref"]);u.s.r=Math.min(u.s.r,h.s.r),u.s.c=Math.min(u.s.c,h.s.c),u.e.r=Math.max(u.e.r,h.e.r),u.e.c=Math.max(u.e.c,h.e.c),s==-1&&(u.e.r=s=h.e.r+1)}var f=[],m=0,p=t["!rows"]||(t["!rows"]=[]),x=0,g=0,y=0,I=0,P=0,A=0;for(t["!cols"]||(t["!cols"]=[]);x<l.length&&g<c;++x){var D=l[x];if(Qf(D)){if(n.display)continue;p[g]={hidden:!0}}var V=D.children;for(y=I=0;y<V.length;++y){var H=V[y];if(!(n.display&&Qf(H))){var w=H.hasAttribute("data-v")?H.getAttribute("data-v"):H.hasAttribute("v")?H.getAttribute("v"):WT(H.innerHTML),E=H.getAttribute("data-z")||H.getAttribute("z");for(m=0;m<f.length;++m){var _=f[m];_.s.c==I+a&&_.s.r<g+s&&g+s<=_.e.r&&(I=_.e.c+1-a,m=-1)}A=+H.getAttribute("colspan")||1,((P=+H.getAttribute("rowspan")||1)>1||A>1)&&f.push({s:{r:g+s,c:I+a},e:{r:g+s+(P||1)-1,c:I+a+(A||1)-1}});var N={t:"s",v:w},T=H.getAttribute("data-t")||H.getAttribute("t")||"";w!=null&&(w.length==0?N.t=T||"z":n.raw||w.trim().length==0||T=="s"||(w==="TRUE"?N={t:"b",v:!0}:w==="FALSE"?N={t:"b",v:!1}:isNaN(Tn(w))?isNaN(Ii(w).getDate())||(N={t:"d",v:gr(w)},n.cellDates||(N={t:"n",v:br(N.v)}),N.z=n.dateNF||At[14]):N={t:"n",v:Tn(w)})),N.z===void 0&&E!=null&&(N.z=E);var R="",S=H.getElementsByTagName("A");if(S&&S.length)for(var se=0;se<S.length&&!(S[se].hasAttribute("href")&&(R=S[se].getAttribute("href"),R.charAt(0)!="#"));++se);R&&R.charAt(0)!="#"&&(N.l={Target:R}),n.dense?(t[g+s]||(t[g+s]=[]),t[g+s][I+a]=N):t[ot({c:I+a,r:g+s})]=N,u.e.c<I+a&&(u.e.c=I+a),I+=A}}++g}return f.length&&(t["!merges"]=(t["!merges"]||[]).concat(f)),u.e.r=Math.max(u.e.r,g-1+s),t["!ref"]=Dt(u),g>=c&&(t["!fullref"]=Dt((u.e.r=l.length-x+g-1+s,u))),t}function vx(t,e){var r=e||{},n=r.dense?[]:{};return xx(n,t,e)}function fP(t,e){return $s(vx(t,e),e)}function Qf(t){var e="",r=mP(t);return r&&(e=r(t).getPropertyValue("display")),e||(e=t.style&&t.style.display),e==="none"}function mP(t){return t.ownerDocument.defaultView&&typeof t.ownerDocument.defaultView.getComputedStyle=="function"?t.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}var pP=(function(){var t=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),e="<office:document-styles "+Ri({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+t+"</office:document-styles>";return function(){return Ft+e}})(),Jf=(function(){var t=function(a){return it(a).replace(/  +/g,function(i){return'<text:s text:c="'+i.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},e=`          <table:table-cell />
`,r=`          <table:covered-table-cell/>
`,n=function(a,i,l){var c=[];c.push('      <table:table table:name="'+it(i.SheetNames[l])+`" table:style-name="ta1">
`);var u=0,h=0,f=kr(a["!ref"]||"A1"),m=a["!merges"]||[],p=0,x=Array.isArray(a);if(a["!cols"])for(h=0;h<=f.e.c;++h)c.push("        <table:table-column"+(a["!cols"][h]?' table:style-name="co'+a["!cols"][h].ods+'"':"")+`></table:table-column>
`);var g="",y=a["!rows"]||[];for(u=0;u<f.s.r;++u)g=y[u]?' table:style-name="ro'+y[u].ods+'"':"",c.push("        <table:table-row"+g+`></table:table-row>
`);for(;u<=f.e.r;++u){for(g=y[u]?' table:style-name="ro'+y[u].ods+'"':"",c.push("        <table:table-row"+g+`>
`),h=0;h<f.s.c;++h)c.push(e);for(;h<=f.e.c;++h){var I=!1,P={},A="";for(p=0;p!=m.length;++p)if(!(m[p].s.c>h)&&!(m[p].s.r>u)&&!(m[p].e.c<h)&&!(m[p].e.r<u)){(m[p].s.c!=h||m[p].s.r!=u)&&(I=!0),P["table:number-columns-spanned"]=m[p].e.c-m[p].s.c+1,P["table:number-rows-spanned"]=m[p].e.r-m[p].s.r+1;break}if(I){c.push(r);continue}var D=ot({r:u,c:h}),V=x?(a[u]||[])[h]:a[D];if(V&&V.f&&(P["table:formula"]=it(kC(V.f)),V.F&&V.F.slice(0,D.length)==D)){var H=kr(V.F);P["table:number-matrix-columns-spanned"]=H.e.c-H.s.c+1,P["table:number-matrix-rows-spanned"]=H.e.r-H.s.r+1}if(!V){c.push(e);continue}switch(V.t){case"b":A=V.v?"TRUE":"FALSE",P["office:value-type"]="boolean",P["office:boolean-value"]=V.v?"true":"false";break;case"n":A=V.w||String(V.v||0),P["office:value-type"]="float",P["office:value"]=V.v||0;break;case"s":case"str":A=V.v==null?"":V.v,P["office:value-type"]="string";break;case"d":A=V.w||gr(V.v).toISOString(),P["office:value-type"]="date",P["office:date-value"]=gr(V.v).toISOString(),P["table:style-name"]="ce1";break;default:c.push(e);continue}var w=t(A);if(V.l&&V.l.Target){var E=V.l.Target;E=E.charAt(0)=="#"?"#"+OC(E.slice(1)):E,E.charAt(0)!="#"&&!E.match(/^\w+:/)&&(E="../"+E),w=ge("text:a",w,{"xlink:href":E.replace(/&/g,"&amp;")})}c.push("          "+ge("table:table-cell",ge("text:p",w,{}),P)+`
`)}c.push(`        </table:table-row>
`)}return c.push(`      </table:table>
`),c.join("")},s=function(a,i){a.push(` <office:automatic-styles>
`),a.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),a.push(`   <number:month number:style="long"/>
`),a.push(`   <number:text>/</number:text>
`),a.push(`   <number:day number:style="long"/>
`),a.push(`   <number:text>/</number:text>
`),a.push(`   <number:year/>
`),a.push(`  </number:date-style>
`);var l=0;i.SheetNames.map(function(u){return i.Sheets[u]}).forEach(function(u){if(u&&u["!cols"]){for(var h=0;h<u["!cols"].length;++h)if(u["!cols"][h]){var f=u["!cols"][h];if(f.width==null&&f.wpx==null&&f.wch==null)continue;gh(f),f.ods=l;var m=u["!cols"][h].wpx+"px";a.push('  <style:style style:name="co'+l+`" style:family="table-column">
`),a.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+m+`"/>
`),a.push(`  </style:style>
`),++l}}});var c=0;i.SheetNames.map(function(u){return i.Sheets[u]}).forEach(function(u){if(u&&u["!rows"]){for(var h=0;h<u["!rows"].length;++h)if(u["!rows"][h]){u["!rows"][h].ods=c;var f=u["!rows"][h].hpx+"px";a.push('  <style:style style:name="ro'+c+`" style:family="table-row">
`),a.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+f+`"/>
`),a.push(`  </style:style>
`),++c}}}),a.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),a.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),a.push(`  </style:style>
`),a.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),a.push(` </office:automatic-styles>
`)};return function(i,l){var c=[Ft],u=Ri({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),h=Ri({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});l.bookType=="fods"?(c.push("<office:document"+u+h+`>
`),c.push(Fg().replace(/office:document-meta/g,"office:meta"))):c.push("<office:document-content"+u+`>
`),s(c,i),c.push(`  <office:body>
`),c.push(`    <office:spreadsheet>
`);for(var f=0;f!=i.SheetNames.length;++f)c.push(n(i.Sheets[i.SheetNames[f]],i,f));return c.push(`    </office:spreadsheet>
`),c.push(`  </office:body>
`),l.bookType=="fods"?c.push("</office:document>"):c.push("</office:document-content>"),c.join("")}})();function yx(t,e){if(e.bookType=="fods")return Jf(t,e);var r=ah(),n="",s=[],a=[];return n="mimetype",$e(r,n,"application/vnd.oasis.opendocument.spreadsheet"),n="content.xml",$e(r,n,Jf(t,e)),s.push([n,"text/xml"]),a.push([n,"ContentFile"]),n="styles.xml",$e(r,n,pP(t,e)),s.push([n,"text/xml"]),a.push([n,"StylesFile"]),n="meta.xml",$e(r,n,Ft+Fg()),s.push([n,"text/xml"]),a.push([n,"MetadataFile"]),n="manifest.rdf",$e(r,n,NA(a)),s.push([n,"application/rdf+xml"]),n="META-INF/manifest.xml",$e(r,n,AA(s)),r}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function vl(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function gP(t){return typeof TextEncoder<"u"?new TextEncoder().encode(t):qr(Pi(t))}function xP(t,e){e:for(var r=0;r<=t.length-e.length;++r){for(var n=0;n<e.length;++n)if(t[r+n]!=e[n])continue e;return!0}return!1}function as(t){var e=t.reduce(function(s,a){return s+a.length},0),r=new Uint8Array(e),n=0;return t.forEach(function(s){r.set(s,n),n+=s.length}),r}function vP(t,e,r){var n=Math.floor(r==0?0:Math.LOG10E*Math.log(Math.abs(r)))+6176-20,s=r/Math.pow(10,n-6176);t[e+15]|=n>>7,t[e+14]|=(n&127)<<1;for(var a=0;s>=1;++a,s/=256)t[e+a]=s&255;t[e+15]|=r>=0?0:128}function Di(t,e){var r=e?e[0]:0,n=t[r]&127;e:if(t[r++]>=128&&(n|=(t[r]&127)<<7,t[r++]<128||(n|=(t[r]&127)<<14,t[r++]<128)||(n|=(t[r]&127)<<21,t[r++]<128)||(n+=(t[r]&127)*Math.pow(2,28),++r,t[r++]<128)||(n+=(t[r]&127)*Math.pow(2,35),++r,t[r++]<128)||(n+=(t[r]&127)*Math.pow(2,42),++r,t[r++]<128)))break e;return e&&(e[0]=r),n}function st(t){var e=new Uint8Array(7);e[0]=t&127;var r=1;e:if(t>127){if(e[r-1]|=128,e[r]=t>>7&127,++r,t<=16383||(e[r-1]|=128,e[r]=t>>14&127,++r,t<=2097151)||(e[r-1]|=128,e[r]=t>>21&127,++r,t<=268435455)||(e[r-1]|=128,e[r]=t/256>>>21&127,++r,t<=34359738367)||(e[r-1]|=128,e[r]=t/65536>>>21&127,++r,t<=4398046511103))break e;e[r-1]|=128,e[r]=t/16777216>>>21&127,++r}return e.slice(0,r)}function xa(t){var e=0,r=t[e]&127;e:if(t[e++]>=128){if(r|=(t[e]&127)<<7,t[e++]<128||(r|=(t[e]&127)<<14,t[e++]<128)||(r|=(t[e]&127)<<21,t[e++]<128))break e;r|=(t[e]&127)<<28}return r}function Mt(t){for(var e=[],r=[0];r[0]<t.length;){var n=r[0],s=Di(t,r),a=s&7;s=Math.floor(s/8);var i=0,l;if(s==0)break;switch(a){case 0:{for(var c=r[0];t[r[0]++]>=128;);l=t.slice(c,r[0])}break;case 5:i=4,l=t.slice(r[0],r[0]+i),r[0]+=i;break;case 1:i=8,l=t.slice(r[0],r[0]+i),r[0]+=i;break;case 2:i=Di(t,r),l=t.slice(r[0],r[0]+i),r[0]+=i;break;case 3:case 4:default:throw new Error("PB Type ".concat(a," for Field ").concat(s," at offset ").concat(n))}var u={data:l,type:a};e[s]==null?e[s]=[u]:e[s].push(u)}return e}function Gt(t){var e=[];return t.forEach(function(r,n){r.forEach(function(s){s.data&&(e.push(st(n*8+s.type)),s.type==2&&e.push(st(s.data.length)),e.push(s.data))})}),as(e)}function Hr(t){for(var e,r=[],n=[0];n[0]<t.length;){var s=Di(t,n),a=Mt(t.slice(n[0],n[0]+s));n[0]+=s;var i={id:xa(a[1][0].data),messages:[]};a[2].forEach(function(l){var c=Mt(l.data),u=xa(c[3][0].data);i.messages.push({meta:c,data:t.slice(n[0],n[0]+u)}),n[0]+=u}),(e=a[3])!=null&&e[0]&&(i.merge=xa(a[3][0].data)>>>0>0),r.push(i)}return r}function ra(t){var e=[];return t.forEach(function(r){var n=[];n[1]=[{data:st(r.id),type:0}],n[2]=[],r.merge!=null&&(n[3]=[{data:st(+!!r.merge),type:0}]);var s=[];r.messages.forEach(function(i){s.push(i.data),i.meta[3]=[{type:0,data:st(i.data.length)}],n[2].push({data:Gt(i.meta),type:2})});var a=Gt(n);e.push(st(a.length)),e.push(a),s.forEach(function(i){return e.push(i)})}),as(e)}function yP(t,e){if(t!=0)throw new Error("Unexpected Snappy chunk type ".concat(t));for(var r=[0],n=Di(e,r),s=[];r[0]<e.length;){var a=e[r[0]]&3;if(a==0){var i=e[r[0]++]>>2;if(i<60)++i;else{var l=i-59;i=e[r[0]],l>1&&(i|=e[r[0]+1]<<8),l>2&&(i|=e[r[0]+2]<<16),l>3&&(i|=e[r[0]+3]<<24),i>>>=0,i++,r[0]+=l}s.push(e.slice(r[0],r[0]+i)),r[0]+=i;continue}else{var c=0,u=0;if(a==1?(u=(e[r[0]]>>2&7)+4,c=(e[r[0]++]&224)<<3,c|=e[r[0]++]):(u=(e[r[0]++]>>2)+1,a==2?(c=e[r[0]]|e[r[0]+1]<<8,r[0]+=2):(c=(e[r[0]]|e[r[0]+1]<<8|e[r[0]+2]<<16|e[r[0]+3]<<24)>>>0,r[0]+=4)),s=[as(s)],c==0)throw new Error("Invalid offset 0");if(c>s[0].length)throw new Error("Invalid offset beyond length");if(u>=c)for(s.push(s[0].slice(-c)),u-=c;u>=s[s.length-1].length;)s.push(s[s.length-1]),u-=s[s.length-1].length;s.push(s[0].slice(-c,-c+u))}}var h=as(s);if(h.length!=n)throw new Error("Unexpected length: ".concat(h.length," != ").concat(n));return h}function Wr(t){for(var e=[],r=0;r<t.length;){var n=t[r++],s=t[r]|t[r+1]<<8|t[r+2]<<16;r+=3,e.push(yP(n,t.slice(r,r+s))),r+=s}if(r!==t.length)throw new Error("data is not a valid framed stream!");return as(e)}function na(t){for(var e=[],r=0;r<t.length;){var n=Math.min(t.length-r,268435455),s=new Uint8Array(4);e.push(s);var a=st(n),i=a.length;e.push(a),n<=60?(i++,e.push(new Uint8Array([n-1<<2]))):n<=256?(i+=2,e.push(new Uint8Array([240,n-1&255]))):n<=65536?(i+=3,e.push(new Uint8Array([244,n-1&255,n-1>>8&255]))):n<=16777216?(i+=4,e.push(new Uint8Array([248,n-1&255,n-1>>8&255,n-1>>16&255]))):n<=4294967296&&(i+=5,e.push(new Uint8Array([252,n-1&255,n-1>>8&255,n-1>>16&255,n-1>>>24&255]))),e.push(t.slice(r,r+n)),i+=n,s[0]=0,s[1]=i&255,s[2]=i>>8&255,s[3]=i>>16&255,r+=n}return as(e)}function Uc(t,e){var r=new Uint8Array(32),n=vl(r),s=12,a=0;switch(r[0]=5,t.t){case"n":r[1]=2,vP(r,s,t.v),a|=1,s+=16;break;case"b":r[1]=6,n.setFloat64(s,t.v?1:0,!0),a|=2,s+=8;break;case"s":if(e.indexOf(t.v)==-1)throw new Error("Value ".concat(t.v," missing from SST!"));r[1]=3,n.setUint32(s,e.indexOf(t.v),!0),a|=8,s+=4;break;default:throw"unsupported cell type "+t.t}return n.setUint32(8,a,!0),r.slice(0,s)}function $c(t,e){var r=new Uint8Array(32),n=vl(r),s=12,a=0;switch(r[0]=3,t.t){case"n":r[2]=2,n.setFloat64(s,t.v,!0),a|=32,s+=8;break;case"b":r[2]=6,n.setFloat64(s,t.v?1:0,!0),a|=32,s+=8;break;case"s":if(e.indexOf(t.v)==-1)throw new Error("Value ".concat(t.v," missing from SST!"));r[2]=3,n.setUint32(s,e.indexOf(t.v),!0),a|=16,s+=4;break;default:throw"unsupported cell type "+t.t}return n.setUint32(4,a,!0),r.slice(0,s)}function qn(t){var e=Mt(t);return Di(e[1][0].data)}function _P(t,e,r){var n,s,a,i;if(!((n=t[6])!=null&&n[0])||!((s=t[7])!=null&&s[0]))throw"Mutation only works on post-BNC storages!";var l=((i=(a=t[8])==null?void 0:a[0])==null?void 0:i.data)&&xa(t[8][0].data)>0||!1;if(l)throw"Math only works with normal offsets";for(var c=0,u=vl(t[7][0].data),h=0,f=[],m=vl(t[4][0].data),p=0,x=[],g=0;g<e.length;++g){if(e[g]==null){u.setUint16(g*2,65535,!0),m.setUint16(g*2,65535);continue}u.setUint16(g*2,h,!0),m.setUint16(g*2,p,!0);var y,I;switch(typeof e[g]){case"string":y=Uc({t:"s",v:e[g]},r),I=$c({t:"s",v:e[g]},r);break;case"number":y=Uc({t:"n",v:e[g]},r),I=$c({t:"n",v:e[g]},r);break;case"boolean":y=Uc({t:"b",v:e[g]},r),I=$c({t:"b",v:e[g]},r);break;default:throw new Error("Unsupported value "+e[g])}f.push(y),h+=y.length,x.push(I),p+=I.length,++c}for(t[2][0].data=st(c);g<t[7][0].data.length/2;++g)u.setUint16(g*2,65535,!0),m.setUint16(g*2,65535,!0);return t[6][0].data=as(f),t[3][0].data=as(x),c}function wP(t,e){if(!e||!e.numbers)throw new Error("Must pass a `numbers` option -- check the README");var r=t.Sheets[t.SheetNames[0]];t.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var n=kr(r["!ref"]);n.s.r=n.s.c=0;var s=!1;n.e.c>9&&(s=!0,n.e.c=9),n.e.r>49&&(s=!0,n.e.r=49),s&&console.error("The Numbers writer is currently limited to ".concat(Dt(n)));var a=yl(r,{range:n,header:1}),i=["~Sh33tJ5~"];a.forEach(function(Y){return Y.forEach(function(q){typeof q=="string"&&i.push(q)})});var l={},c=[],u=lt.read(e.numbers,{type:"base64"});u.FileIndex.map(function(Y,q){return[Y,u.FullPaths[q]]}).forEach(function(Y){var q=Y[0],W=Y[1];if(q.type==2&&q.name.match(/\.iwa/)){var ae=q.content,be=Wr(ae),ye=Hr(be);ye.forEach(function(pe){c.push(pe.id),l[pe.id]={deps:[],location:W,type:xa(pe.messages[0].meta[1][0].data)}})}}),c.sort(function(Y,q){return Y-q});var h=c.filter(function(Y){return Y>1}).map(function(Y){return[Y,st(Y)]});u.FileIndex.map(function(Y,q){return[Y,u.FullPaths[q]]}).forEach(function(Y){var q=Y[0];if(Y[1],!!q.name.match(/\.iwa/)){var W=Hr(Wr(q.content));W.forEach(function(ae){ae.messages.forEach(function(be){h.forEach(function(ye){ae.messages.some(function(pe){return xa(pe.meta[1][0].data)!=11006&&xP(pe.data,ye[1])})&&l[ye[0]].deps.push(ae.id)})})})}});for(var f=lt.find(u,l[1].location),m=Hr(Wr(f.content)),p,x=0;x<m.length;++x){var g=m[x];g.id==1&&(p=g)}var y=qn(Mt(p.messages[0].data)[1][0].data);for(f=lt.find(u,l[y].location),m=Hr(Wr(f.content)),x=0;x<m.length;++x)g=m[x],g.id==y&&(p=g);for(y=qn(Mt(p.messages[0].data)[2][0].data),f=lt.find(u,l[y].location),m=Hr(Wr(f.content)),x=0;x<m.length;++x)g=m[x],g.id==y&&(p=g);for(y=qn(Mt(p.messages[0].data)[2][0].data),f=lt.find(u,l[y].location),m=Hr(Wr(f.content)),x=0;x<m.length;++x)g=m[x],g.id==y&&(p=g);var I=Mt(p.messages[0].data);{I[6][0].data=st(n.e.r+1),I[7][0].data=st(n.e.c+1);var P=qn(I[46][0].data),A=lt.find(u,l[P].location),D=Hr(Wr(A.content));{for(var V=0;V<D.length&&D[V].id!=P;++V);if(D[V].id!=P)throw"Bad ColumnRowUIDMapArchive";var H=Mt(D[V].messages[0].data);H[1]=[],H[2]=[],H[3]=[];for(var w=0;w<=n.e.c;++w){var E=[];E[1]=E[2]=[{type:0,data:st(w+420690)}],H[1].push({type:2,data:Gt(E)}),H[2].push({type:0,data:st(w)}),H[3].push({type:0,data:st(w)})}H[4]=[],H[5]=[],H[6]=[];for(var _=0;_<=n.e.r;++_)E=[],E[1]=E[2]=[{type:0,data:st(_+726270)}],H[4].push({type:2,data:Gt(E)}),H[5].push({type:0,data:st(_)}),H[6].push({type:0,data:st(_)});D[V].messages[0].data=Gt(H)}A.content=na(ra(D)),A.size=A.content.length,delete I[46];var N=Mt(I[4][0].data);{N[7][0].data=st(n.e.r+1);var T=Mt(N[1][0].data),R=qn(T[2][0].data);A=lt.find(u,l[R].location),D=Hr(Wr(A.content));{if(D[0].id!=R)throw"Bad HeaderStorageBucket";var S=Mt(D[0].messages[0].data);for(_=0;_<a.length;++_){var se=Mt(S[2][0].data);se[1][0].data=st(_),se[4][0].data=st(a[_].length),S[2][_]={type:S[2][0].type,data:Gt(se)}}D[0].messages[0].data=Gt(S)}A.content=na(ra(D)),A.size=A.content.length;var te=qn(N[2][0].data);A=lt.find(u,l[te].location),D=Hr(Wr(A.content));{if(D[0].id!=te)throw"Bad HeaderStorageBucket";for(S=Mt(D[0].messages[0].data),w=0;w<=n.e.c;++w)se=Mt(S[2][0].data),se[1][0].data=st(w),se[4][0].data=st(n.e.r+1),S[2][w]={type:S[2][0].type,data:Gt(se)};D[0].messages[0].data=Gt(S)}A.content=na(ra(D)),A.size=A.content.length;var me=qn(N[4][0].data);(function(){for(var Y=lt.find(u,l[me].location),q=Hr(Wr(Y.content)),W,ae=0;ae<q.length;++ae){var be=q[ae];be.id==me&&(W=be)}var ye=Mt(W.messages[0].data);{ye[3]=[];var pe=[];i.forEach(function(Ve,nt){pe[1]=[{type:0,data:st(nt)}],pe[2]=[{type:0,data:st(1)}],pe[3]=[{type:2,data:gP(Ve)}],ye[3].push({type:2,data:Gt(pe)})})}W.messages[0].data=Gt(ye);var xe=ra(q),We=na(xe);Y.content=We,Y.size=Y.content.length})();var ce=Mt(N[3][0].data);{var le=ce[1][0];delete ce[2];var Ae=Mt(le.data);{var Oe=qn(Ae[2][0].data);(function(){for(var Y=lt.find(u,l[Oe].location),q=Hr(Wr(Y.content)),W,ae=0;ae<q.length;++ae){var be=q[ae];be.id==Oe&&(W=be)}var ye=Mt(W.messages[0].data);{delete ye[6],delete ce[7];var pe=new Uint8Array(ye[5][0].data);ye[5]=[];for(var xe=0,We=0;We<=n.e.r;++We){var Ve=Mt(pe);xe+=_P(Ve,a[We],i),Ve[1][0].data=st(We),ye[5].push({data:Gt(Ve),type:2})}ye[1]=[{type:0,data:st(n.e.c+1)}],ye[2]=[{type:0,data:st(n.e.r+1)}],ye[3]=[{type:0,data:st(xe)}],ye[4]=[{type:0,data:st(n.e.r+1)}]}W.messages[0].data=Gt(ye);var nt=ra(q),qe=na(nt);Y.content=qe,Y.size=Y.content.length})()}le.data=Gt(Ae)}N[3][0].data=Gt(ce)}I[4][0].data=Gt(N)}p.messages[0].data=Gt(I);var Je=ra(m),U=na(Je);return f.content=U,f.size=f.content.length,u}function bP(t){return function(r){for(var n=0;n!=t.length;++n){var s=t[n];r[s[0]]===void 0&&(r[s[0]]=s[1]),s[2]==="n"&&(r[s[0]]=Number(r[s[0]]))}}}function wh(t){bP([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(t)}function EP(t,e){return e.bookType=="ods"?yx(t,e):e.bookType=="numbers"?wP(t,e):e.bookType=="xlsb"?TP(t,e):AP(t,e)}function TP(t,e){ua=1024,t&&!t.SSF&&(t.SSF=Er(At)),t&&t.SSF&&(Ql(),Xl(t.SSF),e.revssf=Jl(t.SSF),e.revssf[t.SSF[65535]]=0,e.ssf=t.SSF),e.rels={},e.wbrels={},e.Strings=[],e.Strings.Count=0,e.Strings.Unique=0,pi?e.revStrings=new Map:(e.revStrings={},e.revStrings.foo=[],delete e.revStrings.foo);var r=e.bookType=="xlsb"?"bin":"xml",n=tx.indexOf(e.bookType)>-1,s=Pg();wh(e=e||{});var a=ah(),i="",l=0;if(e.cellXfs=[],gs(e.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={}),i="docProps/core.xml",$e(a,i,jg(t.Props,e)),s.coreprops.push(i),at(e.rels,2,i,Qe.CORE_PROPS),i="docProps/app.xml",!(t.Props&&t.Props.SheetNames))if(!t.Workbook||!t.Workbook.Sheets)t.Props.SheetNames=t.SheetNames;else{for(var c=[],u=0;u<t.SheetNames.length;++u)(t.Workbook.Sheets[u]||{}).Hidden!=2&&c.push(t.SheetNames[u]);t.Props.SheetNames=c}for(t.Props.Worksheets=t.Props.SheetNames.length,$e(a,i,Og(t.Props)),s.extprops.push(i),at(e.rels,3,i,Qe.EXT_PROPS),t.Custprops!==t.Props&&Zt(t.Custprops||{}).length>0&&(i="docProps/custom.xml",$e(a,i,Mg(t.Custprops)),s.custprops.push(i),at(e.rels,4,i,Qe.CUST_PROPS)),l=1;l<=t.SheetNames.length;++l){var h={"!id":{}},f=t.Sheets[t.SheetNames[l-1]],m=(f||{})["!type"]||"sheet";switch(m){case"chart":default:i="xl/worksheets/sheet"+l+"."+r,$e(a,i,NI(l-1,i,e,t,h)),s.sheets.push(i),at(e.wbrels,-1,"worksheets/sheet"+l+"."+r,Qe.WS[0])}if(f){var p=f["!comments"],x=!1,g="";p&&p.length>0&&(g="xl/comments"+l+"."+r,$e(a,g,PI(p,g)),s.comments.push(g),at(h,-1,"../comments"+l+"."+r,Qe.CMNT),x=!0),f["!legacy"]&&x&&$e(a,"xl/drawings/vmlDrawing"+l+".vml",Zg(l,f["!comments"])),delete f["!comments"],delete f["!legacy"]}h["!id"].rId1&&$e(a,Dg(i),pa(h))}return e.Strings!=null&&e.Strings.length>0&&(i="xl/sharedStrings."+r,$e(a,i,II(e.Strings,i,e)),s.strs.push(i),at(e.wbrels,-1,"sharedStrings."+r,Qe.SST)),i="xl/workbook."+r,$e(a,i,SI(t,i)),s.workbooks.push(i),at(e.rels,1,i,Qe.WB),i="xl/theme/theme1.xml",$e(a,i,Qg(t.Themes,e)),s.themes.push(i),at(e.wbrels,-1,"theme/theme1.xml",Qe.THEME),i="xl/styles."+r,$e(a,i,CI(t,i,e)),s.styles.push(i),at(e.wbrels,-1,"styles."+r,Qe.STY),t.vbaraw&&n&&(i="xl/vbaProject.bin",$e(a,i,t.vbaraw),s.vba.push(i),at(e.wbrels,-1,"vbaProject.bin",Qe.VBA)),i="xl/metadata."+r,$e(a,i,RI(i)),s.metadata.push(i),at(e.wbrels,-1,"metadata."+r,Qe.XLMETA),$e(a,"[Content_Types].xml",Rg(s,e)),$e(a,"_rels/.rels",pa(e.rels)),$e(a,"xl/_rels/workbook."+r+".rels",pa(e.wbrels)),delete e.revssf,delete e.ssf,a}function AP(t,e){ua=1024,t&&!t.SSF&&(t.SSF=Er(At)),t&&t.SSF&&(Ql(),Xl(t.SSF),e.revssf=Jl(t.SSF),e.revssf[t.SSF[65535]]=0,e.ssf=t.SSF),e.rels={},e.wbrels={},e.Strings=[],e.Strings.Count=0,e.Strings.Unique=0,pi?e.revStrings=new Map:(e.revStrings={},e.revStrings.foo=[],delete e.revStrings.foo);var r="xml",n=tx.indexOf(e.bookType)>-1,s=Pg();wh(e=e||{});var a=ah(),i="",l=0;if(e.cellXfs=[],gs(e.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={}),i="docProps/core.xml",$e(a,i,jg(t.Props,e)),s.coreprops.push(i),at(e.rels,2,i,Qe.CORE_PROPS),i="docProps/app.xml",!(t.Props&&t.Props.SheetNames))if(!t.Workbook||!t.Workbook.Sheets)t.Props.SheetNames=t.SheetNames;else{for(var c=[],u=0;u<t.SheetNames.length;++u)(t.Workbook.Sheets[u]||{}).Hidden!=2&&c.push(t.SheetNames[u]);t.Props.SheetNames=c}t.Props.Worksheets=t.Props.SheetNames.length,$e(a,i,Og(t.Props)),s.extprops.push(i),at(e.rels,3,i,Qe.EXT_PROPS),t.Custprops!==t.Props&&Zt(t.Custprops||{}).length>0&&(i="docProps/custom.xml",$e(a,i,Mg(t.Custprops)),s.custprops.push(i),at(e.rels,4,i,Qe.CUST_PROPS));var h=["SheetJ5"];for(e.tcid=0,l=1;l<=t.SheetNames.length;++l){var f={"!id":{}},m=t.Sheets[t.SheetNames[l-1]],p=(m||{})["!type"]||"sheet";switch(p){case"chart":default:i="xl/worksheets/sheet"+l+"."+r,$e(a,i,ux(l-1,e,t,f)),s.sheets.push(i),at(e.wbrels,-1,"worksheets/sheet"+l+"."+r,Qe.WS[0])}if(m){var x=m["!comments"],g=!1,y="";if(x&&x.length>0){var I=!1;x.forEach(function(P){P[1].forEach(function(A){A.T==!0&&(I=!0)})}),I&&(y="xl/threadedComments/threadedComment"+l+"."+r,$e(a,y,rN(x,h,e)),s.threadedcomments.push(y),at(f,-1,"../threadedComments/threadedComment"+l+"."+r,Qe.TCMNT)),y="xl/comments"+l+"."+r,$e(a,y,ex(x)),s.comments.push(y),at(f,-1,"../comments"+l+"."+r,Qe.CMNT),g=!0}m["!legacy"]&&g&&$e(a,"xl/drawings/vmlDrawing"+l+".vml",Zg(l,m["!comments"])),delete m["!comments"],delete m["!legacy"]}f["!id"].rId1&&$e(a,Dg(i),pa(f))}return e.Strings!=null&&e.Strings.length>0&&(i="xl/sharedStrings."+r,$e(a,i,qg(e.Strings,e)),s.strs.push(i),at(e.wbrels,-1,"sharedStrings."+r,Qe.SST)),i="xl/workbook."+r,$e(a,i,fx(t)),s.workbooks.push(i),at(e.rels,1,i,Qe.WB),i="xl/theme/theme1.xml",$e(a,i,Qg(t.Themes,e)),s.themes.push(i),at(e.wbrels,-1,"theme/theme1.xml",Qe.THEME),i="xl/styles."+r,$e(a,i,Kg(t,e)),s.styles.push(i),at(e.wbrels,-1,"styles."+r,Qe.STY),t.vbaraw&&n&&(i="xl/vbaProject.bin",$e(a,i,t.vbaraw),s.vba.push(i),at(e.wbrels,-1,"vbaProject.bin",Qe.VBA)),i="xl/metadata."+r,$e(a,i,Jg()),s.metadata.push(i),at(e.wbrels,-1,"metadata."+r,Qe.XLMETA),h.length>1&&(i="xl/persons/person.xml",$e(a,i,nN(h)),s.people.push(i),at(e.wbrels,-1,"persons/person.xml",Qe.PEOPLE)),$e(a,"[Content_Types].xml",Rg(s,e)),$e(a,"_rels/.rels",pa(e.rels)),$e(a,"xl/_rels/workbook."+r+".rels",pa(e.wbrels)),delete e.revssf,delete e.ssf,a}function SP(t,e){var r="";switch((e||{}).type||"base64"){case"buffer":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];case"base64":r=Pn(t.slice(0,12));break;case"binary":r=t;break;case"array":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];default:throw new Error("Unrecognized type "+(e&&e.type||"undefined"))}return[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3),r.charCodeAt(4),r.charCodeAt(5),r.charCodeAt(6),r.charCodeAt(7)]}function _x(t,e){switch(e.type){case"base64":case"binary":break;case"buffer":case"array":e.type="";break;case"file":return Qi(e.file,lt.write(t,{type:et?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+e.bookType+"' files");default:throw new Error("Unrecognized type "+e.type)}return lt.write(t,e)}function NP(t,e){var r=Er(e||{}),n=EP(t,r);return CP(n,r)}function CP(t,e){var r={},n=et?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(e.compression&&(r.compression="DEFLATE"),e.password)r.type=n;else switch(e.type){case"base64":r.type="base64";break;case"binary":r.type="string";break;case"string":throw new Error("'string' output type invalid for '"+e.bookType+"' files");case"buffer":case"file":r.type=n;break;default:throw new Error("Unrecognized type "+e.type)}var s=t.FullPaths?lt.write(t,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[r.type]||r.type,compression:!!e.compression}):t.generate(r);if(typeof Deno<"u"&&typeof s=="string"){if(e.type=="binary"||e.type=="base64")return s;s=new Uint8Array(Kl(s))}return e.password&&typeof encrypt_agile<"u"?_x(encrypt_agile(s,e.password),e):e.type==="file"?Qi(e.file,s):e.type=="string"?hi(s):s}function IP(t,e){var r=e||{},n=qI(t,r);return _x(n,r)}function sn(t,e,r){r||(r="");var n=r+t;switch(e.type){case"base64":return Ci(Pi(n));case"binary":return Pi(n);case"string":return t;case"file":return Qi(e.file,n,"utf8");case"buffer":return et?kn(n,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(n):sn(n,{type:"binary"}).split("").map(function(s){return s.charCodeAt(0)})}throw new Error("Unrecognized type "+e.type)}function PP(t,e){switch(e.type){case"base64":return Ci(t);case"binary":return t;case"string":return t;case"file":return Qi(e.file,t,"binary");case"buffer":return et?kn(t,"binary"):t.split("").map(function(r){return r.charCodeAt(0)})}throw new Error("Unrecognized type "+e.type)}function jo(t,e){switch(e.type){case"string":case"base64":case"binary":for(var r="",n=0;n<t.length;++n)r+=String.fromCharCode(t[n]);return e.type=="base64"?Ci(r):e.type=="string"?hi(r):r;case"file":return Qi(e.file,t);case"buffer":return t;default:throw new Error("Unrecognized type "+e.type)}}function wx(t,e){sT(),pI(t);var r=Er(e||{});if(r.cellStyles&&(r.cellNF=!0,r.sheetStubs=!0),r.type=="array"){r.type="binary";var n=wx(t,r);return r.type="array",Kl(n)}var s=0;if(r.sheet&&(typeof r.sheet=="number"?s=r.sheet:s=t.SheetNames.indexOf(r.sheet),!t.SheetNames[s]))throw new Error("Sheet not found: "+r.sheet+" : "+typeof r.sheet);switch(r.bookType||"xlsb"){case"xml":case"xlml":return sn(HI(t,r),r);case"slk":case"sylk":return sn(dS.from_sheet(t.Sheets[t.SheetNames[s]],r),r);case"htm":case"html":return sn(gx(t.Sheets[t.SheetNames[s]],r),r);case"txt":return PP(bx(t.Sheets[t.SheetNames[s]],r),r);case"csv":return sn(bh(t.Sheets[t.SheetNames[s]],r),r,"\uFEFF");case"dif":return sn(fS.from_sheet(t.Sheets[t.SheetNames[s]],r),r);case"dbf":return jo(hS.from_sheet(t.Sheets[t.SheetNames[s]],r),r);case"prn":return sn(mS.from_sheet(t.Sheets[t.SheetNames[s]],r),r);case"rtf":return sn(wS.from_sheet(t.Sheets[t.SheetNames[s]],r),r);case"eth":return sn(Wg.from_sheet(t.Sheets[t.SheetNames[s]],r),r);case"fods":return sn(yx(t,r),r);case"wk1":return jo(qf.sheet_to_wk1(t.Sheets[t.SheetNames[s]],r),r);case"wk3":return jo(qf.book_to_wk3(t,r),r);case"biff2":r.biff||(r.biff=2);case"biff3":r.biff||(r.biff=3);case"biff4":return r.biff||(r.biff=4),jo(px(t,r),r);case"biff5":r.biff||(r.biff=5);case"biff8":case"xla":case"xls":return r.biff||(r.biff=8),IP(t,r);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return NP(t,r);default:throw new Error("Unrecognized bookType |"+r.bookType+"|")}}function RP(t){if(!t.bookType){var e={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"},r=t.file.slice(t.file.lastIndexOf(".")).toLowerCase();r.match(/^\.[a-z]+$/)&&(t.bookType=r.slice(1)),t.bookType=e[t.bookType]||t.bookType}}function DP(t,e,r){var n={};return n.type="file",n.file=e,RP(n),wx(t,n)}function FP(t,e,r,n,s,a,i,l){var c=Jt(r),u=l.defval,h=l.raw||!Object.prototype.hasOwnProperty.call(l,"raw"),f=!0,m=s===1?[]:{};if(s!==1)if(Object.defineProperty)try{Object.defineProperty(m,"__rowNum__",{value:r,enumerable:!1})}catch{m.__rowNum__=r}else m.__rowNum__=r;if(!i||t[r])for(var p=e.s.c;p<=e.e.c;++p){var x=i?t[r][p]:t[n[p]+c];if(x===void 0||x.t===void 0){if(u===void 0)continue;a[p]!=null&&(m[a[p]]=u);continue}var g=x.v;switch(x.t){case"z":if(g==null)break;continue;case"e":g=g==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+x.t)}if(a[p]!=null){if(g==null)if(x.t=="e"&&g===null)m[a[p]]=null;else if(u!==void 0)m[a[p]]=u;else if(h&&g===null)m[a[p]]=null;else continue;else m[a[p]]=h&&(x.t!=="n"||x.t==="n"&&l.rawNumbers!==!1)?g:Rn(x,g,l);g!=null&&(f=!1)}}return{row:m,isempty:f}}function yl(t,e){if(t==null||t["!ref"]==null)return[];var r={t:"n",v:0},n=0,s=1,a=[],i=0,l="",c={s:{r:0,c:0},e:{r:0,c:0}},u=e||{},h=u.range!=null?u.range:t["!ref"];switch(u.header===1?n=1:u.header==="A"?n=2:Array.isArray(u.header)?n=3:u.header==null&&(n=0),typeof h){case"string":c=xt(h);break;case"number":c=xt(t["!ref"]),c.s.r=h;break;default:c=h}n>0&&(s=0);var f=Jt(c.s.r),m=[],p=[],x=0,g=0,y=Array.isArray(t),I=c.s.r,P=0,A={};y&&!t[I]&&(t[I]=[]);var D=u.skipHidden&&t["!cols"]||[],V=u.skipHidden&&t["!rows"]||[];for(P=c.s.c;P<=c.e.c;++P)if(!(D[P]||{}).hidden)switch(m[P]=cr(P),r=y?t[I][P]:t[m[P]+f],n){case 1:a[P]=P-c.s.c;break;case 2:a[P]=m[P];break;case 3:a[P]=u.header[P-c.s.c];break;default:if(r==null&&(r={w:"__EMPTY",t:"s"}),l=i=Rn(r,null,u),g=A[i]||0,!g)A[i]=1;else{do l=i+"_"+g++;while(A[l]);A[i]=g,A[l]=1}a[P]=l}for(I=c.s.r+s;I<=c.e.r;++I)if(!(V[I]||{}).hidden){var H=FP(t,c,I,m,n,a,y,u);(H.isempty===!1||(n===1?u.blankrows!==!1:u.blankrows))&&(p[x++]=H.row)}return p.length=x,p}var Zf=/"/g;function jP(t,e,r,n,s,a,i,l){for(var c=!0,u=[],h="",f=Jt(r),m=e.s.c;m<=e.e.c;++m)if(n[m]){var p=l.dense?(t[r]||[])[m]:t[n[m]+f];if(p==null)h="";else if(p.v!=null){c=!1,h=""+(l.rawNumbers&&p.t=="n"?p.v:Rn(p,null,l));for(var x=0,g=0;x!==h.length;++x)if((g=h.charCodeAt(x))===s||g===a||g===34||l.forceQuotes){h='"'+h.replace(Zf,'""')+'"';break}h=="ID"&&(h='"ID"')}else p.f!=null&&!p.F?(c=!1,h="="+p.f,h.indexOf(",")>=0&&(h='"'+h.replace(Zf,'""')+'"')):h="";u.push(h)}return l.blankrows===!1&&c?null:u.join(i)}function bh(t,e){var r=[],n=e??{};if(t==null||t["!ref"]==null)return"";var s=xt(t["!ref"]),a=n.FS!==void 0?n.FS:",",i=a.charCodeAt(0),l=n.RS!==void 0?n.RS:`
`,c=l.charCodeAt(0),u=new RegExp((a=="|"?"\\|":a)+"+$"),h="",f=[];n.dense=Array.isArray(t);for(var m=n.skipHidden&&t["!cols"]||[],p=n.skipHidden&&t["!rows"]||[],x=s.s.c;x<=s.e.c;++x)(m[x]||{}).hidden||(f[x]=cr(x));for(var g=0,y=s.s.r;y<=s.e.r;++y)(p[y]||{}).hidden||(h=jP(t,s,y,f,i,c,a,n),h!=null&&(n.strip&&(h=h.replace(u,"")),(h||n.blankrows!==!1)&&r.push((g++?l:"")+h)));return delete n.dense,r.join("")}function bx(t,e){e||(e={}),e.FS="	",e.RS=`
`;var r=bh(t,e);return r}function kP(t){var e="",r,n="";if(t==null||t["!ref"]==null)return[];var s=xt(t["!ref"]),a="",i=[],l,c=[],u=Array.isArray(t);for(l=s.s.c;l<=s.e.c;++l)i[l]=cr(l);for(var h=s.s.r;h<=s.e.r;++h)for(a=Jt(h),l=s.s.c;l<=s.e.c;++l)if(e=i[l]+a,r=u?(t[h]||[])[l]:t[e],n="",r!==void 0){if(r.F!=null){if(e=r.F,!r.f)continue;n=r.f,e.indexOf(":")==-1&&(e=e+":"+e)}if(r.f!=null)n=r.f;else{if(r.t=="z")continue;if(r.t=="n"&&r.v!=null)n=""+r.v;else if(r.t=="b")n=r.v?"TRUE":"FALSE";else if(r.w!==void 0)n="'"+r.w;else{if(r.v===void 0)continue;r.t=="s"?n="'"+r.v:n=""+r.v}}c[c.length]=e+"="+n}return c}function Ex(t,e,r){var n=r||{},s=+!n.skipHeader,a=t||{},i=0,l=0;if(a&&n.origin!=null)if(typeof n.origin=="number")i=n.origin;else{var c=typeof n.origin=="string"?Ht(n.origin):n.origin;i=c.r,l=c.c}var u,h={s:{c:0,r:0},e:{c:l,r:i+e.length-1+s}};if(a["!ref"]){var f=xt(a["!ref"]);h.e.c=Math.max(h.e.c,f.e.c),h.e.r=Math.max(h.e.r,f.e.r),i==-1&&(i=f.e.r+1,h.e.r=i+e.length-1+s)}else i==-1&&(i=0,h.e.r=e.length-1+s);var m=n.header||[],p=0;e.forEach(function(g,y){Zt(g).forEach(function(I){(p=m.indexOf(I))==-1&&(m[p=m.length]=I);var P=g[I],A="z",D="",V=ot({c:l+p,r:i+y+s});u=Fi(a,V),P&&typeof P=="object"&&!(P instanceof Date)?a[V]=P:(typeof P=="number"?A="n":typeof P=="boolean"?A="b":typeof P=="string"?A="s":P instanceof Date?(A="d",n.cellDates||(A="n",P=br(P)),D=n.dateNF||At[14]):P===null&&n.nullError&&(A="e",P=0),u?(u.t=A,u.v=P,delete u.w,delete u.R,D&&(u.z=D)):a[V]=u={t:A,v:P},D&&(u.z=D))})}),h.e.c=Math.max(h.e.c,l+m.length-1);var x=Jt(i);if(s)for(p=0;p<m.length;++p)a[cr(p+l)+x]={t:"s",v:m[p]};return a["!ref"]=Dt(h),a}function OP(t,e){return Ex(null,t,e)}function Fi(t,e,r){if(typeof e=="string"){if(Array.isArray(t)){var n=Ht(e);return t[n.r]||(t[n.r]=[]),t[n.r][n.c]||(t[n.r][n.c]={t:"z"})}return t[e]||(t[e]={t:"z"})}return typeof e!="number"?Fi(t,ot(e)):Fi(t,ot({r:e,c:r||0}))}function MP(t,e){if(typeof e=="number"){if(e>=0&&t.SheetNames.length>e)return e;throw new Error("Cannot find sheet # "+e)}else if(typeof e=="string"){var r=t.SheetNames.indexOf(e);if(r>-1)return r;throw new Error("Cannot find sheet name |"+e+"|")}else throw new Error("Cannot find sheet |"+e+"|")}function LP(){return{SheetNames:[],Sheets:{}}}function BP(t,e,r,n){var s=1;if(!r)for(;s<=65535&&t.SheetNames.indexOf(r="Sheet"+s)!=-1;++s,r=void 0);if(!r||t.SheetNames.length>=65535)throw new Error("Too many worksheets");if(n&&t.SheetNames.indexOf(r)>=0){var a=r.match(/(^.*?)(\d+)$/);s=a&&+a[2]||0;var i=a&&a[1]||r;for(++s;s<=65535&&t.SheetNames.indexOf(r=i+s)!=-1;++s);}if(dx(r),t.SheetNames.indexOf(r)>=0)throw new Error("Worksheet with name |"+r+"| already exists!");return t.SheetNames.push(r),t.Sheets[r]=e,r}function VP(t,e,r){t.Workbook||(t.Workbook={}),t.Workbook.Sheets||(t.Workbook.Sheets=[]);var n=MP(t,e);switch(t.Workbook.Sheets[n]||(t.Workbook.Sheets[n]={}),r){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+r)}t.Workbook.Sheets[n].Hidden=r}function UP(t,e){return t.z=e,t}function Tx(t,e,r){return e?(t.l={Target:e},r&&(t.l.Tooltip=r)):delete t.l,t}function $P(t,e,r){return Tx(t,"#"+e,r)}function HP(t,e,r){t.c||(t.c=[]),t.c.push({t:e,a:r||"SheetJS"})}function WP(t,e,r,n){for(var s=typeof e!="string"?e:xt(e),a=typeof e=="string"?e:Dt(e),i=s.s.r;i<=s.e.r;++i)for(var l=s.s.c;l<=s.e.c;++l){var c=Fi(t,i,l);c.t="n",c.F=a,delete c.v,i==s.s.r&&l==s.s.c&&(c.f=r,n&&(c.D=!0))}return t}var e0={encode_col:cr,encode_row:Jt,encode_cell:ot,encode_range:Dt,decode_col:hh,decode_row:uh,split_cell:sA,decode_cell:Ht,decode_range:kr,format_cell:Rn,sheet_add_aoa:Tg,sheet_add_json:Ex,sheet_add_dom:xx,aoa_to_sheet:ka,json_to_sheet:OP,table_to_sheet:vx,table_to_book:fP,sheet_to_csv:bh,sheet_to_txt:bx,sheet_to_json:yl,sheet_to_html:gx,sheet_to_formulae:kP,sheet_to_row_object_array:yl,sheet_get_cell:Fi,book_new:LP,book_append_sheet:BP,book_set_sheet_visibility:VP,cell_set_number_format:UP,cell_set_hyperlink:Tx,cell_set_internal_link:$P,cell_add_comment:HP,sheet_set_array_formula:WP,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};class qP{createWorkbook(){return{sheets:[]}}addSheet(e,r){e.sheets.push(r)}write(e,r){const n=e0.book_new();e.sheets.forEach(s=>{const a={};let i=1/0,l=-1/0;const c=new Set;if(s.cells.forEach(u=>{const h=`${u.col}${u.row}`;if(u.data.formula)a[h]={t:"n",f:u.data.formula};else if(u.data.value!==null&&u.data.value!==void 0){const f=u.data.value;typeof f=="number"?a[h]={t:"n",v:f}:a[h]={t:"s",v:f}}i=Math.min(i,u.row),l=Math.max(l,u.row),c.add(u.col)}),s.cells.length>0){const u=Array.from(c).sort(),h=u[0],f=u[u.length-1];a["!ref"]=`${h}${i}:${f}${l}`}s.columnWidths&&s.columnWidths.length>0&&(a["!cols"]=s.columnWidths.map(u=>({wch:u.width}))),e0.book_append_sheet(n,a,s.name)}),DP(n,r)}}function Ax(t){const e=t.map(r=>({...r}));return t.forEach(r=>{if(!r.purchaseDetails||r.purchaseDetails.buyingFrom==="Coproprit")return;const{buyingFrom:n,lotId:s}=r.purchaseDetails,a=e.findIndex(l=>l.name===n);if(a===-1){console.warn(`Seller "${n}" not found for buyer "${r.name}"`);return}const i=e[a];if(!i.lotsOwned||i.lotsOwned.length===0){console.warn(`Seller "${n}" has no lots owned`);return}e[a]={...i,lotsOwned:i.lotsOwned.map(l=>l.lotId===s?{...l,soldDate:r.entryDate?new Date(r.entryDate):void 0}:l)}}),e}const t0=600,r0=200;function GP(t){return"label"in t&&"amount"in t&&!("sqm"in t)&&!("cascoPricePerSqm"in t)&&!("parachevementPricePerSqm"in t)}function zP(t){if(!GP(t))return t;const{label:e,amount:r}=t,n=t0+r0,s=Math.round(r/n);return{label:e,sqm:s,cascoPricePerSqm:t0,parachevementPricePerSqm:r0,amount:r}}function YP(t){return t&&{enabled:t.enabled,items:t.items.map(zP)}}function gi(t){const e=t.maxTotalLots&&t.maxTotalLots>0?t.maxTotalLots:Da,r=t.travauxCommuns?YP(t.travauxCommuns):t.travauxCommuns;return{...t,maxTotalLots:e,travauxCommuns:r||void 0}}function KP(t,e,r,n,s,a,i){const l={version:2,releaseVersion:Fa,timestamp:new Date().toISOString(),participants:t,projectParams:e,deedDate:r,portageFormula:n,unitDetails:s,...i,calculations:{totalSurface:a.totalSurface,pricePerM2:a.pricePerM2,sharedCosts:a.sharedCosts,sharedPerPerson:a.sharedPerPerson,participantBreakdown:a.participantBreakdown.map(c=>({name:c.name,unitId:c.unitId,surface:c.surface,quantity:c.quantity,pricePerM2:c.pricePerM2,purchaseShare:c.purchaseShare,droitEnregistrements:c.droitEnregistrements,fraisNotaireFixe:c.fraisNotaireFixe,casco:c.casco,parachevements:c.parachevements,personalRenovationCost:c.personalRenovationCost,constructionCost:c.constructionCost,constructionCostPerUnit:c.constructionCostPerUnit,travauxCommunsPerUnit:c.travauxCommunsPerUnit,sharedCosts:c.sharedCosts,totalCost:c.totalCost,loanNeeded:c.loanNeeded,financingRatio:c.financingRatio,monthlyPayment:c.monthlyPayment,totalRepayment:c.totalRepayment,totalInterest:c.totalInterest,loan1Amount:c.loan1Amount,loan1MonthlyPayment:c.loan1MonthlyPayment,loan1Interest:c.loan1Interest,loan2Amount:c.loan2Amount,loan2DurationYears:c.loan2DurationYears,loan2MonthlyPayment:c.loan2MonthlyPayment,loan2Interest:c.loan2Interest})),totals:{purchase:a.totals.purchase,totalDroitEnregistrements:a.totals.totalDroitEnregistrements,totalFraisNotaireFixe:a.participantBreakdown.reduce((c,u)=>c+u.fraisNotaireFixe,0),construction:a.totals.construction,shared:a.totals.shared,totalTravauxCommuns:a.totals.totalTravauxCommuns,travauxCommunsPerUnit:a.totals.travauxCommunsPerUnit,total:a.totals.total,capitalTotal:a.totals.capitalTotal,totalLoansNeeded:a.totals.totalLoansNeeded,averageLoan:a.totals.averageLoan,averageCapital:a.totals.averageCapital}}};return JSON.stringify(l,null,2)}function XP(t){try{const e=JSON.parse(t);if(!e.participants||!e.projectParams)return{success:!1,error:"Fichier invalide: structure de donnes manquante"};if(!Dp(e.releaseVersion))return{success:!1,error:`Version incompatible: ${e.releaseVersion?`ce fichier a t cr avec la version ${e.releaseVersion}, mais vous utilisez la version ${Fa}`:"ce fichier n'a pas de numro de version (ancien format)"}.

Envoie le fichier  Dragan.`};const r=Ax(e.participants),n=e.portageFormula?{...zr,...e.portageFormula}:zr,s=gi(e.projectParams);return{success:!0,data:{participants:r,projectParams:s,deedDate:e.deedDate||"",portageFormula:n}}}catch(e){return console.error("Error deserializing scenario:",e),{success:!1,error:"Erreur lors du chargement du fichier. Vrifiez que le fichier est valide."}}}function QP(t,e,r,n,s,a,i){const l=KP(t,e,r,n,s,a,i),c=new Blob([l],{type:"application/json"}),u=URL.createObjectURL(c),h=document.createElement("a");h.href=u;const f=new Date,m=f.toISOString().slice(0,10),p=f.toTimeString().slice(0,5).replace(":","-");h.download=`scenario_${m}_${p}.json`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(u)}function JP(t,e){return r=>{const n=r.target.files?.[0];if(!n)return;const s=new FileReader;s.onload=a=>{const i=a.target?.result,l=XP(i);l.success&&l.data?t(l.data):e(l.error||"Erreur inconnue")},s.readAsText(n),r.target&&(r.target.value="")}}function ZP(t,e){const r=Math.max(...t.map(s=>s.unitId||0),0)+1,n=new Date(e);return n.setDate(n.getDate()+1),[...t,{name:"Participante "+(t.length+1),capitalApporte:1e5,registrationFeesRate:12.5,unitId:r,surface:100,interestRate:4.5,durationYears:25,quantity:1,parachevementsPerM2:500,isFounder:!1,entryDate:n,purchaseDetails:{buyingFrom:"Coproprit",lotId:r,purchasePrice:0}}]}function eR(t,e){return t.length<=1?t:t.filter((r,n)=>n!==e)}function tR(t,e,r){const n=[...t];return n[e]={...n[e],name:r},n}function rR(t,e,r){const n=[...t];return n[e]={...n[e],surface:r},n}function nR(t,e,r){const n=[...t];return n[e]={...n[e],capitalApporte:r},n}function sR(t,e,r){const n=[...t];return n[e]={...n[e],registrationFeesRate:r},n}function aR(t,e,r){const n=[...t];return n[e]={...n[e],interestRate:r},n}function iR(t,e,r){const n=[...t];return n[e]={...n[e],durationYears:r},n}function oR(t,e,r){const n=[...t];return n[e]={...n[e],quantity:Math.max(1,r)},n}function lR(t,e,r){const n=[...t];return n[e]={...n[e],parachevementsPerM2:r},n}function cR(t,e,r){const n=[...t];return n[e]={...n[e],cascoSqm:r},n}function uR(t,e,r){const n=[...t];return n[e]={...n[e],parachevementsSqm:r},n}function hR(t,e,r,n,s=[],a=Da){const i=Rp(t,s,a);if(!i.isValid)return{success:!1,error:i.error};const l=[...t],c={...l[e]},u=Math.max(...t.flatMap(f=>f.lotsOwned?.map(m=>m.lotId)||[]),0)+1;c.lotsOwned?c.lotsOwned=[...c.lotsOwned]:c.lotsOwned=[];const h=c.quantity||1;return c.quantity=h+1,c.lotsOwned.push({lotId:u,surface:0,unitId:c.unitId||0,isPortage:!0,allocatedSurface:0,acquiredDate:new Date(r),originalPrice:n?.purchaseShare,originalNotaryFees:n?.droitEnregistrements,originalConstructionCost:n?.casco}),l[e]=c,{success:!0,participants:l}}function dR(t,e,r){const n=[...t],s={...n[e]};if(!s.lotsOwned)return t;const a=s.lotsOwned.find(l=>l.lotId===r);s.lotsOwned=s.lotsOwned.filter(l=>l.lotId!==r);const i=s.quantity||1;if(s.quantity=Math.max(1,i-1),a){const l=s.surface||0;s.surface=Math.max(0,l-(a.surface||0))}return n[e]=s,n}function fR(t,e,r,n){const s=[...t],a={...s[e]};if(!a.lotsOwned)return t;a.lotsOwned=[...a.lotsOwned];const i=a.lotsOwned.find(l=>l.lotId===r);if(i){const l=i.surface||0,c=n-l;i.surface=n,i.allocatedSurface=n;const u=a.surface||0;a.surface=u+c}return s[e]=a,s}function mR(t,e,r,n,s){const a=[...t],i={...a[e]};if(!i.lotsOwned)return t;i.lotsOwned=[...i.lotsOwned];const l=i.lotsOwned.find(c=>c.lotId===r);return l&&(l.founderPaysCasco=n,l.founderPaysParachvement=s&&n),a[e]=i,a}function pR(){return{addParticipant:ZP,removeParticipant:eR,updateParticipantName:tR,updateParticipantSurface:rR,updateCapital:nR,updateNotaryRate:sR,updateInterestRate:aR,updateDuration:iR,updateQuantity:oR,updateParachevementsPerM2:lR,updateCascoSqm:cR,updateParachevementsSqm:uR,addPortageLot:hR,removePortageLot:dR,updatePortageLotSurface:fR,updatePortageLotConstructionPayment:mR}}function gR(t,e,r,n,s){k.useEffect(()=>{s||cu(t,e,r,n)},[t,e,r,n,s])}const xR=()=>{};var n0={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sx=function(t){const e=[];let r=0;for(let n=0;n<t.length;n++){let s=t.charCodeAt(n);s<128?e[r++]=s:s<2048?(e[r++]=s>>6|192,e[r++]=s&63|128):(s&64512)===55296&&n+1<t.length&&(t.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++n)&1023),e[r++]=s>>18|240,e[r++]=s>>12&63|128,e[r++]=s>>6&63|128,e[r++]=s&63|128):(e[r++]=s>>12|224,e[r++]=s>>6&63|128,e[r++]=s&63|128)}return e},vR=function(t){const e=[];let r=0,n=0;for(;r<t.length;){const s=t[r++];if(s<128)e[n++]=String.fromCharCode(s);else if(s>191&&s<224){const a=t[r++];e[n++]=String.fromCharCode((s&31)<<6|a&63)}else if(s>239&&s<365){const a=t[r++],i=t[r++],l=t[r++],c=((s&7)<<18|(a&63)<<12|(i&63)<<6|l&63)-65536;e[n++]=String.fromCharCode(55296+(c>>10)),e[n++]=String.fromCharCode(56320+(c&1023))}else{const a=t[r++],i=t[r++];e[n++]=String.fromCharCode((s&15)<<12|(a&63)<<6|i&63)}}return e.join("")},Nx={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<t.length;s+=3){const a=t[s],i=s+1<t.length,l=i?t[s+1]:0,c=s+2<t.length,u=c?t[s+2]:0,h=a>>2,f=(a&3)<<4|l>>4;let m=(l&15)<<2|u>>6,p=u&63;c||(p=64,i||(m=64)),n.push(r[h],r[f],r[m],r[p])}return n.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Sx(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):vR(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<t.length;){const a=r[t.charAt(s++)],l=s<t.length?r[t.charAt(s)]:0;++s;const u=s<t.length?r[t.charAt(s)]:64;++s;const f=s<t.length?r[t.charAt(s)]:64;if(++s,a==null||l==null||u==null||f==null)throw new yR;const m=a<<2|l>>4;if(n.push(m),u!==64){const p=l<<4&240|u>>2;if(n.push(p),f!==64){const x=u<<6&192|f;n.push(x)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class yR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const _R=function(t){const e=Sx(t);return Nx.encodeByteArray(e,!0)},_l=function(t){return _R(t).replace(/\./g,"")},wR=function(t){try{return Nx.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ER=()=>bR().__FIREBASE_DEFAULTS__,TR=()=>{if(typeof process>"u"||typeof n0>"u")return;const t=n0.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},AR=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&wR(t[1]);return e&&JSON.parse(e)},Eh=()=>{try{return xR()||ER()||TR()||AR()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},SR=t=>Eh()?.emulatorHosts?.[t],NR=t=>{const e=SR(t);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),n]:[e.substring(0,r),n]},Cx=()=>Eh()?.config;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,n)=>{r?this.reject(r):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Th(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function IR(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PR(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},n=e||"demo-project",s=t.iat||0,a=t.sub||t.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}},...t};return[_l(JSON.stringify(r)),_l(JSON.stringify(i)),""].join(".")}const xi={};function RR(){const t={prod:[],emulator:[]};for(const e of Object.keys(xi))xi[e]?t.emulator.push(e):t.prod.push(e);return t}function DR(t){let e=document.getElementById(t),r=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),r=!0),{created:r,element:e}}let s0=!1;function FR(t,e){if(typeof window>"u"||typeof document>"u"||!Th(window.location.host)||xi[t]===e||xi[t]||s0)return;xi[t]=e;function r(m){return`__firebase__banner__${m}`}const n="__firebase__banner",a=RR().prod.length>0;function i(){const m=document.getElementById(n);m&&m.remove()}function l(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function c(m,p){m.setAttribute("width","24"),m.setAttribute("id",p),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function u(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{s0=!0,i()},m}function h(m,p){m.setAttribute("id",p),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function f(){const m=DR(n),p=r("text"),x=document.getElementById(p)||document.createElement("span"),g=r("learnmore"),y=document.getElementById(g)||document.createElement("a"),I=r("preprendIcon"),P=document.getElementById(I)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const A=m.element;l(A),h(y,g);const D=u();c(P,I),A.append(P,x,y,D),document.body.appendChild(A)}a?(x.innerText="Preview backend disconnected.",P.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(P.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",p)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jR(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function kR(){const t=Eh()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function OR(){return!kR()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function MR(){try{return typeof indexedDB=="object"}catch{return!1}}function LR(){return new Promise((t,e)=>{try{let r=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),r||self.indexedDB.deleteDatabase(n),t(!0)},s.onupgradeneeded=()=>{r=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(r){e(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BR="FirebaseError";class La extends Error{constructor(e,r,n){super(r),this.code=e,this.customData=n,this.name=BR,Object.setPrototypeOf(this,La.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ix.prototype.create)}}class Ix{constructor(e,r,n){this.service=e,this.serviceName=r,this.errors=n}create(e,...r){const n=r[0]||{},s=`${this.service}/${e}`,a=this.errors[e],i=a?VR(a,n):"Error",l=`${this.serviceName}: ${i} (${s}).`;return new La(s,l,n)}}function VR(t,e){return t.replace(UR,(r,n)=>{const s=e[n];return s!=null?String(s):`<${n}?>`})}const UR=/\{\$([^}]+)}/g;function wl(t,e){if(t===e)return!0;const r=Object.keys(t),n=Object.keys(e);for(const s of r){if(!n.includes(s))return!1;const a=t[s],i=e[s];if(a0(a)&&a0(i)){if(!wl(a,i))return!1}else if(a!==i)return!1}for(const s of n)if(!r.includes(s))return!1;return!0}function a0(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vr(t){return t&&t._delegate?t._delegate:t}class ji{constructor(e,r,n){this.name=e,this.instanceFactory=r,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const As="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $R{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const n=new CR;if(this.instancesDeferred.set(r,n),this.isInitialized(r)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:r});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){const r=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(WR(e))try{this.getOrInitializeService({instanceIdentifier:As})}catch{}for(const[r,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(r);try{const a=this.getOrInitializeService({instanceIdentifier:s});n.resolve(a)}catch{}}}}clearInstance(e=As){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=As){return this.instances.has(e)}getOptions(e=As){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:r});for(const[a,i]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(a);n===l&&i.resolve(s)}return s}onInit(e,r){const n=this.normalizeInstanceIdentifier(r),s=this.onInitCallbacks.get(n)??new Set;s.add(e),this.onInitCallbacks.set(n,s);const a=this.instances.get(n);return a&&e(a,n),()=>{s.delete(e)}}invokeOnInitCallbacks(e,r){const n=this.onInitCallbacks.get(r);if(n)for(const s of n)try{s(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:HR(e),options:r}),this.instances.set(e,n),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=As){return this.component?this.component.multipleInstances?e:As:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function HR(t){return t===As?void 0:t}function WR(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new $R(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ke;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Ke||(Ke={}));const GR={debug:Ke.DEBUG,verbose:Ke.VERBOSE,info:Ke.INFO,warn:Ke.WARN,error:Ke.ERROR,silent:Ke.SILENT},zR=Ke.INFO,YR={[Ke.DEBUG]:"log",[Ke.VERBOSE]:"log",[Ke.INFO]:"info",[Ke.WARN]:"warn",[Ke.ERROR]:"error"},KR=(t,e,...r)=>{if(e<t.logLevel)return;const n=new Date().toISOString(),s=YR[e];if(s)console[s](`[${n}]  ${t.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Px{constructor(e){this.name=e,this._logLevel=zR,this._logHandler=KR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ke))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?GR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ke.DEBUG,...e),this._logHandler(this,Ke.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ke.VERBOSE,...e),this._logHandler(this,Ke.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ke.INFO,...e),this._logHandler(this,Ke.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ke.WARN,...e),this._logHandler(this,Ke.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ke.ERROR,...e),this._logHandler(this,Ke.ERROR,...e)}}const XR=(t,e)=>e.some(r=>t instanceof r);let i0,o0;function QR(){return i0||(i0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function JR(){return o0||(o0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Rx=new WeakMap,gu=new WeakMap,Dx=new WeakMap,Hc=new WeakMap,Ah=new WeakMap;function ZR(t){const e=new Promise((r,n)=>{const s=()=>{t.removeEventListener("success",a),t.removeEventListener("error",i)},a=()=>{r(Xn(t.result)),s()},i=()=>{n(t.error),s()};t.addEventListener("success",a),t.addEventListener("error",i)});return e.then(r=>{r instanceof IDBCursor&&Rx.set(r,t)}).catch(()=>{}),Ah.set(e,t),e}function eD(t){if(gu.has(t))return;const e=new Promise((r,n)=>{const s=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",i),t.removeEventListener("abort",i)},a=()=>{r(),s()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",a),t.addEventListener("error",i),t.addEventListener("abort",i)});gu.set(t,e)}let xu={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return gu.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Dx.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Xn(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function tD(t){xu=t(xu)}function rD(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const n=t.call(Wc(this),e,...r);return Dx.set(n,e.sort?e.sort():[e]),Xn(n)}:JR().includes(t)?function(...e){return t.apply(Wc(this),e),Xn(Rx.get(this))}:function(...e){return Xn(t.apply(Wc(this),e))}}function nD(t){return typeof t=="function"?rD(t):(t instanceof IDBTransaction&&eD(t),XR(t,QR())?new Proxy(t,xu):t)}function Xn(t){if(t instanceof IDBRequest)return ZR(t);if(Hc.has(t))return Hc.get(t);const e=nD(t);return e!==t&&(Hc.set(t,e),Ah.set(e,t)),e}const Wc=t=>Ah.get(t);function sD(t,e,{blocked:r,upgrade:n,blocking:s,terminated:a}={}){const i=indexedDB.open(t,e),l=Xn(i);return n&&i.addEventListener("upgradeneeded",c=>{n(Xn(i.result),c.oldVersion,c.newVersion,Xn(i.transaction),c)}),r&&i.addEventListener("blocked",c=>r(c.oldVersion,c.newVersion,c)),l.then(c=>{a&&c.addEventListener("close",()=>a()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const aD=["get","getKey","getAll","getAllKeys","count"],iD=["put","add","delete","clear"],qc=new Map;function l0(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(qc.get(e))return qc.get(e);const r=e.replace(/FromIndex$/,""),n=e!==r,s=iD.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(s||aD.includes(r)))return;const a=async function(i,...l){const c=this.transaction(i,s?"readwrite":"readonly");let u=c.store;return n&&(u=u.index(l.shift())),(await Promise.all([u[r](...l),s&&c.done]))[0]};return qc.set(e,a),a}tD(t=>({...t,get:(e,r,n)=>l0(e,r)||t.get(e,r,n),has:(e,r)=>!!l0(e,r)||t.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oD{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(lD(r)){const n=r.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(r=>r).join(" ")}}function lD(t){return t.getComponent()?.type==="VERSION"}const vu="@firebase/app",c0="0.14.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dn=new Px("@firebase/app"),cD="@firebase/app-compat",uD="@firebase/analytics-compat",hD="@firebase/analytics",dD="@firebase/app-check-compat",fD="@firebase/app-check",mD="@firebase/auth",pD="@firebase/auth-compat",gD="@firebase/database",xD="@firebase/data-connect",vD="@firebase/database-compat",yD="@firebase/functions",_D="@firebase/functions-compat",wD="@firebase/installations",bD="@firebase/installations-compat",ED="@firebase/messaging",TD="@firebase/messaging-compat",AD="@firebase/performance",SD="@firebase/performance-compat",ND="@firebase/remote-config",CD="@firebase/remote-config-compat",ID="@firebase/storage",PD="@firebase/storage-compat",RD="@firebase/firestore",DD="@firebase/ai",FD="@firebase/firestore-compat",jD="firebase",kD="12.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yu="[DEFAULT]",OD={[vu]:"fire-core",[cD]:"fire-core-compat",[hD]:"fire-analytics",[uD]:"fire-analytics-compat",[fD]:"fire-app-check",[dD]:"fire-app-check-compat",[mD]:"fire-auth",[pD]:"fire-auth-compat",[gD]:"fire-rtdb",[xD]:"fire-data-connect",[vD]:"fire-rtdb-compat",[yD]:"fire-fn",[_D]:"fire-fn-compat",[wD]:"fire-iid",[bD]:"fire-iid-compat",[ED]:"fire-fcm",[TD]:"fire-fcm-compat",[AD]:"fire-perf",[SD]:"fire-perf-compat",[ND]:"fire-rc",[CD]:"fire-rc-compat",[ID]:"fire-gcs",[PD]:"fire-gcs-compat",[RD]:"fire-fst",[FD]:"fire-fst-compat",[DD]:"fire-vertex","fire-js":"fire-js",[jD]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bl=new Map,MD=new Map,_u=new Map;function u0(t,e){try{t.container.addComponent(e)}catch(r){Dn.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,r)}}function El(t){const e=t.name;if(_u.has(e))return Dn.debug(`There were multiple attempts to register component ${e}.`),!1;_u.set(e,t);for(const r of bl.values())u0(r,t);for(const r of MD.values())u0(r,t);return!0}function LD(t,e){const r=t.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),t.container.getProvider(e)}function BD(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VD={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Qn=new Ix("app","Firebase",VD);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UD{constructor(e,r,n){this._isDeleted=!1,this._options={...e},this._config={...r},this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ji("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Qn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $D=kD;function Fx(t,e={}){let r=t;typeof e!="object"&&(e={name:e});const n={name:yu,automaticDataCollectionEnabled:!0,...e},s=n.name;if(typeof s!="string"||!s)throw Qn.create("bad-app-name",{appName:String(s)});if(r||(r=Cx()),!r)throw Qn.create("no-options");const a=bl.get(s);if(a){if(wl(r,a.options)&&wl(n,a.config))return a;throw Qn.create("duplicate-app",{appName:s})}const i=new qR(s);for(const c of _u.values())i.addComponent(c);const l=new UD(r,n,i);return bl.set(s,l),l}function HD(t=yu){const e=bl.get(t);if(!e&&t===yu&&Cx())return Fx();if(!e)throw Qn.create("no-app",{appName:t});return e}function va(t,e,r){let n=OD[t]??t;r&&(n+=`-${r}`);const s=n.match(/\s|\//),a=e.match(/\s|\//);if(s||a){const i=[`Unable to register library "${n}" with version "${e}":`];s&&i.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&a&&i.push("and"),a&&i.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Dn.warn(i.join(" "));return}El(new ji(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WD="firebase-heartbeat-database",qD=1,ki="firebase-heartbeat-store";let Gc=null;function jx(){return Gc||(Gc=sD(WD,qD,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(ki)}catch(r){console.warn(r)}}}}).catch(t=>{throw Qn.create("idb-open",{originalErrorMessage:t.message})})),Gc}async function GD(t){try{const r=(await jx()).transaction(ki),n=await r.objectStore(ki).get(kx(t));return await r.done,n}catch(e){if(e instanceof La)Dn.warn(e.message);else{const r=Qn.create("idb-get",{originalErrorMessage:e?.message});Dn.warn(r.message)}}}async function h0(t,e){try{const n=(await jx()).transaction(ki,"readwrite");await n.objectStore(ki).put(e,kx(t)),await n.done}catch(r){if(r instanceof La)Dn.warn(r.message);else{const n=Qn.create("idb-set",{originalErrorMessage:r?.message});Dn.warn(n.message)}}}function kx(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zD=1024,YD=30;class KD{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new QD(r),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=d0();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(s=>s.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats.length>YD){const s=JD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Dn.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=d0(),{heartbeatsToSend:r,unsentEntries:n}=XD(this._heartbeatsCache.heartbeats),s=_l(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Dn.warn(e),""}}}function d0(){return new Date().toISOString().substring(0,10)}function XD(t,e=zD){const r=[];let n=t.slice();for(const s of t){const a=r.find(i=>i.agent===s.agent);if(a){if(a.dates.push(s.date),f0(r)>e){a.dates.pop();break}}else if(r.push({agent:s.agent,dates:[s.date]}),f0(r)>e){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class QD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return MR()?LR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await GD(this.app);return r?.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return h0(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return h0(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function f0(t){return _l(JSON.stringify({version:2,heartbeats:t})).length}function JD(t){if(t.length===0)return-1;let e=0,r=t[0].date;for(let n=1;n<t.length;n++)t[n].date<r&&(r=t[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZD(t){El(new ji("platform-logger",e=>new oD(e),"PRIVATE")),El(new ji("heartbeat",e=>new KD(e),"PRIVATE")),va(vu,c0,t),va(vu,c0,"esm2020"),va("fire-js","")}ZD("");var m0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Jn,Ox;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(w,E){function _(){}_.prototype=E.prototype,w.F=E.prototype,w.prototype=new _,w.prototype.constructor=w,w.D=function(N,T,R){for(var S=Array(arguments.length-2),se=2;se<arguments.length;se++)S[se-2]=arguments[se];return E.prototype[T].apply(N,S)}}function r(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(n,r),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(w,E,_){_||(_=0);const N=Array(16);if(typeof E=="string")for(var T=0;T<16;++T)N[T]=E.charCodeAt(_++)|E.charCodeAt(_++)<<8|E.charCodeAt(_++)<<16|E.charCodeAt(_++)<<24;else for(T=0;T<16;++T)N[T]=E[_++]|E[_++]<<8|E[_++]<<16|E[_++]<<24;E=w.g[0],_=w.g[1],T=w.g[2];let R=w.g[3],S;S=E+(R^_&(T^R))+N[0]+3614090360&4294967295,E=_+(S<<7&4294967295|S>>>25),S=R+(T^E&(_^T))+N[1]+3905402710&4294967295,R=E+(S<<12&4294967295|S>>>20),S=T+(_^R&(E^_))+N[2]+606105819&4294967295,T=R+(S<<17&4294967295|S>>>15),S=_+(E^T&(R^E))+N[3]+3250441966&4294967295,_=T+(S<<22&4294967295|S>>>10),S=E+(R^_&(T^R))+N[4]+4118548399&4294967295,E=_+(S<<7&4294967295|S>>>25),S=R+(T^E&(_^T))+N[5]+1200080426&4294967295,R=E+(S<<12&4294967295|S>>>20),S=T+(_^R&(E^_))+N[6]+2821735955&4294967295,T=R+(S<<17&4294967295|S>>>15),S=_+(E^T&(R^E))+N[7]+4249261313&4294967295,_=T+(S<<22&4294967295|S>>>10),S=E+(R^_&(T^R))+N[8]+1770035416&4294967295,E=_+(S<<7&4294967295|S>>>25),S=R+(T^E&(_^T))+N[9]+2336552879&4294967295,R=E+(S<<12&4294967295|S>>>20),S=T+(_^R&(E^_))+N[10]+4294925233&4294967295,T=R+(S<<17&4294967295|S>>>15),S=_+(E^T&(R^E))+N[11]+2304563134&4294967295,_=T+(S<<22&4294967295|S>>>10),S=E+(R^_&(T^R))+N[12]+1804603682&4294967295,E=_+(S<<7&4294967295|S>>>25),S=R+(T^E&(_^T))+N[13]+4254626195&4294967295,R=E+(S<<12&4294967295|S>>>20),S=T+(_^R&(E^_))+N[14]+2792965006&4294967295,T=R+(S<<17&4294967295|S>>>15),S=_+(E^T&(R^E))+N[15]+1236535329&4294967295,_=T+(S<<22&4294967295|S>>>10),S=E+(T^R&(_^T))+N[1]+4129170786&4294967295,E=_+(S<<5&4294967295|S>>>27),S=R+(_^T&(E^_))+N[6]+3225465664&4294967295,R=E+(S<<9&4294967295|S>>>23),S=T+(E^_&(R^E))+N[11]+643717713&4294967295,T=R+(S<<14&4294967295|S>>>18),S=_+(R^E&(T^R))+N[0]+3921069994&4294967295,_=T+(S<<20&4294967295|S>>>12),S=E+(T^R&(_^T))+N[5]+3593408605&4294967295,E=_+(S<<5&4294967295|S>>>27),S=R+(_^T&(E^_))+N[10]+38016083&4294967295,R=E+(S<<9&4294967295|S>>>23),S=T+(E^_&(R^E))+N[15]+3634488961&4294967295,T=R+(S<<14&4294967295|S>>>18),S=_+(R^E&(T^R))+N[4]+3889429448&4294967295,_=T+(S<<20&4294967295|S>>>12),S=E+(T^R&(_^T))+N[9]+568446438&4294967295,E=_+(S<<5&4294967295|S>>>27),S=R+(_^T&(E^_))+N[14]+3275163606&4294967295,R=E+(S<<9&4294967295|S>>>23),S=T+(E^_&(R^E))+N[3]+4107603335&4294967295,T=R+(S<<14&4294967295|S>>>18),S=_+(R^E&(T^R))+N[8]+1163531501&4294967295,_=T+(S<<20&4294967295|S>>>12),S=E+(T^R&(_^T))+N[13]+2850285829&4294967295,E=_+(S<<5&4294967295|S>>>27),S=R+(_^T&(E^_))+N[2]+4243563512&4294967295,R=E+(S<<9&4294967295|S>>>23),S=T+(E^_&(R^E))+N[7]+1735328473&4294967295,T=R+(S<<14&4294967295|S>>>18),S=_+(R^E&(T^R))+N[12]+2368359562&4294967295,_=T+(S<<20&4294967295|S>>>12),S=E+(_^T^R)+N[5]+4294588738&4294967295,E=_+(S<<4&4294967295|S>>>28),S=R+(E^_^T)+N[8]+2272392833&4294967295,R=E+(S<<11&4294967295|S>>>21),S=T+(R^E^_)+N[11]+1839030562&4294967295,T=R+(S<<16&4294967295|S>>>16),S=_+(T^R^E)+N[14]+4259657740&4294967295,_=T+(S<<23&4294967295|S>>>9),S=E+(_^T^R)+N[1]+2763975236&4294967295,E=_+(S<<4&4294967295|S>>>28),S=R+(E^_^T)+N[4]+1272893353&4294967295,R=E+(S<<11&4294967295|S>>>21),S=T+(R^E^_)+N[7]+4139469664&4294967295,T=R+(S<<16&4294967295|S>>>16),S=_+(T^R^E)+N[10]+3200236656&4294967295,_=T+(S<<23&4294967295|S>>>9),S=E+(_^T^R)+N[13]+681279174&4294967295,E=_+(S<<4&4294967295|S>>>28),S=R+(E^_^T)+N[0]+3936430074&4294967295,R=E+(S<<11&4294967295|S>>>21),S=T+(R^E^_)+N[3]+3572445317&4294967295,T=R+(S<<16&4294967295|S>>>16),S=_+(T^R^E)+N[6]+76029189&4294967295,_=T+(S<<23&4294967295|S>>>9),S=E+(_^T^R)+N[9]+3654602809&4294967295,E=_+(S<<4&4294967295|S>>>28),S=R+(E^_^T)+N[12]+3873151461&4294967295,R=E+(S<<11&4294967295|S>>>21),S=T+(R^E^_)+N[15]+530742520&4294967295,T=R+(S<<16&4294967295|S>>>16),S=_+(T^R^E)+N[2]+3299628645&4294967295,_=T+(S<<23&4294967295|S>>>9),S=E+(T^(_|~R))+N[0]+4096336452&4294967295,E=_+(S<<6&4294967295|S>>>26),S=R+(_^(E|~T))+N[7]+1126891415&4294967295,R=E+(S<<10&4294967295|S>>>22),S=T+(E^(R|~_))+N[14]+2878612391&4294967295,T=R+(S<<15&4294967295|S>>>17),S=_+(R^(T|~E))+N[5]+4237533241&4294967295,_=T+(S<<21&4294967295|S>>>11),S=E+(T^(_|~R))+N[12]+1700485571&4294967295,E=_+(S<<6&4294967295|S>>>26),S=R+(_^(E|~T))+N[3]+2399980690&4294967295,R=E+(S<<10&4294967295|S>>>22),S=T+(E^(R|~_))+N[10]+4293915773&4294967295,T=R+(S<<15&4294967295|S>>>17),S=_+(R^(T|~E))+N[1]+2240044497&4294967295,_=T+(S<<21&4294967295|S>>>11),S=E+(T^(_|~R))+N[8]+1873313359&4294967295,E=_+(S<<6&4294967295|S>>>26),S=R+(_^(E|~T))+N[15]+4264355552&4294967295,R=E+(S<<10&4294967295|S>>>22),S=T+(E^(R|~_))+N[6]+2734768916&4294967295,T=R+(S<<15&4294967295|S>>>17),S=_+(R^(T|~E))+N[13]+1309151649&4294967295,_=T+(S<<21&4294967295|S>>>11),S=E+(T^(_|~R))+N[4]+4149444226&4294967295,E=_+(S<<6&4294967295|S>>>26),S=R+(_^(E|~T))+N[11]+3174756917&4294967295,R=E+(S<<10&4294967295|S>>>22),S=T+(E^(R|~_))+N[2]+718787259&4294967295,T=R+(S<<15&4294967295|S>>>17),S=_+(R^(T|~E))+N[9]+3951481745&4294967295,w.g[0]=w.g[0]+E&4294967295,w.g[1]=w.g[1]+(T+(S<<21&4294967295|S>>>11))&4294967295,w.g[2]=w.g[2]+T&4294967295,w.g[3]=w.g[3]+R&4294967295}n.prototype.v=function(w,E){E===void 0&&(E=w.length);const _=E-this.blockSize,N=this.C;let T=this.h,R=0;for(;R<E;){if(T==0)for(;R<=_;)s(this,w,R),R+=this.blockSize;if(typeof w=="string"){for(;R<E;)if(N[T++]=w.charCodeAt(R++),T==this.blockSize){s(this,N),T=0;break}}else for(;R<E;)if(N[T++]=w[R++],T==this.blockSize){s(this,N),T=0;break}}this.h=T,this.o+=E},n.prototype.A=function(){var w=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);w[0]=128;for(var E=1;E<w.length-8;++E)w[E]=0;E=this.o*8;for(var _=w.length-8;_<w.length;++_)w[_]=E&255,E/=256;for(this.v(w),w=Array(16),E=0,_=0;_<4;++_)for(let N=0;N<32;N+=8)w[E++]=this.g[_]>>>N&255;return w};function a(w,E){var _=l;return Object.prototype.hasOwnProperty.call(_,w)?_[w]:_[w]=E(w)}function i(w,E){this.h=E;const _=[];let N=!0;for(let T=w.length-1;T>=0;T--){const R=w[T]|0;N&&R==E||(_[T]=R,N=!1)}this.g=_}var l={};function c(w){return-128<=w&&w<128?a(w,function(E){return new i([E|0],E<0?-1:0)}):new i([w|0],w<0?-1:0)}function u(w){if(isNaN(w)||!isFinite(w))return f;if(w<0)return y(u(-w));const E=[];let _=1;for(let N=0;w>=_;N++)E[N]=w/_|0,_*=4294967296;return new i(E,0)}function h(w,E){if(w.length==0)throw Error("number format error: empty string");if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(w.charAt(0)=="-")return y(h(w.substring(1),E));if(w.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _=u(Math.pow(E,8));let N=f;for(let R=0;R<w.length;R+=8){var T=Math.min(8,w.length-R);const S=parseInt(w.substring(R,R+T),E);T<8?(T=u(Math.pow(E,T)),N=N.j(T).add(u(S))):(N=N.j(_),N=N.add(u(S)))}return N}var f=c(0),m=c(1),p=c(16777216);t=i.prototype,t.m=function(){if(g(this))return-y(this).m();let w=0,E=1;for(let _=0;_<this.g.length;_++){const N=this.i(_);w+=(N>=0?N:4294967296+N)*E,E*=4294967296}return w},t.toString=function(w){if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(x(this))return"0";if(g(this))return"-"+y(this).toString(w);const E=u(Math.pow(w,6));var _=this;let N="";for(;;){const T=D(_,E).g;_=I(_,T.j(E));let R=((_.g.length>0?_.g[0]:_.h)>>>0).toString(w);if(_=T,x(_))return R+N;for(;R.length<6;)R="0"+R;N=R+N}},t.i=function(w){return w<0?0:w<this.g.length?this.g[w]:this.h};function x(w){if(w.h!=0)return!1;for(let E=0;E<w.g.length;E++)if(w.g[E]!=0)return!1;return!0}function g(w){return w.h==-1}t.l=function(w){return w=I(this,w),g(w)?-1:x(w)?0:1};function y(w){const E=w.g.length,_=[];for(let N=0;N<E;N++)_[N]=~w.g[N];return new i(_,~w.h).add(m)}t.abs=function(){return g(this)?y(this):this},t.add=function(w){const E=Math.max(this.g.length,w.g.length),_=[];let N=0;for(let T=0;T<=E;T++){let R=N+(this.i(T)&65535)+(w.i(T)&65535),S=(R>>>16)+(this.i(T)>>>16)+(w.i(T)>>>16);N=S>>>16,R&=65535,S&=65535,_[T]=S<<16|R}return new i(_,_[_.length-1]&-2147483648?-1:0)};function I(w,E){return w.add(y(E))}t.j=function(w){if(x(this)||x(w))return f;if(g(this))return g(w)?y(this).j(y(w)):y(y(this).j(w));if(g(w))return y(this.j(y(w)));if(this.l(p)<0&&w.l(p)<0)return u(this.m()*w.m());const E=this.g.length+w.g.length,_=[];for(var N=0;N<2*E;N++)_[N]=0;for(N=0;N<this.g.length;N++)for(let T=0;T<w.g.length;T++){const R=this.i(N)>>>16,S=this.i(N)&65535,se=w.i(T)>>>16,te=w.i(T)&65535;_[2*N+2*T]+=S*te,P(_,2*N+2*T),_[2*N+2*T+1]+=R*te,P(_,2*N+2*T+1),_[2*N+2*T+1]+=S*se,P(_,2*N+2*T+1),_[2*N+2*T+2]+=R*se,P(_,2*N+2*T+2)}for(w=0;w<E;w++)_[w]=_[2*w+1]<<16|_[2*w];for(w=E;w<2*E;w++)_[w]=0;return new i(_,0)};function P(w,E){for(;(w[E]&65535)!=w[E];)w[E+1]+=w[E]>>>16,w[E]&=65535,E++}function A(w,E){this.g=w,this.h=E}function D(w,E){if(x(E))throw Error("division by zero");if(x(w))return new A(f,f);if(g(w))return E=D(y(w),E),new A(y(E.g),y(E.h));if(g(E))return E=D(w,y(E)),new A(y(E.g),E.h);if(w.g.length>30){if(g(w)||g(E))throw Error("slowDivide_ only works with positive integers.");for(var _=m,N=E;N.l(w)<=0;)_=V(_),N=V(N);var T=H(_,1),R=H(N,1);for(N=H(N,2),_=H(_,2);!x(N);){var S=R.add(N);S.l(w)<=0&&(T=T.add(_),R=S),N=H(N,1),_=H(_,1)}return E=I(w,T.j(E)),new A(T,E)}for(T=f;w.l(E)>=0;){for(_=Math.max(1,Math.floor(w.m()/E.m())),N=Math.ceil(Math.log(_)/Math.LN2),N=N<=48?1:Math.pow(2,N-48),R=u(_),S=R.j(E);g(S)||S.l(w)>0;)_-=N,R=u(_),S=R.j(E);x(R)&&(R=m),T=T.add(R),w=I(w,S)}return new A(T,w)}t.B=function(w){return D(this,w).h},t.and=function(w){const E=Math.max(this.g.length,w.g.length),_=[];for(let N=0;N<E;N++)_[N]=this.i(N)&w.i(N);return new i(_,this.h&w.h)},t.or=function(w){const E=Math.max(this.g.length,w.g.length),_=[];for(let N=0;N<E;N++)_[N]=this.i(N)|w.i(N);return new i(_,this.h|w.h)},t.xor=function(w){const E=Math.max(this.g.length,w.g.length),_=[];for(let N=0;N<E;N++)_[N]=this.i(N)^w.i(N);return new i(_,this.h^w.h)};function V(w){const E=w.g.length+1,_=[];for(let N=0;N<E;N++)_[N]=w.i(N)<<1|w.i(N-1)>>>31;return new i(_,w.h)}function H(w,E){const _=E>>5;E%=32;const N=w.g.length-_,T=[];for(let R=0;R<N;R++)T[R]=E>0?w.i(R+_)>>>E|w.i(R+_+1)<<32-E:w.i(R+_);return new i(T,w.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,Ox=n,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=u,i.fromString=h,Jn=i}).apply(typeof m0<"u"?m0:typeof self<"u"?self:typeof window<"u"?window:{});var ko=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Mx,ai,Lx,Go,wu,Bx,Vx,Ux;(function(){var t,e=Object.defineProperty;function r(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof ko=="object"&&ko];for(var v=0;v<d.length;++v){var b=d[v];if(b&&b.Math==Math)return b}throw Error("Cannot find global object")}var n=r(this);function s(d,v){if(v)e:{var b=n;d=d.split(".");for(var F=0;F<d.length-1;F++){var G=d[F];if(!(G in b))break e;b=b[G]}d=d[d.length-1],F=b[d],v=v(F),v!=F&&v!=null&&e(b,d,{configurable:!0,writable:!0,value:v})}}s("Symbol.dispose",function(d){return d||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(d){return d||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(d){return d||function(v){var b=[],F;for(F in v)Object.prototype.hasOwnProperty.call(v,F)&&b.push([F,v[F]]);return b}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},i=this||self;function l(d){var v=typeof d;return v=="object"&&d!=null||v=="function"}function c(d,v,b){return d.call.apply(d.bind,arguments)}function u(d,v,b){return u=c,u.apply(null,arguments)}function h(d,v){var b=Array.prototype.slice.call(arguments,1);return function(){var F=b.slice();return F.push.apply(F,arguments),d.apply(this,F)}}function f(d,v){function b(){}b.prototype=v.prototype,d.Z=v.prototype,d.prototype=new b,d.prototype.constructor=d,d.Ob=function(F,G,Z){for(var we=Array(arguments.length-2),Ue=2;Ue<arguments.length;Ue++)we[Ue-2]=arguments[Ue];return v.prototype[G].apply(F,we)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?d=>d&&AsyncContext.Snapshot.wrap(d):d=>d;function p(d){const v=d.length;if(v>0){const b=Array(v);for(let F=0;F<v;F++)b[F]=d[F];return b}return[]}function x(d,v){for(let F=1;F<arguments.length;F++){const G=arguments[F];var b=typeof G;if(b=b!="object"?b:G?Array.isArray(G)?"array":b:"null",b=="array"||b=="object"&&typeof G.length=="number"){b=d.length||0;const Z=G.length||0;d.length=b+Z;for(let we=0;we<Z;we++)d[b+we]=G[we]}else d.push(G)}}class g{constructor(v,b){this.i=v,this.j=b,this.h=0,this.g=null}get(){let v;return this.h>0?(this.h--,v=this.g,this.g=v.next,v.next=null):v=this.i(),v}}function y(d){i.setTimeout(()=>{throw d},0)}function I(){var d=w;let v=null;return d.g&&(v=d.g,d.g=d.g.next,d.g||(d.h=null),v.next=null),v}class P{constructor(){this.h=this.g=null}add(v,b){const F=A.get();F.set(v,b),this.h?this.h.next=F:this.g=F,this.h=F}}var A=new g(()=>new D,d=>d.reset());class D{constructor(){this.next=this.g=this.h=null}set(v,b){this.h=v,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}let V,H=!1,w=new P,E=()=>{const d=Promise.resolve(void 0);V=()=>{d.then(_)}};function _(){for(var d;d=I();){try{d.h.call(d.g)}catch(b){y(b)}var v=A;v.j(d),v.h<100&&(v.h++,d.next=v.g,v.g=d)}H=!1}function N(){this.u=this.u,this.C=this.C}N.prototype.u=!1,N.prototype.dispose=function(){this.u||(this.u=!0,this.N())},N.prototype[Symbol.dispose]=function(){this.dispose()},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(d,v){this.type=d,this.g=this.target=v,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var R=(function(){if(!i.addEventListener||!Object.defineProperty)return!1;var d=!1,v=Object.defineProperty({},"passive",{get:function(){d=!0}});try{const b=()=>{};i.addEventListener("test",b,v),i.removeEventListener("test",b,v)}catch{}return d})();function S(d){return/^[\s\xa0]*$/.test(d)}function se(d,v){T.call(this,d?d.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,d&&this.init(d,v)}f(se,T),se.prototype.init=function(d,v){const b=this.type=d.type,F=d.changedTouches&&d.changedTouches.length?d.changedTouches[0]:null;this.target=d.target||d.srcElement,this.g=v,v=d.relatedTarget,v||(b=="mouseover"?v=d.fromElement:b=="mouseout"&&(v=d.toElement)),this.relatedTarget=v,F?(this.clientX=F.clientX!==void 0?F.clientX:F.pageX,this.clientY=F.clientY!==void 0?F.clientY:F.pageY,this.screenX=F.screenX||0,this.screenY=F.screenY||0):(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=d.button,this.key=d.key||"",this.ctrlKey=d.ctrlKey,this.altKey=d.altKey,this.shiftKey=d.shiftKey,this.metaKey=d.metaKey,this.pointerId=d.pointerId||0,this.pointerType=d.pointerType,this.state=d.state,this.i=d,d.defaultPrevented&&se.Z.h.call(this)},se.prototype.h=function(){se.Z.h.call(this);const d=this.i;d.preventDefault?d.preventDefault():d.returnValue=!1};var te="closure_listenable_"+(Math.random()*1e6|0),me=0;function ce(d,v,b,F,G){this.listener=d,this.proxy=null,this.src=v,this.type=b,this.capture=!!F,this.ha=G,this.key=++me,this.da=this.fa=!1}function le(d){d.da=!0,d.listener=null,d.proxy=null,d.src=null,d.ha=null}function Ae(d,v,b){for(const F in d)v.call(b,d[F],F,d)}function Oe(d,v){for(const b in d)v.call(void 0,d[b],b,d)}function Je(d){const v={};for(const b in d)v[b]=d[b];return v}const U="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(d,v){let b,F;for(let G=1;G<arguments.length;G++){F=arguments[G];for(b in F)d[b]=F[b];for(let Z=0;Z<U.length;Z++)b=U[Z],Object.prototype.hasOwnProperty.call(F,b)&&(d[b]=F[b])}}function q(d){this.src=d,this.g={},this.h=0}q.prototype.add=function(d,v,b,F,G){const Z=d.toString();d=this.g[Z],d||(d=this.g[Z]=[],this.h++);const we=ae(d,v,F,G);return we>-1?(v=d[we],b||(v.fa=!1)):(v=new ce(v,this.src,Z,!!F,G),v.fa=b,d.push(v)),v};function W(d,v){const b=v.type;if(b in d.g){var F=d.g[b],G=Array.prototype.indexOf.call(F,v,void 0),Z;(Z=G>=0)&&Array.prototype.splice.call(F,G,1),Z&&(le(v),d.g[b].length==0&&(delete d.g[b],d.h--))}}function ae(d,v,b,F){for(let G=0;G<d.length;++G){const Z=d[G];if(!Z.da&&Z.listener==v&&Z.capture==!!b&&Z.ha==F)return G}return-1}var be="closure_lm_"+(Math.random()*1e6|0),ye={};function pe(d,v,b,F,G){if(Array.isArray(v)){for(let Z=0;Z<v.length;Z++)pe(d,v[Z],b,F,G);return null}return b=jt(b),d&&d[te]?d.J(v,b,l(F)?!!F.capture:!1,G):xe(d,v,b,!1,F,G)}function xe(d,v,b,F,G,Z){if(!v)throw Error("Invalid event type");const we=l(G)?!!G.capture:!!G;let Ue=Xe(d);if(Ue||(d[be]=Ue=new q(d)),b=Ue.add(v,b,F,we,Z),b.proxy)return b;if(F=We(),b.proxy=F,F.src=d,F.listener=b,d.addEventListener)R||(G=we),G===void 0&&(G=!1),d.addEventListener(v.toString(),F,G);else if(d.attachEvent)d.attachEvent(qe(v.toString()),F);else if(d.addListener&&d.removeListener)d.addListener(F);else throw Error("addEventListener and attachEvent are unavailable.");return b}function We(){function d(b){return v.call(d.src,d.listener,b)}const v=hr;return d}function Ve(d,v,b,F,G){if(Array.isArray(v))for(var Z=0;Z<v.length;Z++)Ve(d,v[Z],b,F,G);else F=l(F)?!!F.capture:!!F,b=jt(b),d&&d[te]?(d=d.i,Z=String(v).toString(),Z in d.g&&(v=d.g[Z],b=ae(v,b,F,G),b>-1&&(le(v[b]),Array.prototype.splice.call(v,b,1),v.length==0&&(delete d.g[Z],d.h--)))):d&&(d=Xe(d))&&(v=d.g[v.toString()],d=-1,v&&(d=ae(v,b,F,G)),(b=d>-1?v[d]:null)&&nt(b))}function nt(d){if(typeof d!="number"&&d&&!d.da){var v=d.src;if(v&&v[te])W(v.i,d);else{var b=d.type,F=d.proxy;v.removeEventListener?v.removeEventListener(b,F,d.capture):v.detachEvent?v.detachEvent(qe(b),F):v.addListener&&v.removeListener&&v.removeListener(F),(b=Xe(v))?(W(b,d),b.h==0&&(b.src=null,v[be]=null)):le(d)}}}function qe(d){return d in ye?ye[d]:ye[d]="on"+d}function hr(d,v){if(d.da)d=!0;else{v=new se(v,this);const b=d.listener,F=d.ha||d.src;d.fa&&nt(d),d=b.call(F,v)}return d}function Xe(d){return d=d[be],d instanceof q?d:null}var Ne="__closure_events_fn_"+(Math.random()*1e9>>>0);function jt(d){return typeof d=="function"?d:(d[Ne]||(d[Ne]=function(v){return d.handleEvent(v)}),d[Ne])}function tt(){N.call(this),this.i=new q(this),this.M=this,this.G=null}f(tt,N),tt.prototype[te]=!0,tt.prototype.removeEventListener=function(d,v,b,F){Ve(this,d,v,b,F)};function ct(d,v){var b,F=d.G;if(F)for(b=[];F;F=F.G)b.push(F);if(d=d.M,F=v.type||v,typeof v=="string")v=new T(v,d);else if(v instanceof T)v.target=v.target||d;else{var G=v;v=new T(F,d),Y(v,G)}G=!0;let Z,we;if(b)for(we=b.length-1;we>=0;we--)Z=v.g=b[we],G=dr(Z,F,!0,v)&&G;if(Z=v.g=d,G=dr(Z,F,!0,v)&&G,G=dr(Z,F,!1,v)&&G,b)for(we=0;we<b.length;we++)Z=v.g=b[we],G=dr(Z,F,!1,v)&&G}tt.prototype.N=function(){if(tt.Z.N.call(this),this.i){var d=this.i;for(const v in d.g){const b=d.g[v];for(let F=0;F<b.length;F++)le(b[F]);delete d.g[v],d.h--}}this.G=null},tt.prototype.J=function(d,v,b,F){return this.i.add(String(d),v,!1,b,F)},tt.prototype.K=function(d,v,b,F){return this.i.add(String(d),v,!0,b,F)};function dr(d,v,b,F){if(v=d.i.g[String(v)],!v)return!0;v=v.concat();let G=!0;for(let Z=0;Z<v.length;++Z){const we=v[Z];if(we&&!we.da&&we.capture==b){const Ue=we.listener,Ot=we.ha||we.src;we.fa&&W(d.i,we),G=Ue.call(Ot,F)!==!1&&G}}return G&&!F.defaultPrevented}function On(d,v){if(typeof d!="function")if(d&&typeof d.handleEvent=="function")d=u(d.handleEvent,d);else throw Error("Invalid listener argument");return Number(v)>2147483647?-1:i.setTimeout(d,v||0)}function Jr(d){d.g=On(()=>{d.g=null,d.i&&(d.i=!1,Jr(d))},d.l);const v=d.h;d.h=null,d.m.apply(null,v)}class rr extends N{constructor(v,b){super(),this.m=v,this.l=b,this.h=null,this.i=!1,this.g=null}j(v){this.h=arguments,this.g?this.i=!0:Jr(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function xr(d){N.call(this),this.h=d,this.g={}}f(xr,N);var he=[];function Re(d){Ae(d.g,function(v,b){this.g.hasOwnProperty(b)&&nt(v)},d),d.g={}}xr.prototype.N=function(){xr.Z.N.call(this),Re(this)},xr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ue=i.JSON.stringify,ke=i.JSON.parse,He=class{stringify(d){return i.JSON.stringify(d,void 0)}parse(d){return i.JSON.parse(d,void 0)}};function wt(){}function yt(){}var vr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Pe(){T.call(this,"d")}f(Pe,T);function Fe(){T.call(this,"c")}f(Fe,T);var Ce={},Ze=null;function nr(){return Ze=Ze||new tt}Ce.Ia="serverreachability";function sr(d){T.call(this,Ce.Ia,d)}f(sr,T);function vt(d){const v=nr();ct(v,new sr(v))}Ce.STAT_EVENT="statevent";function fr(d,v){T.call(this,Ce.STAT_EVENT,d),this.stat=v}f(fr,T);function St(d){const v=nr();ct(v,new fr(v,d))}Ce.Ja="timingevent";function Zr(d,v){T.call(this,Ce.Ja,d),this.size=v}f(Zr,T);function Mn(d,v){if(typeof d!="function")throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){d()},v)}function _s(){this.g=!0}_s.prototype.ua=function(){this.g=!1};function _c(d,v,b,F,G,Z){d.info(function(){if(d.g)if(Z){var we="",Ue=Z.split("&");for(let ut=0;ut<Ue.length;ut++){var Ot=Ue[ut].split("=");if(Ot.length>1){const Vt=Ot[0];Ot=Ot[1];const rn=Vt.split("_");we=rn.length>=2&&rn[1]=="type"?we+(Vt+"="+Ot+"&"):we+(Vt+"=redacted&")}}}else we=null;else we=Z;return"XMLHTTP REQ ("+F+") [attempt "+G+"]: "+v+`
`+b+`
`+we})}function wc(d,v,b,F,G,Z,we){d.info(function(){return"XMLHTTP RESP ("+F+") [ attempt "+G+"]: "+v+`
`+b+`
`+Z+" "+we})}function Ln(d,v,b,F){d.info(function(){return"XMLHTTP TEXT ("+v+"): "+Ec(d,b)+(F?" "+F:"")})}function bc(d,v){d.info(function(){return"TIMEOUT: "+v})}_s.prototype.info=function(){};function Ec(d,v){if(!d.g)return v;if(!v)return null;try{const Z=JSON.parse(v);if(Z){for(d=0;d<Z.length;d++)if(Array.isArray(Z[d])){var b=Z[d];if(!(b.length<2)){var F=b[1];if(Array.isArray(F)&&!(F.length<1)){var G=F[0];if(G!="noop"&&G!="stop"&&G!="close")for(let we=1;we<F.length;we++)F[we]=""}}}}return ue(Z)}catch{return v}}var Ks={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Xs={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ho;function Wa(){}f(Wa,wt),Wa.prototype.g=function(){return new XMLHttpRequest},ho=new Wa;function ws(d){return encodeURIComponent(String(d))}function C(d){var v=1;d=d.split(":");const b=[];for(;v>0&&d.length;)b.push(d.shift()),v--;return d.length&&b.push(d.join(":")),b}function M(d,v,b,F){this.j=d,this.i=v,this.l=b,this.S=F||1,this.V=new xr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new j}function j(){this.i=null,this.g="",this.h=!1}var O={},L={};function B(d,v,b){d.M=1,d.A=fo(tn(v)),d.u=b,d.R=!0,X(d,null)}function X(d,v){d.F=Date.now(),J(d),d.B=tn(d.A);var b=d.B,F=d.S;Array.isArray(F)||(F=[String(F)]),xd(b.i,"t",F),d.C=0,b=d.j.L,d.h=new j,d.g=kd(d.j,b?v:null,!d.u),d.P>0&&(d.O=new rr(u(d.Y,d,d.g),d.P)),v=d.V,b=d.g,F=d.ba;var G="readystatechange";Array.isArray(G)||(G&&(he[0]=G.toString()),G=he);for(let Z=0;Z<G.length;Z++){const we=pe(b,G[Z],F||v.handleEvent,!1,v.h||v);if(!we)break;v.g[we.key]=we}v=d.J?Je(d.J):{},d.u?(d.v||(d.v="POST"),v["Content-Type"]="application/x-www-form-urlencoded",d.g.ea(d.B,d.v,d.u,v)):(d.v="GET",d.g.ea(d.B,d.v,null,v)),vt(),_c(d.i,d.v,d.B,d.l,d.S,d.u)}M.prototype.ba=function(d){d=d.target;const v=this.O;v&&$n(d)==3?v.j():this.Y(d)},M.prototype.Y=function(d){try{if(d==this.g)e:{const Ue=$n(this.g),Ot=this.g.ya(),ut=this.g.ca();if(!(Ue<3)&&(Ue!=3||this.g&&(this.h.h||this.g.la()||Td(this.g)))){this.K||Ue!=4||Ot==7||(Ot==8||ut<=0?vt(3):vt(2)),_e(this);var v=this.g.ca();this.X=v;var b=re(this);if(this.o=v==200,wc(this.i,this.v,this.B,this.l,this.S,Ue,v),this.o){if(this.U&&!this.L){t:{if(this.g){var F,G=this.g;if((F=G.g?G.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(F)){var Z=F;break t}}Z=null}if(d=Z)Ln(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ee(this,d);else{this.o=!1,this.m=3,St(12),fe(this),Se(this);break e}}if(this.R){d=!0;let Vt;for(;!this.K&&this.C<b.length;)if(Vt=Q(this,b),Vt==L){Ue==4&&(this.m=4,St(14),d=!1),Ln(this.i,this.l,null,"[Incomplete Response]");break}else if(Vt==O){this.m=4,St(15),Ln(this.i,this.l,b,"[Invalid Chunk]"),d=!1;break}else Ln(this.i,this.l,Vt,null),Ee(this,Vt);if(z(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ue!=4||b.length!=0||this.h.h||(this.m=1,St(16),d=!1),this.o=this.o&&d,!d)Ln(this.i,this.l,b,"[Invalid Chunked Response]"),fe(this),Se(this);else if(b.length>0&&!this.W){this.W=!0;var we=this.j;we.g==this&&we.aa&&!we.P&&(we.j.info("Great, no buffering proxy detected. Bytes received: "+b.length),Ic(we),we.P=!0,St(11))}}else Ln(this.i,this.l,b,null),Ee(this,b);Ue==4&&fe(this),this.o&&!this.K&&(Ue==4?Rd(this.j,this):(this.o=!1,J(this)))}else Lv(this.g),v==400&&b.indexOf("Unknown SID")>0?(this.m=3,St(12)):(this.m=0,St(13)),fe(this),Se(this)}}}catch{}finally{}};function re(d){if(!z(d))return d.g.la();const v=Td(d.g);if(v==="")return"";let b="";const F=v.length,G=$n(d.g)==4;if(!d.h.i){if(typeof TextDecoder>"u")return fe(d),Se(d),"";d.h.i=new i.TextDecoder}for(let Z=0;Z<F;Z++)d.h.h=!0,b+=d.h.i.decode(v[Z],{stream:!(G&&Z==F-1)});return v.length=0,d.h.g+=b,d.C=0,d.h.g}function z(d){return d.g?d.v=="GET"&&d.M!=2&&d.j.Aa:!1}function Q(d,v){var b=d.C,F=v.indexOf(`
`,b);return F==-1?L:(b=Number(v.substring(b,F)),isNaN(b)?O:(F+=1,F+b>v.length?L:(v=v.slice(F,F+b),d.C=F+b,v)))}M.prototype.cancel=function(){this.K=!0,fe(this)};function J(d){d.T=Date.now()+d.H,de(d,d.H)}function de(d,v){if(d.D!=null)throw Error("WatchDog timer not null");d.D=Mn(u(d.aa,d),v)}function _e(d){d.D&&(i.clearTimeout(d.D),d.D=null)}M.prototype.aa=function(){this.D=null;const d=Date.now();d-this.T>=0?(bc(this.i,this.B),this.M!=2&&(vt(),St(17)),fe(this),this.m=2,Se(this)):de(this,this.T-d)};function Se(d){d.j.I==0||d.K||Rd(d.j,d)}function fe(d){_e(d);var v=d.O;v&&typeof v.dispose=="function"&&v.dispose(),d.O=null,Re(d.V),d.g&&(v=d.g,d.g=null,v.abort(),v.dispose())}function Ee(d,v){try{var b=d.j;if(b.I!=0&&(b.g==d||vn(b.h,d))){if(!d.L&&vn(b.h,d)&&b.I==3){try{var F=b.Ba.g.parse(v)}catch{F=null}if(Array.isArray(F)&&F.length==3){var G=F;if(G[0]==0){e:if(!b.v){if(b.g)if(b.g.F+3e3<d.F)vo(b),go(b);else break e;Cc(b),St(18)}}else b.xa=G[1],0<b.xa-b.K&&G[2]<37500&&b.F&&b.A==0&&!b.C&&(b.C=Mn(u(b.Va,b),6e3));kt(b.h)<=1&&b.ta&&(b.ta=void 0)}else Es(b,11)}else if((d.L||b.g==d)&&vo(b),!S(v))for(G=b.Ba.g.parse(v),v=0;v<G.length;v++){let ut=G[v];const Vt=ut[0];if(!(Vt<=b.K))if(b.K=Vt,ut=ut[1],b.I==2)if(ut[0]=="c"){b.M=ut[1],b.ba=ut[2];const rn=ut[3];rn!=null&&(b.ka=rn,b.j.info("VER="+b.ka));const Ts=ut[4];Ts!=null&&(b.za=Ts,b.j.info("SVER="+b.za));const Hn=ut[5];Hn!=null&&typeof Hn=="number"&&Hn>0&&(F=1.5*Hn,b.O=F,b.j.info("backChannelRequestTimeoutMs_="+F)),F=b;const Wn=d.g;if(Wn){const _o=Wn.g?Wn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_o){var Z=F.h;Z.g||_o.indexOf("spdy")==-1&&_o.indexOf("quic")==-1&&_o.indexOf("h2")==-1||(Z.j=Z.l,Z.g=new Set,Z.h&&(yn(Z,Z.h),Z.h=null))}if(F.G){const Pc=Wn.g?Wn.g.getResponseHeader("X-HTTP-Session-Id"):null;Pc&&(F.wa=Pc,pt(F.J,F.G,Pc))}}b.I=3,b.l&&b.l.ra(),b.aa&&(b.T=Date.now()-d.F,b.j.info("Handshake RTT: "+b.T+"ms")),F=b;var we=d;if(F.na=jd(F,F.L?F.ba:null,F.W),we.L){Bn(F.h,we);var Ue=we,Ot=F.O;Ot&&(Ue.H=Ot),Ue.D&&(_e(Ue),J(Ue)),F.g=we}else Id(F);b.i.length>0&&xo(b)}else ut[0]!="stop"&&ut[0]!="close"||Es(b,7);else b.I==3&&(ut[0]=="stop"||ut[0]=="close"?ut[0]=="stop"?Es(b,7):Nc(b):ut[0]!="noop"&&b.l&&b.l.qa(ut),b.A=0)}}vt(4)}catch{}}var Me=class{constructor(d,v){this.g=d,this.map=v}};function dt(d){this.l=d||10,i.PerformanceNavigationTiming?(d=i.performance.getEntriesByType("navigation"),d=d.length>0&&(d[0].nextHopProtocol=="hq"||d[0].nextHopProtocol=="h2")):d=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=d?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ft(d){return d.h?!0:d.g?d.g.size>=d.j:!1}function kt(d){return d.h?1:d.g?d.g.size:0}function vn(d,v){return d.h?d.h==v:d.g?d.g.has(v):!1}function yn(d,v){d.g?d.g.add(v):d.h=v}function Bn(d,v){d.h&&d.h==v?d.h=null:d.g&&d.g.has(v)&&d.g.delete(v)}dt.prototype.cancel=function(){if(this.i=en(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const d of this.g.values())d.cancel();this.g.clear()}};function en(d){if(d.h!=null)return d.i.concat(d.h.G);if(d.g!=null&&d.g.size!==0){let v=d.i;for(const b of d.g.values())v=v.concat(b.G);return v}return p(d.i)}var Qs=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $r(d,v){if(d){d=d.split("&");for(let b=0;b<d.length;b++){const F=d[b].indexOf("=");let G,Z=null;F>=0?(G=d[b].substring(0,F),Z=d[b].substring(F+1)):G=d[b],v(G,Z?decodeURIComponent(Z.replace(/\+/g," ")):"")}}}function Vn(d){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let v;d instanceof Vn?(this.l=d.l,qa(this,d.j),this.o=d.o,this.g=d.g,Ga(this,d.u),this.h=d.h,Tc(this,vd(d.i)),this.m=d.m):d&&(v=String(d).match(Qs))?(this.l=!1,qa(this,v[1]||"",!0),this.o=za(v[2]||""),this.g=za(v[3]||"",!0),Ga(this,v[4]),this.h=za(v[5]||"",!0),Tc(this,v[6]||"",!0),this.m=za(v[7]||"")):(this.l=!1,this.i=new Ka(null,this.l))}Vn.prototype.toString=function(){const d=[];var v=this.j;v&&d.push(Ya(v,fd,!0),":");var b=this.g;return(b||v=="file")&&(d.push("//"),(v=this.o)&&d.push(Ya(v,fd,!0),"@"),d.push(ws(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b=this.u,b!=null&&d.push(":",String(b))),(b=this.h)&&(this.g&&b.charAt(0)!="/"&&d.push("/"),d.push(Ya(b,b.charAt(0)=="/"?Iv:Cv,!0))),(b=this.i.toString())&&d.push("?",b),(b=this.m)&&d.push("#",Ya(b,Rv)),d.join("")},Vn.prototype.resolve=function(d){const v=tn(this);let b=!!d.j;b?qa(v,d.j):b=!!d.o,b?v.o=d.o:b=!!d.g,b?v.g=d.g:b=d.u!=null;var F=d.h;if(b)Ga(v,d.u);else if(b=!!d.h){if(F.charAt(0)!="/")if(this.g&&!this.h)F="/"+F;else{var G=v.h.lastIndexOf("/");G!=-1&&(F=v.h.slice(0,G+1)+F)}if(G=F,G==".."||G==".")F="";else if(G.indexOf("./")!=-1||G.indexOf("/.")!=-1){F=G.lastIndexOf("/",0)==0,G=G.split("/");const Z=[];for(let we=0;we<G.length;){const Ue=G[we++];Ue=="."?F&&we==G.length&&Z.push(""):Ue==".."?((Z.length>1||Z.length==1&&Z[0]!="")&&Z.pop(),F&&we==G.length&&Z.push("")):(Z.push(Ue),F=!0)}F=Z.join("/")}else F=G}return b?v.h=F:b=d.i.toString()!=="",b?Tc(v,vd(d.i)):b=!!d.m,b&&(v.m=d.m),v};function tn(d){return new Vn(d)}function qa(d,v,b){d.j=b?za(v,!0):v,d.j&&(d.j=d.j.replace(/:$/,""))}function Ga(d,v){if(v){if(v=Number(v),isNaN(v)||v<0)throw Error("Bad port number "+v);d.u=v}else d.u=null}function Tc(d,v,b){v instanceof Ka?(d.i=v,Dv(d.i,d.l)):(b||(v=Ya(v,Pv)),d.i=new Ka(v,d.l))}function pt(d,v,b){d.i.set(v,b)}function fo(d){return pt(d,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),d}function za(d,v){return d?v?decodeURI(d.replace(/%25/g,"%2525")):decodeURIComponent(d):""}function Ya(d,v,b){return typeof d=="string"?(d=encodeURI(d).replace(v,Nv),b&&(d=d.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d):null}function Nv(d){return d=d.charCodeAt(0),"%"+(d>>4&15).toString(16)+(d&15).toString(16)}var fd=/[#\/\?@]/g,Cv=/[#\?:]/g,Iv=/[#\?]/g,Pv=/[#\?@]/g,Rv=/#/g;function Ka(d,v){this.h=this.g=null,this.i=d||null,this.j=!!v}function bs(d){d.g||(d.g=new Map,d.h=0,d.i&&$r(d.i,function(v,b){d.add(decodeURIComponent(v.replace(/\+/g," ")),b)}))}t=Ka.prototype,t.add=function(d,v){bs(this),this.i=null,d=Js(this,d);let b=this.g.get(d);return b||this.g.set(d,b=[]),b.push(v),this.h+=1,this};function md(d,v){bs(d),v=Js(d,v),d.g.has(v)&&(d.i=null,d.h-=d.g.get(v).length,d.g.delete(v))}function pd(d,v){return bs(d),v=Js(d,v),d.g.has(v)}t.forEach=function(d,v){bs(this),this.g.forEach(function(b,F){b.forEach(function(G){d.call(v,G,F,this)},this)},this)};function gd(d,v){bs(d);let b=[];if(typeof v=="string")pd(d,v)&&(b=b.concat(d.g.get(Js(d,v))));else for(d=Array.from(d.g.values()),v=0;v<d.length;v++)b=b.concat(d[v]);return b}t.set=function(d,v){return bs(this),this.i=null,d=Js(this,d),pd(this,d)&&(this.h-=this.g.get(d).length),this.g.set(d,[v]),this.h+=1,this},t.get=function(d,v){return d?(d=gd(this,d),d.length>0?String(d[0]):v):v};function xd(d,v,b){md(d,v),b.length>0&&(d.i=null,d.g.set(Js(d,v),p(b)),d.h+=b.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const d=[],v=Array.from(this.g.keys());for(let F=0;F<v.length;F++){var b=v[F];const G=ws(b);b=gd(this,b);for(let Z=0;Z<b.length;Z++){let we=G;b[Z]!==""&&(we+="="+ws(b[Z])),d.push(we)}}return this.i=d.join("&")};function vd(d){const v=new Ka;return v.i=d.i,d.g&&(v.g=new Map(d.g),v.h=d.h),v}function Js(d,v){return v=String(v),d.j&&(v=v.toLowerCase()),v}function Dv(d,v){v&&!d.j&&(bs(d),d.i=null,d.g.forEach(function(b,F){const G=F.toLowerCase();F!=G&&(md(this,F),xd(this,G,b))},d)),d.j=v}function Fv(d,v){const b=new _s;if(i.Image){const F=new Image;F.onload=h(Un,b,"TestLoadImage: loaded",!0,v,F),F.onerror=h(Un,b,"TestLoadImage: error",!1,v,F),F.onabort=h(Un,b,"TestLoadImage: abort",!1,v,F),F.ontimeout=h(Un,b,"TestLoadImage: timeout",!1,v,F),i.setTimeout(function(){F.ontimeout&&F.ontimeout()},1e4),F.src=d}else v(!1)}function jv(d,v){const b=new _s,F=new AbortController,G=setTimeout(()=>{F.abort(),Un(b,"TestPingServer: timeout",!1,v)},1e4);fetch(d,{signal:F.signal}).then(Z=>{clearTimeout(G),Z.ok?Un(b,"TestPingServer: ok",!0,v):Un(b,"TestPingServer: server error",!1,v)}).catch(()=>{clearTimeout(G),Un(b,"TestPingServer: error",!1,v)})}function Un(d,v,b,F,G){try{G&&(G.onload=null,G.onerror=null,G.onabort=null,G.ontimeout=null),F(b)}catch{}}function kv(){this.g=new He}function Ac(d){this.i=d.Sb||null,this.h=d.ab||!1}f(Ac,wt),Ac.prototype.g=function(){return new mo(this.i,this.h)};function mo(d,v){tt.call(this),this.H=d,this.o=v,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}f(mo,tt),t=mo.prototype,t.open=function(d,v){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=d,this.D=v,this.readyState=1,Qa(this)},t.send=function(d){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const v={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};d&&(v.body=d),(this.H||i).fetch(new Request(this.D,v)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Xa(this)),this.readyState=0},t.Pa=function(d){if(this.g&&(this.l=d,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=d.headers,this.readyState=2,Qa(this)),this.g&&(this.readyState=3,Qa(this),this.g)))if(this.responseType==="arraybuffer")d.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof i.ReadableStream<"u"&&"body"in d){if(this.j=d.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;yd(this)}else d.text().then(this.Oa.bind(this),this.ga.bind(this))};function yd(d){d.j.read().then(d.Ma.bind(d)).catch(d.ga.bind(d))}t.Ma=function(d){if(this.g){if(this.o&&d.value)this.response.push(d.value);else if(!this.o){var v=d.value?d.value:new Uint8Array(0);(v=this.B.decode(v,{stream:!d.done}))&&(this.response=this.responseText+=v)}d.done?Xa(this):Qa(this),this.readyState==3&&yd(this)}},t.Oa=function(d){this.g&&(this.response=this.responseText=d,Xa(this))},t.Na=function(d){this.g&&(this.response=d,Xa(this))},t.ga=function(){this.g&&Xa(this)};function Xa(d){d.readyState=4,d.l=null,d.j=null,d.B=null,Qa(d)}t.setRequestHeader=function(d,v){this.A.append(d,v)},t.getResponseHeader=function(d){return this.h&&this.h.get(d.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const d=[],v=this.h.entries();for(var b=v.next();!b.done;)b=b.value,d.push(b[0]+": "+b[1]),b=v.next();return d.join(`\r
`)};function Qa(d){d.onreadystatechange&&d.onreadystatechange.call(d)}Object.defineProperty(mo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(d){this.m=d?"include":"same-origin"}});function _d(d){let v="";return Ae(d,function(b,F){v+=F,v+=":",v+=b,v+=`\r
`}),v}function Sc(d,v,b){e:{for(F in b){var F=!1;break e}F=!0}F||(b=_d(b),typeof d=="string"?b!=null&&ws(b):pt(d,v,b))}function bt(d){tt.call(this),this.headers=new Map,this.L=d||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}f(bt,tt);var Ov=/^https?$/i,Mv=["POST","PUT"];t=bt.prototype,t.Fa=function(d){this.H=d},t.ea=function(d,v,b,F){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+d);v=v?v.toUpperCase():"GET",this.D=d,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ho.g(),this.g.onreadystatechange=m(u(this.Ca,this));try{this.B=!0,this.g.open(v,String(d),!0),this.B=!1}catch(Z){wd(this,Z);return}if(d=b||"",b=new Map(this.headers),F)if(Object.getPrototypeOf(F)===Object.prototype)for(var G in F)b.set(G,F[G]);else if(typeof F.keys=="function"&&typeof F.get=="function")for(const Z of F.keys())b.set(Z,F.get(Z));else throw Error("Unknown input type for opt_headers: "+String(F));F=Array.from(b.keys()).find(Z=>Z.toLowerCase()=="content-type"),G=i.FormData&&d instanceof i.FormData,!(Array.prototype.indexOf.call(Mv,v,void 0)>=0)||F||G||b.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Z,we]of b)this.g.setRequestHeader(Z,we);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(d),this.v=!1}catch(Z){wd(this,Z)}};function wd(d,v){d.h=!1,d.g&&(d.j=!0,d.g.abort(),d.j=!1),d.l=v,d.o=5,bd(d),po(d)}function bd(d){d.A||(d.A=!0,ct(d,"complete"),ct(d,"error"))}t.abort=function(d){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=d||7,ct(this,"complete"),ct(this,"abort"),po(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),po(this,!0)),bt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Ed(this):this.Xa())},t.Xa=function(){Ed(this)};function Ed(d){if(d.h&&typeof a<"u"){if(d.v&&$n(d)==4)setTimeout(d.Ca.bind(d),0);else if(ct(d,"readystatechange"),$n(d)==4){d.h=!1;try{const Z=d.ca();e:switch(Z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var v=!0;break e;default:v=!1}var b;if(!(b=v)){var F;if(F=Z===0){let we=String(d.D).match(Qs)[1]||null;!we&&i.self&&i.self.location&&(we=i.self.location.protocol.slice(0,-1)),F=!Ov.test(we?we.toLowerCase():"")}b=F}if(b)ct(d,"complete"),ct(d,"success");else{d.o=6;try{var G=$n(d)>2?d.g.statusText:""}catch{G=""}d.l=G+" ["+d.ca()+"]",bd(d)}}finally{po(d)}}}}function po(d,v){if(d.g){d.m&&(clearTimeout(d.m),d.m=null);const b=d.g;d.g=null,v||ct(d,"ready");try{b.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function $n(d){return d.g?d.g.readyState:0}t.ca=function(){try{return $n(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(d){if(this.g){var v=this.g.responseText;return d&&v.indexOf(d)==0&&(v=v.substring(d.length)),ke(v)}};function Td(d){try{if(!d.g)return null;if("response"in d.g)return d.g.response;switch(d.F){case"":case"text":return d.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in d.g)return d.g.mozResponseArrayBuffer}return null}catch{return null}}function Lv(d){const v={};d=(d.g&&$n(d)>=2&&d.g.getAllResponseHeaders()||"").split(`\r
`);for(let F=0;F<d.length;F++){if(S(d[F]))continue;var b=C(d[F]);const G=b[0];if(b=b[1],typeof b!="string")continue;b=b.trim();const Z=v[G]||[];v[G]=Z,Z.push(b)}Oe(v,function(F){return F.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ja(d,v,b){return b&&b.internalChannelParams&&b.internalChannelParams[d]||v}function Ad(d){this.za=0,this.i=[],this.j=new _s,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ja("failFast",!1,d),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ja("baseRetryDelayMs",5e3,d),this.Za=Ja("retryDelaySeedMs",1e4,d),this.Ta=Ja("forwardChannelMaxRetries",2,d),this.va=Ja("forwardChannelRequestTimeoutMs",2e4,d),this.ma=d&&d.xmlHttpFactory||void 0,this.Ua=d&&d.Rb||void 0,this.Aa=d&&d.useFetchStreams||!1,this.O=void 0,this.L=d&&d.supportsCrossDomainXhr||!1,this.M="",this.h=new dt(d&&d.concurrentRequestLimit),this.Ba=new kv,this.S=d&&d.fastHandshake||!1,this.R=d&&d.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=d&&d.Pb||!1,d&&d.ua&&this.j.ua(),d&&d.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&d&&d.detectBufferingProxy||!1,this.ia=void 0,d&&d.longPollingTimeout&&d.longPollingTimeout>0&&(this.ia=d.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=Ad.prototype,t.ka=8,t.I=1,t.connect=function(d,v,b,F){St(0),this.W=d,this.H=v||{},b&&F!==void 0&&(this.H.OSID=b,this.H.OAID=F),this.F=this.X,this.J=jd(this,null,this.W),xo(this)};function Nc(d){if(Sd(d),d.I==3){var v=d.V++,b=tn(d.J);if(pt(b,"SID",d.M),pt(b,"RID",v),pt(b,"TYPE","terminate"),Za(d,b),v=new M(d,d.j,v),v.M=2,v.A=fo(tn(b)),b=!1,i.navigator&&i.navigator.sendBeacon)try{b=i.navigator.sendBeacon(v.A.toString(),"")}catch{}!b&&i.Image&&(new Image().src=v.A,b=!0),b||(v.g=kd(v.j,null),v.g.ea(v.A)),v.F=Date.now(),J(v)}Fd(d)}function go(d){d.g&&(Ic(d),d.g.cancel(),d.g=null)}function Sd(d){go(d),d.v&&(i.clearTimeout(d.v),d.v=null),vo(d),d.h.cancel(),d.m&&(typeof d.m=="number"&&i.clearTimeout(d.m),d.m=null)}function xo(d){if(!ft(d.h)&&!d.m){d.m=!0;var v=d.Ea;V||E(),H||(V(),H=!0),w.add(v,d),d.D=0}}function Bv(d,v){return kt(d.h)>=d.h.j-(d.m?1:0)?!1:d.m?(d.i=v.G.concat(d.i),!0):d.I==1||d.I==2||d.D>=(d.Sa?0:d.Ta)?!1:(d.m=Mn(u(d.Ea,d,v),Dd(d,d.D)),d.D++,!0)}t.Ea=function(d){if(this.m)if(this.m=null,this.I==1){if(!d){this.V=Math.floor(Math.random()*1e5),d=this.V++;const G=new M(this,this.j,d);let Z=this.o;if(this.U&&(Z?(Z=Je(Z),Y(Z,this.U)):Z=this.U),this.u!==null||this.R||(G.J=Z,Z=null),this.S)e:{for(var v=0,b=0;b<this.i.length;b++){t:{var F=this.i[b];if("__data__"in F.map&&(F=F.map.__data__,typeof F=="string")){F=F.length;break t}F=void 0}if(F===void 0)break;if(v+=F,v>4096){v=b;break e}if(v===4096||b===this.i.length-1){v=b+1;break e}}v=1e3}else v=1e3;v=Cd(this,G,v),b=tn(this.J),pt(b,"RID",d),pt(b,"CVER",22),this.G&&pt(b,"X-HTTP-Session-Id",this.G),Za(this,b),Z&&(this.R?v="headers="+ws(_d(Z))+"&"+v:this.u&&Sc(b,this.u,Z)),yn(this.h,G),this.Ra&&pt(b,"TYPE","init"),this.S?(pt(b,"$req",v),pt(b,"SID","null"),G.U=!0,B(G,b,null)):B(G,b,v),this.I=2}}else this.I==3&&(d?Nd(this,d):this.i.length==0||ft(this.h)||Nd(this))};function Nd(d,v){var b;v?b=v.l:b=d.V++;const F=tn(d.J);pt(F,"SID",d.M),pt(F,"RID",b),pt(F,"AID",d.K),Za(d,F),d.u&&d.o&&Sc(F,d.u,d.o),b=new M(d,d.j,b,d.D+1),d.u===null&&(b.J=d.o),v&&(d.i=v.G.concat(d.i)),v=Cd(d,b,1e3),b.H=Math.round(d.va*.5)+Math.round(d.va*.5*Math.random()),yn(d.h,b),B(b,F,v)}function Za(d,v){d.H&&Ae(d.H,function(b,F){pt(v,F,b)}),d.l&&Ae({},function(b,F){pt(v,F,b)})}function Cd(d,v,b){b=Math.min(d.i.length,b);const F=d.l?u(d.l.Ka,d.l,d):null;e:{var G=d.i;let Ue=-1;for(;;){const Ot=["count="+b];Ue==-1?b>0?(Ue=G[0].g,Ot.push("ofs="+Ue)):Ue=0:Ot.push("ofs="+Ue);let ut=!0;for(let Vt=0;Vt<b;Vt++){var Z=G[Vt].g;const rn=G[Vt].map;if(Z-=Ue,Z<0)Ue=Math.max(0,G[Vt].g-100),ut=!1;else try{Z="req"+Z+"_"||"";try{var we=rn instanceof Map?rn:Object.entries(rn);for(const[Ts,Hn]of we){let Wn=Hn;l(Hn)&&(Wn=ue(Hn)),Ot.push(Z+Ts+"="+encodeURIComponent(Wn))}}catch(Ts){throw Ot.push(Z+"type="+encodeURIComponent("_badmap")),Ts}}catch{F&&F(rn)}}if(ut){we=Ot.join("&");break e}}we=void 0}return d=d.i.splice(0,b),v.G=d,we}function Id(d){if(!d.g&&!d.v){d.Y=1;var v=d.Da;V||E(),H||(V(),H=!0),w.add(v,d),d.A=0}}function Cc(d){return d.g||d.v||d.A>=3?!1:(d.Y++,d.v=Mn(u(d.Da,d),Dd(d,d.A)),d.A++,!0)}t.Da=function(){if(this.v=null,Pd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var d=4*this.T;this.j.info("BP detection timer enabled: "+d),this.B=Mn(u(this.Wa,this),d)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,St(10),go(this),Pd(this))};function Ic(d){d.B!=null&&(i.clearTimeout(d.B),d.B=null)}function Pd(d){d.g=new M(d,d.j,"rpc",d.Y),d.u===null&&(d.g.J=d.o),d.g.P=0;var v=tn(d.na);pt(v,"RID","rpc"),pt(v,"SID",d.M),pt(v,"AID",d.K),pt(v,"CI",d.F?"0":"1"),!d.F&&d.ia&&pt(v,"TO",d.ia),pt(v,"TYPE","xmlhttp"),Za(d,v),d.u&&d.o&&Sc(v,d.u,d.o),d.O&&(d.g.H=d.O);var b=d.g;d=d.ba,b.M=1,b.A=fo(tn(v)),b.u=null,b.R=!0,X(b,d)}t.Va=function(){this.C!=null&&(this.C=null,go(this),Cc(this),St(19))};function vo(d){d.C!=null&&(i.clearTimeout(d.C),d.C=null)}function Rd(d,v){var b=null;if(d.g==v){vo(d),Ic(d),d.g=null;var F=2}else if(vn(d.h,v))b=v.G,Bn(d.h,v),F=1;else return;if(d.I!=0){if(v.o)if(F==1){b=v.u?v.u.length:0,v=Date.now()-v.F;var G=d.D;F=nr(),ct(F,new Zr(F,b)),xo(d)}else Id(d);else if(G=v.m,G==3||G==0&&v.X>0||!(F==1&&Bv(d,v)||F==2&&Cc(d)))switch(b&&b.length>0&&(v=d.h,v.i=v.i.concat(b)),G){case 1:Es(d,5);break;case 4:Es(d,10);break;case 3:Es(d,6);break;default:Es(d,2)}}}function Dd(d,v){let b=d.Qa+Math.floor(Math.random()*d.Za);return d.isActive()||(b*=2),b*v}function Es(d,v){if(d.j.info("Error code "+v),v==2){var b=u(d.bb,d),F=d.Ua;const G=!F;F=new Vn(F||"//www.google.com/images/cleardot.gif"),i.location&&i.location.protocol=="http"||qa(F,"https"),fo(F),G?Fv(F.toString(),b):jv(F.toString(),b)}else St(2);d.I=0,d.l&&d.l.pa(v),Fd(d),Sd(d)}t.bb=function(d){d?(this.j.info("Successfully pinged google.com"),St(2)):(this.j.info("Failed to ping google.com"),St(1))};function Fd(d){if(d.I=0,d.ja=[],d.l){const v=en(d.h);(v.length!=0||d.i.length!=0)&&(x(d.ja,v),x(d.ja,d.i),d.h.i.length=0,p(d.i),d.i.length=0),d.l.oa()}}function jd(d,v,b){var F=b instanceof Vn?tn(b):new Vn(b);if(F.g!="")v&&(F.g=v+"."+F.g),Ga(F,F.u);else{var G=i.location;F=G.protocol,v=v?v+"."+G.hostname:G.hostname,G=+G.port;const Z=new Vn(null);F&&qa(Z,F),v&&(Z.g=v),G&&Ga(Z,G),b&&(Z.h=b),F=Z}return b=d.G,v=d.wa,b&&v&&pt(F,b,v),pt(F,"VER",d.ka),Za(d,F),F}function kd(d,v,b){if(v&&!d.L)throw Error("Can't create secondary domain capable XhrIo object.");return v=d.Aa&&!d.ma?new bt(new Ac({ab:b})):new bt(d.ma),v.Fa(d.L),v}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Od(){}t=Od.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function yo(){}yo.prototype.g=function(d,v){return new Ar(d,v)};function Ar(d,v){tt.call(this),this.g=new Ad(v),this.l=d,this.h=v&&v.messageUrlParams||null,d=v&&v.messageHeaders||null,v&&v.clientProtocolHeaderRequired&&(d?d["X-Client-Protocol"]="webchannel":d={"X-Client-Protocol":"webchannel"}),this.g.o=d,d=v&&v.initMessageHeaders||null,v&&v.messageContentType&&(d?d["X-WebChannel-Content-Type"]=v.messageContentType:d={"X-WebChannel-Content-Type":v.messageContentType}),v&&v.sa&&(d?d["X-WebChannel-Client-Profile"]=v.sa:d={"X-WebChannel-Client-Profile":v.sa}),this.g.U=d,(d=v&&v.Qb)&&!S(d)&&(this.g.u=d),this.A=v&&v.supportsCrossDomainXhr||!1,this.v=v&&v.sendRawJson||!1,(v=v&&v.httpSessionIdParam)&&!S(v)&&(this.g.G=v,d=this.h,d!==null&&v in d&&(d=this.h,v in d&&delete d[v])),this.j=new Zs(this)}f(Ar,tt),Ar.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ar.prototype.close=function(){Nc(this.g)},Ar.prototype.o=function(d){var v=this.g;if(typeof d=="string"){var b={};b.__data__=d,d=b}else this.v&&(b={},b.__data__=ue(d),d=b);v.i.push(new Me(v.Ya++,d)),v.I==3&&xo(v)},Ar.prototype.N=function(){this.g.l=null,delete this.j,Nc(this.g),delete this.g,Ar.Z.N.call(this)};function Md(d){Pe.call(this),d.__headers__&&(this.headers=d.__headers__,this.statusCode=d.__status__,delete d.__headers__,delete d.__status__);var v=d.__sm__;if(v){e:{for(const b in v){d=b;break e}d=void 0}(this.i=d)&&(d=this.i,v=v!==null&&d in v?v[d]:void 0),this.data=v}else this.data=d}f(Md,Pe);function Ld(){Fe.call(this),this.status=1}f(Ld,Fe);function Zs(d){this.g=d}f(Zs,Od),Zs.prototype.ra=function(){ct(this.g,"a")},Zs.prototype.qa=function(d){ct(this.g,new Md(d))},Zs.prototype.pa=function(d){ct(this.g,new Ld)},Zs.prototype.oa=function(){ct(this.g,"b")},yo.prototype.createWebChannel=yo.prototype.g,Ar.prototype.send=Ar.prototype.o,Ar.prototype.open=Ar.prototype.m,Ar.prototype.close=Ar.prototype.close,Ux=function(){return new yo},Vx=function(){return nr()},Bx=Ce,wu={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ks.NO_ERROR=0,Ks.TIMEOUT=8,Ks.HTTP_ERROR=6,Go=Ks,Xs.COMPLETE="complete",Lx=Xs,yt.EventType=vr,vr.OPEN="a",vr.CLOSE="b",vr.ERROR="c",vr.MESSAGE="d",tt.prototype.listen=tt.prototype.J,ai=yt,bt.prototype.listenOnce=bt.prototype.K,bt.prototype.getLastError=bt.prototype.Ha,bt.prototype.getLastErrorCode=bt.prototype.ya,bt.prototype.getStatus=bt.prototype.ca,bt.prototype.getResponseJson=bt.prototype.La,bt.prototype.getResponseText=bt.prototype.la,bt.prototype.send=bt.prototype.ea,bt.prototype.setWithCredentials=bt.prototype.Fa,Mx=bt}).apply(typeof ko<"u"?ko:typeof self<"u"?self:typeof window<"u"?window:{});const p0="@firebase/firestore",g0="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}or.UNAUTHENTICATED=new or(null),or.GOOGLE_CREDENTIALS=new or("google-credentials-uid"),or.FIRST_PARTY=new or("first-party-uid"),or.MOCK_USER=new or("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ba="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ls=new Px("@firebase/firestore");function ia(){return Ls.logLevel}function Ie(t,...e){if(Ls.logLevel<=Ke.DEBUG){const r=e.map(Sh);Ls.debug(`Firestore (${Ba}): ${t}`,...r)}}function Fn(t,...e){if(Ls.logLevel<=Ke.ERROR){const r=e.map(Sh);Ls.error(`Firestore (${Ba}): ${t}`,...r)}}function Ta(t,...e){if(Ls.logLevel<=Ke.WARN){const r=e.map(Sh);Ls.warn(`Firestore (${Ba}): ${t}`,...r)}}function Sh(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(r){return JSON.stringify(r)})(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(t,e,r){let n="Unexpected state";typeof e=="string"?n=e:r=e,$x(t,n,r)}function $x(t,e,r){let n=`FIRESTORE (${Ba}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(r!==void 0)try{n+=" CONTEXT: "+JSON.stringify(r)}catch{n+=" CONTEXT: "+r}throw Fn(n),new Error(n)}function rt(t,e,r,n){let s="Unexpected state";typeof r=="string"?s=r:n=r,t||$x(e,s,n)}function Be(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ne={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Te extends La{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(){this.promise=new Promise(((e,r)=>{this.resolve=e,this.reject=r}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hx{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class e3{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable((()=>r(or.UNAUTHENTICATED)))}shutdown(){}}class t3{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable((()=>r(this.token.user)))}shutdown(){this.changeListener=null}}class r3{constructor(e){this.t=e,this.currentUser=or.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,r){rt(this.o===void 0,42304);let n=this.i;const s=c=>this.i!==n?(n=this.i,r(c)):Promise.resolve();let a=new Sn;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Sn,e.enqueueRetryable((()=>s(this.currentUser)))};const i=()=>{const c=a;e.enqueueRetryable((async()=>{await c.promise,await s(this.currentUser)}))},l=c=>{Ie("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit((c=>l(c))),setTimeout((()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(Ie("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Sn)}}),0),i()}getToken(){const e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then((n=>this.i!==e?(Ie("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(rt(typeof n.accessToken=="string",31837,{l:n}),new Hx(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return rt(e===null||typeof e=="string",2055,{h:e}),new or(e)}}class n3{constructor(e,r,n){this.P=e,this.T=r,this.I=n,this.type="FirstParty",this.user=or.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class s3{constructor(e,r,n){this.P=e,this.T=r,this.I=n}getToken(){return Promise.resolve(new n3(this.P,this.T,this.I))}start(e,r){e.enqueueRetryable((()=>r(or.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class x0{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class a3{constructor(e,r){this.V=r,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,BD(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,r){rt(this.o===void 0,3512);const n=a=>{a.error!=null&&Ie("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const i=a.token!==this.m;return this.m=a.token,Ie("FirebaseAppCheckTokenProvider",`Received ${i?"new":"existing"} token.`),i?r(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable((()=>n(a)))};const s=a=>{Ie("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((a=>s(a))),setTimeout((()=>{if(!this.appCheck){const a=this.V.getImmediate({optional:!0});a?s(a):Ie("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new x0(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((r=>r?(rt(typeof r.token=="string",44558,{tokenResult:r}),this.m=r.token,new x0(r.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i3(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let n=0;n<t;n++)r[n]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const s=i3(40);for(let a=0;a<s.length;++a)n.length<20&&s[a]<r&&(n+=e.charAt(s[a]%62))}return n}}function Ge(t,e){return t<e?-1:t>e?1:0}function bu(t,e){const r=Math.min(t.length,e.length);for(let n=0;n<r;n++){const s=t.charAt(n),a=e.charAt(n);if(s!==a)return zc(s)===zc(a)?Ge(s,a):zc(s)?1:-1}return Ge(t.length,e.length)}const o3=55296,l3=57343;function zc(t){const e=t.charCodeAt(0);return e>=o3&&e<=l3}function Aa(t,e,r){return t.length===e.length&&t.every(((n,s)=>r(n,e[s])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v0="__name__";class an{constructor(e,r,n){r===void 0?r=0:r>e.length&&je(637,{offset:r,range:e.length}),n===void 0?n=e.length-r:n>e.length-r&&je(1746,{length:n,range:e.length-r}),this.segments=e,this.offset=r,this.len=n}get length(){return this.len}isEqual(e){return an.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof an?e.forEach((n=>{r.push(n)})):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,n=this.limit();r<n;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const n=Math.min(e.length,r.length);for(let s=0;s<n;s++){const a=an.compareSegments(e.get(s),r.get(s));if(a!==0)return a}return Ge(e.length,r.length)}static compareSegments(e,r){const n=an.isNumericId(e),s=an.isNumericId(r);return n&&!s?-1:!n&&s?1:n&&s?an.extractNumericId(e).compare(an.extractNumericId(r)):bu(e,r)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Jn.fromString(e.substring(4,e.length-2))}}class mt extends an{construct(e,r,n){return new mt(e,r,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const r=[];for(const n of e){if(n.indexOf("//")>=0)throw new Te(ne.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);r.push(...n.split("/").filter((s=>s.length>0)))}return new mt(r)}static emptyPath(){return new mt([])}}const c3=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Qt extends an{construct(e,r,n){return new Qt(e,r,n)}static isValidIdentifier(e){return c3.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Qt.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===v0}static keyField(){return new Qt([v0])}static fromServerFormat(e){const r=[];let n="",s=0;const a=()=>{if(n.length===0)throw new Te(ne.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(n),n=""};let i=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new Te(ne.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new Te(ne.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,s+=2}else l==="`"?(i=!i,s++):l!=="."||i?(n+=l,s++):(a(),s++)}if(a(),i)throw new Te(ne.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Qt(r)}static emptyPath(){return new Qt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De{constructor(e){this.path=e}static fromPath(e){return new De(mt.fromString(e))}static fromName(e){return new De(mt.fromString(e).popFirst(5))}static empty(){return new De(mt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&mt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return mt.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new De(new mt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wx(t,e,r){if(!r)throw new Te(ne.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function u3(t,e,r,n){if(e===!0&&n===!0)throw new Te(ne.INVALID_ARGUMENT,`${t} and ${r} cannot be used together.`)}function y0(t){if(!De.isDocumentKey(t))throw new Te(ne.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function _0(t){if(De.isDocumentKey(t))throw new Te(ne.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function qx(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function nc(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(n){return n.constructor?n.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":je(12329,{type:typeof t})}function Fr(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Te(ne.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=nc(t);throw new Te(ne.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${r}`)}}return t}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rt(t,e){const r={typeString:t};return e&&(r.value=e),r}function ro(t,e){if(!qx(t))throw new Te(ne.INVALID_ARGUMENT,"JSON must be an object");let r;for(const n in e)if(e[n]){const s=e[n].typeString,a="value"in e[n]?{value:e[n].value}:void 0;if(!(n in t)){r=`JSON missing required field: '${n}'`;break}const i=t[n];if(s&&typeof i!==s){r=`JSON field '${n}' must be a ${s}.`;break}if(a!==void 0&&i!==a.value){r=`Expected '${n}' field to equal '${a.value}'`;break}}if(r)throw new Te(ne.INVALID_ARGUMENT,r);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w0=-62135596800,b0=1e6;class gt{static now(){return gt.fromMillis(Date.now())}static fromDate(e){return gt.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),n=Math.floor((e-1e3*r)*b0);return new gt(r,n)}constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new Te(ne.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new Te(ne.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<w0)throw new Te(ne.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Te(ne.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/b0}_compareTo(e){return this.seconds===e.seconds?Ge(this.nanoseconds,e.nanoseconds):Ge(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:gt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ro(e,gt._jsonSchema))return new gt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-w0;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}gt._jsonSchemaVersion="firestore/timestamp/1.0",gt._jsonSchema={type:Rt("string",gt._jsonSchemaVersion),seconds:Rt("number"),nanoseconds:Rt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{static fromTimestamp(e){return new Le(e)}static min(){return new Le(new gt(0,0))}static max(){return new Le(new gt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oi=-1;function h3(t,e){const r=t.toTimestamp().seconds,n=t.toTimestamp().nanoseconds+1,s=Le.fromTimestamp(n===1e9?new gt(r+1,0):new gt(r,n));return new is(s,De.empty(),e)}function d3(t){return new is(t.readTime,t.key,Oi)}class is{constructor(e,r,n){this.readTime=e,this.documentKey=r,this.largestBatchId=n}static min(){return new is(Le.min(),De.empty(),Oi)}static max(){return new is(Le.max(),De.empty(),Oi)}}function f3(t,e){let r=t.readTime.compareTo(e.readTime);return r!==0?r:(r=De.comparator(t.documentKey,e.documentKey),r!==0?r:Ge(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m3="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class p3{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Va(t){if(t.code!==ne.FAILED_PRECONDITION||t.message!==m3)throw t;Ie("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)}),(r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)}))}catch(e){return this.next(void 0,e)}next(e,r){return this.callbackAttached&&je(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new ie(((n,s)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(n,s)},this.catchCallback=a=>{this.wrapFailure(r,a).next(n,s)}}))}toPromise(){return new Promise(((e,r)=>{this.next(e,r)}))}wrapUserFunction(e){try{const r=e();return r instanceof ie?r:ie.resolve(r)}catch(r){return ie.reject(r)}}wrapSuccess(e,r){return e?this.wrapUserFunction((()=>e(r))):ie.resolve(r)}wrapFailure(e,r){return e?this.wrapUserFunction((()=>e(r))):ie.reject(r)}static resolve(e){return new ie(((r,n)=>{r(e)}))}static reject(e){return new ie(((r,n)=>{n(e)}))}static waitFor(e){return new ie(((r,n)=>{let s=0,a=0,i=!1;e.forEach((l=>{++s,l.next((()=>{++a,i&&a===s&&r()}),(c=>n(c)))})),i=!0,a===s&&r()}))}static or(e){let r=ie.resolve(!1);for(const n of e)r=r.next((s=>s?ie.resolve(s):n()));return r}static forEach(e,r){const n=[];return e.forEach(((s,a)=>{n.push(r.call(this,s,a))})),this.waitFor(n)}static mapArray(e,r){return new ie(((n,s)=>{const a=e.length,i=new Array(a);let l=0;for(let c=0;c<a;c++){const u=c;r(e[u]).next((h=>{i[u]=h,++l,l===a&&n(i)}),(h=>s(h)))}}))}static doWhile(e,r){return new ie(((n,s)=>{const a=()=>{e()===!0?r().next((()=>{a()}),s):n()};a()}))}}function g3(t){const e=t.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function Ua(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>r.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}sc.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ch=-1;function ac(t){return t==null}function Tl(t){return t===0&&1/t==-1/0}function x3(t){return typeof t=="number"&&Number.isInteger(t)&&!Tl(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gx="";function v3(t){let e="";for(let r=0;r<t.length;r++)e.length>0&&(e=E0(e)),e=y3(t.get(r),e);return E0(e)}function y3(t,e){let r=e;const n=t.length;for(let s=0;s<n;s++){const a=t.charAt(s);switch(a){case"\0":r+="";break;case Gx:r+="";break;default:r+=a}}return r}function E0(t){return t+Gx+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T0(t){let e=0;for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}function xs(t,e){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e(r,t[r])}function zx(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e,r){this.comparator=e,this.root=r||Yt.EMPTY}insert(e,r){return new _t(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,Yt.BLACK,null,null))}remove(e){return new _t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Yt.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const n=this.comparator(e,r.key);if(n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}indexOf(e){let r=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(s===0)return r+n.left.size;s<0?n=n.left:(r+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((r,n)=>(e(r,n),!1)))}toString(){const e=[];return this.inorderTraversal(((r,n)=>(e.push(`${r}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Oo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Oo(this.root,e,this.comparator,!1)}getReverseIterator(){return new Oo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Oo(this.root,e,this.comparator,!0)}}class Oo{constructor(e,r,n,s){this.isReverse=s,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=r?n(e.key,r):1,r&&s&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Yt{constructor(e,r,n,s,a){this.key=e,this.value=r,this.color=n??Yt.RED,this.left=s??Yt.EMPTY,this.right=a??Yt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,n,s,a){return new Yt(e??this.key,r??this.value,n??this.color,s??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,n){let s=this;const a=n(e,s.key);return s=a<0?s.copy(null,null,null,s.left.insert(e,r,n),null):a===0?s.copy(null,r,null,null,null):s.copy(null,null,null,null,s.right.insert(e,r,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Yt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let n,s=this;if(r(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),r(e,s.key)===0){if(s.right.isEmpty())return Yt.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Yt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Yt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw je(43730,{key:this.key,value:this.value});if(this.right.isRed())throw je(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw je(27949);return e+(this.isRed()?0:1)}}Yt.EMPTY=null,Yt.RED=!0,Yt.BLACK=!1;Yt.EMPTY=new class{constructor(){this.size=0}get key(){throw je(57766)}get value(){throw je(16141)}get color(){throw je(16727)}get left(){throw je(29726)}get right(){throw je(36894)}copy(e,r,n,s,a){return this}insert(e,r,n){return new Yt(e,r)}remove(e,r){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e){this.comparator=e,this.data=new _t(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((r,n)=>(e(r),!1)))}forEachInRange(e,r){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;r(s.key)}}forEachWhile(e,r){let n;for(n=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new A0(this.data.getIterator())}getIteratorFrom(e){return new A0(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach((n=>{r=r.add(n)})),r}isEqual(e){if(!(e instanceof Bt)||this.size!==e.size)return!1;const r=this.data.getIterator(),n=e.data.getIterator();for(;r.hasNext();){const s=r.getNext().key,a=n.getNext().key;if(this.comparator(s,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((r=>{e.push(r)})),e}toString(){const e=[];return this.forEach((r=>e.push(r))),"SortedSet("+e.toString()+")"}copy(e){const r=new Bt(this.comparator);return r.data=e,r}}class A0{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr{constructor(e){this.fields=e,e.sort(Qt.comparator)}static empty(){return new Rr([])}unionWith(e){let r=new Bt(Qt.comparator);for(const n of this.fields)r=r.add(n);for(const n of e)r=r.add(n);return new Rr(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return Aa(this.fields,e.fields,((r,n)=>r.isEqual(n)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yx extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e){this.binaryString=e}static fromBase64String(e){const r=(function(s){try{return atob(s)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new Yx("Invalid base64 string: "+a):a}})(e);return new er(r)}static fromUint8Array(e){const r=(function(s){let a="";for(let i=0;i<s.length;++i)a+=String.fromCharCode(s[i]);return a})(e);return new er(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(r){return btoa(r)})(this.binaryString)}toUint8Array(){return(function(r){const n=new Uint8Array(r.length);for(let s=0;s<r.length;s++)n[s]=r.charCodeAt(s);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ge(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}er.EMPTY_BYTE_STRING=new er("");const _3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function os(t){if(rt(!!t,39018),typeof t=="string"){let e=0;const r=_3.exec(t);if(rt(!!r,46558,{timestamp:t}),r[1]){let s=r[1];s=(s+"000000000").substr(0,9),e=Number(s)}const n=new Date(t);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Nt(t.seconds),nanos:Nt(t.nanos)}}function Nt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ls(t){return typeof t=="string"?er.fromBase64String(t):er.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kx="server_timestamp",Xx="__type__",Qx="__previous_value__",Jx="__local_write_time__";function Ih(t){return(t?.mapValue?.fields||{})[Xx]?.stringValue===Kx}function ic(t){const e=t.mapValue.fields[Qx];return Ih(e)?ic(e):e}function Mi(t){const e=os(t.mapValue.fields[Jx].timestampValue);return new gt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w3{constructor(e,r,n,s,a,i,l,c,u,h){this.databaseId=e,this.appId=r,this.persistenceKey=n,this.host=s,this.ssl=a,this.forceLongPolling=i,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=u,this.isUsingEmulator=h}}const Al="(default)";class Li{constructor(e,r){this.projectId=e,this.database=r||Al}static empty(){return new Li("","")}get isDefaultDatabase(){return this.database===Al}isEqual(e){return e instanceof Li&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zx="__type__",b3="__max__",Mo={mapValue:{}},e1="__vector__",Sl="value";function cs(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ih(t)?4:T3(t)?9007199254740991:E3(t)?10:11:je(28295,{value:t})}function gn(t,e){if(t===e)return!0;const r=cs(t);if(r!==cs(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Mi(t).isEqual(Mi(e));case 3:return(function(s,a){if(typeof s.timestampValue=="string"&&typeof a.timestampValue=="string"&&s.timestampValue.length===a.timestampValue.length)return s.timestampValue===a.timestampValue;const i=os(s.timestampValue),l=os(a.timestampValue);return i.seconds===l.seconds&&i.nanos===l.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(s,a){return ls(s.bytesValue).isEqual(ls(a.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(s,a){return Nt(s.geoPointValue.latitude)===Nt(a.geoPointValue.latitude)&&Nt(s.geoPointValue.longitude)===Nt(a.geoPointValue.longitude)})(t,e);case 2:return(function(s,a){if("integerValue"in s&&"integerValue"in a)return Nt(s.integerValue)===Nt(a.integerValue);if("doubleValue"in s&&"doubleValue"in a){const i=Nt(s.doubleValue),l=Nt(a.doubleValue);return i===l?Tl(i)===Tl(l):isNaN(i)&&isNaN(l)}return!1})(t,e);case 9:return Aa(t.arrayValue.values||[],e.arrayValue.values||[],gn);case 10:case 11:return(function(s,a){const i=s.mapValue.fields||{},l=a.mapValue.fields||{};if(T0(i)!==T0(l))return!1;for(const c in i)if(i.hasOwnProperty(c)&&(l[c]===void 0||!gn(i[c],l[c])))return!1;return!0})(t,e);default:return je(52216,{left:t})}}function Bi(t,e){return(t.values||[]).find((r=>gn(r,e)))!==void 0}function Sa(t,e){if(t===e)return 0;const r=cs(t),n=cs(e);if(r!==n)return Ge(r,n);switch(r){case 0:case 9007199254740991:return 0;case 1:return Ge(t.booleanValue,e.booleanValue);case 2:return(function(a,i){const l=Nt(a.integerValue||a.doubleValue),c=Nt(i.integerValue||i.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1})(t,e);case 3:return S0(t.timestampValue,e.timestampValue);case 4:return S0(Mi(t),Mi(e));case 5:return bu(t.stringValue,e.stringValue);case 6:return(function(a,i){const l=ls(a),c=ls(i);return l.compareTo(c)})(t.bytesValue,e.bytesValue);case 7:return(function(a,i){const l=a.split("/"),c=i.split("/");for(let u=0;u<l.length&&u<c.length;u++){const h=Ge(l[u],c[u]);if(h!==0)return h}return Ge(l.length,c.length)})(t.referenceValue,e.referenceValue);case 8:return(function(a,i){const l=Ge(Nt(a.latitude),Nt(i.latitude));return l!==0?l:Ge(Nt(a.longitude),Nt(i.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return N0(t.arrayValue,e.arrayValue);case 10:return(function(a,i){const l=a.fields||{},c=i.fields||{},u=l[Sl]?.arrayValue,h=c[Sl]?.arrayValue,f=Ge(u?.values?.length||0,h?.values?.length||0);return f!==0?f:N0(u,h)})(t.mapValue,e.mapValue);case 11:return(function(a,i){if(a===Mo.mapValue&&i===Mo.mapValue)return 0;if(a===Mo.mapValue)return 1;if(i===Mo.mapValue)return-1;const l=a.fields||{},c=Object.keys(l),u=i.fields||{},h=Object.keys(u);c.sort(),h.sort();for(let f=0;f<c.length&&f<h.length;++f){const m=bu(c[f],h[f]);if(m!==0)return m;const p=Sa(l[c[f]],u[h[f]]);if(p!==0)return p}return Ge(c.length,h.length)})(t.mapValue,e.mapValue);default:throw je(23264,{he:r})}}function S0(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Ge(t,e);const r=os(t),n=os(e),s=Ge(r.seconds,n.seconds);return s!==0?s:Ge(r.nanos,n.nanos)}function N0(t,e){const r=t.values||[],n=e.values||[];for(let s=0;s<r.length&&s<n.length;++s){const a=Sa(r[s],n[s]);if(a)return a}return Ge(r.length,n.length)}function Na(t){return Eu(t)}function Eu(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(r){const n=os(r);return`time(${n.seconds},${n.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(r){return ls(r).toBase64()})(t.bytesValue):"referenceValue"in t?(function(r){return De.fromName(r).toString()})(t.referenceValue):"geoPointValue"in t?(function(r){return`geo(${r.latitude},${r.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(r){let n="[",s=!0;for(const a of r.values||[])s?s=!1:n+=",",n+=Eu(a);return n+"]"})(t.arrayValue):"mapValue"in t?(function(r){const n=Object.keys(r.fields||{}).sort();let s="{",a=!0;for(const i of n)a?a=!1:s+=",",s+=`${i}:${Eu(r.fields[i])}`;return s+"}"})(t.mapValue):je(61005,{value:t})}function zo(t){switch(cs(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ic(t);return e?16+zo(e):16;case 5:return 2*t.stringValue.length;case 6:return ls(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((s,a)=>s+zo(a)),0)})(t.arrayValue);case 10:case 11:return(function(n){let s=0;return xs(n.fields,((a,i)=>{s+=a.length+zo(i)})),s})(t.mapValue);default:throw je(13486,{value:t})}}function C0(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Tu(t){return!!t&&"integerValue"in t}function Ph(t){return!!t&&"arrayValue"in t}function I0(t){return!!t&&"nullValue"in t}function P0(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Yo(t){return!!t&&"mapValue"in t}function E3(t){return(t?.mapValue?.fields||{})[Zx]?.stringValue===e1}function vi(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return xs(t.mapValue.fields,((r,n)=>e.mapValue.fields[r]=vi(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=vi(t.arrayValue.values[r]);return e}return{...t}}function T3(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===b3}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r{constructor(e){this.value=e}static empty(){return new _r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let n=0;n<e.length-1;++n)if(r=(r.mapValue.fields||{})[e.get(n)],!Yo(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=vi(r)}setAll(e){let r=Qt.emptyPath(),n={},s=[];e.forEach(((i,l)=>{if(!r.isImmediateParentOf(l)){const c=this.getFieldsMap(r);this.applyChanges(c,n,s),n={},s=[],r=l.popLast()}i?n[l.lastSegment()]=vi(i):s.push(l.lastSegment())}));const a=this.getFieldsMap(r);this.applyChanges(a,n,s)}delete(e){const r=this.field(e.popLast());Yo(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return gn(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=r.mapValue.fields[e.get(n)];Yo(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},r.mapValue.fields[e.get(n)]=s),r=s}return r.mapValue.fields}applyChanges(e,r,n){xs(r,((s,a)=>e[s]=a));for(const s of n)delete e[s]}clone(){return new _r(vi(this.value))}}function t1(t){const e=[];return xs(t.fields,((r,n)=>{const s=new Qt([r]);if(Yo(n)){const a=t1(n.mapValue).fields;if(a.length===0)e.push(s);else for(const i of a)e.push(s.child(i))}else e.push(s)})),new Rr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lr{constructor(e,r,n,s,a,i,l){this.key=e,this.documentType=r,this.version=n,this.readTime=s,this.createTime=a,this.data=i,this.documentState=l}static newInvalidDocument(e){return new lr(e,0,Le.min(),Le.min(),Le.min(),_r.empty(),0)}static newFoundDocument(e,r,n,s){return new lr(e,1,r,Le.min(),n,s,0)}static newNoDocument(e,r){return new lr(e,2,r,Le.min(),Le.min(),_r.empty(),0)}static newUnknownDocument(e,r){return new lr(e,3,r,Le.min(),Le.min(),_r.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(Le.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_r.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_r.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Le.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof lr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new lr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl{constructor(e,r){this.position=e,this.inclusive=r}}function R0(t,e,r){let n=0;for(let s=0;s<t.position.length;s++){const a=e[s],i=t.position[s];if(a.field.isKeyField()?n=De.comparator(De.fromName(i.referenceValue),r.key):n=Sa(i,r.data.field(a.field)),a.dir==="desc"&&(n*=-1),n!==0)break}return n}function D0(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let r=0;r<t.position.length;r++)if(!gn(t.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e,r="asc"){this.field=e,this.dir=r}}function A3(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r1{}class Pt extends r1{constructor(e,r,n){super(),this.field=e,this.op=r,this.value=n}static create(e,r,n){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,n):new N3(e,r,n):r==="array-contains"?new P3(e,n):r==="in"?new R3(e,n):r==="not-in"?new D3(e,n):r==="array-contains-any"?new F3(e,n):new Pt(e,r,n)}static createKeyFieldInFilter(e,r,n){return r==="in"?new C3(e,n):new I3(e,n)}matches(e){const r=e.data.field(this.field);return this.op==="!="?r!==null&&r.nullValue===void 0&&this.matchesComparison(Sa(r,this.value)):r!==null&&cs(this.value)===cs(r)&&this.matchesComparison(Sa(r,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return je(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Qr extends r1{constructor(e,r){super(),this.filters=e,this.op=r,this.Pe=null}static create(e,r){return new Qr(e,r)}matches(e){return n1(this)?this.filters.find((r=>!r.matches(e)))===void 0:this.filters.find((r=>r.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,r)=>e.concat(r.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function n1(t){return t.op==="and"}function s1(t){return S3(t)&&n1(t)}function S3(t){for(const e of t.filters)if(e instanceof Qr)return!1;return!0}function Au(t){if(t instanceof Pt)return t.field.canonicalString()+t.op.toString()+Na(t.value);if(s1(t))return t.filters.map((e=>Au(e))).join(",");{const e=t.filters.map((r=>Au(r))).join(",");return`${t.op}(${e})`}}function a1(t,e){return t instanceof Pt?(function(n,s){return s instanceof Pt&&n.op===s.op&&n.field.isEqual(s.field)&&gn(n.value,s.value)})(t,e):t instanceof Qr?(function(n,s){return s instanceof Qr&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce(((a,i,l)=>a&&a1(i,s.filters[l])),!0):!1})(t,e):void je(19439)}function i1(t){return t instanceof Pt?(function(r){return`${r.field.canonicalString()} ${r.op} ${Na(r.value)}`})(t):t instanceof Qr?(function(r){return r.op.toString()+" {"+r.getFilters().map(i1).join(" ,")+"}"})(t):"Filter"}class N3 extends Pt{constructor(e,r,n){super(e,r,n),this.key=De.fromName(n.referenceValue)}matches(e){const r=De.comparator(e.key,this.key);return this.matchesComparison(r)}}class C3 extends Pt{constructor(e,r){super(e,"in",r),this.keys=o1("in",r)}matches(e){return this.keys.some((r=>r.isEqual(e.key)))}}class I3 extends Pt{constructor(e,r){super(e,"not-in",r),this.keys=o1("not-in",r)}matches(e){return!this.keys.some((r=>r.isEqual(e.key)))}}function o1(t,e){return(e.arrayValue?.values||[]).map((r=>De.fromName(r.referenceValue)))}class P3 extends Pt{constructor(e,r){super(e,"array-contains",r)}matches(e){const r=e.data.field(this.field);return Ph(r)&&Bi(r.arrayValue,this.value)}}class R3 extends Pt{constructor(e,r){super(e,"in",r)}matches(e){const r=e.data.field(this.field);return r!==null&&Bi(this.value.arrayValue,r)}}class D3 extends Pt{constructor(e,r){super(e,"not-in",r)}matches(e){if(Bi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=e.data.field(this.field);return r!==null&&r.nullValue===void 0&&!Bi(this.value.arrayValue,r)}}class F3 extends Pt{constructor(e,r){super(e,"array-contains-any",r)}matches(e){const r=e.data.field(this.field);return!(!Ph(r)||!r.arrayValue.values)&&r.arrayValue.values.some((n=>Bi(this.value.arrayValue,n)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j3{constructor(e,r=null,n=[],s=[],a=null,i=null,l=null){this.path=e,this.collectionGroup=r,this.orderBy=n,this.filters=s,this.limit=a,this.startAt=i,this.endAt=l,this.Te=null}}function F0(t,e=null,r=[],n=[],s=null,a=null,i=null){return new j3(t,e,r,n,s,a,i)}function Rh(t){const e=Be(t);if(e.Te===null){let r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map((n=>Au(n))).join(","),r+="|ob:",r+=e.orderBy.map((n=>(function(a){return a.field.canonicalString()+a.dir})(n))).join(","),ac(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map((n=>Na(n))).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map((n=>Na(n))).join(",")),e.Te=r}return e.Te}function Dh(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<t.orderBy.length;r++)if(!A3(t.orderBy[r],e.orderBy[r]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let r=0;r<t.filters.length;r++)if(!a1(t.filters[r],e.filters[r]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!D0(t.startAt,e.startAt)&&D0(t.endAt,e.endAt)}function Su(t){return De.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e,r=null,n=[],s=[],a=null,i="F",l=null,c=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=n,this.filters=s,this.limit=a,this.limitType=i,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function k3(t,e,r,n,s,a,i,l){return new $a(t,e,r,n,s,a,i,l)}function oc(t){return new $a(t)}function j0(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function l1(t){return t.collectionGroup!==null}function yi(t){const e=Be(t);if(e.Ie===null){e.Ie=[];const r=new Set;for(const a of e.explicitOrderBy)e.Ie.push(a),r.add(a.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(i){let l=new Bt(Qt.comparator);return i.filters.forEach((c=>{c.getFlattenedFilters().forEach((u=>{u.isInequality()&&(l=l.add(u.field))}))})),l})(e).forEach((a=>{r.has(a.canonicalString())||a.isKeyField()||e.Ie.push(new Vi(a,n))})),r.has(Qt.keyField().canonicalString())||e.Ie.push(new Vi(Qt.keyField(),n))}return e.Ie}function un(t){const e=Be(t);return e.Ee||(e.Ee=O3(e,yi(t))),e.Ee}function O3(t,e){if(t.limitType==="F")return F0(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((s=>{const a=s.dir==="desc"?"asc":"desc";return new Vi(s.field,a)}));const r=t.endAt?new Nl(t.endAt.position,t.endAt.inclusive):null,n=t.startAt?new Nl(t.startAt.position,t.startAt.inclusive):null;return F0(t.path,t.collectionGroup,e,t.filters,t.limit,r,n)}}function Nu(t,e){const r=t.filters.concat([e]);return new $a(t.path,t.collectionGroup,t.explicitOrderBy.slice(),r,t.limit,t.limitType,t.startAt,t.endAt)}function Cu(t,e,r){return new $a(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,r,t.startAt,t.endAt)}function lc(t,e){return Dh(un(t),un(e))&&t.limitType===e.limitType}function c1(t){return`${Rh(un(t))}|lt:${t.limitType}`}function oa(t){return`Query(target=${(function(r){let n=r.path.canonicalString();return r.collectionGroup!==null&&(n+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(n+=`, filters: [${r.filters.map((s=>i1(s))).join(", ")}]`),ac(r.limit)||(n+=", limit: "+r.limit),r.orderBy.length>0&&(n+=`, orderBy: [${r.orderBy.map((s=>(function(i){return`${i.field.canonicalString()} (${i.dir})`})(s))).join(", ")}]`),r.startAt&&(n+=", startAt: ",n+=r.startAt.inclusive?"b:":"a:",n+=r.startAt.position.map((s=>Na(s))).join(",")),r.endAt&&(n+=", endAt: ",n+=r.endAt.inclusive?"a:":"b:",n+=r.endAt.position.map((s=>Na(s))).join(",")),`Target(${n})`})(un(t))}; limitType=${t.limitType})`}function cc(t,e){return e.isFoundDocument()&&(function(n,s){const a=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(a):De.isDocumentKey(n.path)?n.path.isEqual(a):n.path.isImmediateParentOf(a)})(t,e)&&(function(n,s){for(const a of yi(n))if(!a.field.isKeyField()&&s.data.field(a.field)===null)return!1;return!0})(t,e)&&(function(n,s){for(const a of n.filters)if(!a.matches(s))return!1;return!0})(t,e)&&(function(n,s){return!(n.startAt&&!(function(i,l,c){const u=R0(i,l,c);return i.inclusive?u<=0:u<0})(n.startAt,yi(n),s)||n.endAt&&!(function(i,l,c){const u=R0(i,l,c);return i.inclusive?u>=0:u>0})(n.endAt,yi(n),s))})(t,e)}function M3(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function u1(t){return(e,r)=>{let n=!1;for(const s of yi(t)){const a=L3(s,e,r);if(a!==0)return a;n=n||s.field.isKeyField()}return 0}}function L3(t,e,r){const n=t.field.isKeyField()?De.comparator(e.key,r.key):(function(a,i,l){const c=i.data.field(a),u=l.data.field(a);return c!==null&&u!==null?Sa(c,u):je(42886)})(t.field,e,r);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return je(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(e,r){this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0}get(e){const r=this.mapKeyFn(e),n=this.inner[r];if(n!==void 0){for(const[s,a]of n)if(this.equalsFn(s,e))return a}}has(e){return this.get(e)!==void 0}set(e,r){const n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return this.inner[n]=[[e,r]],void this.innerSize++;for(let a=0;a<s.length;a++)if(this.equalsFn(s[a][0],e))return void(s[a]=[e,r]);s.push([e,r]),this.innerSize++}delete(e){const r=this.mapKeyFn(e),n=this.inner[r];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return n.length===1?delete this.inner[r]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){xs(this.inner,((r,n)=>{for(const[s,a]of n)e(s,a)}))}isEmpty(){return zx(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B3=new _t(De.comparator);function jn(){return B3}const h1=new _t(De.comparator);function ii(...t){let e=h1;for(const r of t)e=e.insert(r.key,r);return e}function d1(t){let e=h1;return t.forEach(((r,n)=>e=e.insert(r,n.overlayedDocument))),e}function Is(){return _i()}function f1(){return _i()}function _i(){return new zs((t=>t.toString()),((t,e)=>t.isEqual(e)))}const V3=new _t(De.comparator),U3=new Bt(De.comparator);function ze(...t){let e=U3;for(const r of t)e=e.add(r);return e}const $3=new Bt(Ge);function H3(){return $3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fh(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Tl(e)?"-0":e}}function m1(t){return{integerValue:""+t}}function W3(t,e){return x3(e)?m1(e):Fh(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uc{constructor(){this._=void 0}}function q3(t,e,r){return t instanceof Ui?(function(s,a){const i={fields:{[Xx]:{stringValue:Kx},[Jx]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return a&&Ih(a)&&(a=ic(a)),a&&(i.fields[Qx]=a),{mapValue:i}})(r,e):t instanceof $i?g1(t,e):t instanceof Hi?x1(t,e):(function(s,a){const i=p1(s,a),l=k0(i)+k0(s.Ae);return Tu(i)&&Tu(s.Ae)?m1(l):Fh(s.serializer,l)})(t,e)}function G3(t,e,r){return t instanceof $i?g1(t,e):t instanceof Hi?x1(t,e):r}function p1(t,e){return t instanceof Cl?(function(n){return Tu(n)||(function(a){return!!a&&"doubleValue"in a})(n)})(e)?e:{integerValue:0}:null}class Ui extends uc{}class $i extends uc{constructor(e){super(),this.elements=e}}function g1(t,e){const r=v1(e);for(const n of t.elements)r.some((s=>gn(s,n)))||r.push(n);return{arrayValue:{values:r}}}class Hi extends uc{constructor(e){super(),this.elements=e}}function x1(t,e){let r=v1(e);for(const n of t.elements)r=r.filter((s=>!gn(s,n)));return{arrayValue:{values:r}}}class Cl extends uc{constructor(e,r){super(),this.serializer=e,this.Ae=r}}function k0(t){return Nt(t.integerValue||t.doubleValue)}function v1(t){return Ph(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z3{constructor(e,r){this.field=e,this.transform=r}}function Y3(t,e){return t.field.isEqual(e.field)&&(function(n,s){return n instanceof $i&&s instanceof $i||n instanceof Hi&&s instanceof Hi?Aa(n.elements,s.elements,gn):n instanceof Cl&&s instanceof Cl?gn(n.Ae,s.Ae):n instanceof Ui&&s instanceof Ui})(t.transform,e.transform)}class K3{constructor(e,r){this.version=e,this.transformResults=r}}class jr{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new jr}static exists(e){return new jr(void 0,e)}static updateTime(e){return new jr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ko(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class hc{}function y1(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new jh(t.key,jr.none()):new no(t.key,t.data,jr.none());{const r=t.data,n=_r.empty();let s=new Bt(Qt.comparator);for(let a of e.fields)if(!s.has(a)){let i=r.field(a);i===null&&a.length>1&&(a=a.popLast(),i=r.field(a)),i===null?n.delete(a):n.set(a,i),s=s.add(a)}return new vs(t.key,n,new Rr(s.toArray()),jr.none())}}function X3(t,e,r){t instanceof no?(function(s,a,i){const l=s.value.clone(),c=M0(s.fieldTransforms,a,i.transformResults);l.setAll(c),a.convertToFoundDocument(i.version,l).setHasCommittedMutations()})(t,e,r):t instanceof vs?(function(s,a,i){if(!Ko(s.precondition,a))return void a.convertToUnknownDocument(i.version);const l=M0(s.fieldTransforms,a,i.transformResults),c=a.data;c.setAll(_1(s)),c.setAll(l),a.convertToFoundDocument(i.version,c).setHasCommittedMutations()})(t,e,r):(function(s,a,i){a.convertToNoDocument(i.version).setHasCommittedMutations()})(0,e,r)}function wi(t,e,r,n){return t instanceof no?(function(a,i,l,c){if(!Ko(a.precondition,i))return l;const u=a.value.clone(),h=L0(a.fieldTransforms,c,i);return u.setAll(h),i.convertToFoundDocument(i.version,u).setHasLocalMutations(),null})(t,e,r,n):t instanceof vs?(function(a,i,l,c){if(!Ko(a.precondition,i))return l;const u=L0(a.fieldTransforms,c,i),h=i.data;return h.setAll(_1(a)),h.setAll(u),i.convertToFoundDocument(i.version,h).setHasLocalMutations(),l===null?null:l.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map((f=>f.field)))})(t,e,r,n):(function(a,i,l){return Ko(a.precondition,i)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):l})(t,e,r)}function Q3(t,e){let r=null;for(const n of t.fieldTransforms){const s=e.data.field(n.field),a=p1(n.transform,s||null);a!=null&&(r===null&&(r=_r.empty()),r.set(n.field,a))}return r||null}function O0(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&Aa(n,s,((a,i)=>Y3(a,i)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class no extends hc{constructor(e,r,n,s=[]){super(),this.key=e,this.value=r,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class vs extends hc{constructor(e,r,n,s,a=[]){super(),this.key=e,this.data=r,this.fieldMask=n,this.precondition=s,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function _1(t){const e=new Map;return t.fieldMask.fields.forEach((r=>{if(!r.isEmpty()){const n=t.data.field(r);e.set(r,n)}})),e}function M0(t,e,r){const n=new Map;rt(t.length===r.length,32656,{Re:r.length,Ve:t.length});for(let s=0;s<r.length;s++){const a=t[s],i=a.transform,l=e.data.field(a.field);n.set(a.field,G3(i,l,r[s]))}return n}function L0(t,e,r){const n=new Map;for(const s of t){const a=s.transform,i=r.data.field(s.field);n.set(s.field,q3(a,i,e))}return n}class jh extends hc{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class J3 extends hc{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z3{constructor(e,r,n,s){this.batchId=e,this.localWriteTime=r,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,r){const n=r.mutationResults;for(let s=0;s<this.mutations.length;s++){const a=this.mutations[s];a.key.isEqual(e.key)&&X3(a,e,n[s])}}applyToLocalView(e,r){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(r=wi(n,e,r,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(r=wi(n,e,r,this.localWriteTime));return r}applyToLocalDocumentSet(e,r){const n=f1();return this.mutations.forEach((s=>{const a=e.get(s.key),i=a.overlayedDocument;let l=this.applyToLocalView(i,a.mutatedFields);l=r.has(s.key)?null:l;const c=y1(i,l);c!==null&&n.set(s.key,c),i.isValidDocument()||i.convertToNoDocument(Le.min())})),n}keys(){return this.mutations.reduce(((e,r)=>e.add(r.key)),ze())}isEqual(e){return this.batchId===e.batchId&&Aa(this.mutations,e.mutations,((r,n)=>O0(r,n)))&&Aa(this.baseMutations,e.baseMutations,((r,n)=>O0(r,n)))}}class kh{constructor(e,r,n,s){this.batch=e,this.commitVersion=r,this.mutationResults=n,this.docVersions=s}static from(e,r,n){rt(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let s=(function(){return V3})();const a=e.mutations;for(let i=0;i<a.length;i++)s=s.insert(a[i].key,n[i].version);return new kh(e,r,n,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eF{constructor(e,r){this.largestBatchId=e,this.mutation=r}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tF{constructor(e,r){this.count=e,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var It,Ye;function rF(t){switch(t){case ne.OK:return je(64938);case ne.CANCELLED:case ne.UNKNOWN:case ne.DEADLINE_EXCEEDED:case ne.RESOURCE_EXHAUSTED:case ne.INTERNAL:case ne.UNAVAILABLE:case ne.UNAUTHENTICATED:return!1;case ne.INVALID_ARGUMENT:case ne.NOT_FOUND:case ne.ALREADY_EXISTS:case ne.PERMISSION_DENIED:case ne.FAILED_PRECONDITION:case ne.ABORTED:case ne.OUT_OF_RANGE:case ne.UNIMPLEMENTED:case ne.DATA_LOSS:return!0;default:return je(15467,{code:t})}}function w1(t){if(t===void 0)return Fn("GRPC error has no .code"),ne.UNKNOWN;switch(t){case It.OK:return ne.OK;case It.CANCELLED:return ne.CANCELLED;case It.UNKNOWN:return ne.UNKNOWN;case It.DEADLINE_EXCEEDED:return ne.DEADLINE_EXCEEDED;case It.RESOURCE_EXHAUSTED:return ne.RESOURCE_EXHAUSTED;case It.INTERNAL:return ne.INTERNAL;case It.UNAVAILABLE:return ne.UNAVAILABLE;case It.UNAUTHENTICATED:return ne.UNAUTHENTICATED;case It.INVALID_ARGUMENT:return ne.INVALID_ARGUMENT;case It.NOT_FOUND:return ne.NOT_FOUND;case It.ALREADY_EXISTS:return ne.ALREADY_EXISTS;case It.PERMISSION_DENIED:return ne.PERMISSION_DENIED;case It.FAILED_PRECONDITION:return ne.FAILED_PRECONDITION;case It.ABORTED:return ne.ABORTED;case It.OUT_OF_RANGE:return ne.OUT_OF_RANGE;case It.UNIMPLEMENTED:return ne.UNIMPLEMENTED;case It.DATA_LOSS:return ne.DATA_LOSS;default:return je(39323,{code:t})}}(Ye=It||(It={}))[Ye.OK=0]="OK",Ye[Ye.CANCELLED=1]="CANCELLED",Ye[Ye.UNKNOWN=2]="UNKNOWN",Ye[Ye.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ye[Ye.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ye[Ye.NOT_FOUND=5]="NOT_FOUND",Ye[Ye.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ye[Ye.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ye[Ye.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ye[Ye.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ye[Ye.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ye[Ye.ABORTED=10]="ABORTED",Ye[Ye.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ye[Ye.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ye[Ye.INTERNAL=13]="INTERNAL",Ye[Ye.UNAVAILABLE=14]="UNAVAILABLE",Ye[Ye.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nF(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sF=new Jn([4294967295,4294967295],0);function B0(t){const e=nF().encode(t),r=new Ox;return r.update(e),new Uint8Array(r.digest())}function V0(t){const e=new DataView(t.buffer),r=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new Jn([r,n],0),new Jn([s,a],0)]}class Oh{constructor(e,r,n){if(this.bitmap=e,this.padding=r,this.hashCount=n,r<0||r>=8)throw new oi(`Invalid padding: ${r}`);if(n<0)throw new oi(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new oi(`Invalid hash count: ${n}`);if(e.length===0&&r!==0)throw new oi(`Invalid padding when bitmap length is 0: ${r}`);this.ge=8*e.length-r,this.pe=Jn.fromNumber(this.ge)}ye(e,r,n){let s=e.add(r.multiply(Jn.fromNumber(n)));return s.compare(sF)===1&&(s=new Jn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const r=B0(e),[n,s]=V0(r);for(let a=0;a<this.hashCount;a++){const i=this.ye(n,s,a);if(!this.we(i))return!1}return!0}static create(e,r,n){const s=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),i=new Oh(a,s,r);return n.forEach((l=>i.insert(l))),i}insert(e){if(this.ge===0)return;const r=B0(e),[n,s]=V0(r);for(let a=0;a<this.hashCount;a++){const i=this.ye(n,s,a);this.Se(i)}}Se(e){const r=Math.floor(e/8),n=e%8;this.bitmap[r]|=1<<n}}class oi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dc{constructor(e,r,n,s,a){this.snapshotVersion=e,this.targetChanges=r,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,r,n){const s=new Map;return s.set(e,so.createSynthesizedTargetChangeForCurrentChange(e,r,n)),new dc(Le.min(),s,new _t(Ge),jn(),ze())}}class so{constructor(e,r,n,s,a){this.resumeToken=e,this.current=r,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,r,n){return new so(n,r,ze(),ze(),ze())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(e,r,n,s){this.be=e,this.removedTargetIds=r,this.key=n,this.De=s}}class b1{constructor(e,r){this.targetId=e,this.Ce=r}}class E1{constructor(e,r,n=er.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=r,this.resumeToken=n,this.cause=s}}class U0{constructor(){this.ve=0,this.Fe=$0(),this.Me=er.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ze(),r=ze(),n=ze();return this.Fe.forEach(((s,a)=>{switch(a){case 0:e=e.add(s);break;case 2:r=r.add(s);break;case 1:n=n.add(s);break;default:je(38017,{changeType:a})}})),new so(this.Me,this.xe,e,r,n)}qe(){this.Oe=!1,this.Fe=$0()}Qe(e,r){this.Oe=!0,this.Fe=this.Fe.insert(e,r)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,rt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class aF{constructor(e){this.Ge=e,this.ze=new Map,this.je=jn(),this.Je=Lo(),this.He=Lo(),this.Ye=new _t(Ge)}Ze(e){for(const r of e.be)e.De&&e.De.isFoundDocument()?this.Xe(r,e.De):this.et(r,e.key,e.De);for(const r of e.removedTargetIds)this.et(r,e.key,e.De)}tt(e){this.forEachTarget(e,(r=>{const n=this.nt(r);switch(e.state){case 0:this.rt(r)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(r);break;case 3:this.rt(r)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(r)&&(this.it(r),n.Le(e.resumeToken));break;default:je(56790,{state:e.state})}}))}forEachTarget(e,r){e.targetIds.length>0?e.targetIds.forEach(r):this.ze.forEach(((n,s)=>{this.rt(s)&&r(s)}))}st(e){const r=e.targetId,n=e.Ce.count,s=this.ot(r);if(s){const a=s.target;if(Su(a))if(n===0){const i=new De(a.path);this.et(r,i,lr.newNoDocument(i,Le.min()))}else rt(n===1,20013,{expectedCount:n});else{const i=this._t(r);if(i!==n){const l=this.ut(e),c=l?this.ct(l,e,i):1;if(c!==0){this.it(r);const u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(r,u)}}}}}ut(e){const r=e.Ce.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:a=0}=r;let i,l;try{i=ls(n).toUint8Array()}catch(c){if(c instanceof Yx)return Ta("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new Oh(i,s,a)}catch(c){return Ta(c instanceof oi?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,r,n){return r.Ce.count===n-this.Pt(e,r.targetId)?0:2}Pt(e,r){const n=this.Ge.getRemoteKeysForTarget(r);let s=0;return n.forEach((a=>{const i=this.Ge.ht(),l=`projects/${i.projectId}/databases/${i.database}/documents/${a.path.canonicalString()}`;e.mightContain(l)||(this.et(r,a,null),s++)})),s}Tt(e){const r=new Map;this.ze.forEach(((a,i)=>{const l=this.ot(i);if(l){if(a.current&&Su(l.target)){const c=new De(l.target.path);this.It(c).has(i)||this.Et(i,c)||this.et(i,c,lr.newNoDocument(c,e))}a.Be&&(r.set(i,a.ke()),a.qe())}}));let n=ze();this.He.forEach(((a,i)=>{let l=!0;i.forEachWhile((c=>{const u=this.ot(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(n=n.add(a))})),this.je.forEach(((a,i)=>i.setReadTime(e)));const s=new dc(e,r,this.Ye,this.je,n);return this.je=jn(),this.Je=Lo(),this.He=Lo(),this.Ye=new _t(Ge),s}Xe(e,r){if(!this.rt(e))return;const n=this.Et(e,r.key)?2:0;this.nt(e).Qe(r.key,n),this.je=this.je.insert(r.key,r),this.Je=this.Je.insert(r.key,this.It(r.key).add(e)),this.He=this.He.insert(r.key,this.dt(r.key).add(e))}et(e,r,n){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,r)?s.Qe(r,1):s.$e(r),this.He=this.He.insert(r,this.dt(r).delete(e)),this.He=this.He.insert(r,this.dt(r).add(e)),n&&(this.je=this.je.insert(r,n))}removeTarget(e){this.ze.delete(e)}_t(e){const r=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let r=this.ze.get(e);return r||(r=new U0,this.ze.set(e,r)),r}dt(e){let r=this.He.get(e);return r||(r=new Bt(Ge),this.He=this.He.insert(e,r)),r}It(e){let r=this.Je.get(e);return r||(r=new Bt(Ge),this.Je=this.Je.insert(e,r)),r}rt(e){const r=this.ot(e)!==null;return r||Ie("WatchChangeAggregator","Detected inactive target",e),r}ot(e){const r=this.ze.get(e);return r&&r.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new U0),this.Ge.getRemoteKeysForTarget(e).forEach((r=>{this.et(e,r,null)}))}Et(e,r){return this.Ge.getRemoteKeysForTarget(e).has(r)}}function Lo(){return new _t(De.comparator)}function $0(){return new _t(De.comparator)}const iF={asc:"ASCENDING",desc:"DESCENDING"},oF={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},lF={and:"AND",or:"OR"};class cF{constructor(e,r){this.databaseId=e,this.useProto3Json=r}}function Iu(t,e){return t.useProto3Json||ac(e)?e:{value:e}}function Il(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function T1(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function uF(t,e){return Il(t,e.toTimestamp())}function hn(t){return rt(!!t,49232),Le.fromTimestamp((function(r){const n=os(r);return new gt(n.seconds,n.nanos)})(t))}function Mh(t,e){return Pu(t,e).canonicalString()}function Pu(t,e){const r=(function(s){return new mt(["projects",s.projectId,"databases",s.database])})(t).child("documents");return e===void 0?r:r.child(e)}function A1(t){const e=mt.fromString(t);return rt(P1(e),10190,{key:e.toString()}),e}function Ru(t,e){return Mh(t.databaseId,e.path)}function Yc(t,e){const r=A1(e);if(r.get(1)!==t.databaseId.projectId)throw new Te(ne.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+t.databaseId.projectId);if(r.get(3)!==t.databaseId.database)throw new Te(ne.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+t.databaseId.database);return new De(N1(r))}function S1(t,e){return Mh(t.databaseId,e)}function hF(t){const e=A1(t);return e.length===4?mt.emptyPath():N1(e)}function Du(t){return new mt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function N1(t){return rt(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function H0(t,e,r){return{name:Ru(t,e),fields:r.value.mapValue.fields}}function dF(t,e){let r;if("targetChange"in e){e.targetChange;const n=(function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:je(39313,{state:u})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],a=(function(u,h){return u.useProto3Json?(rt(h===void 0||typeof h=="string",58123),er.fromBase64String(h||"")):(rt(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),er.fromUint8Array(h||new Uint8Array))})(t,e.targetChange.resumeToken),i=e.targetChange.cause,l=i&&(function(u){const h=u.code===void 0?ne.UNKNOWN:w1(u.code);return new Te(h,u.message||"")})(i);r=new E1(n,s,a,l||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const s=Yc(t,n.document.name),a=hn(n.document.updateTime),i=n.document.createTime?hn(n.document.createTime):Le.min(),l=new _r({mapValue:{fields:n.document.fields}}),c=lr.newFoundDocument(s,a,i,l),u=n.targetIds||[],h=n.removedTargetIds||[];r=new Xo(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const s=Yc(t,n.document),a=n.readTime?hn(n.readTime):Le.min(),i=lr.newNoDocument(s,a),l=n.removedTargetIds||[];r=new Xo([],l,i.key,i)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const s=Yc(t,n.document),a=n.removedTargetIds||[];r=new Xo([],a,s,null)}else{if(!("filter"in e))return je(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:s=0,unchangedNames:a}=n,i=new tF(s,a),l=n.targetId;r=new b1(l,i)}}return r}function fF(t,e){let r;if(e instanceof no)r={update:H0(t,e.key,e.value)};else if(e instanceof jh)r={delete:Ru(t,e.key)};else if(e instanceof vs)r={update:H0(t,e.key,e.data),updateMask:bF(e.fieldMask)};else{if(!(e instanceof J3))return je(16599,{Vt:e.type});r={verify:Ru(t,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map((n=>(function(a,i){const l=i.transform;if(l instanceof Ui)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof $i)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Hi)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Cl)return{fieldPath:i.field.canonicalString(),increment:l.Ae};throw je(20930,{transform:i.transform})})(0,n)))),e.precondition.isNone||(r.currentDocument=(function(s,a){return a.updateTime!==void 0?{updateTime:uF(s,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:je(27497)})(t,e.precondition)),r}function mF(t,e){return t&&t.length>0?(rt(e!==void 0,14353),t.map((r=>(function(s,a){let i=s.updateTime?hn(s.updateTime):hn(a);return i.isEqual(Le.min())&&(i=hn(a)),new K3(i,s.transformResults||[])})(r,e)))):[]}function pF(t,e){return{documents:[S1(t,e.path)]}}function gF(t,e){const r={structuredQuery:{}},n=e.path;let s;e.collectionGroup!==null?(s=n,r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),r.structuredQuery.from=[{collectionId:n.lastSegment()}]),r.parent=S1(t,s);const a=(function(u){if(u.length!==0)return I1(Qr.create(u,"and"))})(e.filters);a&&(r.structuredQuery.where=a);const i=(function(u){if(u.length!==0)return u.map((h=>(function(m){return{field:la(m.field),direction:yF(m.dir)}})(h)))})(e.orderBy);i&&(r.structuredQuery.orderBy=i);const l=Iu(t,e.limit);return l!==null&&(r.structuredQuery.limit=l),e.startAt&&(r.structuredQuery.startAt=(function(u){return{before:u.inclusive,values:u.position}})(e.startAt)),e.endAt&&(r.structuredQuery.endAt=(function(u){return{before:!u.inclusive,values:u.position}})(e.endAt)),{ft:r,parent:s}}function xF(t){let e=hF(t.parent);const r=t.structuredQuery,n=r.from?r.from.length:0;let s=null;if(n>0){rt(n===1,65062);const h=r.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let a=[];r.where&&(a=(function(f){const m=C1(f);return m instanceof Qr&&s1(m)?m.getFilters():[m]})(r.where));let i=[];r.orderBy&&(i=(function(f){return f.map((m=>(function(x){return new Vi(ca(x.field),(function(y){switch(y){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(x.direction))})(m)))})(r.orderBy));let l=null;r.limit&&(l=(function(f){let m;return m=typeof f=="object"?f.value:f,ac(m)?null:m})(r.limit));let c=null;r.startAt&&(c=(function(f){const m=!!f.before,p=f.values||[];return new Nl(p,m)})(r.startAt));let u=null;return r.endAt&&(u=(function(f){const m=!f.before,p=f.values||[];return new Nl(p,m)})(r.endAt)),k3(e,s,i,a,l,"F",c,u)}function vF(t,e){const r=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return je(28987,{purpose:s})}})(e.purpose);return r==null?null:{"goog-listen-tags":r}}function C1(t){return t.unaryFilter!==void 0?(function(r){switch(r.unaryFilter.op){case"IS_NAN":const n=ca(r.unaryFilter.field);return Pt.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=ca(r.unaryFilter.field);return Pt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=ca(r.unaryFilter.field);return Pt.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=ca(r.unaryFilter.field);return Pt.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return je(61313);default:return je(60726)}})(t):t.fieldFilter!==void 0?(function(r){return Pt.create(ca(r.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return je(58110);default:return je(50506)}})(r.fieldFilter.op),r.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(r){return Qr.create(r.compositeFilter.filters.map((n=>C1(n))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return je(1026)}})(r.compositeFilter.op))})(t):je(30097,{filter:t})}function yF(t){return iF[t]}function _F(t){return oF[t]}function wF(t){return lF[t]}function la(t){return{fieldPath:t.canonicalString()}}function ca(t){return Qt.fromServerFormat(t.fieldPath)}function I1(t){return t instanceof Pt?(function(r){if(r.op==="=="){if(P0(r.value))return{unaryFilter:{field:la(r.field),op:"IS_NAN"}};if(I0(r.value))return{unaryFilter:{field:la(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(P0(r.value))return{unaryFilter:{field:la(r.field),op:"IS_NOT_NAN"}};if(I0(r.value))return{unaryFilter:{field:la(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:la(r.field),op:_F(r.op),value:r.value}}})(t):t instanceof Qr?(function(r){const n=r.getFilters().map((s=>I1(s)));return n.length===1?n[0]:{compositeFilter:{op:wF(r.op),filters:n}}})(t):je(54877,{filter:t})}function bF(t){const e=[];return t.fields.forEach((r=>e.push(r.canonicalString()))),{fieldPaths:e}}function P1(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(e,r,n,s,a=Le.min(),i=Le.min(),l=er.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=r,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new Kn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,r){return new Kn(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Kn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Kn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(e){this.yt=e}}function TF(t){const e=xF({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Cu(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AF{constructor(){this.Cn=new SF}addToCollectionParentIndex(e,r){return this.Cn.add(r),ie.resolve()}getCollectionParents(e,r){return ie.resolve(this.Cn.getEntries(r))}addFieldIndex(e,r){return ie.resolve()}deleteFieldIndex(e,r){return ie.resolve()}deleteAllFieldIndexes(e){return ie.resolve()}createTargetIndexes(e,r){return ie.resolve()}getDocumentsMatchingTarget(e,r){return ie.resolve(null)}getIndexType(e,r){return ie.resolve(0)}getFieldIndexes(e,r){return ie.resolve([])}getNextCollectionGroupToUpdate(e){return ie.resolve(null)}getMinOffset(e,r){return ie.resolve(is.min())}getMinOffsetFromCollectionGroup(e,r){return ie.resolve(is.min())}updateCollectionGroup(e,r,n){return ie.resolve()}updateIndexEntries(e,r){return ie.resolve()}}class SF{constructor(){this.index={}}add(e){const r=e.lastSegment(),n=e.popLast(),s=this.index[r]||new Bt(mt.comparator),a=!s.has(n);return this.index[r]=s.add(n),a}has(e){const r=e.lastSegment(),n=e.popLast(),s=this.index[r];return s&&s.has(n)}getEntries(e){return(this.index[e]||new Bt(mt.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W0={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},R1=41943040;class yr{static withCacheSize(e){return new yr(e,yr.DEFAULT_COLLECTION_PERCENTILE,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,r,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=r,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yr.DEFAULT_COLLECTION_PERCENTILE=10,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yr.DEFAULT=new yr(R1,yr.DEFAULT_COLLECTION_PERCENTILE,yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yr.DISABLED=new yr(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ca(0)}static cr(){return new Ca(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q0="LruGarbageCollector",NF=1048576;function G0([t,e],[r,n]){const s=Ge(t,r);return s===0?Ge(e,n):s}class CF{constructor(e){this.Ir=e,this.buffer=new Bt(G0),this.Er=0}dr(){return++this.Er}Ar(e){const r=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(r);else{const n=this.buffer.last();G0(r,n)<0&&(this.buffer=this.buffer.delete(n).add(r))}}get maxValue(){return this.buffer.last()[0]}}class IF{constructor(e,r,n){this.garbageCollector=e,this.asyncQueue=r,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ie(q0,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(r){Ua(r)?Ie(q0,"Ignoring IndexedDB error during garbage collection: ",r):await Va(r)}await this.Vr(3e5)}))}}class PF{constructor(e,r){this.mr=e,this.params=r}calculateTargetCount(e,r){return this.mr.gr(e).next((n=>Math.floor(r/100*n)))}nthSequenceNumber(e,r){if(r===0)return ie.resolve(sc.ce);const n=new CF(r);return this.mr.forEachTarget(e,(s=>n.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>n.Ar(s))))).next((()=>n.maxValue))}removeTargets(e,r,n){return this.mr.removeTargets(e,r,n)}removeOrphanedDocuments(e,r){return this.mr.removeOrphanedDocuments(e,r)}collect(e,r){return this.params.cacheSizeCollectionThreshold===-1?(Ie("LruGarbageCollector","Garbage collection skipped; disabled"),ie.resolve(W0)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(Ie("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),W0):this.yr(e,r)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,r){let n,s,a,i,l,c,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((f=>(f>this.params.maximumSequenceNumbersToCollect?(Ie("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,i=Date.now(),this.nthSequenceNumber(e,s)))).next((f=>(n=f,l=Date.now(),this.removeTargets(e,n,r)))).next((f=>(a=f,c=Date.now(),this.removeOrphanedDocuments(e,n)))).next((f=>(u=Date.now(),ia()<=Ke.DEBUG&&Ie("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${i-h}ms
	Determined least recently used ${s} in `+(l-i)+`ms
	Removed ${a} targets in `+(c-l)+`ms
	Removed ${f} documents in `+(u-c)+`ms
Total Duration: ${u-h}ms`),ie.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:a,documentsRemoved:f}))))}}function RF(t,e){return new PF(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DF{constructor(){this.changes=new zs((e=>e.toString()),((e,r)=>e.isEqual(r))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,r){this.assertNotApplied(),this.changes.set(e,lr.newInvalidDocument(e).setReadTime(r))}getEntry(e,r){this.assertNotApplied();const n=this.changes.get(r);return n!==void 0?ie.resolve(n):this.getFromCache(e,r)}getEntries(e,r){return this.getAllFromCache(e,r)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FF{constructor(e,r){this.overlayedDocument=e,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jF{constructor(e,r,n,s){this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,r){let n=null;return this.documentOverlayCache.getOverlay(e,r).next((s=>(n=s,this.remoteDocumentCache.getEntry(e,r)))).next((s=>(n!==null&&wi(n.mutation,s,Rr.empty(),gt.now()),s)))}getDocuments(e,r){return this.remoteDocumentCache.getEntries(e,r).next((n=>this.getLocalViewOfDocuments(e,n,ze()).next((()=>n))))}getLocalViewOfDocuments(e,r,n=ze()){const s=Is();return this.populateOverlays(e,s,r).next((()=>this.computeViews(e,r,s,n).next((a=>{let i=ii();return a.forEach(((l,c)=>{i=i.insert(l,c.overlayedDocument)})),i}))))}getOverlayedDocuments(e,r){const n=Is();return this.populateOverlays(e,n,r).next((()=>this.computeViews(e,r,n,ze())))}populateOverlays(e,r,n){const s=[];return n.forEach((a=>{r.has(a)||s.push(a)})),this.documentOverlayCache.getOverlays(e,s).next((a=>{a.forEach(((i,l)=>{r.set(i,l)}))}))}computeViews(e,r,n,s){let a=jn();const i=_i(),l=(function(){return _i()})();return r.forEach(((c,u)=>{const h=n.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof vs)?a=a.insert(u.key,u):h!==void 0?(i.set(u.key,h.mutation.getFieldMask()),wi(h.mutation,u,h.mutation.getFieldMask(),gt.now())):i.set(u.key,Rr.empty())})),this.recalculateAndSaveOverlays(e,a).next((c=>(c.forEach(((u,h)=>i.set(u,h))),r.forEach(((u,h)=>l.set(u,new FF(h,i.get(u)??null)))),l)))}recalculateAndSaveOverlays(e,r){const n=_i();let s=new _t(((i,l)=>i-l)),a=ze();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,r).next((i=>{for(const l of i)l.keys().forEach((c=>{const u=r.get(c);if(u===null)return;let h=n.get(c)||Rr.empty();h=l.applyToLocalView(u,h),n.set(c,h);const f=(s.get(l.batchId)||ze()).add(c);s=s.insert(l.batchId,f)}))})).next((()=>{const i=[],l=s.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),u=c.key,h=c.value,f=f1();h.forEach((m=>{if(!a.has(m)){const p=y1(r.get(m),n.get(m));p!==null&&f.set(m,p),a=a.add(m)}})),i.push(this.documentOverlayCache.saveOverlays(e,u,f))}return ie.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,r){return this.remoteDocumentCache.getEntries(e,r).next((n=>this.recalculateAndSaveOverlays(e,n)))}getDocumentsMatchingQuery(e,r,n,s){return(function(i){return De.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0})(r)?this.getDocumentsMatchingDocumentQuery(e,r.path):l1(r)?this.getDocumentsMatchingCollectionGroupQuery(e,r,n,s):this.getDocumentsMatchingCollectionQuery(e,r,n,s)}getNextDocuments(e,r,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,r,n,s).next((a=>{const i=s-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,r,n.largestBatchId,s-a.size):ie.resolve(Is());let l=Oi,c=a;return i.next((u=>ie.forEach(u,((h,f)=>(l<f.largestBatchId&&(l=f.largestBatchId),a.get(h)?ie.resolve():this.remoteDocumentCache.getEntry(e,h).next((m=>{c=c.insert(h,m)}))))).next((()=>this.populateOverlays(e,u,a))).next((()=>this.computeViews(e,c,u,ze()))).next((h=>({batchId:l,changes:d1(h)})))))}))}getDocumentsMatchingDocumentQuery(e,r){return this.getDocument(e,new De(r)).next((n=>{let s=ii();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s}))}getDocumentsMatchingCollectionGroupQuery(e,r,n,s){const a=r.collectionGroup;let i=ii();return this.indexManager.getCollectionParents(e,a).next((l=>ie.forEach(l,(c=>{const u=(function(f,m){return new $a(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)})(r,c.child(a));return this.getDocumentsMatchingCollectionQuery(e,u,n,s).next((h=>{h.forEach(((f,m)=>{i=i.insert(f,m)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,r,n,s){let a;return this.documentOverlayCache.getOverlaysForCollection(e,r.path,n.largestBatchId).next((i=>(a=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,r,n,a,s)))).next((i=>{a.forEach(((c,u)=>{const h=u.getKey();i.get(h)===null&&(i=i.insert(h,lr.newInvalidDocument(h)))}));let l=ii();return i.forEach(((c,u)=>{const h=a.get(c);h!==void 0&&wi(h.mutation,u,Rr.empty(),gt.now()),cc(r,u)&&(l=l.insert(c,u))})),l}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kF{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,r){return ie.resolve(this.Lr.get(r))}saveBundleMetadata(e,r){return this.Lr.set(r.id,(function(s){return{id:s.id,version:s.version,createTime:hn(s.createTime)}})(r)),ie.resolve()}getNamedQuery(e,r){return ie.resolve(this.kr.get(r))}saveNamedQuery(e,r){return this.kr.set(r.name,(function(s){return{name:s.name,query:TF(s.bundledQuery),readTime:hn(s.readTime)}})(r)),ie.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OF{constructor(){this.overlays=new _t(De.comparator),this.qr=new Map}getOverlay(e,r){return ie.resolve(this.overlays.get(r))}getOverlays(e,r){const n=Is();return ie.forEach(r,(s=>this.getOverlay(e,s).next((a=>{a!==null&&n.set(s,a)})))).next((()=>n))}saveOverlays(e,r,n){return n.forEach(((s,a)=>{this.St(e,r,a)})),ie.resolve()}removeOverlaysForBatchId(e,r,n){const s=this.qr.get(n);return s!==void 0&&(s.forEach((a=>this.overlays=this.overlays.remove(a))),this.qr.delete(n)),ie.resolve()}getOverlaysForCollection(e,r,n){const s=Is(),a=r.length+1,i=new De(r.child("")),l=this.overlays.getIteratorFrom(i);for(;l.hasNext();){const c=l.getNext().value,u=c.getKey();if(!r.isPrefixOf(u.path))break;u.path.length===a&&c.largestBatchId>n&&s.set(c.getKey(),c)}return ie.resolve(s)}getOverlaysForCollectionGroup(e,r,n,s){let a=new _t(((u,h)=>u-h));const i=this.overlays.getIterator();for(;i.hasNext();){const u=i.getNext().value;if(u.getKey().getCollectionGroup()===r&&u.largestBatchId>n){let h=a.get(u.largestBatchId);h===null&&(h=Is(),a=a.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const l=Is(),c=a.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((u,h)=>l.set(u,h))),!(l.size()>=s)););return ie.resolve(l)}St(e,r,n){const s=this.overlays.get(n.key);if(s!==null){const i=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,i)}this.overlays=this.overlays.insert(n.key,new eF(r,n));let a=this.qr.get(r);a===void 0&&(a=ze(),this.qr.set(r,a)),this.qr.set(r,a.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MF{constructor(){this.sessionToken=er.EMPTY_BYTE_STRING}getSessionToken(e){return ie.resolve(this.sessionToken)}setSessionToken(e,r){return this.sessionToken=r,ie.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lh{constructor(){this.Qr=new Bt(Ut.$r),this.Ur=new Bt(Ut.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,r){const n=new Ut(e,r);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,r){e.forEach((n=>this.addReference(n,r)))}removeReference(e,r){this.Gr(new Ut(e,r))}zr(e,r){e.forEach((n=>this.removeReference(n,r)))}jr(e){const r=new De(new mt([])),n=new Ut(r,e),s=new Ut(r,e+1),a=[];return this.Ur.forEachInRange([n,s],(i=>{this.Gr(i),a.push(i.key)})),a}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const r=new De(new mt([])),n=new Ut(r,e),s=new Ut(r,e+1);let a=ze();return this.Ur.forEachInRange([n,s],(i=>{a=a.add(i.key)})),a}containsKey(e){const r=new Ut(e,0),n=this.Qr.firstAfterOrEqual(r);return n!==null&&e.isEqual(n.key)}}class Ut{constructor(e,r){this.key=e,this.Yr=r}static $r(e,r){return De.comparator(e.key,r.key)||Ge(e.Yr,r.Yr)}static Kr(e,r){return Ge(e.Yr,r.Yr)||De.comparator(e.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LF{constructor(e,r){this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.tr=1,this.Zr=new Bt(Ut.$r)}checkEmpty(e){return ie.resolve(this.mutationQueue.length===0)}addMutationBatch(e,r,n,s){const a=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Z3(a,r,n,s);this.mutationQueue.push(i);for(const l of s)this.Zr=this.Zr.add(new Ut(l.key,a)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return ie.resolve(i)}lookupMutationBatch(e,r){return ie.resolve(this.Xr(r))}getNextMutationBatchAfterBatchId(e,r){const n=r+1,s=this.ei(n),a=s<0?0:s;return ie.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return ie.resolve(this.mutationQueue.length===0?Ch:this.tr-1)}getAllMutationBatches(e){return ie.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,r){const n=new Ut(r,0),s=new Ut(r,Number.POSITIVE_INFINITY),a=[];return this.Zr.forEachInRange([n,s],(i=>{const l=this.Xr(i.Yr);a.push(l)})),ie.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,r){let n=new Bt(Ge);return r.forEach((s=>{const a=new Ut(s,0),i=new Ut(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([a,i],(l=>{n=n.add(l.Yr)}))})),ie.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,r){const n=r.path,s=n.length+1;let a=n;De.isDocumentKey(a)||(a=a.child(""));const i=new Ut(new De(a),0);let l=new Bt(Ge);return this.Zr.forEachWhile((c=>{const u=c.key.path;return!!n.isPrefixOf(u)&&(u.length===s&&(l=l.add(c.Yr)),!0)}),i),ie.resolve(this.ti(l))}ti(e){const r=[];return e.forEach((n=>{const s=this.Xr(n);s!==null&&r.push(s)})),r}removeMutationBatch(e,r){rt(this.ni(r.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return ie.forEach(r.mutations,(s=>{const a=new Ut(s.key,r.batchId);return n=n.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,r){const n=new Ut(r,0),s=this.Zr.firstAfterOrEqual(n);return ie.resolve(r.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,ie.resolve()}ni(e,r){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const r=this.ei(e);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BF{constructor(e){this.ri=e,this.docs=(function(){return new _t(De.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,r){const n=r.key,s=this.docs.get(n),a=s?s.size:0,i=this.ri(r);return this.docs=this.docs.insert(n,{document:r.mutableCopy(),size:i}),this.size+=i-a,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const r=this.docs.get(e);r&&(this.docs=this.docs.remove(e),this.size-=r.size)}getEntry(e,r){const n=this.docs.get(r);return ie.resolve(n?n.document.mutableCopy():lr.newInvalidDocument(r))}getEntries(e,r){let n=jn();return r.forEach((s=>{const a=this.docs.get(s);n=n.insert(s,a?a.document.mutableCopy():lr.newInvalidDocument(s))})),ie.resolve(n)}getDocumentsMatchingQuery(e,r,n,s){let a=jn();const i=r.path,l=new De(i.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:u,value:{document:h}}=c.getNext();if(!i.isPrefixOf(u.path))break;u.path.length>i.length+1||f3(d3(h),n)<=0||(s.has(h.key)||cc(r,h))&&(a=a.insert(h.key,h.mutableCopy()))}return ie.resolve(a)}getAllFromCollectionGroup(e,r,n,s){je(9500)}ii(e,r){return ie.forEach(this.docs,(n=>r(n)))}newChangeBuffer(e){return new VF(this)}getSize(e){return ie.resolve(this.size)}}class VF extends DF{constructor(e){super(),this.Nr=e}applyChanges(e){const r=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?r.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(n)})),ie.waitFor(r)}getFromCache(e,r){return this.Nr.getEntry(e,r)}getAllFromCache(e,r){return this.Nr.getEntries(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UF{constructor(e){this.persistence=e,this.si=new zs((r=>Rh(r)),Dh),this.lastRemoteSnapshotVersion=Le.min(),this.highestTargetId=0,this.oi=0,this._i=new Lh,this.targetCount=0,this.ai=Ca.ur()}forEachTarget(e,r){return this.si.forEach(((n,s)=>r(s))),ie.resolve()}getLastRemoteSnapshotVersion(e){return ie.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ie.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ie.resolve(this.highestTargetId)}setTargetsMetadata(e,r,n){return n&&(this.lastRemoteSnapshotVersion=n),r>this.oi&&(this.oi=r),ie.resolve()}Pr(e){this.si.set(e.target,e);const r=e.targetId;r>this.highestTargetId&&(this.ai=new Ca(r),this.highestTargetId=r),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,r){return this.Pr(r),this.targetCount+=1,ie.resolve()}updateTargetData(e,r){return this.Pr(r),ie.resolve()}removeTargetData(e,r){return this.si.delete(r.target),this._i.jr(r.targetId),this.targetCount-=1,ie.resolve()}removeTargets(e,r,n){let s=0;const a=[];return this.si.forEach(((i,l)=>{l.sequenceNumber<=r&&n.get(l.targetId)===null&&(this.si.delete(i),a.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),ie.waitFor(a).next((()=>s))}getTargetCount(e){return ie.resolve(this.targetCount)}getTargetData(e,r){const n=this.si.get(r)||null;return ie.resolve(n)}addMatchingKeys(e,r,n){return this._i.Wr(r,n),ie.resolve()}removeMatchingKeys(e,r,n){this._i.zr(r,n);const s=this.persistence.referenceDelegate,a=[];return s&&r.forEach((i=>{a.push(s.markPotentiallyOrphaned(e,i))})),ie.waitFor(a)}removeMatchingKeysForTargetId(e,r){return this._i.jr(r),ie.resolve()}getMatchingKeysForTargetId(e,r){const n=this._i.Hr(r);return ie.resolve(n)}containsKey(e,r){return ie.resolve(this._i.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(e,r){this.ui={},this.overlays={},this.ci=new sc(0),this.li=!1,this.li=!0,this.hi=new MF,this.referenceDelegate=e(this),this.Pi=new UF(this),this.indexManager=new AF,this.remoteDocumentCache=(function(s){return new BF(s)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new EF(r),this.Ii=new kF(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let r=this.overlays[e.toKey()];return r||(r=new OF,this.overlays[e.toKey()]=r),r}getMutationQueue(e,r){let n=this.ui[e.toKey()];return n||(n=new LF(r,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,r,n){Ie("MemoryPersistence","Starting transaction:",e);const s=new $F(this.ci.next());return this.referenceDelegate.Ei(),n(s).next((a=>this.referenceDelegate.di(s).next((()=>a)))).toPromise().then((a=>(s.raiseOnCommittedEvent(),a)))}Ai(e,r){return ie.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,r))))}}class $F extends p3{constructor(e){super(),this.currentSequenceNumber=e}}class Bh{constructor(e){this.persistence=e,this.Ri=new Lh,this.Vi=null}static mi(e){return new Bh(e)}get fi(){if(this.Vi)return this.Vi;throw je(60996)}addReference(e,r,n){return this.Ri.addReference(n,r),this.fi.delete(n.toString()),ie.resolve()}removeReference(e,r,n){return this.Ri.removeReference(n,r),this.fi.add(n.toString()),ie.resolve()}markPotentiallyOrphaned(e,r){return this.fi.add(r.toString()),ie.resolve()}removeTarget(e,r){this.Ri.jr(r.targetId).forEach((s=>this.fi.add(s.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,r.targetId).next((s=>{s.forEach((a=>this.fi.add(a.toString())))})).next((()=>n.removeTargetData(e,r)))}Ei(){this.Vi=new Set}di(e){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ie.forEach(this.fi,(n=>{const s=De.fromPath(n);return this.gi(e,s).next((a=>{a||r.removeEntry(s,Le.min())}))})).next((()=>(this.Vi=null,r.apply(e))))}updateLimboDocument(e,r){return this.gi(e,r).next((n=>{n?this.fi.delete(r.toString()):this.fi.add(r.toString())}))}Ti(e){return 0}gi(e,r){return ie.or([()=>ie.resolve(this.Ri.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(e,r),()=>this.persistence.Ai(e,r)])}}class Pl{constructor(e,r){this.persistence=e,this.pi=new zs((n=>v3(n.path)),((n,s)=>n.isEqual(s))),this.garbageCollector=RF(this,r)}static mi(e,r){return new Pl(e,r)}Ei(){}di(e){return ie.resolve()}forEachTarget(e,r){return this.persistence.getTargetCache().forEachTarget(e,r)}gr(e){const r=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((n=>r.next((s=>n+s))))}wr(e){let r=0;return this.pr(e,(n=>{r++})).next((()=>r))}pr(e,r){return ie.forEach(this.pi,((n,s)=>this.br(e,n,s).next((a=>a?ie.resolve():r(s)))))}removeTargets(e,r,n){return this.persistence.getTargetCache().removeTargets(e,r,n)}removeOrphanedDocuments(e,r){let n=0;const s=this.persistence.getRemoteDocumentCache(),a=s.newChangeBuffer();return s.ii(e,(i=>this.br(e,i,r).next((l=>{l||(n++,a.removeEntry(i,Le.min()))})))).next((()=>a.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,r){return this.pi.set(r,e.currentSequenceNumber),ie.resolve()}removeTarget(e,r){const n=r.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,r,n){return this.pi.set(n,e.currentSequenceNumber),ie.resolve()}removeReference(e,r,n){return this.pi.set(n,e.currentSequenceNumber),ie.resolve()}updateLimboDocument(e,r){return this.pi.set(r,e.currentSequenceNumber),ie.resolve()}Ti(e){let r=e.key.toString().length;return e.isFoundDocument()&&(r+=zo(e.data.value)),r}br(e,r,n){return ie.or([()=>this.persistence.Ai(e,r),()=>this.persistence.getTargetCache().containsKey(e,r),()=>{const s=this.pi.get(r);return ie.resolve(s!==void 0&&s>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vh{constructor(e,r,n,s){this.targetId=e,this.fromCache=r,this.Es=n,this.ds=s}static As(e,r){let n=ze(),s=ze();for(const a of r.docChanges)switch(a.type){case 0:n=n.add(a.doc.key);break;case 1:s=s.add(a.doc.key)}return new Vh(e,r.fromCache,n,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HF{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WF{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return OR()?8:g3(jR())>0?6:4})()}initialize(e,r){this.ps=e,this.indexManager=r,this.Rs=!0}getDocumentsMatchingQuery(e,r,n,s){const a={result:null};return this.ys(e,r).next((i=>{a.result=i})).next((()=>{if(!a.result)return this.ws(e,r,s,n).next((i=>{a.result=i}))})).next((()=>{if(a.result)return;const i=new HF;return this.Ss(e,r,i).next((l=>{if(a.result=l,this.Vs)return this.bs(e,r,i,l.size)}))})).next((()=>a.result))}bs(e,r,n,s){return n.documentReadCount<this.fs?(ia()<=Ke.DEBUG&&Ie("QueryEngine","SDK will not create cache indexes for query:",oa(r),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ie.resolve()):(ia()<=Ke.DEBUG&&Ie("QueryEngine","Query:",oa(r),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(ia()<=Ke.DEBUG&&Ie("QueryEngine","The SDK decides to create cache indexes for query:",oa(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,un(r))):ie.resolve())}ys(e,r){if(j0(r))return ie.resolve(null);let n=un(r);return this.indexManager.getIndexType(e,n).next((s=>s===0?null:(r.limit!==null&&s===1&&(r=Cu(r,null,"F"),n=un(r)),this.indexManager.getDocumentsMatchingTarget(e,n).next((a=>{const i=ze(...a);return this.ps.getDocuments(e,i).next((l=>this.indexManager.getMinOffset(e,n).next((c=>{const u=this.Ds(r,l);return this.Cs(r,u,i,c.readTime)?this.ys(e,Cu(r,null,"F")):this.vs(e,u,r,c)}))))})))))}ws(e,r,n,s){return j0(r)||s.isEqual(Le.min())?ie.resolve(null):this.ps.getDocuments(e,n).next((a=>{const i=this.Ds(r,a);return this.Cs(r,i,n,s)?ie.resolve(null):(ia()<=Ke.DEBUG&&Ie("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),oa(r)),this.vs(e,i,r,h3(s,Oi)).next((l=>l)))}))}Ds(e,r){let n=new Bt(u1(e));return r.forEach(((s,a)=>{cc(e,a)&&(n=n.add(a))})),n}Cs(e,r,n,s){if(e.limit===null)return!1;if(n.size!==r.size)return!0;const a=e.limitType==="F"?r.last():r.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(s)>0)}Ss(e,r,n){return ia()<=Ke.DEBUG&&Ie("QueryEngine","Using full collection scan to execute query:",oa(r)),this.ps.getDocumentsMatchingQuery(e,r,is.min(),n)}vs(e,r,n,s){return this.ps.getDocumentsMatchingQuery(e,n,s).next((a=>(r.forEach((i=>{a=a.insert(i.key,i)})),a)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uh="LocalStore",qF=3e8;class GF{constructor(e,r,n,s){this.persistence=e,this.Fs=r,this.serializer=s,this.Ms=new _t(Ge),this.xs=new zs((a=>Rh(a)),Dh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new jF(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(r=>e.collect(r,this.Ms)))}}function zF(t,e,r,n){return new GF(t,e,r,n)}async function F1(t,e){const r=Be(t);return await r.persistence.runTransaction("Handle user change","readonly",(n=>{let s;return r.mutationQueue.getAllMutationBatches(n).next((a=>(s=a,r.Bs(e),r.mutationQueue.getAllMutationBatches(n)))).next((a=>{const i=[],l=[];let c=ze();for(const u of s){i.push(u.batchId);for(const h of u.mutations)c=c.add(h.key)}for(const u of a){l.push(u.batchId);for(const h of u.mutations)c=c.add(h.key)}return r.localDocuments.getDocuments(n,c).next((u=>({Ls:u,removedBatchIds:i,addedBatchIds:l})))}))}))}function YF(t,e){const r=Be(t);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const s=e.batch.keys(),a=r.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,c,u,h){const f=u.batch,m=f.keys();let p=ie.resolve();return m.forEach((x=>{p=p.next((()=>h.getEntry(c,x))).next((g=>{const y=u.docVersions.get(x);rt(y!==null,48541),g.version.compareTo(y)<0&&(f.applyToRemoteDocument(g,u),g.isValidDocument()&&(g.setReadTime(u.commitVersion),h.addEntry(g)))}))})),p.next((()=>l.mutationQueue.removeMutationBatch(c,f)))})(r,n,e,a).next((()=>a.apply(n))).next((()=>r.mutationQueue.performConsistencyCheck(n))).next((()=>r.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId))).next((()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(l){let c=ze();for(let u=0;u<l.mutationResults.length;++u)l.mutationResults[u].transformResults.length>0&&(c=c.add(l.batch.mutations[u].key));return c})(e)))).next((()=>r.localDocuments.getDocuments(n,s)))}))}function j1(t){const e=Be(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(r=>e.Pi.getLastRemoteSnapshotVersion(r)))}function KF(t,e){const r=Be(t),n=e.snapshotVersion;let s=r.Ms;return r.persistence.runTransaction("Apply remote event","readwrite-primary",(a=>{const i=r.Ns.newChangeBuffer({trackRemovals:!0});s=r.Ms;const l=[];e.targetChanges.forEach(((h,f)=>{const m=s.get(f);if(!m)return;l.push(r.Pi.removeMatchingKeys(a,h.removedDocuments,f).next((()=>r.Pi.addMatchingKeys(a,h.addedDocuments,f))));let p=m.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(f)!==null?p=p.withResumeToken(er.EMPTY_BYTE_STRING,Le.min()).withLastLimboFreeSnapshotVersion(Le.min()):h.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(h.resumeToken,n)),s=s.insert(f,p),(function(g,y,I){return g.resumeToken.approximateByteSize()===0||y.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=qF?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0})(m,p,h)&&l.push(r.Pi.updateTargetData(a,p))}));let c=jn(),u=ze();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&l.push(r.persistence.referenceDelegate.updateLimboDocument(a,h))})),l.push(XF(a,i,e.documentUpdates).next((h=>{c=h.ks,u=h.qs}))),!n.isEqual(Le.min())){const h=r.Pi.getLastRemoteSnapshotVersion(a).next((f=>r.Pi.setTargetsMetadata(a,a.currentSequenceNumber,n)));l.push(h)}return ie.waitFor(l).next((()=>i.apply(a))).next((()=>r.localDocuments.getLocalViewOfDocuments(a,c,u))).next((()=>c))})).then((a=>(r.Ms=s,a)))}function XF(t,e,r){let n=ze(),s=ze();return r.forEach((a=>n=n.add(a))),e.getEntries(t,n).next((a=>{let i=jn();return r.forEach(((l,c)=>{const u=a.get(l);c.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(l)),c.isNoDocument()&&c.version.isEqual(Le.min())?(e.removeEntry(l,c.readTime),i=i.insert(l,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),i=i.insert(l,c)):Ie(Uh,"Ignoring outdated watch update for ",l,". Current version:",u.version," Watch version:",c.version)})),{ks:i,qs:s}}))}function QF(t,e){const r=Be(t);return r.persistence.runTransaction("Get next mutation batch","readonly",(n=>(e===void 0&&(e=Ch),r.mutationQueue.getNextMutationBatchAfterBatchId(n,e))))}function JF(t,e){const r=Be(t);return r.persistence.runTransaction("Allocate target","readwrite",(n=>{let s;return r.Pi.getTargetData(n,e).next((a=>a?(s=a,ie.resolve(s)):r.Pi.allocateTargetId(n).next((i=>(s=new Kn(e,i,"TargetPurposeListen",n.currentSequenceNumber),r.Pi.addTargetData(n,s).next((()=>s)))))))})).then((n=>{const s=r.Ms.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(r.Ms=r.Ms.insert(n.targetId,n),r.xs.set(e,n.targetId)),n}))}async function Fu(t,e,r){const n=Be(t),s=n.Ms.get(e),a=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",a,(i=>n.persistence.referenceDelegate.removeTarget(i,s)))}catch(i){if(!Ua(i))throw i;Ie(Uh,`Failed to update sequence numbers for target ${e}: ${i}`)}n.Ms=n.Ms.remove(e),n.xs.delete(s.target)}function z0(t,e,r){const n=Be(t);let s=Le.min(),a=ze();return n.persistence.runTransaction("Execute query","readwrite",(i=>(function(c,u,h){const f=Be(c),m=f.xs.get(h);return m!==void 0?ie.resolve(f.Ms.get(m)):f.Pi.getTargetData(u,h)})(n,i,un(e)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(i,l.targetId).next((c=>{a=c}))})).next((()=>n.Fs.getDocumentsMatchingQuery(i,e,r?s:Le.min(),r?a:ze()))).next((l=>(ZF(n,M3(e),l),{documents:l,Qs:a})))))}function ZF(t,e,r){let n=t.Os.get(e)||Le.min();r.forEach(((s,a)=>{a.readTime.compareTo(n)>0&&(n=a.readTime)})),t.Os.set(e,n)}class Y0{constructor(){this.activeTargetIds=H3()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ej{constructor(){this.Mo=new Y0,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,r,n){}addLocalQueryTarget(e,r=!0){return r&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,r,n){this.xo[e]=r}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Y0,Promise.resolve()}handleUserChange(e,r,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K0="ConnectivityMonitor";class X0{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ie(K0,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ie(K0,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bo=null;function ju(){return Bo===null?Bo=(function(){return 268435456+Math.round(2147483648*Math.random())})():Bo++,"0x"+Bo.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kc="RestConnection",rj={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class nj{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const r=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=r+"://"+e.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===Al?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(e,r,n,s,a){const i=ju(),l=this.zo(e,r.toUriEncodedString());Ie(Kc,`Sending RPC '${e}' ${i}:`,l,n);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,a);const{host:u}=new URL(l),h=Th(u);return this.Jo(e,l,c,n,h).then((f=>(Ie(Kc,`Received RPC '${e}' ${i}: `,f),f)),(f=>{throw Ta(Kc,`RPC '${e}' ${i} failed with error: `,f,"url: ",l,"request:",n),f}))}Ho(e,r,n,s,a,i){return this.Go(e,r,n,s,a)}jo(e,r,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ba})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach(((s,a)=>e[a]=s)),n&&n.headers.forEach(((s,a)=>e[a]=s))}zo(e,r){const n=rj[e];return`${this.Uo}/v1/${r}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sj{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ar="WebChannelConnection";class aj extends nj{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,r,n,s,a){const i=ju();return new Promise(((l,c)=>{const u=new Mx;u.setWithCredentials(!0),u.listenOnce(Lx.COMPLETE,(()=>{try{switch(u.getLastErrorCode()){case Go.NO_ERROR:const f=u.getResponseJson();Ie(ar,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(f)),l(f);break;case Go.TIMEOUT:Ie(ar,`RPC '${e}' ${i} timed out`),c(new Te(ne.DEADLINE_EXCEEDED,"Request time out"));break;case Go.HTTP_ERROR:const m=u.getStatus();if(Ie(ar,`RPC '${e}' ${i} failed with status:`,m,"response text:",u.getResponseText()),m>0){let p=u.getResponseJson();Array.isArray(p)&&(p=p[0]);const x=p?.error;if(x&&x.status&&x.message){const g=(function(I){const P=I.toLowerCase().replace(/_/g,"-");return Object.values(ne).indexOf(P)>=0?P:ne.UNKNOWN})(x.status);c(new Te(g,x.message))}else c(new Te(ne.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new Te(ne.UNAVAILABLE,"Connection failed."));break;default:je(9055,{l_:e,streamId:i,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{Ie(ar,`RPC '${e}' ${i} completed.`)}}));const h=JSON.stringify(s);Ie(ar,`RPC '${e}' ${i} sending request:`,s),u.send(r,"POST",h,n,15)}))}T_(e,r,n){const s=ju(),a=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Ux(),l=Vx(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,r,n),c.encodeInitMessageHeaders=!0;const h=a.join("");Ie(ar,`Creating RPC '${e}' stream ${s}: ${h}`,c);const f=i.createWebChannel(h,c);this.I_(f);let m=!1,p=!1;const x=new sj({Yo:y=>{p?Ie(ar,`Not sending because RPC '${e}' stream ${s} is closed:`,y):(m||(Ie(ar,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),Ie(ar,`RPC '${e}' stream ${s} sending:`,y),f.send(y))},Zo:()=>f.close()}),g=(y,I,P)=>{y.listen(I,(A=>{try{P(A)}catch(D){setTimeout((()=>{throw D}),0)}}))};return g(f,ai.EventType.OPEN,(()=>{p||(Ie(ar,`RPC '${e}' stream ${s} transport opened.`),x.o_())})),g(f,ai.EventType.CLOSE,(()=>{p||(p=!0,Ie(ar,`RPC '${e}' stream ${s} transport closed`),x.a_(),this.E_(f))})),g(f,ai.EventType.ERROR,(y=>{p||(p=!0,Ta(ar,`RPC '${e}' stream ${s} transport errored. Name:`,y.name,"Message:",y.message),x.a_(new Te(ne.UNAVAILABLE,"The operation could not be completed")))})),g(f,ai.EventType.MESSAGE,(y=>{if(!p){const I=y.data[0];rt(!!I,16349);const P=I,A=P?.error||P[0]?.error;if(A){Ie(ar,`RPC '${e}' stream ${s} received error:`,A);const D=A.status;let V=(function(E){const _=It[E];if(_!==void 0)return w1(_)})(D),H=A.message;V===void 0&&(V=ne.INTERNAL,H="Unknown error status: "+D+" with message "+A.message),p=!0,x.a_(new Te(V,H)),f.close()}else Ie(ar,`RPC '${e}' stream ${s} received:`,I),x.u_(I)}})),g(l,Bx.STAT_EVENT,(y=>{y.stat===wu.PROXY?Ie(ar,`RPC '${e}' stream ${s} detected buffering proxy`):y.stat===wu.NOPROXY&&Ie(ar,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{x.__()}),0),x}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((r=>r===e))}}function Xc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fc(t){return new cF(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k1{constructor(e,r,n=1e3,s=1.5,a=6e4){this.Mi=e,this.timerId=r,this.d_=n,this.A_=s,this.R_=a,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const r=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,r-n);s>0&&Ie("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${r} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q0="PersistentStream";class O1{constructor(e,r,n,s,a,i,l,c){this.Mi=e,this.S_=n,this.b_=s,this.connection=a,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new k1(e,r)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,r){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():r&&r.code===ne.RESOURCE_EXHAUSTED?(Fn(r.toString()),Fn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):r&&r.code===ne.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(r)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),r=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,s])=>{this.D_===r&&this.G_(n,s)}),(n=>{e((()=>{const s=new Te(ne.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)}))}))}G_(e,r){const n=this.W_(this.D_);this.stream=this.j_(e,r),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{n((()=>this.z_(s)))})),this.stream.onMessage((s=>{n((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ie(Q0,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return r=>{this.Mi.enqueueAndForget((()=>this.D_===e?r():(Ie(Q0,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ij extends O1{constructor(e,r,n,s,a,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,n,s,i),this.serializer=a}j_(e,r){return this.connection.T_("Listen",e,r)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const r=dF(this.serializer,e),n=(function(a){if(!("targetChange"in a))return Le.min();const i=a.targetChange;return i.targetIds&&i.targetIds.length?Le.min():i.readTime?hn(i.readTime):Le.min()})(e);return this.listener.H_(r,n)}Y_(e){const r={};r.database=Du(this.serializer),r.addTarget=(function(a,i){let l;const c=i.target;if(l=Su(c)?{documents:pF(a,c)}:{query:gF(a,c).ft},l.targetId=i.targetId,i.resumeToken.approximateByteSize()>0){l.resumeToken=T1(a,i.resumeToken);const u=Iu(a,i.expectedCount);u!==null&&(l.expectedCount=u)}else if(i.snapshotVersion.compareTo(Le.min())>0){l.readTime=Il(a,i.snapshotVersion.toTimestamp());const u=Iu(a,i.expectedCount);u!==null&&(l.expectedCount=u)}return l})(this.serializer,e);const n=vF(this.serializer,e);n&&(r.labels=n),this.q_(r)}Z_(e){const r={};r.database=Du(this.serializer),r.removeTarget=e,this.q_(r)}}class oj extends O1{constructor(e,r,n,s,a,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,n,s,i),this.serializer=a}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,r){return this.connection.T_("Write",e,r)}J_(e){return rt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,rt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){rt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const r=mF(e.writeResults,e.commitTime),n=hn(e.commitTime);return this.listener.na(n,r)}ra(){const e={};e.database=Du(this.serializer),this.q_(e)}ea(e){const r={streamToken:this.lastStreamToken,writes:e.map((n=>fF(this.serializer,n)))};this.q_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lj{}class cj extends lj{constructor(e,r,n,s){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new Te(ne.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,r,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,i])=>this.connection.Go(e,Pu(r,n),s,a,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===ne.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Te(ne.UNKNOWN,a.toString())}))}Ho(e,r,n,s,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,l])=>this.connection.Ho(e,Pu(r,n),s,i,l,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===ne.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Te(ne.UNKNOWN,i.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class uj{constructor(e,r){this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const r=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Fn(r),this.aa=!1):Ie("OnlineStateTracker",r)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bs="RemoteStore";class hj{constructor(e,r,n,s,a){this.localStore=e,this.datastore=r,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=a,this.Aa.Oo((i=>{n.enqueueAndForget((async()=>{Ys(this)&&(Ie(Bs,"Restarting streams for network reachability change."),await(async function(c){const u=Be(c);u.Ea.add(4),await ao(u),u.Ra.set("Unknown"),u.Ea.delete(4),await mc(u)})(this))}))})),this.Ra=new uj(n,s)}}async function mc(t){if(Ys(t))for(const e of t.da)await e(!0)}async function ao(t){for(const e of t.da)await e(!1)}function M1(t,e){const r=Be(t);r.Ia.has(e.targetId)||(r.Ia.set(e.targetId,e),qh(r)?Wh(r):Ha(r).O_()&&Hh(r,e))}function $h(t,e){const r=Be(t),n=Ha(r);r.Ia.delete(e),n.O_()&&L1(r,e),r.Ia.size===0&&(n.O_()?n.L_():Ys(r)&&r.Ra.set("Unknown"))}function Hh(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Le.min())>0){const r=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(r)}Ha(t).Y_(e)}function L1(t,e){t.Va.Ue(e),Ha(t).Z_(e)}function Wh(t){t.Va=new aF({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),Ha(t).start(),t.Ra.ua()}function qh(t){return Ys(t)&&!Ha(t).x_()&&t.Ia.size>0}function Ys(t){return Be(t).Ea.size===0}function B1(t){t.Va=void 0}async function dj(t){t.Ra.set("Online")}async function fj(t){t.Ia.forEach(((e,r)=>{Hh(t,e)}))}async function mj(t,e){B1(t),qh(t)?(t.Ra.ha(e),Wh(t)):t.Ra.set("Unknown")}async function pj(t,e,r){if(t.Ra.set("Online"),e instanceof E1&&e.state===2&&e.cause)try{await(async function(s,a){const i=a.cause;for(const l of a.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,i),s.Ia.delete(l),s.Va.removeTarget(l))})(t,e)}catch(n){Ie(Bs,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Rl(t,n)}else if(e instanceof Xo?t.Va.Ze(e):e instanceof b1?t.Va.st(e):t.Va.tt(e),!r.isEqual(Le.min()))try{const n=await j1(t.localStore);r.compareTo(n)>=0&&await(function(a,i){const l=a.Va.Tt(i);return l.targetChanges.forEach(((c,u)=>{if(c.resumeToken.approximateByteSize()>0){const h=a.Ia.get(u);h&&a.Ia.set(u,h.withResumeToken(c.resumeToken,i))}})),l.targetMismatches.forEach(((c,u)=>{const h=a.Ia.get(c);if(!h)return;a.Ia.set(c,h.withResumeToken(er.EMPTY_BYTE_STRING,h.snapshotVersion)),L1(a,c);const f=new Kn(h.target,c,u,h.sequenceNumber);Hh(a,f)})),a.remoteSyncer.applyRemoteEvent(l)})(t,r)}catch(n){Ie(Bs,"Failed to raise snapshot:",n),await Rl(t,n)}}async function Rl(t,e,r){if(!Ua(e))throw e;t.Ea.add(1),await ao(t),t.Ra.set("Offline"),r||(r=()=>j1(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ie(Bs,"Retrying IndexedDB access"),await r(),t.Ea.delete(1),await mc(t)}))}function V1(t,e){return e().catch((r=>Rl(t,r,e)))}async function pc(t){const e=Be(t),r=us(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ch;for(;gj(e);)try{const s=await QF(e.localStore,n);if(s===null){e.Ta.length===0&&r.L_();break}n=s.batchId,xj(e,s)}catch(s){await Rl(e,s)}U1(e)&&$1(e)}function gj(t){return Ys(t)&&t.Ta.length<10}function xj(t,e){t.Ta.push(e);const r=us(t);r.O_()&&r.X_&&r.ea(e.mutations)}function U1(t){return Ys(t)&&!us(t).x_()&&t.Ta.length>0}function $1(t){us(t).start()}async function vj(t){us(t).ra()}async function yj(t){const e=us(t);for(const r of t.Ta)e.ea(r.mutations)}async function _j(t,e,r){const n=t.Ta.shift(),s=kh.from(n,e,r);await V1(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await pc(t)}async function wj(t,e){e&&us(t).X_&&await(async function(n,s){if((function(i){return rF(i)&&i!==ne.ABORTED})(s.code)){const a=n.Ta.shift();us(n).B_(),await V1(n,(()=>n.remoteSyncer.rejectFailedWrite(a.batchId,s))),await pc(n)}})(t,e),U1(t)&&$1(t)}async function J0(t,e){const r=Be(t);r.asyncQueue.verifyOperationInProgress(),Ie(Bs,"RemoteStore received new credentials");const n=Ys(r);r.Ea.add(3),await ao(r),n&&r.Ra.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.Ea.delete(3),await mc(r)}async function bj(t,e){const r=Be(t);e?(r.Ea.delete(2),await mc(r)):e||(r.Ea.add(2),await ao(r),r.Ra.set("Unknown"))}function Ha(t){return t.ma||(t.ma=(function(r,n,s){const a=Be(r);return a.sa(),new ij(n,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,s)})(t.datastore,t.asyncQueue,{Xo:dj.bind(null,t),t_:fj.bind(null,t),r_:mj.bind(null,t),H_:pj.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),qh(t)?Wh(t):t.Ra.set("Unknown")):(await t.ma.stop(),B1(t))}))),t.ma}function us(t){return t.fa||(t.fa=(function(r,n,s){const a=Be(r);return a.sa(),new oj(n,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,s)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:vj.bind(null,t),r_:wj.bind(null,t),ta:yj.bind(null,t),na:_j.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await pc(t)):(await t.fa.stop(),t.Ta.length>0&&(Ie(Bs,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gh{constructor(e,r,n,s,a){this.asyncQueue=e,this.timerId=r,this.targetTimeMs=n,this.op=s,this.removalCallback=a,this.deferred=new Sn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((i=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,r,n,s,a){const i=Date.now()+n,l=new Gh(e,r,i,s,a);return l.start(n),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Te(ne.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zh(t,e){if(Fn("AsyncQueue",`${e}: ${t}`),Ua(t))return new Te(ne.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{static emptySet(e){return new ya(e.comparator)}constructor(e){this.comparator=e?(r,n)=>e(r,n)||De.comparator(r.key,n.key):(r,n)=>De.comparator(r.key,n.key),this.keyedMap=ii(),this.sortedSet=new _t(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const r=this.keyedMap.get(e);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((r,n)=>(e(r),!1)))}add(e){const r=this.delete(e.key);return r.copy(r.keyedMap.insert(e.key,e),r.sortedSet.insert(e,null))}delete(e){const r=this.get(e);return r?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(r)):this}isEqual(e){if(!(e instanceof ya)||this.size!==e.size)return!1;const r=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;r.hasNext();){const s=r.getNext().key,a=n.getNext().key;if(!s.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach((r=>{e.push(r.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,r){const n=new ya;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=r,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(){this.ga=new _t(De.comparator)}track(e){const r=e.doc.key,n=this.ga.get(r);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(r,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(r,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(r,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(r,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(r):e.type===1&&n.type===2?this.ga=this.ga.insert(r,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(r,{type:2,doc:e.doc}):je(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(r,e)}ya(){const e=[];return this.ga.inorderTraversal(((r,n)=>{e.push(n)})),e}}class Ia{constructor(e,r,n,s,a,i,l,c,u){this.query=e,this.docs=r,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=a,this.fromCache=i,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,r,n,s,a){const i=[];return r.forEach((l=>{i.push({type:0,doc:l})})),new Ia(e,r,ya.emptySet(r),i,n,s,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&lc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const r=this.docChanges,n=e.docChanges;if(r.length!==n.length)return!1;for(let s=0;s<r.length;s++)if(r[s].type!==n[s].type||!r[s].doc.isEqual(n[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ej{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class Tj{constructor(){this.queries=em(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(r,n){const s=Be(r),a=s.queries;s.queries=em(),a.forEach(((i,l)=>{for(const c of l.Sa)c.onError(n)}))})(this,new Te(ne.ABORTED,"Firestore shutting down"))}}function em(){return new zs((t=>c1(t)),lc)}async function Yh(t,e){const r=Be(t);let n=3;const s=e.query;let a=r.queries.get(s);a?!a.ba()&&e.Da()&&(n=2):(a=new Ej,n=e.Da()?0:1);try{switch(n){case 0:a.wa=await r.onListen(s,!0);break;case 1:a.wa=await r.onListen(s,!1);break;case 2:await r.onFirstRemoteStoreListen(s)}}catch(i){const l=zh(i,`Initialization of query '${oa(e.query)}' failed`);return void e.onError(l)}r.queries.set(s,a),a.Sa.push(e),e.va(r.onlineState),a.wa&&e.Fa(a.wa)&&Xh(r)}async function Kh(t,e){const r=Be(t),n=e.query;let s=3;const a=r.queries.get(n);if(a){const i=a.Sa.indexOf(e);i>=0&&(a.Sa.splice(i,1),a.Sa.length===0?s=e.Da()?0:1:!a.ba()&&e.Da()&&(s=2))}switch(s){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function Aj(t,e){const r=Be(t);let n=!1;for(const s of e){const a=s.query,i=r.queries.get(a);if(i){for(const l of i.Sa)l.Fa(s)&&(n=!0);i.wa=s}}n&&Xh(r)}function Sj(t,e,r){const n=Be(t),s=n.queries.get(e);if(s)for(const a of s.Sa)a.onError(r);n.queries.delete(e)}function Xh(t){t.Ca.forEach((e=>{e.next()}))}var ku,tm;(tm=ku||(ku={})).Ma="default",tm.Cache="cache";class Qh{constructor(e,r,n){this.query=e,this.xa=r,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const s of e.docChanges)s.type!==3&&n.push(s);e=new Ia(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let r=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),r=!0):this.La(e,this.onlineState)&&(this.ka(e),r=!0),this.Na=e,r}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let r=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),r=!0),r}La(e,r){if(!e.fromCache||!this.Da())return!0;const n=r!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||r==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const r=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}ka(e){e=Ia.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==ku.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H1{constructor(e){this.key=e}}class W1{constructor(e){this.key=e}}class Nj{constructor(e,r){this.query=e,this.Ya=r,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ze(),this.mutatedKeys=ze(),this.eu=u1(e),this.tu=new ya(this.eu)}get nu(){return this.Ya}ru(e,r){const n=r?r.iu:new Z0,s=r?r.tu:this.tu;let a=r?r.mutatedKeys:this.mutatedKeys,i=s,l=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((h,f)=>{const m=s.get(h),p=cc(this.query,f)?f:null,x=!!m&&this.mutatedKeys.has(m.key),g=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let y=!1;m&&p?m.data.isEqual(p.data)?x!==g&&(n.track({type:3,doc:p}),y=!0):this.su(m,p)||(n.track({type:2,doc:p}),y=!0,(c&&this.eu(p,c)>0||u&&this.eu(p,u)<0)&&(l=!0)):!m&&p?(n.track({type:0,doc:p}),y=!0):m&&!p&&(n.track({type:1,doc:m}),y=!0,(c||u)&&(l=!0)),y&&(p?(i=i.add(p),a=g?a.add(h):a.delete(h)):(i=i.delete(h),a=a.delete(h)))})),this.query.limit!==null)for(;i.size>this.query.limit;){const h=this.query.limitType==="F"?i.last():i.first();i=i.delete(h.key),a=a.delete(h.key),n.track({type:1,doc:h})}return{tu:i,iu:n,Cs:l,mutatedKeys:a}}su(e,r){return e.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(e,r,n,s){const a=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const i=e.iu.ya();i.sort(((h,f)=>(function(p,x){const g=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return je(20277,{Rt:y})}};return g(p)-g(x)})(h.type,f.type)||this.eu(h.doc,f.doc))),this.ou(n),s=s??!1;const l=r&&!s?this._u():[],c=this.Xa.size===0&&this.current&&!s?1:0,u=c!==this.Za;return this.Za=c,i.length!==0||u?{snapshot:new Ia(this.query,e.tu,a,i,e.mutatedKeys,c===0,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Z0,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((r=>this.Ya=this.Ya.add(r))),e.modifiedDocuments.forEach((r=>{})),e.removedDocuments.forEach((r=>this.Ya=this.Ya.delete(r))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=ze(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const r=[];return e.forEach((n=>{this.Xa.has(n)||r.push(new W1(n))})),this.Xa.forEach((n=>{e.has(n)||r.push(new H1(n))})),r}cu(e){this.Ya=e.Qs,this.Xa=ze();const r=this.ru(e.documents);return this.applyChanges(r,!0)}lu(){return Ia.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Jh="SyncEngine";class Cj{constructor(e,r,n){this.query=e,this.targetId=r,this.view=n}}class Ij{constructor(e){this.key=e,this.hu=!1}}class Pj{constructor(e,r,n,s,a,i){this.localStore=e,this.remoteStore=r,this.eventManager=n,this.sharedClientState=s,this.currentUser=a,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new zs((l=>c1(l)),lc),this.Iu=new Map,this.Eu=new Set,this.du=new _t(De.comparator),this.Au=new Map,this.Ru=new Lh,this.Vu={},this.mu=new Map,this.fu=Ca.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Rj(t,e,r=!0){const n=X1(t);let s;const a=n.Tu.get(e);return a?(n.sharedClientState.addLocalQueryTarget(a.targetId),s=a.view.lu()):s=await q1(n,e,r,!0),s}async function Dj(t,e){const r=X1(t);await q1(r,e,!0,!1)}async function q1(t,e,r,n){const s=await JF(t.localStore,un(e)),a=s.targetId,i=t.sharedClientState.addLocalQueryTarget(a,r);let l;return n&&(l=await Fj(t,e,a,i==="current",s.resumeToken)),t.isPrimaryClient&&r&&M1(t.remoteStore,s),l}async function Fj(t,e,r,n,s){t.pu=(f,m,p)=>(async function(g,y,I,P){let A=y.view.ru(I);A.Cs&&(A=await z0(g.localStore,y.query,!1).then((({documents:w})=>y.view.ru(w,A))));const D=P&&P.targetChanges.get(y.targetId),V=P&&P.targetMismatches.get(y.targetId)!=null,H=y.view.applyChanges(A,g.isPrimaryClient,D,V);return nm(g,y.targetId,H.au),H.snapshot})(t,f,m,p);const a=await z0(t.localStore,e,!0),i=new Nj(e,a.Qs),l=i.ru(a.documents),c=so.createSynthesizedTargetChangeForCurrentChange(r,n&&t.onlineState!=="Offline",s),u=i.applyChanges(l,t.isPrimaryClient,c);nm(t,r,u.au);const h=new Cj(e,r,i);return t.Tu.set(e,h),t.Iu.has(r)?t.Iu.get(r).push(e):t.Iu.set(r,[e]),u.snapshot}async function jj(t,e,r){const n=Be(t),s=n.Tu.get(e),a=n.Iu.get(s.targetId);if(a.length>1)return n.Iu.set(s.targetId,a.filter((i=>!lc(i,e)))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Fu(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),r&&$h(n.remoteStore,s.targetId),Ou(n,s.targetId)})).catch(Va)):(Ou(n,s.targetId),await Fu(n.localStore,s.targetId,!0))}async function kj(t,e){const r=Be(t),n=r.Tu.get(e),s=r.Iu.get(n.targetId);r.isPrimaryClient&&s.length===1&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),$h(r.remoteStore,n.targetId))}async function Oj(t,e,r){const n=Hj(t);try{const s=await(function(i,l){const c=Be(i),u=gt.now(),h=l.reduce(((p,x)=>p.add(x.key)),ze());let f,m;return c.persistence.runTransaction("Locally write mutations","readwrite",(p=>{let x=jn(),g=ze();return c.Ns.getEntries(p,h).next((y=>{x=y,x.forEach(((I,P)=>{P.isValidDocument()||(g=g.add(I))}))})).next((()=>c.localDocuments.getOverlayedDocuments(p,x))).next((y=>{f=y;const I=[];for(const P of l){const A=Q3(P,f.get(P.key).overlayedDocument);A!=null&&I.push(new vs(P.key,A,t1(A.value.mapValue),jr.exists(!0)))}return c.mutationQueue.addMutationBatch(p,u,I,l)})).next((y=>{m=y;const I=y.applyToLocalDocumentSet(f,g);return c.documentOverlayCache.saveOverlays(p,y.batchId,I)}))})).then((()=>({batchId:m.batchId,changes:d1(f)})))})(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),(function(i,l,c){let u=i.Vu[i.currentUser.toKey()];u||(u=new _t(Ge)),u=u.insert(l,c),i.Vu[i.currentUser.toKey()]=u})(n,s.batchId,r),await io(n,s.changes),await pc(n.remoteStore)}catch(s){const a=zh(s,"Failed to persist write");r.reject(a)}}async function G1(t,e){const r=Be(t);try{const n=await KF(r.localStore,e);e.targetChanges.forEach(((s,a)=>{const i=r.Au.get(a);i&&(rt(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?i.hu=!0:s.modifiedDocuments.size>0?rt(i.hu,14607):s.removedDocuments.size>0&&(rt(i.hu,42227),i.hu=!1))})),await io(r,n,e)}catch(n){await Va(n)}}function rm(t,e,r){const n=Be(t);if(n.isPrimaryClient&&r===0||!n.isPrimaryClient&&r===1){const s=[];n.Tu.forEach(((a,i)=>{const l=i.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(i,l){const c=Be(i);c.onlineState=l;let u=!1;c.queries.forEach(((h,f)=>{for(const m of f.Sa)m.va(l)&&(u=!0)})),u&&Xh(c)})(n.eventManager,e),s.length&&n.Pu.H_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function Mj(t,e,r){const n=Be(t);n.sharedClientState.updateQueryState(e,"rejected",r);const s=n.Au.get(e),a=s&&s.key;if(a){let i=new _t(De.comparator);i=i.insert(a,lr.newNoDocument(a,Le.min()));const l=ze().add(a),c=new dc(Le.min(),new Map,new _t(Ge),i,l);await G1(n,c),n.du=n.du.remove(a),n.Au.delete(e),Zh(n)}else await Fu(n.localStore,e,!1).then((()=>Ou(n,e,r))).catch(Va)}async function Lj(t,e){const r=Be(t),n=e.batch.batchId;try{const s=await YF(r.localStore,e);Y1(r,n,null),z1(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await io(r,s)}catch(s){await Va(s)}}async function Bj(t,e,r){const n=Be(t);try{const s=await(function(i,l){const c=Be(i);return c.persistence.runTransaction("Reject batch","readwrite-primary",(u=>{let h;return c.mutationQueue.lookupMutationBatch(u,l).next((f=>(rt(f!==null,37113),h=f.keys(),c.mutationQueue.removeMutationBatch(u,f)))).next((()=>c.mutationQueue.performConsistencyCheck(u))).next((()=>c.documentOverlayCache.removeOverlaysForBatchId(u,h,l))).next((()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h))).next((()=>c.localDocuments.getDocuments(u,h)))}))})(n.localStore,e);Y1(n,e,r),z1(n,e),n.sharedClientState.updateMutationState(e,"rejected",r),await io(n,s)}catch(s){await Va(s)}}function z1(t,e){(t.mu.get(e)||[]).forEach((r=>{r.resolve()})),t.mu.delete(e)}function Y1(t,e,r){const n=Be(t);let s=n.Vu[n.currentUser.toKey()];if(s){const a=s.get(e);a&&(r?a.reject(r):a.resolve(),s=s.remove(e)),n.Vu[n.currentUser.toKey()]=s}}function Ou(t,e,r=null){t.sharedClientState.removeLocalQueryTarget(e);for(const n of t.Iu.get(e))t.Tu.delete(n),r&&t.Pu.yu(n,r);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((n=>{t.Ru.containsKey(n)||K1(t,n)}))}function K1(t,e){t.Eu.delete(e.path.canonicalString());const r=t.du.get(e);r!==null&&($h(t.remoteStore,r),t.du=t.du.remove(e),t.Au.delete(r),Zh(t))}function nm(t,e,r){for(const n of r)n instanceof H1?(t.Ru.addReference(n.key,e),Vj(t,n)):n instanceof W1?(Ie(Jh,"Document no longer in limbo: "+n.key),t.Ru.removeReference(n.key,e),t.Ru.containsKey(n.key)||K1(t,n.key)):je(19791,{wu:n})}function Vj(t,e){const r=e.key,n=r.path.canonicalString();t.du.get(r)||t.Eu.has(n)||(Ie(Jh,"New document in limbo: "+r),t.Eu.add(n),Zh(t))}function Zh(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const r=new De(mt.fromString(e)),n=t.fu.next();t.Au.set(n,new Ij(r)),t.du=t.du.insert(r,n),M1(t.remoteStore,new Kn(un(oc(r.path)),n,"TargetPurposeLimboResolution",sc.ce))}}async function io(t,e,r){const n=Be(t),s=[],a=[],i=[];n.Tu.isEmpty()||(n.Tu.forEach(((l,c)=>{i.push(n.pu(c,e,r).then((u=>{if((u||r)&&n.isPrimaryClient){const h=u?!u.fromCache:r?.targetChanges.get(c.targetId)?.current;n.sharedClientState.updateQueryState(c.targetId,h?"current":"not-current")}if(u){s.push(u);const h=Vh.As(c.targetId,u);a.push(h)}})))})),await Promise.all(i),n.Pu.H_(s),await(async function(c,u){const h=Be(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(f=>ie.forEach(u,(m=>ie.forEach(m.Es,(p=>h.persistence.referenceDelegate.addReference(f,m.targetId,p))).next((()=>ie.forEach(m.ds,(p=>h.persistence.referenceDelegate.removeReference(f,m.targetId,p)))))))))}catch(f){if(!Ua(f))throw f;Ie(Uh,"Failed to update sequence numbers: "+f)}for(const f of u){const m=f.targetId;if(!f.fromCache){const p=h.Ms.get(m),x=p.snapshotVersion,g=p.withLastLimboFreeSnapshotVersion(x);h.Ms=h.Ms.insert(m,g)}}})(n.localStore,a))}async function Uj(t,e){const r=Be(t);if(!r.currentUser.isEqual(e)){Ie(Jh,"User change. New user:",e.toKey());const n=await F1(r.localStore,e);r.currentUser=e,(function(a,i){a.mu.forEach((l=>{l.forEach((c=>{c.reject(new Te(ne.CANCELLED,i))}))})),a.mu.clear()})(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await io(r,n.Ls)}}function $j(t,e){const r=Be(t),n=r.Au.get(e);if(n&&n.hu)return ze().add(n.key);{let s=ze();const a=r.Iu.get(e);if(!a)return s;for(const i of a){const l=r.Tu.get(i);s=s.unionWith(l.view.nu)}return s}}function X1(t){const e=Be(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=G1.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=$j.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Mj.bind(null,e),e.Pu.H_=Aj.bind(null,e.eventManager),e.Pu.yu=Sj.bind(null,e.eventManager),e}function Hj(t){const e=Be(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Lj.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Bj.bind(null,e),e}class Dl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=fc(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,r){return null}Mu(e,r){return null}vu(e){return zF(this.persistence,new WF,e.initialUser,this.serializer)}Cu(e){return new D1(Bh.mi,this.serializer)}Du(e){return new ej}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Dl.provider={build:()=>new Dl};class Wj extends Dl{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,r){rt(this.persistence.referenceDelegate instanceof Pl,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new IF(n,e.asyncQueue,r)}Cu(e){const r=this.cacheSizeBytes!==void 0?yr.withCacheSize(this.cacheSizeBytes):yr.DEFAULT;return new D1((n=>Pl.mi(n,r)),this.serializer)}}class Mu{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>rm(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=Uj.bind(null,this.syncEngine),await bj(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Tj})()}createDatastore(e){const r=fc(e.databaseInfo.databaseId),n=(function(a){return new aj(a)})(e.databaseInfo);return(function(a,i,l,c){return new cj(a,i,l,c)})(e.authCredentials,e.appCheckCredentials,n,r)}createRemoteStore(e){return(function(n,s,a,i,l){return new hj(n,s,a,i,l)})(this.localStore,this.datastore,e.asyncQueue,(r=>rm(this.syncEngine,r,0)),(function(){return X0.v()?new X0:new tj})())}createSyncEngine(e,r){return(function(s,a,i,l,c,u,h){const f=new Pj(s,a,i,l,c,u);return h&&(f.gu=!0),f})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){await(async function(r){const n=Be(r);Ie(Bs,"RemoteStore shutting down."),n.Ea.add(5),await ao(n),n.Aa.shutdown(),n.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Mu.provider={build:()=>new Mu};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ed{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Fn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,r){setTimeout((()=>{this.muted||e(r)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hs="FirestoreClient";class qj{constructor(e,r,n,s,a){this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=n,this.databaseInfo=s,this.user=or.UNAUTHENTICATED,this.clientId=Nh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(n,(async i=>{Ie(hs,"Received user=",i.uid),await this.authCredentialListener(i),this.user=i})),this.appCheckCredentials.start(n,(i=>(Ie(hs,"Received new app check token=",i),this.appCheckCredentialListener(i,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Sn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const n=zh(r,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Qc(t,e){t.asyncQueue.verifyOperationInProgress(),Ie(hs,"Initializing OfflineComponentProvider");const r=t.configuration;await e.initialize(r);let n=r.initialUser;t.setCredentialChangeListener((async s=>{n.isEqual(s)||(await F1(e.localStore,s),n=s)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function sm(t,e){t.asyncQueue.verifyOperationInProgress();const r=await Gj(t);Ie(hs,"Initializing OnlineComponentProvider"),await e.initialize(r,t.configuration),t.setCredentialChangeListener((n=>J0(e.remoteStore,n))),t.setAppCheckTokenChangeListener(((n,s)=>J0(e.remoteStore,s))),t._onlineComponents=e}async function Gj(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ie(hs,"Using user provided OfflineComponentProvider");try{await Qc(t,t._uninitializedComponentsProvider._offline)}catch(e){const r=e;if(!(function(s){return s.name==="FirebaseError"?s.code===ne.FAILED_PRECONDITION||s.code===ne.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(r))throw r;Ta("Error using user provided cache. Falling back to memory cache: "+r),await Qc(t,new Dl)}}else Ie(hs,"Using default OfflineComponentProvider"),await Qc(t,new Wj(void 0));return t._offlineComponents}async function Q1(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ie(hs,"Using user provided OnlineComponentProvider"),await sm(t,t._uninitializedComponentsProvider._online)):(Ie(hs,"Using default OnlineComponentProvider"),await sm(t,new Mu))),t._onlineComponents}function zj(t){return Q1(t).then((e=>e.syncEngine))}async function Fl(t){const e=await Q1(t),r=e.eventManager;return r.onListen=Rj.bind(null,e.syncEngine),r.onUnlisten=jj.bind(null,e.syncEngine),r.onFirstRemoteStoreListen=Dj.bind(null,e.syncEngine),r.onLastRemoteStoreUnlisten=kj.bind(null,e.syncEngine),r}function Yj(t,e,r={}){const n=new Sn;return t.asyncQueue.enqueueAndForget((async()=>(function(a,i,l,c,u){const h=new ed({next:m=>{h.Nu(),i.enqueueAndForget((()=>Kh(a,f)));const p=m.docs.has(l);!p&&m.fromCache?u.reject(new Te(ne.UNAVAILABLE,"Failed to get document because the client is offline.")):p&&m.fromCache&&c&&c.source==="server"?u.reject(new Te(ne.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new Qh(oc(l.path),h,{includeMetadataChanges:!0,qa:!0});return Yh(a,f)})(await Fl(t),t.asyncQueue,e,r,n))),n.promise}function Kj(t,e,r={}){const n=new Sn;return t.asyncQueue.enqueueAndForget((async()=>(function(a,i,l,c,u){const h=new ed({next:m=>{h.Nu(),i.enqueueAndForget((()=>Kh(a,f))),m.fromCache&&c.source==="server"?u.reject(new Te(ne.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new Qh(l,h,{includeMetadataChanges:!0,qa:!0});return Yh(a,f)})(await Fl(t),t.asyncQueue,e,r,n))),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J1(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const am=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z1="firestore.googleapis.com",im=!0;class om{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Te(ne.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Z1,this.ssl=im}else this.host=e.host,this.ssl=e.ssl??im;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=R1;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<NF)throw new Te(ne.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}u3("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=J1(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new Te(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new Te(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new Te(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,s){return n.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class gc{constructor(e,r,n,s){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new om({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Te(ne.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Te(ne.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new om(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new e3;switch(n.type){case"firstParty":return new s3(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new Te(ne.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(r){const n=am.get(r);n&&(Ie("ComponentProvider","Removing Datastore"),am.delete(r),n.terminate())})(this),Promise.resolve()}}function Xj(t,e,r,n={}){t=Fr(t,gc);const s=Th(e),a=t._getSettings(),i={...a,emulatorOptions:t._getEmulatorOptions()},l=`${e}:${r}`;s&&(IR(`https://${l}`),FR("Firestore",!0)),a.host!==Z1&&a.host!==l&&Ta("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...a,host:l,ssl:s,emulatorOptions:n};if(!wl(c,i)&&(t._setSettings(c),n.mockUserToken)){let u,h;if(typeof n.mockUserToken=="string")u=n.mockUserToken,h=or.MOCK_USER;else{u=PR(n.mockUserToken,t._app?.options.projectId);const f=n.mockUserToken.sub||n.mockUserToken.user_id;if(!f)throw new Te(ne.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new or(f)}t._authCredentials=new t3(new Hx(u,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e,r,n){this.converter=r,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new ys(this.firestore,e,this._query)}}class Tt{constructor(e,r,n){this.converter=r,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Zn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Tt(this.firestore,e,this._key)}toJSON(){return{type:Tt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,r,n){if(ro(r,Tt._jsonSchema))return new Tt(e,n||null,new De(mt.fromString(r.referencePath)))}}Tt._jsonSchemaVersion="firestore/documentReference/1.0",Tt._jsonSchema={type:Rt("string",Tt._jsonSchemaVersion),referencePath:Rt("string")};class Zn extends ys{constructor(e,r,n){super(e,r,oc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Tt(this.firestore,null,new De(e))}withConverter(e){return new Zn(this.firestore,e,this._path)}}function ev(t,e,...r){if(t=Vr(t),Wx("collection","path",e),t instanceof gc){const n=mt.fromString(e,...r);return _0(n),new Zn(t,null,n)}{if(!(t instanceof Tt||t instanceof Zn))throw new Te(ne.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(mt.fromString(e,...r));return _0(n),new Zn(t.firestore,null,n)}}function qt(t,e,...r){if(t=Vr(t),arguments.length===1&&(e=Nh.newId()),Wx("doc","path",e),t instanceof gc){const n=mt.fromString(e,...r);return y0(n),new Tt(t,null,new De(n))}{if(!(t instanceof Tt||t instanceof Zn))throw new Te(ne.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(mt.fromString(e,...r));return y0(n),new Tt(t.firestore,t instanceof Zn?t.converter:null,new De(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lm="AsyncQueue";class cm{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new k1(this,"async_queue_retry"),this._c=()=>{const n=Xc();n&&Ie(lm,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const r=Xc();r&&typeof r.addEventListener=="function"&&r.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const r=Xc();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const r=new Sn;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(r.resolve,r.reject),r.promise))).then((()=>r.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Ua(e))throw e;Ie(lm,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const r=this.ac.then((()=>(this.rc=!0,e().catch((n=>{throw this.nc=n,this.rc=!1,Fn("INTERNAL UNHANDLED ERROR: ",um(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=r,r}enqueueAfterDelay(e,r,n){this.uc(),this.oc.indexOf(e)>-1&&(r=0);const s=Gh.createAndSchedule(this,e,r,n,(a=>this.hc(a)));return this.tc.push(s),s}uc(){this.nc&&je(47125,{Pc:um(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const r of this.tc)if(r.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((r,n)=>r.targetTimeMs-n.targetTimeMs));for(const r of this.tc)if(r.skipDelay(),e!=="all"&&r.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const r=this.tc.indexOf(e);this.tc.splice(r,1)}}function um(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(t){return(function(r,n){if(typeof r!="object"||r===null)return!1;const s=r;for(const a of n)if(a in s&&typeof s[a]=="function")return!0;return!1})(t,["next","error","complete"])}class ds extends gc{constructor(e,r,n,s){super(e,r,n,s),this.type="firestore",this._queue=new cm,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new cm(e),this._firestoreClient=void 0,await e}}}function Qj(t,e){const r=typeof t=="object"?t:HD(),n=typeof t=="string"?t:Al,s=LD(r,"firestore").getImmediate({identifier:n});if(!s._initialized){const a=NR("firestore");a&&Xj(s,...a)}return s}function oo(t){if(t._terminated)throw new Te(ne.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||Jj(t),t._firestoreClient}function Jj(t){const e=t._freezeSettings(),r=(function(s,a,i,l){return new w3(s,a,i,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,J1(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new qj(t._authCredentials,t._appCheckCredentials,t._queue,r,t._componentsProvider&&(function(s){const a=s?._online.build();return{_offline:s?._offline.build(a),_online:a}})(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Lr(er.fromBase64String(e))}catch(r){throw new Te(ne.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new Lr(er.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Lr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ro(e,Lr._jsonSchema))return Lr.fromBase64String(e.bytes)}}Lr._jsonSchemaVersion="firestore/bytes/1.0",Lr._jsonSchema={type:Rt("string",Lr._jsonSchemaVersion),bytes:Rt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new Te(ne.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Qt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new Te(ne.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new Te(ne.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ge(this._lat,e._lat)||Ge(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:dn._jsonSchemaVersion}}static fromJSON(e){if(ro(e,dn._jsonSchema))return new dn(e.latitude,e.longitude)}}dn._jsonSchemaVersion="firestore/geoPoint/1.0",dn._jsonSchema={type:Rt("string",dn._jsonSchemaVersion),latitude:Rt("number"),longitude:Rt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e){this._values=(e||[]).map((r=>r))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(n,s){if(n.length!==s.length)return!1;for(let a=0;a<n.length;++a)if(n[a]!==s[a])return!1;return!0})(this._values,e._values)}toJSON(){return{type:fn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ro(e,fn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((r=>typeof r=="number")))return new fn(e.vectorValues);throw new Te(ne.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}fn._jsonSchemaVersion="firestore/vectorValue/1.0",fn._jsonSchema={type:Rt("string",fn._jsonSchemaVersion),vectorValues:Rt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zj=/^__.*__$/;class e6{constructor(e,r,n){this.data=e,this.fieldMask=r,this.fieldTransforms=n}toMutation(e,r){return this.fieldMask!==null?new vs(e,this.data,this.fieldMask,r,this.fieldTransforms):new no(e,this.data,r,this.fieldTransforms)}}class tv{constructor(e,r,n){this.data=e,this.fieldMask=r,this.fieldTransforms=n}toMutation(e,r){return new vs(e,this.data,this.fieldMask,r,this.fieldTransforms)}}function rv(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw je(40011,{Ac:t})}}class td{constructor(e,r,n,s,a,i){this.settings=e,this.databaseId=r,this.serializer=n,this.ignoreUndefinedProperties=s,a===void 0&&this.Rc(),this.fieldTransforms=a||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new td({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const r=this.path?.child(e),n=this.Vc({path:r,fc:!1});return n.gc(e),n}yc(e){const r=this.path?.child(e),n=this.Vc({path:r,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return jl(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((r=>e.isPrefixOf(r)))!==void 0||this.fieldTransforms.find((r=>e.isPrefixOf(r.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(rv(this.Ac)&&Zj.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class t6{constructor(e,r,n){this.databaseId=e,this.ignoreUndefinedProperties=r,this.serializer=n||fc(e)}Cc(e,r,n,s=!1){return new td({Ac:e,methodName:r,Dc:n,path:Qt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vc(t){const e=t._freezeSettings(),r=fc(t._databaseId);return new t6(t._databaseId,!!e.ignoreUndefinedProperties,r)}function nv(t,e,r,n,s,a={}){const i=t.Cc(a.merge||a.mergeFields?2:0,e,r,s);nd("Data must be an object, but it was:",i,n);const l=iv(n,i);let c,u;if(a.merge)c=new Rr(i.fieldMask),u=i.fieldTransforms;else if(a.mergeFields){const h=[];for(const f of a.mergeFields){const m=Lu(e,f,r);if(!i.contains(m))throw new Te(ne.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);lv(h,m)||h.push(m)}c=new Rr(h),u=i.fieldTransforms.filter((f=>c.covers(f.field)))}else c=null,u=i.fieldTransforms;return new e6(new _r(l),c,u)}class co extends xc{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof co}}class rd extends xc{_toFieldTransform(e){return new z3(e.path,new Ui)}isEqual(e){return e instanceof rd}}function sv(t,e,r,n){const s=t.Cc(1,e,r);nd("Data must be an object, but it was:",s,n);const a=[],i=_r.empty();xs(n,((c,u)=>{const h=sd(e,c,r);u=Vr(u);const f=s.yc(h);if(u instanceof co)a.push(h);else{const m=uo(u,f);m!=null&&(a.push(h),i.set(h,m))}}));const l=new Rr(a);return new tv(i,l,s.fieldTransforms)}function av(t,e,r,n,s,a){const i=t.Cc(1,e,r),l=[Lu(e,n,r)],c=[s];if(a.length%2!=0)throw new Te(ne.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<a.length;m+=2)l.push(Lu(e,a[m])),c.push(a[m+1]);const u=[],h=_r.empty();for(let m=l.length-1;m>=0;--m)if(!lv(u,l[m])){const p=l[m];let x=c[m];x=Vr(x);const g=i.yc(p);if(x instanceof co)u.push(p);else{const y=uo(x,g);y!=null&&(u.push(p),h.set(p,y))}}const f=new Rr(u);return new tv(h,f,i.fieldTransforms)}function r6(t,e,r,n=!1){return uo(r,t.Cc(n?4:3,e))}function uo(t,e){if(ov(t=Vr(t)))return nd("Unsupported field value:",e,t),iv(t,e);if(t instanceof xc)return(function(n,s){if(!rv(s.Ac))throw s.Sc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${n._methodName}() is not currently supported inside arrays`);const a=n._toFieldTransform(s);a&&s.fieldTransforms.push(a)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(n,s){const a=[];let i=0;for(const l of n){let c=uo(l,s.wc(i));c==null&&(c={nullValue:"NULL_VALUE"}),a.push(c),i++}return{arrayValue:{values:a}}})(t,e)}return(function(n,s){if((n=Vr(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return W3(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const a=gt.fromDate(n);return{timestampValue:Il(s.serializer,a)}}if(n instanceof gt){const a=new gt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Il(s.serializer,a)}}if(n instanceof dn)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Lr)return{bytesValue:T1(s.serializer,n._byteString)};if(n instanceof Tt){const a=s.databaseId,i=n.firestore._databaseId;if(!i.isEqual(a))throw s.Sc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:Mh(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof fn)return(function(i,l){return{mapValue:{fields:{[Zx]:{stringValue:e1},[Sl]:{arrayValue:{values:i.toArray().map((u=>{if(typeof u!="number")throw l.Sc("VectorValues must only contain numeric values.");return Fh(l.serializer,u)}))}}}}}})(n,s);throw s.Sc(`Unsupported field value: ${nc(n)}`)})(t,e)}function iv(t,e){const r={};return zx(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):xs(t,((n,s)=>{const a=uo(s,e.mc(n));a!=null&&(r[n]=a)})),{mapValue:{fields:r}}}function ov(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof gt||t instanceof dn||t instanceof Lr||t instanceof Tt||t instanceof xc||t instanceof fn)}function nd(t,e,r){if(!ov(r)||!qx(r)){const n=nc(r);throw n==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+n)}}function Lu(t,e,r){if((e=Vr(e))instanceof lo)return e._internalPath;if(typeof e=="string")return sd(t,e);throw jl("Field path arguments must be of type string or ",t,!1,void 0,r)}const n6=new RegExp("[~\\*/\\[\\]]");function sd(t,e,r){if(e.search(n6)>=0)throw jl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new lo(...e.split("."))._internalPath}catch{throw jl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function jl(t,e,r,n,s){const a=n&&!n.isEmpty(),i=s!==void 0;let l=`Function ${e}() called with invalid data`;r&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(a||i)&&(c+=" (found",a&&(c+=` in field ${n}`),i&&(c+=` in document ${s}`),c+=")"),new Te(ne.INVALID_ARGUMENT,l+t+c)}function lv(t,e){return t.some((r=>r.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{constructor(e,r,n,s,a){this._firestore=e,this._userDataWriter=r,this._key=n,this._document=s,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new Tt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new s6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const r=this._document.data.field(ad("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r)}}}class s6 extends cv{data(){return super.data()}}function ad(t,e){return typeof e=="string"?sd(t,e):e instanceof lo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uv(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Te(ne.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class id{}class hv extends id{}function dv(t,e,...r){let n=[];e instanceof id&&n.push(e),n=n.concat(r),(function(a){const i=a.filter((c=>c instanceof ld)).length,l=a.filter((c=>c instanceof od)).length;if(i>1||i>0&&l>0)throw new Te(ne.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const s of n)t=s._apply(t);return t}class od extends hv{constructor(e,r,n){super(),this._field=e,this._op=r,this._value=n,this.type="where"}static _create(e,r,n){return new od(e,r,n)}_apply(e){const r=this._parse(e);return mv(e._query,r),new ys(e.firestore,e.converter,Nu(e._query,r))}_parse(e){const r=vc(e.firestore);return(function(a,i,l,c,u,h,f){let m;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new Te(ne.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){fm(f,h);const x=[];for(const g of f)x.push(dm(c,a,g));m={arrayValue:{values:x}}}else m=dm(c,a,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||fm(f,h),m=r6(l,i,f,h==="in"||h==="not-in");return Pt.create(u,h,m)})(e._query,"where",r,e.firestore._databaseId,this._field,this._op,this._value)}}class ld extends id{constructor(e,r){super(),this.type=e,this._queryConstraints=r}static _create(e,r){return new ld(e,r)}_parse(e){const r=this._queryConstraints.map((n=>n._parse(e))).filter((n=>n.getFilters().length>0));return r.length===1?r[0]:Qr.create(r,this._getOperator())}_apply(e){const r=this._parse(e);return r.getFilters().length===0?e:((function(s,a){let i=s;const l=a.getFlattenedFilters();for(const c of l)mv(i,c),i=Nu(i,c)})(e._query,r),new ys(e.firestore,e.converter,Nu(e._query,r)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class cd extends hv{constructor(e,r){super(),this._field=e,this._direction=r,this.type="orderBy"}static _create(e,r){return new cd(e,r)}_apply(e){const r=(function(s,a,i){if(s.startAt!==null)throw new Te(ne.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Te(ne.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Vi(a,i)})(e._query,this._field,this._direction);return new ys(e.firestore,e.converter,(function(s,a){const i=s.explicitOrderBy.concat([a]);return new $a(s.path,s.collectionGroup,i,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(e._query,r))}}function fv(t,e="asc"){const r=e,n=ad("orderBy",t);return cd._create(n,r)}function dm(t,e,r){if(typeof(r=Vr(r))=="string"){if(r==="")throw new Te(ne.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!l1(e)&&r.indexOf("/")!==-1)throw new Te(ne.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const n=e.path.child(mt.fromString(r));if(!De.isDocumentKey(n))throw new Te(ne.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return C0(t,new De(n))}if(r instanceof Tt)return C0(t,r._key);throw new Te(ne.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${nc(r)}.`)}function fm(t,e){if(!Array.isArray(t)||t.length===0)throw new Te(ne.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function mv(t,e){const r=(function(s,a){for(const i of s)for(const l of i.getFlattenedFilters())if(a.indexOf(l.op)>=0)return l.op;return null})(t.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(r!==null)throw r===e.op?new Te(ne.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Te(ne.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${r.toString()}' filters.`)}class a6{convertValue(e,r="none"){switch(cs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Nt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,r);case 5:return e.stringValue;case 6:return this.convertBytes(ls(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,r);case 11:return this.convertObject(e.mapValue,r);case 10:return this.convertVectorValue(e.mapValue);default:throw je(62114,{value:e})}}convertObject(e,r){return this.convertObjectMap(e.fields,r)}convertObjectMap(e,r="none"){const n={};return xs(e,((s,a)=>{n[s]=this.convertValue(a,r)})),n}convertVectorValue(e){const r=e.fields?.[Sl].arrayValue?.values?.map((n=>Nt(n.doubleValue)));return new fn(r)}convertGeoPoint(e){return new dn(Nt(e.latitude),Nt(e.longitude))}convertArray(e,r){return(e.values||[]).map((n=>this.convertValue(n,r)))}convertServerTimestamp(e,r){switch(r){case"previous":const n=ic(e);return n==null?null:this.convertValue(n,r);case"estimate":return this.convertTimestamp(Mi(e));default:return null}}convertTimestamp(e){const r=os(e);return new gt(r.seconds,r.nanos)}convertDocumentKey(e,r){const n=mt.fromString(e);rt(P1(n),9688,{name:e});const s=new Li(n.get(1),n.get(3)),a=new De(n.popFirst(5));return s.isEqual(r)||Fn(`Document ${a} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pv(t,e,r){let n;return n=t?r&&(r.merge||r.mergeFields)?t.toFirestore(e,r):t.toFirestore(e):e,n}class li{constructor(e,r){this.hasPendingWrites=e,this.fromCache=r}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Rs extends cv{constructor(e,r,n,s,a,i){super(e,r,n,s,i),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const r=new Qo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,r={}){if(this._document){const n=this._document.data.field(ad("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,r.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Te(ne.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,r={};return r.type=Rs._jsonSchemaVersion,r.bundle="",r.bundleSource="DocumentSnapshot",r.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?r:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),r.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),r)}}Rs._jsonSchemaVersion="firestore/documentSnapshot/1.0",Rs._jsonSchema={type:Rt("string",Rs._jsonSchemaVersion),bundleSource:Rt("string","DocumentSnapshot"),bundleName:Rt("string"),bundle:Rt("string")};class Qo extends Rs{data(e={}){return super.data(e)}}class Ds{constructor(e,r,n,s){this._firestore=e,this._userDataWriter=r,this._snapshot=s,this.metadata=new li(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach((r=>e.push(r))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,r){this._snapshot.docs.forEach((n=>{e.call(r,new Qo(this._firestore,this._userDataWriter,n.key,n,new li(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const r=!!e.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new Te(ne.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=(function(s,a){if(s._snapshot.oldDocs.isEmpty()){let i=0;return s._snapshot.docChanges.map((l=>{const c=new Qo(s._firestore,s._userDataWriter,l.doc.key,l.doc,new li(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:i++}}))}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>a||l.type!==3)).map((l=>{const c=new Qo(s._firestore,s._userDataWriter,l.doc.key,l.doc,new li(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return l.type!==0&&(u=i.indexOf(l.doc.key),i=i.delete(l.doc.key)),l.type!==1&&(i=i.add(l.doc),h=i.indexOf(l.doc.key)),{type:i6(l.type),doc:c,oldIndex:u,newIndex:h}}))}})(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Te(ne.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Ds._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Nh.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const r=[],n=[],s=[];return this.docs.forEach((a=>{a._document!==null&&(r.push(a._document),n.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),s.push(a.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function i6(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return je(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tr(t){t=Fr(t,Tt);const e=Fr(t.firestore,ds);return Yj(oo(e),t._key).then((r=>yv(e,t,r)))}Ds._jsonSchemaVersion="firestore/querySnapshot/1.0",Ds._jsonSchema={type:Rt("string",Ds._jsonSchemaVersion),bundleSource:Rt("string","QuerySnapshot"),bundleName:Rt("string"),bundle:Rt("string")};class ud extends a6{constructor(e){super(),this.firestore=e}convertBytes(e){return new Lr(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new Tt(this.firestore,null,r)}}function o6(t){t=Fr(t,ys);const e=Fr(t.firestore,ds),r=oo(e),n=new ud(e);return uv(t._query),Kj(r,t._query).then((s=>new Ds(e,n,t,s)))}function gv(t,e,r){t=Fr(t,Tt);const n=Fr(t.firestore,ds),s=pv(t.converter,e,r);return hd(n,[nv(vc(n),"setDoc",t._key,s,t.converter!==null,r).toMutation(t._key,jr.none())])}function xv(t,e,r,...n){t=Fr(t,Tt);const s=Fr(t.firestore,ds),a=vc(s);let i;return i=typeof(e=Vr(e))=="string"||e instanceof lo?av(a,"updateDoc",t._key,e,r,n):sv(a,"updateDoc",t._key,e),hd(s,[i.toMutation(t._key,jr.exists(!0))])}function vv(t,...e){t=Vr(t);let r={includeMetadataChanges:!1,source:"default"},n=0;typeof e[n]!="object"||hm(e[n])||(r=e[n++]);const s={includeMetadataChanges:r.includeMetadataChanges,source:r.source};if(hm(e[n])){const c=e[n];e[n]=c.next?.bind(c),e[n+1]=c.error?.bind(c),e[n+2]=c.complete?.bind(c)}let a,i,l;if(t instanceof Tt)i=Fr(t.firestore,ds),l=oc(t._key.path),a={next:c=>{e[n]&&e[n](yv(i,t,c))},error:e[n+1],complete:e[n+2]};else{const c=Fr(t,ys);i=Fr(c.firestore,ds),l=c._query;const u=new ud(i);a={next:h=>{e[n]&&e[n](new Ds(i,u,c,h))},error:e[n+1],complete:e[n+2]},uv(t._query)}return(function(u,h,f,m){const p=new ed(m),x=new Qh(h,p,f);return u.asyncQueue.enqueueAndForget((async()=>Yh(await Fl(u),x))),()=>{p.Nu(),u.asyncQueue.enqueueAndForget((async()=>Kh(await Fl(u),x)))}})(oo(i),l,s,a)}function hd(t,e){return(function(n,s){const a=new Sn;return n.asyncQueue.enqueueAndForget((async()=>Oj(await zj(n),s,a))),a.promise})(oo(t),e)}function yv(t,e,r){const n=r.docs.get(e._key),s=new ud(t);return new Rs(t,s,e._key,n,new li(r.hasPendingWrites,r.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l6{constructor(e,r){this._firestore=e,this._commitHandler=r,this._mutations=[],this._committed=!1,this._dataReader=vc(e)}set(e,r,n){this._verifyNotCommitted();const s=Jc(e,this._firestore),a=pv(s.converter,r,n),i=nv(this._dataReader,"WriteBatch.set",s._key,a,s.converter!==null,n);return this._mutations.push(i.toMutation(s._key,jr.none())),this}update(e,r,n,...s){this._verifyNotCommitted();const a=Jc(e,this._firestore);let i;return i=typeof(r=Vr(r))=="string"||r instanceof lo?av(this._dataReader,"WriteBatch.update",a._key,r,n,s):sv(this._dataReader,"WriteBatch.update",a._key,r),this._mutations.push(i.toMutation(a._key,jr.exists(!0))),this}delete(e){this._verifyNotCommitted();const r=Jc(e,this._firestore);return this._mutations=this._mutations.concat(new jh(r._key,jr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Te(ne.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Jc(t,e){if((t=Vr(t)).firestore!==e)throw new Te(ne.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mm(){return new co("deleteField")}function Vs(){return new rd("serverTimestamp")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dd(t){return oo(t=Fr(t,ds)),new l6(t,(e=>hd(t,e)))}(function(e,r=!0){(function(s){Ba=s})($D),El(new ji("firestore",((n,{instanceIdentifier:s,options:a})=>{const i=n.getProvider("app").getImmediate(),l=new ds(new r3(n.getProvider("auth-internal")),new a3(i,n.getProvider("app-check-internal")),(function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Te(ne.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Li(u.options.projectId,h)})(i,s),i);return a={useFetchStreams:r,...a},l._setSettings(a),l}),"PUBLIC").setMultipleInstances(!0)),va(p0,g0,e),va(p0,g0,"esm2020")})();var c6="firebase",u6="12.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */va(c6,u6,"app");const Ss={apiKey:"AIzaSyDrVR30sIBPBDjdISVzmf6a89yYt3hsrmw",authDomain:"credit-castor.firebaseapp.com",projectId:"credit-castor",storageBucket:"credit-castor.firebasestorage.app",messagingSenderId:"333663202165",appId:"1:333663202165:web:ed09ad1f3cbc75e3f4013c"};function h6(){return!!(Ss.apiKey&&Ss.authDomain&&Ss.projectId&&Ss.storageBucket&&Ss.messagingSenderId&&Ss.appId)}let ri=null,ha=null;function _v(){if(ri&&ha)return{app:ri,db:ha};if(!h6())return console.warn(`Firebase is not configured. Please add Firebase environment variables to .env file.
Required variables:
  - VITE_FIREBASE_API_KEY
  - VITE_FIREBASE_AUTH_DOMAIN
  - VITE_FIREBASE_PROJECT_ID
  - VITE_FIREBASE_STORAGE_BUCKET
  - VITE_FIREBASE_MESSAGING_SENDER_ID
  - VITE_FIREBASE_APP_ID

The app will continue to work with localStorage-only mode.`),{app:null,db:null};try{return ri=Fx(Ss),ha=Qj(ri),console.log(" Firebase initialized successfully"),{app:ri,db:ha}}catch(t){return console.error(" Failed to initialize Firebase:",t),{app:null,db:null}}}function tr(){if(!ha){const{db:t}=_v();return t}return ha}const sa={maxTotalLots:Da,travauxCommuns:{enabled:!1,items:[{label:"Travaux communs",sqm:336,cascoPricePerSqm:600,parachevementPricePerSqm:200}]}};function d6(t){const e={...t};return(!("maxTotalLots"in e)||!e.maxTotalLots||typeof e.maxTotalLots!="number"||e.maxTotalLots<=0)&&(e.maxTotalLots=sa.maxTotalLots,console.log(" Initializing maxTotalLots to default value:",sa.maxTotalLots)),(!e.travauxCommuns||typeof e.travauxCommuns!="object"||!e.travauxCommuns.items||!Array.isArray(e.travauxCommuns.items)||e.travauxCommuns.items.length===0)&&(e.travauxCommuns={...sa.travauxCommuns},console.log(" Initializing travauxCommuns to default values:",{sqm:sa.travauxCommuns.items[0].sqm,cascoPricePerSqm:sa.travauxCommuns.items[0].cascoPricePerSqm,parachevementPricePerSqm:sa.travauxCommuns.items[0].parachevementPricePerSqm})),e}const yc="shared-project";async function wv(t,e){try{const r=tr();if(!r)return{success:!1,error:"Firebase non configur. Sauvegarde locale uniquement."};const n=e&&e.trim().length>0?e.trim():"anonymous-user",s=qt(r,"projects",yc),a=await Tr(s),i=a.exists()&&a.data()?.participantsInSubcollection===!0;if(!t.projectParams||!t.deedDate||!t.portageFormula)return{success:!1,error:"Donnes incompltes: projectParams, deedDate ou portageFormula manquants."};const l=gi(t.projectParams);t={...t,projectParams:l};let c={};if(a.exists()){const h=a.data();if(h.projectParams&&(c={...h.projectParams},"maxTotalLots"in c)){const f=c.maxTotalLots;(f==null||f===0||typeof f=="number"&&!Number.isInteger(f)||typeof f=="number"&&f<=0)&&delete c.maxTotalLots}}Object.keys(t.projectParams).forEach(h=>{const f=t.projectParams[h];f!==void 0&&(c[h]=f)}),Object.keys(t.projectParams).forEach(h=>{if(!(h in c)){const f=t.projectParams[h];f!=null&&(c[h]=f)}});const u={projectParams:c,deedDate:t.deedDate,portageFormula:t.portageFormula,lastModifiedBy:n,lastModifiedAt:new Date().toISOString(),serverTimestamp:Vs(),version:t.version||1};if(Object.keys(u).forEach(h=>{u[h]===void 0&&delete u[h]}),u.projectParams&&typeof u.projectParams=="object"){const h={};Object.keys(u.projectParams).forEach(f=>{const m=u.projectParams[f];f==="maxTotalLots"?typeof m=="number"&&m>0&&Number.isInteger(m)&&(h[f]=m):m!=null&&(h[f]=m)}),u.projectParams=h}if(!a.exists()&&u.projectParams&&(u.projectParams=d6(u.projectParams)),i?u.participantsInSubcollection=!0:u.participants=t.participants,t.fieldVersions&&(u.fieldVersions=t.fieldVersions),console.log(" Saving to Firestore:",{documentExists:a.exists(),usesSubcollections:i,lastModifiedBy:u.lastModifiedBy,hasProjectParams:!!u.projectParams,hasParticipants:!!u.participants,version:u.version,maxTotalLots:u.projectParams?.maxTotalLots,projectParamsKeys:u.projectParams?Object.keys(u.projectParams):[],existingMaxTotalLots:a.exists()?a.data()?.projectParams?.maxTotalLots:void 0}),u.projectParams&&(console.log(" projectParams being saved:",JSON.stringify(u.projectParams,null,2)),console.log(" maxTotalLots in projectParams?","maxTotalLots"in u.projectParams),console.log(" maxTotalLots value:",u.projectParams.maxTotalLots)),console.log(" Input data.projectParams keys:",t.projectParams?Object.keys(t.projectParams):[]),console.log(" Input data.projectParams.maxTotalLots:",t.projectParams?.maxTotalLots),console.log(" Input data.projectParams.travauxCommuns:",t.projectParams?.travauxCommuns?"exists":"missing"),a.exists()){const h={projectParams:u.projectParams,deedDate:u.deedDate,portageFormula:u.portageFormula,lastModifiedBy:u.lastModifiedBy,lastModifiedAt:u.lastModifiedAt,serverTimestamp:u.serverTimestamp,version:u.version},m=a.data()?.projectParams,p=m?.maxTotalLots,x=u.projectParams?.maxTotalLots,g=m&&"maxTotalLots"in m;if(console.log(" Checking maxTotalLots:",{maxTotalLotsExistsInDoc:g,existingValue:p,existingType:typeof p,newExists:x!==void 0,newValue:x}),g&&x===void 0?(console.log(" Explicitly deleting maxTotalLots (exists in doc, not in new data):",p),h["projectParams.maxTotalLots"]=mm()):x!==void 0?typeof x=="number"&&Number.isInteger(x)&&x>0?console.log(" Keeping valid maxTotalLots:",x):(console.log(" Deleting invalid maxTotalLots from new data:",x),delete h.projectParams.maxTotalLots,h["projectParams.maxTotalLots"]=mm()):console.log(" maxTotalLots does not exist in document or new data, no action needed"),!i&&u.participants&&(h.participants=u.participants),u.fieldVersions&&(h.fieldVersions=u.fieldVersions),console.log(" Using updateDoc (document exists)"),console.log(" Update data being sent:",{hasProjectParams:!!h.projectParams,projectParamsKeys:h.projectParams?Object.keys(h.projectParams):[],hasMaxTotalLots:"projectParams.maxTotalLots"in h,lastModifiedBy:h.lastModifiedBy,lastModifiedByType:typeof h.lastModifiedBy,lastModifiedByLength:h.lastModifiedBy?.length,hasParticipants:!!h.participants,updateDataKeys:Object.keys(h)}),h.projectParams&&(console.log(" projectParams keys:",Object.keys(h.projectParams)),console.log(" maxTotalLots in projectParams?","maxTotalLots"in h.projectParams),console.log(" maxTotalLots value:",h.projectParams.maxTotalLots),console.log(" maxTotalLots type:",typeof h.projectParams.maxTotalLots),h.projectParams.travauxCommuns)){const y=h.projectParams.travauxCommuns;console.log(" travauxCommuns.enabled:",y.enabled,"type:",typeof y.enabled),console.log(" travauxCommuns.items:",Array.isArray(y.items)?"is array":"NOT ARRAY"),console.log(" travauxCommuns.items count:",y.items?.length),y.items&&y.items.length>0&&console.log(" First item:",JSON.stringify(y.items[0]))}console.log(" Full updateData (summary):",{hasProjectParams:!!h.projectParams,hasDeedDate:!!h.deedDate,hasPortageFormula:!!h.portageFormula,hasParticipants:!!h.participants,participantCount:h.participants?.length,version:h.version}),await xv(s,h)}else console.log(" Using setDoc (document does not exist)"),await gv(s,u);return{success:!0,savedData:u}}catch(r){const n=e&&e.trim().length>0?e.trim():"anonymous-user",s={userEmail:n,hasData:!!t,hasProjectParams:!!t?.projectParams,maxTotalLots:t?.projectParams?.maxTotalLots};return console.error("Error saving to Firestore:",r),console.error("Error code:",r?.code),console.error("Error message:",r?.message),console.error("User email (original):",e),console.error("User email (effective):",n),console.error("Data being saved:",s),{success:!1,error:r?.message||"Erreur lors de la sauvegarde sur Firestore."}}}async function f6(t,e,r){try{const n=tr();if(!n)return{success:!1,error:"Firebase non configur.",updatedFields:[]};const s=qt(n,"projects",yc),a=await Tr(s);if(!a.exists())return{success:!1,error:"Document does not exist. Use saveScenarioToFirestore for initial save.",updatedFields:[]};const i=a.data();if(i.version>r)return{success:!1,error:`Version conflict: local=${r}, remote=${i.version}`,updatedFields:[]};const l={...t,lastModifiedBy:e,lastModifiedAt:new Date().toISOString(),version:r+1,serverTimestamp:Vs()},c=i.fieldVersions||{},u=Object.keys(t);return u.forEach(h=>{const f=c[h]||0;c[h]=f+1}),l.fieldVersions=c,await xv(s,l),{success:!0,updatedFields:u}}catch(n){return console.error("Error updating Firestore fields:",n),{success:!1,error:"Erreur lors de la mise  jour des champs.",updatedFields:[]}}}function bv(t){const e=n=>{if(n){if(n&&typeof n=="object"){if(typeof n.toDate=="function")return n.toDate();if("seconds"in n&&"nanoseconds"in n)return new Date(n.seconds*1e3+n.nanoseconds/1e6)}if(n instanceof Date)return n;if(typeof n=="string")return new Date(n)}},r=t.participants.map(n=>{const s={...n};return n.entryDate&&(s.entryDate=e(n.entryDate)),n.exitDate&&(s.exitDate=e(n.exitDate)),n.lotsOwned&&(s.lotsOwned=n.lotsOwned.map(a=>{const i={...a};return a.acquiredDate&&(i.acquiredDate=e(a.acquiredDate)),a.soldDate&&(i.soldDate=e(a.soldDate)),i})),s});return{...t,participants:r}}async function bi(){try{const t=tr();if(!t)return{success:!1,error:"Firebase non configur.",errorType:"not-configured"};const e=qt(t,"projects",yc),r=await Tr(e);if(!r.exists())return{success:!1,error:"Aucune donne trouve sur Firestore.",errorType:"no-data"};const n=r.data();return{success:!0,data:bv(n)}}catch(t){console.error("Error loading from Firestore:",t);const e=t?.code||"",r=t?.message||"";return{success:!1,error:"Erreur lors du chargement depuis Firestore.",errorType:e==="unavailable"||e==="permission-denied"||r.includes("network")||r.includes("fetch")||r.includes("timeout")||r.includes("Failed to fetch")?"network-error":"unknown"}}}function pm(t){try{const e=tr();if(!e)return console.warn("Firebase not configured, cannot subscribe to changes"),null;const r=qt(e,"projects",yc);let n=!0;return vv(r,a=>{if(a.exists()){const i=a.data(),l=bv(i),c=a.metadata.hasPendingWrites?"local":"remote";t({data:l,source:c,isFirstLoad:n}),n=!1}},a=>{console.error("Error in Firestore snapshot listener:",a)})}catch(e){return console.error("Error subscribing to Firestore changes:",e),null}}function gm(t,e){return e>t?{hasConflict:!0,localVersion:t,remoteVersion:e,message:`Conflit dtect : version locale (${t}) vs version distante (${e})`}:{hasConflict:!1,localVersion:t,remoteVersion:e}}function Ev(){return tr()!==null}async function m6(t,e,r,n){try{const s=tr();if(!s)return{success:!1,error:"Firebase non configur."};const a=qt(s,"projects",r,"participants",e),i=await Tr(a),l=i.exists()?i.data().version:0,c={...t,lastModifiedBy:n,lastModifiedAt:new Date().toISOString(),version:l+1,serverTimestamp:Vs(),displayOrder:parseInt(e)};return await gv(a,c),{success:!0}}catch(s){return console.error("Error saving participant to subcollection:",s),{success:!1,error:"Erreur lors de la sauvegarde du participant."}}}async function Tv(t){try{const e=tr();if(!e)return{success:!1,error:"Firebase non configur."};const r=ev(e,"projects",t,"participants"),n=dv(r,fv("displayOrder","asc")),s=await o6(n),a=[];return s.forEach(i=>{const l=i.data(),{lastModifiedBy:c,lastModifiedAt:u,version:h,serverTimestamp:f,displayOrder:m,...p}=l;a.push(p)}),{success:!0,participants:a}}catch(e){return console.error("Error loading participants from subcollection:",e),{success:!1,error:"Erreur lors du chargement des participants."}}}async function p6(t,e){try{const r=tr();if(!r)return{success:!1,error:"Firebase non configur."};const n=qt(r,"projects",t),s=await Tr(n);if(!s.exists())return{success:!1,error:"Project document does not exist."};const a=s.data();if(a.participantsInSubcollection)return{success:!0,migratedCount:0,error:"Already migrated."};const i=a.participants||[],l=dd(r);i.forEach((u,h)=>{const f=qt(r,"projects",t,"participants",h.toString()),m={...u,lastModifiedBy:e,lastModifiedAt:new Date().toISOString(),version:1,displayOrder:h,serverTimestamp:Vs()};l.set(f,m)});const c={participantsInSubcollection:!0,lastModifiedBy:e,lastModifiedAt:new Date().toISOString(),serverTimestamp:Vs()};return l.update(n,{...c,participants:[]}),await l.commit(),console.log(` Migrated ${i.length} participants to subcollection`),{success:!0,migratedCount:i.length}}catch(r){return console.error("Error migrating participants to subcollection:",r),{success:!1,error:"Erreur lors de la migration des participants."}}}function g6(t,e){try{const r=tr();if(!r)return console.warn("Firebase not configured"),null;const n=ev(r,"projects",t,"participants"),s=dv(n,fv("displayOrder","asc"));return vv(s,i=>{const l=[],c=i.metadata.hasPendingWrites?"local":"remote";i.forEach(u=>{const h=u.data(),{lastModifiedBy:f,lastModifiedAt:m,version:p,serverTimestamp:x,displayOrder:g,...y}=h;l.push(y)}),e(l,c)},i=>{console.error("Error in participants collection listener:",i)})}catch(r){return console.error("Error subscribing to participants collection:",r),null}}function x6(t,e){if(t.name!==e.name||t.enabled!==e.enabled||t.capitalApporte!==e.capitalApporte||t.registrationFeesRate!==e.registrationFeesRate||t.interestRate!==e.interestRate||t.durationYears!==e.durationYears||t.useTwoLoans!==e.useTwoLoans||t.loan2DelayYears!==e.loan2DelayYears||t.loan2RenovationAmount!==e.loan2RenovationAmount||t.capitalForLoan1!==e.capitalForLoan1||t.capitalForLoan2!==e.capitalForLoan2||t.isFounder!==e.isFounder)return!1;const r=t.entryDate?new Date(t.entryDate).getTime():null,n=e.entryDate?new Date(e.entryDate).getTime():null;if(r!==n)return!1;const s=t.exitDate?new Date(t.exitDate).getTime():null,a=e.exitDate?new Date(e.exitDate).getTime():null;return!(s!==a||t.unitId!==e.unitId||t.surface!==e.surface||t.quantity!==e.quantity||t.parachevementsPerM2!==e.parachevementsPerM2||t.cascoSqm!==e.cascoSqm||t.parachevementsSqm!==e.parachevementsSqm||JSON.stringify(t.purchaseDetails)!==JSON.stringify(e.purchaseDetails)||JSON.stringify(t.lotsOwned)!==JSON.stringify(e.lotsOwned))}function Av(t,e){const r=[];if(t.length!==e.length)return e.map((n,s)=>s);for(let n=0;n<e.length;n++)x6(t[n],e[n])||r.push(n);return r}async function v6(t,e,r,n){try{const s=tr();if(!s)return{success:!1,error:"Firebase non configur.",syncedCount:0,syncedParticipantIds:[],skippedCount:0};const a=Av(t,e);if(a.length===0)return{success:!0,syncedCount:0,syncedParticipantIds:[],skippedCount:e.length};const i=[],l=[];for(const h of a){const f=h.toString(),m=qt(s,"projects",r,"participants",f);try{const p=await Tr(m);if(p.exists()){const x=p.data();i.push({participant:e[h],participantId:f,version:x.version+1})}else i.push({participant:e[h],participantId:f,version:1})}catch(p){console.error(`Error loading participant ${f}:`,p)}}if(i.length===0)return{success:!1,error:"No participants could be loaded for sync",syncedCount:0,syncedParticipantIds:[],skippedCount:a.length};const c=dd(s),u=new Date().toISOString();for(const{participant:h,participantId:f,version:m}of i){const p=qt(s,"projects",r,"participants",f),x={...h,lastModifiedBy:n,lastModifiedAt:u,version:m,serverTimestamp:Vs(),displayOrder:parseInt(f)};c.set(p,x)}return await c.commit(),{success:!0,syncedCount:i.length,syncedParticipantIds:i.map(h=>h.participantId),skippedCount:a.length-i.length,conflicts:l.length>0?l:void 0}}catch(s){return console.error("Error syncing changed participants:",s),{success:!1,error:"Erreur lors de la synchronisation des participants.",syncedCount:0,syncedParticipantIds:[],skippedCount:0}}}function y6(t){return{projectParams:"Paramtres du projet",deedDate:"Date d'acte",portageFormula:"Formule de portage",participants:"Participants"}[t]}function _6(t,e=!0,r,n){const[s,a]=k.useState("offline"),[i,l]=k.useState(!1),[c,u]=k.useState(null),[h,f]=k.useState({hasConflict:!1}),[m,p]=k.useState(null),x=k.useRef(1),g=k.useRef(!1),[y,I]=k.useState(!1),P=k.useRef([]);k.useEffect(()=>{if(!e){a("offline");return}Ev()?(a("firestore"),console.log(" Firestore sync enabled")):(a("localStorage"),console.log(" Using localStorage (Firestore not configured)"))},[e]);const A=k.useCallback(async()=>{if(s==="firestore"){const E=tr();if(E)try{const N=qt(E,"projects","shared-project"),T=await Tr(N);if(T.exists()){const S=T.data().participantsInSubcollection===!0;if(I(S),S){const se=await Tv("shared-project"),te=await bi();if(se.success&&te.success&&te.data){x.current=te.data.version,u(new Date);const me=se.participants||[];return P.current=[...me],{participants:me,projectParams:te.data.projectParams,deedDate:te.data.deedDate,portageFormula:te.data.portageFormula}}}}}catch(N){console.error("Error checking subcollection:",N)}const _=await bi();if(_.success&&_.data){x.current=_.data.version,u(new Date);const N=_.data.participants;return P.current=[...N],{participants:N,projectParams:_.data.projectParams,deedDate:_.data.deedDate,portageFormula:_.data.portageFormula}}}const w=nl();return w?{participants:w.participants,projectParams:w.projectParams,deedDate:w.deedDate,portageFormula:w.portageFormula}:null},[s]),D=k.useCallback(async(w,E,_,N,T)=>{if(g.current)return{success:!1,error:"Sauvegarde dj en cours"};g.current=!0,l(!0),p(null);try{if(cu(w,E,_,N),s==="firestore"&&t){let R=y;const S=tr();if(S)try{const ce=qt(S,"projects","shared-project"),le=await Tr(ce);if(le.exists()){const Oe=le.data().participantsInSubcollection===!0;R=Oe,Oe!==y&&(console.log(" Updating subcollection mode:",Oe),I(Oe))}}catch(ce){console.error("Error checking subcollection status:",ce)}const se=!T||T.includes("participants");if(console.log(" Granular sync check:",{participantsChanged:se,useSubcollection:R,prevParticipantsLength:P.current.length,canUseGranular:se&&R&&P.current.length>0}),se&&R&&P.current.length>0){const ce=Av(P.current,w);if(console.log(" Changed participants detected:",ce),ce.length>0){const le=t||"participant-edit",Ae=await v6(P.current,w,"shared-project",le);if(Ae.success){if(P.current=[...w],u(new Date),console.log(` Batched participant sync: ${Ae.syncedCount}/${w.length} participants updated`),Ae.syncedParticipantIds.length>0&&console.log(`   Updated participants: ${Ae.syncedParticipantIds.join(", ")}`),r){const Oe=Ae.syncedCount===1?`Participant ${Ae.syncedParticipantIds[0]}`:`${Ae.syncedCount} participants`;r(Oe,["participants"])}return{success:!0}}else console.warn(" Batched participant sync failed, falling back to full save:",Ae.error)}}if(!se&&T&&T.length>0){const ce={projectParams:E};T.includes("deedDate")&&(ce.deedDate=_),T.includes("portageFormula")&&(ce.portageFormula=N);const le=t||w&&w.length>0&&w[0].name||"participant-edit",Ae=await f6(ce,le,x.current);if(Ae.success){if(x.current+=1,u(new Date),console.log(` Granular update: ${Ae.updatedFields.join(", ")}`),r){const Oe=Ae.updatedFields.map(y6),Je=Oe.length===1?Oe[0]:Oe.join(", ");r(Je,Ae.updatedFields)}return{success:!0}}else console.warn(" Granular update failed, falling back to full save")}P.current=[...w],x.current+=1;const te=t||w&&w.length>0&&w[0].name||"participant-edit",me=await wv({participants:w,projectParams:E,deedDate:_,portageFormula:N,version:x.current},te);return me.success?(u(new Date),console.log(" Full document save"),{success:!0}):(p(me.error||"Erreur de synchronisation"),{success:!1,error:me.error})}return P.current=[...w],{success:!0}}catch(R){const S=R instanceof Error?R.message:"Erreur inconnue";return p(S),{success:!1,error:S}}finally{g.current=!1,l(!1)}},[s,t,y,r]);k.useEffect(()=>{if(!(s!=="firestore"||!e))if(y){const w=pm(_=>{if(_.source==="local"||_.isFirstLoad)return;const N=gm(x.current,_.data.version);N.hasConflict?(console.warn(" Project conflict detected:",N.message),f({hasConflict:!0,remoteData:_.data,message:N.message})):(x.current=_.data.version,u(new Date))}),E=g6("shared-project",(_,N)=>{N==="remote"&&(console.log(" Remote participant update detected"),u(new Date))});return()=>{w&&w(),E&&E()}}else{const w=pm(E=>{if(E.source==="local"||E.isFirstLoad)return;const _=gm(x.current,E.data.version);_.hasConflict?(console.warn(" Conflict detected:",_.message),f({hasConflict:!0,remoteData:E.data,message:_.message})):(x.current=E.data.version,u(new Date))});return()=>{w&&w()}}},[s,e,y]);const V=k.useCallback(async w=>{if(h.hasConflict){if(w==="cancel"){f({hasConflict:!1});return}if(w==="remote"&&h.remoteData){const{participants:E,projectParams:_,deedDate:N,portageFormula:T}=h.remoteData;cu(E,_,N,T),x.current=h.remoteData.version,f({hasConflict:!1}),u(new Date),n?n({participants:E,projectParams:_,deedDate:N,portageFormula:T}):window.location.reload()}else w==="local"&&f({hasConflict:!1})}},[h,n]),H=k.useCallback(async(w,E)=>{if(!y)return{success:!1,error:"Subcollection mode not enabled"};try{const _=await m6(w,E.toString(),"shared-project",t);return _.success&&console.log(` Saved participant ${E} to subcollection`),_}catch(_){return{success:!1,error:_ instanceof Error?_.message:"Erreur inconnue"}}},[y,t]);return{syncMode:s,isSyncing:i,lastSyncedAt:c,conflictState:h,syncError:m,useSubcollection:y,loadInitialData:A,saveData:D,saveParticipant:H,resolveConflict:V}}function w6(){const t=k.useRef({changedFields:new Set,lastSaveTimestamp:Date.now()}),e=k.useCallback(l=>{t.current.changedFields.add(l)},[]),r=k.useCallback(l=>{l.forEach(c=>t.current.changedFields.add(c))},[]),n=k.useCallback(()=>{t.current.changedFields.clear(),t.current.lastSaveTimestamp=Date.now()},[]),s=k.useCallback(()=>Array.from(t.current.changedFields),[]),a=k.useCallback(()=>t.current.changedFields.size>0,[]),i=k.useCallback(l=>t.current.changedFields.has(l),[]);return{markDirty:e,markMultipleDirty:r,clearDirty:n,getDirtyFields:s,isDirty:a,isFieldDirty:i}}const b6={heartbeatInterval:5e3,inactiveThreshold:15e3,storageKey:"credit-castor-presence"};function E6(){return`${Date.now()}-${Math.random().toString(36).substring(2,9)}`}function T6(){let t=sessionStorage.getItem("credit-castor-session-id");return t||(t=E6(),sessionStorage.setItem("credit-castor-session-id",t)),t}function Zc(t){try{const e=localStorage.getItem(t);if(!e)return{};const r=JSON.parse(e),n={};for(const[s,a]of Object.entries(r))n[s]={...a,lastSeen:new Date(a.lastSeen)};return n}catch(e){return console.error("Failed to load presence data:",e),{}}}function xm(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(r){console.error("Failed to save presence data:",r)}}function vm(t,e){const r=Date.now(),n={};for(const[s,a]of Object.entries(t))r-a.lastSeen.getTime()<e&&(n[s]=a);return n}function A6(t,e={}){const{heartbeatInterval:r,inactiveThreshold:n,storageKey:s}={...b6,...e},[a,i]=k.useState([]),l=T6(),c=k.useCallback(()=>{const h=Zc(s);h[l]={email:t,lastSeen:new Date,sessionId:l};const f=vm(h,n);xm(s,f);const m=Object.values(f).filter(p=>p.sessionId!==l);i(m)},[t,l,s,n]),u=k.useCallback(()=>{const h=Zc(s);delete h[l],xm(s,h)},[l,s]);return k.useEffect(()=>{const h=f=>{if(f.key===s&&f.newValue)try{const m=Zc(s),p=vm(m,n),x=Object.values(p).filter(g=>g.sessionId!==l);i(x)}catch(m){console.error("Error handling presence update:",m)}};return window.addEventListener("storage",h),()=>window.removeEventListener("storage",h)},[s,l,n]),k.useEffect(()=>{c();const h=setInterval(c,r);return()=>{clearInterval(h),u()}},[t,r,c,u]),{activeUsers:a,updatePresence:c,removePresence:u}}function Vo(t){if(!t)return!1;if(!t.participants||!Array.isArray(t.participants))return console.error("Schema validation failed: participants missing or invalid"),!1;if(!t.projectParams||typeof t.projectParams!="object")return console.error("Schema validation failed: projectParams missing or invalid"),!1;if(!t.deedDate||typeof t.deedDate!="string")return console.error("Schema validation failed: deedDate missing or invalid"),!1;if(!t.portageFormula||typeof t.portageFormula!="object")return console.error("Schema validation failed: portageFormula missing or invalid"),!1;for(const e of t.participants){if(!e.name||typeof e.name!="string")return console.error("Schema validation failed: participant missing name"),!1;if(e.capitalApporte===void 0||typeof e.capitalApporte!="number")return console.error("Schema validation failed: participant missing capitalApporte"),!1}return!0}function S6(){alert(` DEVELOPER ALERT

No valid data source found:
- Firestore: Not available or no data
- localStorage: Not available or schema invalid

The application cannot initialize without valid data.
Please check your Firebase configuration or clear corrupted localStorage data.`)}async function N6(t){const e=Ev();if(e){console.log(" Attempting to load from Firestore...");const n=tr();let s=!1;if(n)try{const i=qt(n,"projects","shared-project"),l=await Tr(i);l.exists()&&(s=l.data().participantsInSubcollection===!0)}catch(i){console.error("Error checking subcollection flag:",i)}if(s){console.log(" Loading from subcollection architecture...");const i=await bi(),l=await Tv("shared-project");if(i.success&&l.success&&i.data){const c={...i.data,participants:l.participants||[]};if(Vo(c)){console.log(" Loaded valid data from Firestore (subcollection)");const u=gi(c.projectParams);return{success:!0,data:{participants:c.participants,projectParams:u,deedDate:c.deedDate,portageFormula:c.portageFormula,source:"firestore",needsMigration:!1}}}}}else{const i=await bi();if(i.success&&i.data)if(Vo(i.data)){console.log(" Loaded valid data from Firestore (legacy array)");const l=gi(i.data.projectParams),c=nl(),u=c&&c.isCompatible&&Vo(c);return{success:!0,data:{participants:i.data.participants,projectParams:l,deedDate:i.data.deedDate,portageFormula:i.data.portageFormula,source:"firestore",needsMigration:!1,...u&&{localStorageData:{participants:c.participants,projectParams:c.projectParams,deedDate:c.deedDate,portageFormula:c.portageFormula}}}}}else console.error(" Firestore data failed schema validation"),alert(` DEVELOPER ALERT

Firestore data failed schema validation:
- Data structure is invalid or corrupted
- Required fields may be missing

Falling back to localStorage if available.
Please check Firestore data integrity.`)}const a=await bi();if(!a.success){if(a.errorType==="network-error")return console.error(" Network error accessing Firestore"),{success:!1,error:a.error||"Erreur rseau lors de l'accs  Firestore",errorType:"network-error",showToast:!0};console.log(" No data found in Firestore, checking localStorage...")}}console.log(" Attempting to load from localStorage...");const r=nl();if(r&&r.isCompatible)if(Vo(r)){console.log(" Loaded valid data from localStorage");const n=gi(r.projectParams);return{success:!0,data:{participants:r.participants,projectParams:n,deedDate:r.deedDate,portageFormula:r.portageFormula,source:"localStorage",needsMigration:e}}}else console.error(" localStorage data failed schema validation");else r&&!r.isCompatible?console.error(" localStorage data version incompatible"):console.log(" No data found in localStorage");return console.error(" No valid data source available"),S6(),{success:!1,error:"No valid data source available",requiresAlert:!0}}function C6({data:t,onConfirm:e,onCancel:r}){const[n,s]=k.useState(new Set(t.participants.map(f=>f.name))),a=f=>{const m=new Set(n);m.has(f)?m.delete(f):m.add(f),s(m)},i=()=>{s(new Set(t.participants.map(f=>f.name)))},l=()=>{s(new Set)},c=()=>{const f=t.participants.filter(m=>n.has(m.name));e(f)},u=t.participants.length,h=n.size;return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:f=>{f.target===f.currentTarget&&r()},children:o.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[o.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-900",children:" Migration vers Firestore"}),o.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Choisissez les participants  migrer"})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:[o.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:o.jsxs("p",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:"Note importante:"})," Seules les donnes individuelles des participants seront migres. Les paramtres communs du projet (prix d'achat, frais partags, etc.) ne seront pas inclus."]})}),o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("div",{className:"text-sm text-gray-700",children:[o.jsx("strong",{children:h})," sur ",o.jsx("strong",{children:u})," participant",u>1?"s":""," slectionn",h>1?"s":""]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:i,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Tout slectionner"}),o.jsx("span",{className:"text-gray-300",children:"|"}),o.jsx("button",{onClick:l,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Tout dslectionner"})]})]}),o.jsx("div",{className:"space-y-2",children:t.participants.map(f=>{const m=n.has(f.name);return o.jsxs("label",{className:`flex items-start gap-3 p-3 border rounded-lg cursor-pointer transition-colors ${m?"bg-blue-50 border-blue-300":"bg-white border-gray-200 hover:bg-gray-50"}`,children:[o.jsx("input",{type:"checkbox",checked:m,onChange:()=>a(f.name),className:"mt-1 w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"font-medium text-gray-900",children:f.name}),o.jsxs("div",{className:"text-sm text-gray-600 mt-1 space-y-0.5",children:[o.jsxs("div",{children:["Capital apport: ",f.capitalApporte.toLocaleString("fr-FR")," "]}),o.jsxs("div",{children:["Surface: ",f.surface," m"]}),f.isFounder&&o.jsx("div",{className:"text-xs text-green-600 font-medium",children:" Fondateur"}),!f.isFounder&&f.purchaseDetails&&o.jsxs("div",{className:"text-xs text-orange-600 font-medium",children:[" Nouvel arrivant (acquiert lot #",f.purchaseDetails.lotId,")"]})]})]})]},f.name)})})]}),o.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex items-center justify-between",children:[o.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors font-medium",children:"Annuler"}),o.jsxs("button",{onClick:c,disabled:h===0,className:`px-6 py-2 rounded-lg font-medium transition-colors ${h===0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:["Migrer ",h>0&&`(${h})`]})]})]})})}function I6({participantCount:t,onConfirm:e,onCancel:r}){const[n,s]=k.useState(!1),[a,i]=k.useState(null),l=async()=>{s(!0),i(null);try{await e()}catch(c){i(c instanceof Error?c.message:"Migration failed")}finally{s(!1)}};return o.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:o.jsxs("div",{style:{backgroundColor:"white",borderRadius:"8px",padding:"24px",maxWidth:"500px",width:"90%",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},children:[o.jsx("h2",{style:{marginTop:0,color:"#1976d2"},children:" Mise  jour de l'architecture"}),o.jsx("p",{style:{fontSize:"14px",lineHeight:"1.6"},children:"Une nouvelle version de l'application utilise une architecture amliore pour les participants."}),o.jsxs("div",{style:{backgroundColor:"#e3f2fd",padding:"16px",borderRadius:"4px",marginBottom:"16px"},children:[o.jsx("p",{style:{margin:0,fontWeight:"bold",color:"#1976d2"},children:"Avantages :"}),o.jsxs("ul",{style:{marginBottom:0,paddingLeft:"20px"},children:[o.jsx("li",{children:"Mises  jour en temps rel par participant"}),o.jsx("li",{children:"Dtection de conflits plus prcise"}),o.jsx("li",{children:"Meilleure performance"})]})]}),o.jsxs("p",{style:{fontSize:"14px",color:"#666"},children:["Cette opration va migrer ",o.jsxs("strong",{children:[t," participant(s)"]})," ","vers la nouvelle structure. Vos donnes seront prserves."]}),a&&o.jsxs("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"12px",borderRadius:"4px",marginBottom:"16px",fontSize:"14px"},children:[" Erreur : ",a]}),o.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[o.jsx("button",{onClick:r,disabled:n,style:{padding:"10px 20px",border:"1px solid #ddd",borderRadius:"4px",backgroundColor:"white",cursor:n?"not-allowed":"pointer",opacity:n?.5:1},children:"Plus tard"}),o.jsx("button",{onClick:l,disabled:n,style:{padding:"10px 20px",border:"none",borderRadius:"4px",backgroundColor:"#1976d2",color:"white",cursor:n?"not-allowed":"pointer",opacity:n?.5:1},children:n?"Migration en cours...":"Migrer maintenant"})]})]})})}const Uo={1:{casco:178080,parachevements:56e3},3:{casco:213060,parachevements:67e3},5:{casco:187620,parachevements:59e3},6:{casco:171720,parachevements:54e3}};function P6({children:t}){k.useEffect(()=>{_v()},[]);const e=xb(),{participants:r,projectParams:n,deedDate:s,portageFormula:a,pinnedParticipant:i,fullscreenParticipantIndex:l,versionMismatch:c,isInitialized:u,setParticipants:h,setProjectParams:f,setDeedDate:m,setPortageFormula:p,setFullscreenParticipantIndex:x,setVersionMismatch:g,setIsInitialized:y,handlePinParticipant:I,handleUnpinParticipant:P,participantRefs:A}=e,[D,V]=k.useState(!0),[H,w]=k.useState(null),[E,_]=k.useState(null),[N,T]=k.useState(!1),[R,S]=k.useState(!1),se=pR(),te=k.useRef(null),{unlockedBy:me,isUnlocked:ce}=ql();k.useEffect(()=>{console.log(" Unlock state:",{isUnlocked:ce,unlockedBy:me})},[ce,me]),k.useEffect(()=>{let Pe=!0;async function Fe(){try{V(!0),w(null);const Ce=await N6();if(!Pe)return;if(Ce.success&&Ce.data){const Ze=Ce.data?Ax(Ce.data.participants.map(vt=>({...vt,isFounder:vt.isFounder!==void 0?vt.isFounder:!0,entryDate:vt.entryDate||new Date(Ce.data.deedDate)}))):[],nr=Ce.data.projectParams.renovationStartDate||(()=>{const vt=new Date(Ce.data.deedDate);return vt.setFullYear(vt.getFullYear()+1),vt.toISOString().split("T")[0]})(),sr={...Ce.data.projectParams,renovationStartDate:nr};if(h(Ze),f(sr),m(Ce.data.deedDate),p(Ce.data.portageFormula),y(!0),console.log(` Data loaded from ${Ce.data.source}`),Ce.data.needsMigration&&me&&(_({participants:Ze,projectParams:Ce.data.projectParams,deedDate:Ce.data.deedDate,portageFormula:Ce.data.portageFormula}),T(!0)),Ce.data.source==="firestore"&&Ze.length>0&&me&&!sessionStorage.getItem("skipParticipantMigration")){const fr=tr();if(fr)try{const St=qt(fr,"projects","shared-project"),Zr=await Tr(St);Zr.exists()&&(Zr.data().participantsInSubcollection||S(!0))}catch(St){console.error("Error checking for subcollection migration:",St)}}}else Ce.errorType==="network-error"&&Ce.showToast?(console.error(" Network error accessing Firestore"),ir.custom(Ze=>o.jsx(ei,{title:"Firestore inaccessible",message:"Es-tu connect-e  internet ?",type:"error",onDismiss:()=>ir.dismiss(Ze.id)}),{duration:8e3,position:"top-right"}),w(Ce.error||"Network error")):(w(Ce.error||"Unknown error"),console.error(" Failed to load data:",Ce.error))}catch(Ce){if(!Pe)return;const Ze=Ce instanceof Error?Ce.message:"Unknown error";w(Ze),console.error(" Error during data initialization:",Ce)}finally{Pe&&V(!1)}}return Fe(),()=>{Pe=!1}},[]);const{markDirty:le,getDirtyFields:Ae,clearDirty:Oe}=w6(),Je=k.useRef(n);k.useEffect(()=>{u&&n!==Je.current&&(le("projectParams"),Je.current=n)},[n,u,le]);const U=k.useRef(s);k.useEffect(()=>{u&&s!==U.current&&(le("deedDate"),U.current=s)},[s,u,le]);const Y=k.useRef(a);k.useEffect(()=>{u&&a!==Y.current&&(le("portageFormula"),Y.current=a)},[a,u,le]);const q=k.useRef(r);k.useEffect(()=>{u&&r!==q.current&&(le("participants"),q.current=r)},[r,u,le]);const W=k.useCallback((Pe,Fe)=>{ir.custom(Ce=>o.jsx(ei,{title:"Synchronis",message:` ${Pe}`,type:"success",onDismiss:()=>ir.dismiss(Ce.id)}),{duration:2e3})},[]),ae=k.useCallback(Pe=>{console.log(" Accepting remote data and updating state..."),h(Pe.participants),f(Pe.projectParams),m(Pe.deedDate),p(Pe.portageFormula),ir.custom(Fe=>o.jsx(ei,{title:"Modifications acceptes",message:"Les donnes distantes ont t charges avec succs",type:"success",onDismiss:()=>ir.dismiss(Fe.id)}),{duration:3e3})},[h,f,m,p]),be=me||r&&r.length>0&&r[0].name||"participant-edit",{syncMode:ye,isSyncing:pe,lastSyncedAt:xe,conflictState:We,syncError:Ve,saveData:nt,resolveConflict:qe}=_6(be,!0,W,ae);k.useEffect(()=>{if(u&&r&&n&&s&&a){const Pe=setTimeout(async()=>{const Fe=Ae();if(Fe.length>0){console.log(" Auto-saving changes:",Fe);const Ce=await nt(r,n,s,a,Fe);Ce.success?Oe():console.error(" Auto-save failed:",Ce.error)}},500);return()=>clearTimeout(Pe)}else u||console.log(" Not saving: Data not initialized")},[r,n,s,a,nt,u,Ae,Oe]);const{activeUsers:hr}=A6(be);gR(r||[],n||Wo,s||Cs,a||zr,c.show||!u);const Xe=k.useMemo(()=>!r||!n?{totalSurface:0,pricePerM2:0,sharedCosts:0,sharedPerPerson:0,participantBreakdown:[],totals:{purchase:0,totalDroitEnregistrements:0,construction:0,shared:0,totalTravauxCommuns:0,travauxCommunsPerUnit:0,total:0,capitalTotal:0,totalLoansNeeded:0,averageLoan:0,averageCapital:0}}:Nw(r,n,Uo,s||void 0,a||void 0),[r,n,s,a,u]),Ne=()=>{if(!r||!s)return;const Pe=se.addParticipant(r,s);h(Pe),setTimeout(()=>{const Fe=r.length;A.current[Fe]?.scrollIntoView&&A.current[Fe].scrollIntoView({behavior:"smooth",block:"start"})},50)},jt=Pe=>{if(!r||r.length<=1)return;r[Pe].name===i&&P();const Fe=se.removeParticipant(r,Pe);h(Fe)},tt=(Pe,Fe)=>{if(!r)return;const Ce=[...r],Ze=Ce[Pe].name;Ce[Pe]=Fe,h(Ce),Ze===i&&Fe.name!==Ze&&I(Fe.name)},ct=(Pe,Fe)=>{if(!r)return;const Ce=r[Pe].name,Ze=se.updateParticipantName(r,Pe,Fe);h(Ze),Ce===i&&I(Fe)},dr=(Pe,Fe)=>{if(!r)return;const Ce=se.updateParticipantSurface(r,Pe,Fe);h(Ce)},On=Pe=>{if(n){if(s&&new Date(Pe)<new Date(s)){ir.custom(Fe=>o.jsx(ei,{title:"Erreur",message:"La date de dbut des rnovations ne peut pas tre avant la date de l'acte.",type:"error",onDismiss:()=>ir.dismiss(Fe.id)}),{duration:5e3});return}f({...n,renovationStartDate:Pe})}},Jr=Pe=>{if(!r||!s){if(m(Pe),!n?.renovationStartDate){const Fe=(()=>{const Ce=new Date(Pe);return Ce.setFullYear(Ce.getFullYear()+1),Ce.toISOString().split("T")[0]})();f(Ce=>Ce&&{...Ce,renovationStartDate:Fe})}return}try{const Fe=new Date(s),Ze=new Date(Pe).getTime()-Fe.getTime(),nr=r.map(sr=>{if(!sr.entryDate)return sr;const vt=new Date(sr.entryDate),fr=new Date(vt.getTime()+Ze);return{...sr,entryDate:fr}});if(n){let sr;if(n.renovationStartDate){const vt=new Date(n.renovationStartDate),fr=new Date(vt.getTime()+Ze);sr={...n,renovationStartDate:fr.toISOString().split("T")[0]}}else{const vt=(()=>{const fr=new Date(Pe);return fr.setFullYear(fr.getFullYear()+1),fr.toISOString().split("T")[0]})();sr={...n,renovationStartDate:vt}}m(Pe),h(nr),f(sr)}else m(Pe),h(nr)}catch(Fe){console.error("Error updating deed date:",Fe),ir.custom(Ce=>o.jsx(ei,{title:"Erreur",message:"Erreur de calcul avec cette date. Veuillez choisir une autre date.",type:"error",onDismiss:()=>ir.dismiss(Ce.id)}),{duration:5e3})}},rr=()=>{if(!r||!n||!s||!a)return;const Pe=new qP,Fe=kp(r,Xe,s,a,n);tT(Xe,n,Uo,Pe,void 0,{timelineSnapshots:Fe,participants:r})},xr=()=>{!r||!n||!s||!a||QP(r,n,s,a,Uo,Xe)},he=()=>{te.current?.click()},Re=JP(Pe=>{h(Pe.participants),f(Pe.projectParams),Pe.deedDate&&m(Pe.deedDate),p(Pe.portageFormula),y(!0),alert("Scnario charg avec succs!")},Pe=>{alert(Pe)}),ue=()=>{confirm("tes-vous sr de vouloir rinitialiser compltement? Toutes les donnes seront perdues.")&&(pb(),h(Fp),f(Wo),m(Cs),p(zr),y(!0),alert("Donnes rinitialises aux valeurs par dfaut."))},ke=async Pe=>{if(!me||!E)return;console.log(" Migrating selected participants to Firestore...");const Fe=await wv({participants:Pe,projectParams:E.projectParams,deedDate:E.deedDate,portageFormula:E.portageFormula,version:1},me);T(!1),_(null),Fe.success?alert(` Migration russie! ${Pe.length} participant(s) migr(s) vers Firestore.`):alert(" chec de la migration: "+Fe.error)},He=()=>{T(!1),_(null)},wt=async()=>{if(!me)return;console.log(" Migrating participants to subcollection...");const Pe=await p6("shared-project",me);S(!1),Pe.success?(alert(` Migration russie! ${Pe.migratedCount} participant(s) migr(s).`),window.location.reload()):alert(" chec de la migration: "+Pe.error)},yt=()=>{S(!1),sessionStorage.setItem("skipParticipantMigration","true")},vr={state:{participants:r||[],projectParams:n||Wo,deedDate:s||Cs,portageFormula:a||zr,pinnedParticipant:i,fullscreenParticipantIndex:l,versionMismatch:c,syncMode:ye,isSyncing:pe,lastSyncedAt:xe,conflictState:We,syncError:Ve,activeUsers:hr,calculations:Xe,unitDetails:Uo},actions:{addParticipant:Ne,removeParticipant:jt,updateParticipant:tt,updateParticipantName:ct,updateParticipantSurface:dr,setParticipants:h,setProjectParams:f,setDeedDate:m,handleDeedDateChange:Jr,handleRenovationStartDateChange:On,setPortageFormula:p,setFullscreenParticipantIndex:x,setVersionMismatch:g,handlePinParticipant:I,handleUnpinParticipant:P,downloadScenario:xr,loadScenario:he,resetToDefaults:ue,exportToExcel:rr,resolveConflict:qe}};return D?o.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontSize:"18px",color:"#666"},children:o.jsxs("div",{children:[o.jsx("div",{style:{marginBottom:"10px"},children:" Chargement des donnes..."}),o.jsx("div",{style:{fontSize:"14px",color:"#999"},children:"Vrification Firestore  localStorage"})]})}):H?o.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontSize:"18px",color:"#d32f2f"},children:o.jsxs("div",{children:[o.jsx("div",{style:{marginBottom:"10px"},children:" Erreur de chargement"}),o.jsx("div",{style:{fontSize:"14px",color:"#666"},children:H}),o.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"20px",padding:"10px 20px",fontSize:"14px",cursor:"pointer"},children:"Recharger la page"})]})}):o.jsxs(Wp.Provider,{value:vr,children:[t,o.jsx("input",{ref:te,type:"file",accept:".json",style:{display:"none"},onChange:Re}),N&&E&&o.jsx(C6,{data:E,onConfirm:ke,onCancel:He}),R&&o.jsx(I6,{participantCount:r?.length||0,onConfirm:wt,onCancel:yt})]})}async function Sv(t){try{const e=tr();if(!e)return!1;const r=qt(e,"projects",t),n=await Tr(r);return n.exists()?n.data().participantsInSubcollection===!0:!1}catch(e){return console.error("Error checking migration status:",e),!1}}async function R6(t,e){try{const r=tr();if(!r)return{success:!1,error:"Firebase not configured"};if(console.log(" Starting subcollection migration for project:",t),await Sv(t))return console.log(" Project already migrated to subcollections"),{success:!0,alreadyMigrated:!0,migratedCount:0};const s=qt(r,"projects",t),a=await Tr(s);if(!a.exists())return{success:!1,error:"Project document does not exist"};const l=a.data().participants;if(!l||!Array.isArray(l))return{success:!1,error:"No participants array found in project document"};console.log(` Found ${l.length} participants to migrate`);const c=dd(r),u=new Date().toISOString();for(let h=0;h<l.length;h++){const f=l[h],m=h.toString(),p=qt(r,"projects",t,"participants",m),x={...f,lastModifiedBy:e,lastModifiedAt:u,version:1,serverTimestamp:Vs(),displayOrder:h,enabled:f.enabled??!0};c.set(p,x)}return c.set(s,{participantsInSubcollection:!0,participants:[],lastModifiedBy:e,lastModifiedAt:u,migrationTimestamp:u},{merge:!0}),await c.commit(),console.log(` Successfully migrated ${l.length} participants to subcollections`),{success:!0,migratedCount:l.length,alreadyMigrated:!1}}catch(r){return console.error(" Error during subcollection migration:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error during migration"}}}async function D6(t,e){try{const r=tr();if(!r)return{valid:!1,error:"Firebase not configured"};const n=qt(r,"projects",t),s=await Tr(n);if(!s.exists())return{valid:!1,error:"Project document does not exist"};const a=s.data();if(a.participantsInSubcollection!==!0)return{valid:!1,error:"participantsInSubcollection flag not set"};if(a.participants&&a.participants.length>0)return{valid:!1,error:"participants array not cleared"};const i=Array.from({length:e},(c,u)=>u.toString());let l=0;for(const c of i){const u=qt(r,"projects",t,"participants",c);(await Tr(u)).exists()&&l++}return l!==e?{valid:!1,error:`Expected ${e} participants, found ${l}`,actualCount:l}:{valid:!0,actualCount:l}}catch(r){return console.error("Error validating migration:",r),{valid:!1,error:r instanceof Error?r.message:"Unknown validation error"}}}const F6={async checkMigration(t="shared-project"){console.log(` Checking migration status for project: ${t}`);const e=await Sv(t);return console.log(e?" Project is already migrated to subcollections":"  Project is NOT migrated (still using legacy array)"),e},async runMigration(t,e="shared-project"){console.log(` Starting migration for project: ${e}`),console.log(`   User: ${t}`);const r=await R6(e,t);if(r.success)r.alreadyMigrated?console.log(" Project already migrated"):(console.log(" Migration complete!"),console.log(`   Migrated ${r.migratedCount} participants to subcollections`),console.log("   Reload the page to see granular participant updates in action"));else throw console.error(" Migration failed:",r.error),new Error(r.error)},async validateMigration(t,e="shared-project"){console.log(` Validating migration for project: ${e}`),console.log(`   Expected participant count: ${t}`);const r=await D6(e,t);return r.valid?(console.log(" Migration validation passed"),console.log(`   Found ${r.actualCount} participants in subcollections`)):(console.error(" Migration validation failed:",r.error),r.actualCount!==void 0&&console.error(`   Expected ${t}, found ${r.actualCount}`)),r.valid}};typeof window<"u"&&(window.creditCastor={...window.creditCastor,...F6});function L6(){const[t,e]=k.useState(!1);return k.useEffect(()=>{localStorage.getItem("authenticated")==="true"&&e(!0)},[]),t?o.jsx(xp,{children:o.jsx(P6,{children:o.jsx(XE,{})})}):o.jsx(QE,{onUnlock:()=>e(!0)})}export{L6 as default};
