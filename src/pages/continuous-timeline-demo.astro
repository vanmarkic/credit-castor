---
/**
 * Continuous Timeline Demo Page
 *
 * Demonstrates the complete continuous timeline feature with:
 * - Timeline visualization from deed date
 * - Participant cash flows
 * - Copropriété panel
 */

import ContinuousTimelineView from '../components/ContinuousTimelineView';
import type { DomainEvent, InitialPurchaseEvent, Lot } from '../types/timeline';
import type { Participant } from '../utils/calculatorUtils';
import '../components/index.css';

// ============================================
// Mock Data Setup
// ============================================

const DEED_DATE = new Date('2026-02-01');

// Create mock lots
function createLot(lotId: number, isPortage: boolean): Lot {
  return {
    lotId,
    surface: 85,
    unitId: 101,
    isPortage,
    acquiredDate: DEED_DATE,
    originalPrice: 170000,
    originalNotaryFees: 21250,
    monthlyCarryingCost: isPortage ? 500 : undefined,
  };
}

// Create mock participants
const alice: Participant = {
  name: 'Alice',
  isFounder: true,
  entryDate: DEED_DATE,
  lotsOwned: [createLot(1, false)],
  capitalApporte: 50000,
  notaryFeesRate: 0.125,
  interestRate: 0.04,
  durationYears: 20,
};

const bob: Participant = {
  name: 'Bob',
  isFounder: true,
  entryDate: DEED_DATE,
  lotsOwned: [createLot(2, false), createLot(3, true)],
  capitalApporte: 120000,
  notaryFeesRate: 0.125,
  interestRate: 0.04,
  durationYears: 20,
};

const charlie: Participant = {
  name: 'Charlie',
  isFounder: true,
  entryDate: DEED_DATE,
  lotsOwned: [createLot(4, false)],
  capitalApporte: 60000,
  notaryFeesRate: 0.125,
  interestRate: 0.04,
  durationYears: 20,
};

// Create initial purchase event
const initialEvent: InitialPurchaseEvent = {
  id: 'evt-001',
  date: DEED_DATE,
  type: 'INITIAL_PURCHASE',
  participants: [alice, bob, charlie],
  projectParams: {
    totalPurchase: 680000,
    mesuresConservatoires: 20000,
    demolition: 40000,
    infrastructures: 90000,
    etudesPreparatoires: 59820,
    fraisEtudesPreparatoires: 27320,
    fraisGeneraux3ans: 0,
    batimentFondationConservatoire: 43700,
    batimentFondationComplete: 269200,
    batimentCoproConservatoire: 56000,
    globalCascoPerM2: 1590,
  },
  scenario: {
    constructionCostChange: 0,
    infrastructureReduction: 0,
    purchasePriceReduction: 0,
  },
  copropropriete: {
    name: 'Les Acacias',
    hiddenLots: [10, 11],
  },
};

const events: DomainEvent[] = [initialEvent];
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Continuous Timeline Demo - Credit Castor</title>
  </head>
  <body>
    <ContinuousTimelineView client:load events={events} />
  </body>
</html>
